{"ast":null,"code":"import SquadChatCommunicator from \"./SquadChatCommunicator\";\nimport API from \"@digivox/apicommunicator\";\nimport PresenceStatus from \"../enuns/PresenceStatus\";\nimport UserType from \"../enuns/UserType\";\nimport short from \"short-uuid\";\nimport { Events } from \"./chat/types/types\";\nimport ChatType from \"../enuns/ChatType\";\nimport { getAttachmentType } from \"./utils/parseUtils\";\nexport class SquadCommunicator {\n  constructor(chatCommunicatorSubscribe) {\n    this.chatCommunicatorSubscribe = (event, data) => {\n      var _this$contacts$get;\n\n      switch (event) {\n        case Events.MESSAGE:\n          const senderId = data.fromUser.split(\"@\")[0];\n          data.userName = (_this$contacts$get = this.contacts.get(senderId)) === null || _this$contacts$get === void 0 ? void 0 : _this$contacts$get.name;\n          this.interfaceChatCommunicatorSubscribe(event, data);\n          break;\n\n        default:\n          this.interfaceChatCommunicatorSubscribe(event, data);\n      }\n    };\n\n    this.createGroup = (group, callback) => {\n      if (!this.api) return;\n      const contactsId = group.contacts.map(contact => contact.id);\n      const body = {\n        name: group.name,\n        description: group.description,\n        members: contactsId,\n        domain: this.settings.sipDomain\n      };\n      this.api.createGroup({\n        body\n      }, (returnGroup, err) => {\n        if (err) return;\n        if (!this.api) return;\n        if (!returnGroup) return;\n        this.api.getGroup(returnGroup.id, {\n          paramsUrl: {\n            members: true\n          }\n        }, groupWithMember => {\n          const parsedGroup = this.parseGroup(groupWithMember);\n          this.groups.set(parsedGroup.groupId, parsedGroup);\n          callback(parsedGroup);\n        });\n      });\n    };\n\n    this.getMessages = (chat, callback) => {\n      if (!this.api) return;\n      const lastMessageId = chat.messages[0].id;\n      this.api.getMessages(chat.id, chat.chatType, {\n        paramsUrl: {\n          startingByMessageId: lastMessageId\n        }\n      }, data => {\n        if (data) callback(data.messages.map(msg => this.parseMessage(msg)));else return;\n      });\n    };\n\n    this.sendMessage = (chat, text) => {\n      var _this$chat;\n\n      (_this$chat = this.chat) === null || _this$chat === void 0 ? void 0 : _this$chat.sendMessage(chat, text);\n    };\n\n    this.getAttachments = (chat, callback) => {\n      if (!this.api) return;\n      const paramsUrl = {\n        kind: chat.chatType === ChatType.USER ? \"chat\" : \"group\",\n        src: `${this.getAuthorization().user_name}@${this.settings.xmppDomain}`,\n        dst: chat.jid\n      };\n      this.api.getAttachments({\n        paramsUrl\n      }, attachments => {\n        if (attachments === null || attachments === void 0 ? void 0 : attachments.attachments) {\n          const parsedAttachments = attachments === null || attachments === void 0 ? void 0 : attachments.attachments.map(attachment => {\n            const booleans = getAttachmentType(attachment.fileExtension);\n            return {\n              name: attachment.fileName,\n              // size: \"any\",\n              thumbnail: \"default\",\n              ...booleans\n            };\n          });\n          callback(parsedAttachments);\n        }\n      });\n    };\n\n    this.parseToIChat = (chat, arr) => {\n      const chatUser = this.groups.get(chat.id) || this.contacts.get(chat.id);\n\n      if (chatUser) {\n        const chatMessage = chat.messages[0];\n        const iChat = {\n          id: chat.id,\n          jid: chatUser.jid,\n          name: chat.name,\n          profilePicture: chatUser.profilePicture,\n          status: \"status\" in chatUser ? chatUser.status : undefined,\n          unRead: chat.unreadMessages,\n          chatType: chat.chatType,\n          isTyping: false,\n          messages: [this.parseMessage(chatMessage)]\n        };\n        arr.push(iChat);\n      }\n    };\n\n    this.parseGroup = apiGroup => {\n      return {\n        groupId: apiGroup.id,\n        name: apiGroup.name,\n        description: apiGroup.description,\n        jid: `${apiGroup.id}@${apiGroup.domainName}`,\n        profilePicture: apiGroup.imageUrl,\n        members: apiGroup.members.map(member => {\n          return {\n            userId: member.id,\n            name: member.name,\n            profilePicture: member.imageUrl,\n            role: member.admin ? UserType.ADMIN : UserType.USER,\n            status: PresenceStatus.ONLINE\n          };\n        })\n      };\n    };\n\n    this.parseContact = apiContact => {\n      return {\n        id: apiContact.id,\n        jid: apiContact.imId,\n        name: apiContact.name,\n        domain: apiContact.domainName,\n        number: apiContact.extension,\n        profilePicture: apiContact.imageUrl,\n        email: apiContact.email,\n        blocked: apiContact.blocked,\n        added: apiContact.added,\n        status: PresenceStatus.ONLINE,\n        favorite: apiContact.favorite\n      };\n    };\n\n    this.interfaceChatCommunicatorSubscribe = chatCommunicatorSubscribe;\n    this.contacts = new Map();\n    this.groups = new Map();\n    this.makeAPI();\n  }\n\n  static getInstance(chatCommunicatorSubscribe) {\n    if (!this.instance) {\n      this.instance = new SquadCommunicator(chatCommunicatorSubscribe);\n      return this.instance;\n    }\n  } // -- Make Services --\n\n\n  makeAPI() {\n    const authorization = this.getAuthorization();\n\n    if (authorization) {\n      const api = new API({\n        token: authorization.access_token,\n        apiUrl: authorization.baseUrl\n      });\n      this.api = api;\n      this.getSettings(settings => {\n        this.settings = settings;\n        this.makeChat();\n      });\n    }\n  }\n\n  makeChat() {\n    return new SquadChatCommunicator({\n      service: `wss://${this.settings.xmppDomain}:5280/websocket`,\n      domain: this.settings.xmppDomain,\n      username: this.settings.xmppUser,\n      password: this.settings.xmppPw,\n      resource: `squad.web_${short().generate()}`\n    }, this.chatCommunicatorSubscribe);\n  } // -- END --\n  // -- Subscribe Intercept --\n\n\n  // END\n  // User\n  getAuthorization() {\n    const Auth = localStorage.getItem(\"authorization\");\n    if (Auth) return JSON.parse(Auth);\n    return {};\n  }\n\n  getUser(callback) {\n    if (!this.api) return;\n    const Auth = this.getAuthorization();\n    this.getSettings(settings => {\n      callback({\n        id: settings.xmppUser,\n        jid: `${settings.xmppUser}@${settings.xmppDomain}`,\n        name: Auth.user_name,\n        email: Auth.email,\n        profilePicture: settings.imageUrl,\n        number: settings.sipUser.replace(\"w-\", \"\").replace(\"s-\", \"\")\n      });\n    });\n  } // -- END --\n  // -- Settings --\n\n\n  getSettings(callback) {\n    if (!this.api) return;\n    this.api.getSettings({}, (settings, error) => {\n      if (error) throw error;\n      if (settings) callback(settings);\n    });\n  } // -- Contacts --\n\n\n  getContacts(callback) {\n    callback(Array.from(this.contacts.values()));\n  }\n\n  getFavorites(callback) {\n    const contacts = Array.from(this.contacts.values()).filter(contact => contact.favorite);\n    callback(contacts);\n  } // -- END --\n  // -- Groups --\n\n\n  getGroups(callback) {\n    callback(Array.from(this.groups.values()));\n  }\n\n  // -- END --\n  // -- Chats --\n  getChats(callback) {\n    if (!this.api) return;\n    this.api.getSettings({}, (settings, error) => {\n      if (settings) this.settings = settings;\n      if (this.api) this.api.getContacts({\n        paramsUrl: {\n          added: true,\n          limit: 5000,\n          contactType: \"contact\"\n        }\n      }, (apiContacts, err) => {\n        // Populando o Map de contatos\n        if (!err) {\n          if (!this.api) return;\n          this.populateContacts(apiContacts);\n          this.api.getGroups({\n            paramsUrl: {\n              members: true\n            }\n          }, (apiGroups, err) => {\n            // Populando o Map de grupos\n            if (!err) {\n              if (!this.api) return;\n              this.api.getChats({\n                paramsUrl: {\n                  limit: 5000,\n                  contactType: \"contact\"\n                }\n              }, apiChats => {\n                //Retornando os Chats\n                if (!this.api) {\n                  return;\n                }\n\n                this.populateGroups(apiGroups);\n                const returnChats = [];\n                apiChats.chats.forEach(chat => {\n                  this.parseToIChat(chat, returnChats);\n                });\n                callback(returnChats);\n              });\n            }\n          });\n        }\n      });\n    });\n  } // -- Messages --\n\n\n  parseMessage(chatMessage) {\n    const msg = {\n      id: chatMessage.idXmpp,\n      userName: this.getContactName(chatMessage),\n      message: chatMessage.message,\n      time: chatMessage.sentAt,\n      isImageMessage: chatMessage.isImage,\n      isFileMessage: chatMessage.isFile,\n      isVideoMessage: chatMessage.isVideo,\n      isAudioMessage: chatMessage.isAudio,\n      fileUrl: chatMessage.message,\n      toUser: chatMessage.to,\n      fromUser: chatMessage.from,\n      deliverStatus: chatMessage.deliveryStatus,\n      readStatus: chatMessage.readStatus,\n      deliverTimestamp: chatMessage.deliveryTimestamp || \"\",\n      readTimestamp: chatMessage.readTimestamp || \"\",\n      content: chatMessage.content,\n      contentType: chatMessage.contentType\n    };\n    return msg;\n  }\n\n  getContactName(chatMessage) {\n    var _this$contacts$get2, _this$contacts$get3;\n\n    return chatMessage.fromName || ((_this$contacts$get2 = this.contacts.get(chatMessage.from)) === null || _this$contacts$get2 === void 0 ? void 0 : _this$contacts$get2.name) || ((_this$contacts$get3 = this.contacts.get(chatMessage.to)) === null || _this$contacts$get3 === void 0 ? void 0 : _this$contacts$get3.name) || this.getAuthorization().user_name || \"\";\n  }\n\n  // -- END --\n  // -- Populate --\n  populateGroups(apiGroups) {\n    apiGroups.groups.forEach(group => {\n      this.groups.set(group.id, this.parseGroup(group));\n    });\n  }\n\n  populateContacts(apiContacts) {\n    apiContacts.contacts.forEach(contact => {\n      this.contacts.set(contact.id, this.parseContact(contact));\n    });\n  } // -- END --\n\n\n}\nSquadCommunicator.instance = void 0;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/SquadCommunicatorService.ts"],"names":["SquadChatCommunicator","API","PresenceStatus","UserType","short","Events","ChatType","getAttachmentType","SquadCommunicator","constructor","chatCommunicatorSubscribe","event","data","MESSAGE","senderId","fromUser","split","userName","contacts","get","name","interfaceChatCommunicatorSubscribe","createGroup","group","callback","api","contactsId","map","contact","id","body","description","members","domain","settings","sipDomain","returnGroup","err","getGroup","paramsUrl","groupWithMember","parsedGroup","parseGroup","groups","set","groupId","getMessages","chat","lastMessageId","messages","chatType","startingByMessageId","msg","parseMessage","sendMessage","text","getAttachments","kind","USER","src","getAuthorization","user_name","xmppDomain","dst","jid","attachments","parsedAttachments","attachment","booleans","fileExtension","fileName","thumbnail","parseToIChat","arr","chatUser","chatMessage","iChat","profilePicture","status","undefined","unRead","unreadMessages","isTyping","push","apiGroup","domainName","imageUrl","member","userId","role","admin","ADMIN","ONLINE","parseContact","apiContact","imId","number","extension","email","blocked","added","favorite","Map","makeAPI","getInstance","instance","authorization","token","access_token","apiUrl","baseUrl","getSettings","makeChat","service","username","xmppUser","password","xmppPw","resource","generate","Auth","localStorage","getItem","JSON","parse","getUser","sipUser","replace","error","getContacts","Array","from","values","getFavorites","filter","getGroups","getChats","limit","contactType","apiContacts","populateContacts","apiGroups","apiChats","populateGroups","returnChats","chats","forEach","idXmpp","getContactName","message","time","sentAt","isImageMessage","isImage","isFileMessage","isFile","isVideoMessage","isVideo","isAudioMessage","isAudio","fileUrl","toUser","to","deliverStatus","deliveryStatus","readStatus","deliverTimestamp","deliveryTimestamp","readTimestamp","content","contentType","fromName"],"mappings":"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","sourcesContent":["import SquadChatCommunicator from \"./SquadChatCommunicator\";\r\nimport API from \"@digivox/apicommunicator\";\r\nimport IChat from \"../alias/IChat\";\r\nimport IContact from \"../alias/IContact\";\r\nimport PresenceStatus from \"../enuns/PresenceStatus\";\r\nimport IGroup from \"../alias/IGroup\";\r\nimport UserType from \"../enuns/UserType\";\r\nimport IUser from \"../alias/IUser\";\r\nimport INewGroup from \"../alias/INewGroup\";\r\nimport IAttachedFiles from \"../alias/IAttachedFiles\";\r\nimport {\r\n  Message,\r\n  Settings,\r\n} from \"@digivox/apicommunicator/dist/types/types/types\";\r\nimport IMessage from \"../alias/IMessage\";\r\nimport short from \"short-uuid\";\r\nimport { SubscriptionCallBack } from \"./types\";\r\nimport { Events } from \"./chat/types/types\";\r\nimport ChatType from \"../enuns/ChatType\";\r\nimport { getAttachmentType } from \"./utils/parseUtils\";\r\n\r\ninterface GetAttachmentsCallback {\r\n  (attachment: IAttachedFiles[]): void;\r\n}\r\ninterface GetSettingsCallback {\r\n  (settings: Settings): void;\r\n}\r\ninterface NewGroupCallback {\r\n  (group: IGroup): void;\r\n}\r\ninterface GetUserCallBack {\r\n  (user: IUser): void;\r\n}\r\ninterface ContactsCallBack {\r\n  (contacts: IContact[]): void;\r\n}\r\ninterface FavoritesCallBack {\r\n  (favorites: IContact[]): void;\r\n}\r\ninterface GroupsCallBack {\r\n  (groups: IGroup[]): void;\r\n}\r\n\r\ninterface ChatsCallBack {\r\n  (chats: IChat[]): void;\r\n}\r\ninterface GetMessagesCallback {\r\n  (messages: IMessage[]): void;\r\n}\r\n\r\ninterface AuthReturn {\r\n  access_token: string;\r\n  user_id: string;\r\n  user_name: string;\r\n  expires_in: number;\r\n  baseUrl: string;\r\n}\r\nexport interface SquadCommunicator {\r\n  interfaceChatCommunicatorSubscribe: SubscriptionCallBack;\r\n  getInstance(): SquadCommunicator;\r\n  api: API | undefined;\r\n  chat: SquadChatCommunicator | undefined;\r\n  getChats(callback: ChatsCallBack): void;\r\n  getAuthorization(): AuthReturn;\r\n  contacts: Map<string, IContact>;\r\n  groups: Map<string, IGroup>;\r\n  settings: Settings;\r\n}\r\nexport class SquadCommunicator {\r\n  private static instance: SquadCommunicator | undefined;\r\n  constructor(chatCommunicatorSubscribe: SubscriptionCallBack) {\r\n    this.interfaceChatCommunicatorSubscribe = chatCommunicatorSubscribe;\r\n    this.contacts = new Map<string, IContact>();\r\n    this.groups = new Map<string, IGroup>();\r\n    this.makeAPI();\r\n  }\r\n  static getInstance(chatCommunicatorSubscribe: SubscriptionCallBack) {\r\n    if (!this.instance) {\r\n      this.instance = new SquadCommunicator(chatCommunicatorSubscribe);\r\n\r\n      return this.instance;\r\n    }\r\n  }\r\n  // -- Make Services --\r\n  makeAPI() {\r\n    const authorization = this.getAuthorization();\r\n    if (authorization) {\r\n      const api = new API({\r\n        token: authorization.access_token,\r\n        apiUrl: authorization.baseUrl,\r\n      });\r\n      this.api = api;\r\n      this.getSettings((settings) => {\r\n        this.settings = settings;\r\n        this.makeChat();\r\n      });\r\n    }\r\n  }\r\n  makeChat() {\r\n    return new SquadChatCommunicator(\r\n      {\r\n        service: `wss://${this.settings.xmppDomain}:5280/websocket`,\r\n        domain: this.settings.xmppDomain,\r\n        username: this.settings.xmppUser,\r\n        password: this.settings.xmppPw,\r\n        resource: `squad.web_${short().generate()}`,\r\n      },\r\n      this.chatCommunicatorSubscribe\r\n    );\r\n  }\r\n  // -- END --\r\n  // -- Subscribe Intercept --\r\n  chatCommunicatorSubscribe = (event: string, data: any) => {\r\n    switch (event) {\r\n      case Events.MESSAGE:\r\n        const senderId = data.fromUser.split(\"@\")[0];\r\n        data.userName = this.contacts.get(senderId)?.name;\r\n        this.interfaceChatCommunicatorSubscribe(event, data);\r\n        break;\r\n      default:\r\n        this.interfaceChatCommunicatorSubscribe(event, data);\r\n    }\r\n  };\r\n  // END\r\n  // User\r\n  getAuthorization() {\r\n    const Auth = localStorage.getItem(\"authorization\");\r\n    if (Auth) return JSON.parse(Auth);\r\n    return {};\r\n  }\r\n  getUser(callback: GetUserCallBack) {\r\n    if (!this.api) return;\r\n    const Auth = this.getAuthorization();\r\n    this.getSettings((settings) => {\r\n      callback({\r\n        id: settings.xmppUser,\r\n        jid: `${settings.xmppUser}@${settings.xmppDomain}`,\r\n        name: Auth.user_name,\r\n        email: Auth.email,\r\n        profilePicture: settings.imageUrl,\r\n        number: settings.sipUser.replace(\"w-\", \"\").replace(\"s-\", \"\"),\r\n      });\r\n    });\r\n  }\r\n  // -- END --\r\n  // -- Settings --\r\n  getSettings(callback: GetSettingsCallback) {\r\n    if (!this.api) return;\r\n    this.api.getSettings({}, (settings, error) => {\r\n      if (error) throw error;\r\n      if (settings) callback(settings);\r\n    });\r\n  }\r\n  // -- Contacts --\r\n  getContacts(callback: ContactsCallBack) {\r\n    callback(Array.from(this.contacts.values()));\r\n  }\r\n  getFavorites(callback: FavoritesCallBack) {\r\n    const contacts = Array.from(this.contacts.values()).filter(\r\n      (contact) => contact.favorite\r\n    );\r\n    callback(contacts);\r\n  }\r\n  // -- END --\r\n  // -- Groups --\r\n  getGroups(callback: GroupsCallBack) {\r\n    callback(Array.from(this.groups.values()));\r\n  }\r\n  createGroup = (group: INewGroup, callback: NewGroupCallback) => {\r\n    if (!this.api) return;\r\n    const contactsId = group.contacts.map((contact) => contact.id);\r\n    const body = {\r\n      name: group.name,\r\n      description: group.description,\r\n      members: contactsId,\r\n      domain: this.settings.sipDomain,\r\n    };\r\n    this.api.createGroup({ body }, (returnGroup, err) => {\r\n      if (err) return;\r\n      if (!this.api) return;\r\n      if (!returnGroup) return;\r\n      this.api.getGroup(\r\n        returnGroup.id,\r\n        { paramsUrl: { members: true } },\r\n        (groupWithMember) => {\r\n          const parsedGroup = this.parseGroup(groupWithMember);\r\n          this.groups.set(parsedGroup.groupId, parsedGroup);\r\n          callback(parsedGroup);\r\n        }\r\n      );\r\n    });\r\n  };\r\n  // -- END --\r\n  // -- Chats --\r\n  getChats(callback: ChatsCallBack) {\r\n    if (!this.api) return;\r\n    this.api.getSettings({}, (settings, error) => {\r\n      if (settings) this.settings = settings;\r\n      if (this.api)\r\n        this.api.getContacts(\r\n          { paramsUrl: { added: true, limit: 5000, contactType: \"contact\" } },\r\n          (apiContacts: any, err: any) => {\r\n            // Populando o Map de contatos\r\n            if (!err) {\r\n              if (!this.api) return;\r\n              this.populateContacts(apiContacts);\r\n              this.api.getGroups(\r\n                { paramsUrl: { members: true } },\r\n                (apiGroups: any, err) => {\r\n                  // Populando o Map de grupos\r\n                  if (!err) {\r\n                    if (!this.api) return;\r\n                    this.api.getChats(\r\n                      { paramsUrl: { limit: 5000, contactType: \"contact\" } },\r\n                      (apiChats: any) => {\r\n                        //Retornando os Chats\r\n                        if (!this.api) {\r\n                          return;\r\n                        }\r\n                        this.populateGroups(apiGroups);\r\n                        const returnChats: IChat[] = [];\r\n                        apiChats.chats.forEach((chat: any) => {\r\n                          this.parseToIChat(chat, returnChats);\r\n                        });\r\n                        callback(returnChats);\r\n                      }\r\n                    );\r\n                  }\r\n                }\r\n              );\r\n            }\r\n          }\r\n        );\r\n    });\r\n  }\r\n  // -- Messages --\r\n  getMessages = (chat: IChat, callback: GetMessagesCallback) => {\r\n    if (!this.api) return;\r\n    const lastMessageId = chat.messages[0].id;\r\n    this.api.getMessages(\r\n      chat.id,\r\n      chat.chatType,\r\n      { paramsUrl: { startingByMessageId: lastMessageId } },\r\n      (data) => {\r\n        if (data) callback(data.messages.map((msg) => this.parseMessage(msg)));\r\n        else return;\r\n      }\r\n    );\r\n  };\r\n  sendMessage = (chat: IChat, text: string) => {\r\n    this.chat?.sendMessage(chat, text);\r\n  };\r\n  // -- END --\r\n  // -- Attachments --\r\n  getAttachments = (chat: IChat, callback: GetAttachmentsCallback) => {\r\n    if (!this.api) return;\r\n    const paramsUrl = {\r\n      kind: chat.chatType === ChatType.USER ? \"chat\" : \"group\",\r\n      src: `${this.getAuthorization().user_name}@${this.settings.xmppDomain}`,\r\n      dst: chat.jid,\r\n    };\r\n    this.api.getAttachments({ paramsUrl }, (attachments) => {\r\n      if (attachments?.attachments) {\r\n        const parsedAttachments: IAttachedFiles[] = attachments?.attachments.map(\r\n          (attachment) => {\r\n            const booleans = getAttachmentType(attachment.fileExtension);\r\n            return {\r\n              name: attachment.fileName,\r\n              // size: \"any\",\r\n              thumbnail: \"default\",\r\n              ...booleans,\r\n            };\r\n          }\r\n        );\r\n        callback(parsedAttachments);\r\n      }\r\n    });\r\n  };\r\n  // -- END --\r\n  // -- Parse Functions --\r\n  parseToIChat = (chat: any, arr: IChat[]) => {\r\n    const chatUser = this.groups.get(chat.id) || this.contacts.get(chat.id);\r\n    if (chatUser) {\r\n      const chatMessage = chat.messages[0];\r\n      const iChat: IChat = {\r\n        id: chat.id,\r\n        jid: chatUser.jid,\r\n        name: chat.name,\r\n        profilePicture: chatUser.profilePicture,\r\n        status:\r\n          \"status\" in chatUser ? (chatUser as IContact).status : undefined,\r\n        unRead: chat.unreadMessages,\r\n        chatType: chat.chatType,\r\n        isTyping: false,\r\n        messages: [this.parseMessage(chatMessage)],\r\n      };\r\n      arr.push(iChat);\r\n    }\r\n  };\r\n  parseMessage(chatMessage: Message) {\r\n    const msg: IMessage = {\r\n      id: chatMessage.idXmpp,\r\n      userName: this.getContactName(chatMessage),\r\n      message: chatMessage.message,\r\n      time: chatMessage.sentAt,\r\n      isImageMessage: chatMessage.isImage,\r\n      isFileMessage: chatMessage.isFile,\r\n      isVideoMessage: chatMessage.isVideo,\r\n      isAudioMessage: chatMessage.isAudio,\r\n      fileUrl: chatMessage.message,\r\n      toUser: chatMessage.to,\r\n      fromUser: chatMessage.from,\r\n      deliverStatus: chatMessage.deliveryStatus,\r\n      readStatus: chatMessage.readStatus,\r\n      deliverTimestamp: chatMessage.deliveryTimestamp || \"\",\r\n      readTimestamp: chatMessage.readTimestamp || \"\",\r\n      content: chatMessage.content,\r\n      contentType: chatMessage.contentType,\r\n    };\r\n    return msg;\r\n  }\r\n  getContactName(chatMessage: Message) {\r\n    return (\r\n      chatMessage.fromName ||\r\n      this.contacts.get(chatMessage.from)?.name ||\r\n      this.contacts.get(chatMessage.to)?.name ||\r\n      this.getAuthorization().user_name ||\r\n      \"\"\r\n    );\r\n  }\r\n  parseGroup = (apiGroup: any) => {\r\n    return {\r\n      groupId: apiGroup.id,\r\n      name: apiGroup.name,\r\n      description: apiGroup.description,\r\n      jid: `${apiGroup.id}@${apiGroup.domainName}`,\r\n      profilePicture: apiGroup.imageUrl,\r\n      members: apiGroup.members.map((member: any) => {\r\n        return {\r\n          userId: member.id,\r\n          name: member.name,\r\n          profilePicture: member.imageUrl,\r\n          role: member.admin ? UserType.ADMIN : UserType.USER,\r\n          status: PresenceStatus.ONLINE,\r\n        };\r\n      }),\r\n    };\r\n  };\r\n  parseContact = (apiContact: any) => {\r\n    return {\r\n      id: apiContact.id,\r\n      jid: apiContact.imId,\r\n      name: apiContact.name,\r\n      domain: apiContact.domainName,\r\n      number: apiContact.extension,\r\n      profilePicture: apiContact.imageUrl,\r\n      email: apiContact.email,\r\n      blocked: apiContact.blocked,\r\n      added: apiContact.added,\r\n      status: PresenceStatus.ONLINE,\r\n      favorite: apiContact.favorite,\r\n    };\r\n  };\r\n  // -- END --\r\n  // -- Populate --\r\n  populateGroups(apiGroups: any) {\r\n    apiGroups.groups.forEach((group: any) => {\r\n      this.groups.set(group.id, this.parseGroup(group));\r\n    });\r\n  }\r\n  populateContacts(apiContacts: any) {\r\n    apiContacts.contacts.forEach((contact: any) => {\r\n      this.contacts.set(contact.id, this.parseContact(contact));\r\n    });\r\n  }\r\n  // -- END --\r\n}\r\n"]},"metadata":{},"sourceType":"module"}