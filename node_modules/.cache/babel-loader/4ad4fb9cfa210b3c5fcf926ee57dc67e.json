{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import React,{useEffect}from\"react\";import{SquadCommunicator as SquadService}from\"./SquadCommunicatorService\";import{useChat}from\"../contexts/ChatContext\";import{useAuth}from\"../contexts/AuthContext\";import{Events}from\"./chat/types/types\";import ChatType from\"./../enuns/ChatType\";import DeliverStatus from\"../enuns/DeliverStatus\";import{ChatType as XMPPChatType}from\"./chat/types/types\";import{getFileName,getUrlBooleans,isUrl}from\"./utils/parseUtils\";import ReadStatus from\"../enuns/ReadStatus\";import{useGroup}from\"../contexts/GroupContext\";import{useContact}from\"../contexts/ContactContext\";import{useModal}from\"../contexts/ModalContext\";import UserType from\"../enuns/UserType\";import{useConference}from\"../contexts/ConferenceContext\";import moment from\"moment\";import{ConferenceRoomParticipantType}from\"./business/Conferences\";import PresenceStatus from\"../enuns/PresenceStatus\";import{DateTime}from\"luxon\";import{useLoading}from\"../contexts/LoadingContext\";// import { activeChat as actChtData } from \"../data/chat\";\n//import { callbackify } from \"util\";\n// import IContact from \"../alias/IContact\";\n//Comentar para Evitar Warnings no console\nvar squadService;var typingTimeout=new Map();var SquadCommunicator=function SquadCommunicator(){var _squadService64;var _useChat=useChat(),chats=_useChat.chats,setChats=_useChat.setChats,activeChat=_useChat.activeChat,replyMsg=_useChat.replyMsg,setReplyMsg=_useChat.setReplyMsg,setActiveChat=_useChat.setActiveChat,forwardMessageList=_useChat.forwardMessageList,setForwardMessageList=_useChat.setForwardMessageList,setShowChat=_useChat.setShowChat,showChatProfileSidebar=_useChat.showChatProfileSidebar,setFavoriteMessagePayload=_useChat.setFavoriteMessagePayload,favoriteMessagePayload=_useChat.favoriteMessagePayload,flagToLoadFavoriteMessages=_useChat.flagToLoadFavoriteMessages,setFlagToLoadFavoriteMessages=_useChat.setFlagToLoadFavoriteMessages,setFavoriteMessages=_useChat.setFavoriteMessages,deleteFavoriteMessage=_useChat.deleteFavoriteMessage,setDeleteFavoriteMessage=_useChat.setDeleteFavoriteMessage;var _useContact=useContact(),contactsSearch=_useContact.contactsSearch,setContactsSearched=_useContact.setContactsSearched,newFavorite=_useContact.newFavorite,setNewFavorite=_useContact.setNewFavorite,contacts=_useContact.contacts,setContacts=_useContact.setContacts,setContactsOutsideUserContacts=_useContact.setContactsOutsideUserContacts,toggleAddingContacts=_useContact.toggleAddingContacts,setToggleAddingContacts=_useContact.setToggleAddingContacts,checkedContacts=_useContact.checkedContacts,setCheckedContacts=_useContact.setCheckedContacts,removedContact=_useContact.removedContact,setRemovedContact=_useContact.setRemovedContact,checkedMembers=_useContact.checkedMembers,setCheckedMembers=_useContact.setCheckedMembers,groupToInsertMember=_useContact.groupToInsertMember,setGroupToInsertMember=_useContact.setGroupToInsertMember,clickedContact=_useContact.clickedContact,setClickedContact=_useContact.setClickedContact;var _useAuth=useAuth(),user=_useAuth.user,setUser=_useAuth.setUser,changedUserData=_useAuth.changedUserData,changedUserPassword=_useAuth.changedUserPassword,setChangedUserPassword=_useAuth.setChangedUserPassword;var _useModal=useModal(),showModalForwardMessageTo=_useModal.showModalForwardMessageTo,setShowModalForwardMessageTo=_useModal.setShowModalForwardMessageTo,showModalAddContact=_useModal.showModalAddContact;var _useLoading=useLoading(),setDisconnected=_useLoading.setDisconnected;var _useGroup=useGroup(),setGroups=_useGroup.setGroups,groups=_useGroup.groups,memberQuit=_useGroup.memberQuit,groupIdOfLeaveRequest=_useGroup.groupIdOfLeaveRequest,setGroupIdOfLeaveRequest=_useGroup.setGroupIdOfLeaveRequest,setMemberQuit=_useGroup.setMemberQuit,groupToRemoveContact=_useGroup.groupToRemoveContact,setGroupToRemoveContact=_useGroup.setGroupToRemoveContact,removedMember=_useGroup.removedMember,setRemovedMember=_useGroup.setRemovedMember,toggleMemberRole=_useGroup.toggleMemberRole,setToggleMemberRole=_useGroup.setToggleMemberRole,changeGroupData=_useGroup.changeGroupData,setChangeGroupData=_useGroup.setChangeGroupData,groupToCreate=_useGroup.groupToCreate,setGroupToCreate=_useGroup.setGroupToCreate,groupJid=_useGroup.groupJid,setGroupJid=_useGroup.setGroupJid;var _useConference=useConference(),listRooms=_useConference.listRooms,setListRooms=_useConference.setListRooms,setConferenceList=_useConference.setConferenceList,setCreateConference=_useConference.setCreateConference,createConference=_useConference.createConference;var init=function init(){var _squadService;// localStorage.setItem(\n//   \"authorization\",\n//   JSON.stringify({\n//     access_token: \"71e1503a96d94e1e231444bc5c0399ca\",\n//     user_id: \"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",\n//     user_name: \"ZZ Romero 2\",\n//     expires_in: 2592000,\n//     email: \"romero2@digivox.com.br\",\n//     baseUrl: \"https://app.citrussquad.com/api/v1/\",\n//   })\n// );\nsquadService=SquadService.getInstance({chatCommunicatorSubscribe:chatCommunicatorSubscribe});(_squadService=squadService)===null||_squadService===void 0?void 0:_squadService.user.get(function(user){setUser(user);//Ao iniciar o website\nNotification.requestPermission();});};var clearSendFile=function clearSendFile(chatId,messageId){setChats(chats.map(function(chat){if(chat.id===chatId){chat.messages=chat.messages.map(function(message){if(message.id===messageId){message.deliverStatus=DeliverStatus.QUEUED;message.sendFile=undefined;}return message;});}return chat;}));};var onChatsChange=function onChatsChange(){// chats.forEach((chat) => {\n// });\n};var onActiveChatChange=function onActiveChatChange(){checkSendMessage(activeChat);checkAttachedFiles(activeChat);checkNewContact(activeChat);// checkTyping(activeChat)\n};// const checkTyping = (chat: IChat) => {\n//   const oldTimeoutData = typingTimeout.get(chat.jid)\n//   if (chat.inputMessage !== \"\" && (!oldTimeoutData || (oldTimeoutData.msgStr !== chat.inputMessage))) {\n//     if (oldTimeoutData)\n//       clearTimeout(oldTimeoutData.timeout)\n//     else\n//       squadService?.chat?.chat.sendTyping(chat.jid)\n//     const timeoutData = {\n//       timeout: setTimeout(() => { squadService?.chat?.chat.sendActive(chat.jid); typingTimeout.delete(chat.jid) }, 3000),\n//       msgStr: `${chat.inputMessage}`\n//     }\n//     typingTimeout.set(chat.jid, timeoutData)\n//   }\n// }\nvar checkNewContact=function checkNewContact(cht){if(!cht.added){var _squadService2;(_squadService2=squadService)===null||_squadService2===void 0?void 0:_squadService2.contacts.add(cht,function(success){if(success){var _squadService3;setChats(chats.map(function(chat){if(chat.jid===cht.jid){chat.added=true;}if(activeChat.jid===chat.jid)setActiveChat(chat);return chat;}));(_squadService3=squadService)===null||_squadService3===void 0?void 0:_squadService3.contacts.list(function(ctcs){setContacts(ctcs);});}});}};var checkAttachedFiles=function checkAttachedFiles(cht){if(cht.attachedFileList&&!cht.attachedFileList[0]){var _squadService4;(_squadService4=squadService)===null||_squadService4===void 0?void 0:_squadService4.attachments.list(cht,function(attachments){if(attachments.length>0){setActiveChat(_objectSpread(_objectSpread({},cht),{},{attachedFileList:attachments}));}else setActiveChat(_objectSpread(_objectSpread({},cht),{},{attachedFileList:null}));});}};/* getMessageUserProfilePicture = (msg: Message | FileMessage) => {\r\n    if (msg.from.includes(\"@conference.\")) {\r\n      const groups = this.groups.getGroups();\r\n      const group = groups.get(msg.from.split(\"@\")[0]);\r\n      const member = group?.members.filter(\r\n        (member) => member.userId === msg.from.split(\"/\")[1]\r\n      )[0];\r\n      return member?.profilePicture;\r\n    } else {\r\n      return this.contacts.getContacts().get(msg.from.split(\"@\")[0])\r\n        ?.profilePicture;\r\n    }\r\n  }; */var checkSearchMessages=function checkSearchMessages(){if(activeChat.messageLoaded){var _squadService5;(_squadService5=squadService)===null||_squadService5===void 0?void 0:_squadService5.messages.list(activeChat,function(messages){if(messages.length){setChats(chats.map(function(cht){if(cht.id===activeChat.id){messages.forEach(function(msg){if(!activeChat.messages.find(function(m){return m.id===msg.id;}))cht.messages.unshift(msg);});cht.messageLoaded=false;setActiveChat(cht);}return cht;}));}else{var chat=_objectSpread(_objectSpread({},activeChat),{},{messageLoaded:false});setActiveChat(chat);}});}};var getFileExtension=function getFileExtension(url){return url.split(\".\")[1];};var checkSendMessage=function checkSendMessage(chat){chat.messages.forEach(function(msg){if(msg.deliverStatus===DeliverStatus.SENDING){if(msg.sendFile&&!replyMsg){var _squadService6,_squadService6$chat;var files=[msg.sendFile];clearSendFile(chat.id,msg.id);(_squadService6=squadService)===null||_squadService6===void 0?void 0:(_squadService6$chat=_squadService6.chat)===null||_squadService6$chat===void 0?void 0:_squadService6$chat.sendFiles(chat,files,function(data){var _squadService7,_squadService7$user$u,_squadService8,_squadService$user$us;updateMessageFiles(data,chat,msg);console.log(\"jidFromUser:\",(_squadService7=squadService)===null||_squadService7===void 0?void 0:(_squadService7$user$u=_squadService7.user.user)===null||_squadService7$user$u===void 0?void 0:_squadService7$user$u.jid);(_squadService8=squadService)===null||_squadService8===void 0?void 0:_squadService8.attachments.saveData({createdAt:DateTime.local().toISO().split(\"T\").join(\" \").slice(0,18),src:(_squadService$user$us=squadService.user.user)===null||_squadService$user$us===void 0?void 0:_squadService$user$us.jid,dst:chat.jid,fileExtension:getFileExtension(getFileName(data.url)),fileName:getFileName(data.url),fileUrl:data.url,kind:chat.chatType},function(){return true;});});}else{if(!msg.isForwardMessage&&!replyMsg){sendMessage(chat,msg.message,function(msgId){return updateMessage(msgId,chat,msg);});}else if(replyMsg){var _squadService9,_squadService9$chat;var replyMsgCopy=_objectSpread({},replyMsg);setReplyMsg(undefined);(_squadService9=squadService)===null||_squadService9===void 0?void 0:(_squadService9$chat=_squadService9.chat)===null||_squadService9$chat===void 0?void 0:_squadService9$chat.replyMsg(chat,msg,replyMsgCopy,function(msgId){updateMessage(msgId,chat,msg,replyMsgCopy);});}}}});};var updateMessageFiles=function updateMessageFiles(data,chat,msg){var newChat=_objectSpread({},chat);newChat.messages=chat.messages.map(function(message){if(msg.id===message.id){var booleans=getUrlBooleans(data.url);message.id=data.msgId;message.fileUrl=data.url;message.deliverStatus=DeliverStatus.QUEUED;message.time=new Date().toISOString();message.message=getFileName(data.url);message.isFileMessage=booleans.isFileMessage;message.isImageMessage=booleans.isImageMessage;message.isVideoMessage=booleans.isVideoMessage;message.isAudioMessage=booleans.isAudioMessage;}return message;});setActiveChat(newChat);if(!chats.filter(function(cht){return cht.id===chat.id;})[0]){var newChats=[chat].concat(_toConsumableArray(chats));setChats(newChats);}else{var _newChats=[];chats.forEach(function(cht){if(cht.id===chat.id){cht.messages=newChat.messages;_newChats.unshift(cht);}else{_newChats.push(cht);}});setChats(_newChats);}};var updateMessage=function updateMessage(msgId,chat,msg){var replyedMsg=arguments.length>3&&arguments[3]!==undefined?arguments[3]:undefined;var newChat=_objectSpread({},chat);newChat.messages=chat.messages.map(function(message){if(msg.id===message.id){message.id=msgId;message.deliverStatus=DeliverStatus.QUEUED;message.time=new Date().toISOString();if(replyedMsg){var _squadService10,_squadService10$conta,_squadService11,_squadService11$user,_squadService11$user$,_squadService12,_squadService12$user,_squadService12$user$;message.isReplyMessage=true;message.replyedMessage=replyedMsg.message||replyedMsg.fileUrl;message.replyedMessageId=replyedMsg.id;message.replyedMessageTo=((_squadService10=squadService)===null||_squadService10===void 0?void 0:(_squadService10$conta=_squadService10.contacts.getContacts().get(replyedMsg.fromUser.split(\"@\")[0]))===null||_squadService10$conta===void 0?void 0:_squadService10$conta.name)||((_squadService11=squadService)===null||_squadService11===void 0?void 0:(_squadService11$user=_squadService11.user)===null||_squadService11$user===void 0?void 0:(_squadService11$user$=_squadService11$user.user)===null||_squadService11$user$===void 0?void 0:_squadService11$user$.id)===replyedMsg.fromUser.split(\"@\")[0]?(_squadService12=squadService)===null||_squadService12===void 0?void 0:(_squadService12$user=_squadService12.user)===null||_squadService12$user===void 0?void 0:(_squadService12$user$=_squadService12$user.user)===null||_squadService12$user$===void 0?void 0:_squadService12$user$.name:\"Participant\";}if(isUrl(message.message)){var booleans=getUrlBooleans(message.message);message.isFileMessage=booleans.isFileMessage;message.isImageMessage=booleans.isImageMessage;message.isAudioMessage=booleans.isAudioMessage;message.isVideoMessage=booleans.isVideoMessage;message.fileUrl=message.message;}}return message;});if(activeChat.jid===newChat.jid)setActiveChat(newChat);if(!chats.filter(function(cht){return cht.id===chat.id;})[0]){var newChats=[chat].concat(_toConsumableArray(chats));setChats(newChats);}else{var _newChats2=[];chats.forEach(function(cht){if(cht.id===chat.id){cht.messages=newChat.messages;_newChats2.unshift(cht);}else{_newChats2.push(cht);}});setChats(_newChats2);}};var forwardMessage=function forwardMessage(){if(forwardMessageList&&showModalForwardMessageTo){var ctcs=_toConsumableArray(forwardMessageList);var message=_objectSpread({},showModalForwardMessageTo);setForwardMessageList(undefined);setShowModalForwardMessageTo(undefined);var chatsFinded=[];var oldChats=_toConsumableArray(chats.map(function(chat){return _objectSpread({},chat);}));ctcs===null||ctcs===void 0?void 0:ctcs.forEach(function(ctc,i){var cht=oldChats.find(function(cht){return cht.jid===ctc.jid;});if(cht){var _squadService13,_squadService13$chat;var msg=_objectSpread(_objectSpread({},message),{},{id:\"\".concat(cht.messages.length+1),userName:user.name,fromUser:user.id,toUser:ctc.jid.split(\"@\")[0],message:message.fileUrl||message.message,deliverStatus:DeliverStatus.QUEUED,isForwardMessage:true});(_squadService13=squadService)===null||_squadService13===void 0?void 0:(_squadService13$chat=_squadService13.chat)===null||_squadService13$chat===void 0?void 0:_squadService13$chat.forwardMessage(cht,msg,function(msgId){msg.id=msgId;cht.messages.push(msg);chatsFinded.push(cht);});}});var newChats=oldChats.map(function(chat){return chatsFinded.find(function(cht){return cht.id===chat.id;})||chat;});var ctcsNotInChat=ctcs.filter(function(ctc){return!newChats.find(function(cht){return ctc.jid===cht.jid;});});ctcsNotInChat.forEach(function(ctc,i){var _squadService14,_squadService14$chat;var chat={id:ctc.jid.split(\"@\")[0],jid:ctc.jid,name:ctc.name,profilePicture:ctc.profilePicture,status:ctc.status||undefined,unRead:0,chatType:ctc.jid.includes(\"@conference.\")?ChatType.GROUP:ChatType.USER,inputMessage:\"\",messageLoaded:false,isTyping:false,messages:[],email:ctc.email||undefined,favorite:ctc.favorite,added:ctc.added};var newMessage=_objectSpread(_objectSpread({},message),{},{id:\"\".concat(1),userName:user.name,fromUser:user.id,toUser:ctc.jid.split(\"@\")[0],deliverStatus:DeliverStatus.QUEUED,isForwardMessage:true});(_squadService14=squadService)===null||_squadService14===void 0?void 0:(_squadService14$chat=_squadService14.chat)===null||_squadService14$chat===void 0?void 0:_squadService14$chat.forwardMessage(chat,newMessage,function(msgId){newMessage.id=msgId;chat.messages.push(newMessage);newChats.unshift(chat);});});setChats(newChats);}};var onChangeStatus=function onChangeStatus(){var _squadService15,_squadService15$chat,_squadService15$chat$,_squadService15$chat$2;if(((_squadService15=squadService)===null||_squadService15===void 0?void 0:(_squadService15$chat=_squadService15.chat)===null||_squadService15$chat===void 0?void 0:(_squadService15$chat$=_squadService15$chat.chat)===null||_squadService15$chat$===void 0?void 0:(_squadService15$chat$2=_squadService15$chat$.client)===null||_squadService15$chat$2===void 0?void 0:_squadService15$chat$2.status)===\"online\"){var _squadService16,_squadService16$chat;(_squadService16=squadService)===null||_squadService16===void 0?void 0:(_squadService16$chat=_squadService16.chat)===null||_squadService16$chat===void 0?void 0:_squadService16$chat.changeStatus(user.status);}};var onSearchContacts=function onSearchContacts(){if(contactsSearch.length>2){var _squadService17;(_squadService17=squadService)===null||_squadService17===void 0?void 0:_squadService17.contacts.search(contactsSearch,function(searchList){setContactsSearched(searchList);});}else{setContactsSearched(undefined);}};var onSearchContactsOutsideUserContacts=function onSearchContactsOutsideUserContacts(){var _squadService18;(_squadService18=squadService)===null||_squadService18===void 0?void 0:_squadService18.contacts.getContactsOutsideUserLists(function(contacts){if(contacts){setContactsOutsideUserContacts(contacts);}});};var onToggleSidebarMenu=function onToggleSidebarMenu(){var _squadService19;(_squadService19=squadService)===null||_squadService19===void 0?void 0:_squadService19.contacts.getContactsOutsideUserLists(function(contacts){if(contacts){setContactsOutsideUserContacts(contacts);}});};var onRemovingMember=function onRemovingMember(){if(removedMember&&groupToRemoveContact){var _squadService20;var group=groups.find(function(grp){return grp.groupId===groupToRemoveContact;});if(group)(_squadService20=squadService)===null||_squadService20===void 0?void 0:_squadService20.groups.removeMember(group.groupId,removedMember,function(success){if(success){setGroups(groups.map(function(grp){if(grp.groupId===(group===null||group===void 0?void 0:group.groupId))grp.members=grp.members.filter(function(mb){return mb.userId!==removedMember.userId;});return grp;}));setChats(chats.map(function(cht){if(cht.groupId===(group===null||group===void 0?void 0:group.groupId)){var _cht$members;cht.members=(_cht$members=cht.members)===null||_cht$members===void 0?void 0:_cht$members.filter(function(mb){return mb.userId!==removedMember.userId;});if(cht.groupId===activeChat.groupId)setActiveChat(cht);}return cht;}));if(group){var _squadService21,_squadService21$chat;(_squadService21=squadService)===null||_squadService21===void 0?void 0:(_squadService21$chat=_squadService21.chat)===null||_squadService21$chat===void 0?void 0:_squadService21$chat.chat.sendEvent(group===null||group===void 0?void 0:group.jid,removedMember.userId,\"6\");}setRemovedMember(undefined);setGroupToRemoveContact(undefined);}});}};var onLeavingGroup=function onLeavingGroup(){if(memberQuit&&groupIdOfLeaveRequest&&groupJid){var _squadService22;(_squadService22=squadService)===null||_squadService22===void 0?void 0:_squadService22.groups.leftingGroup({groupId:groupIdOfLeaveRequest,memberId:memberQuit.userId},function(success){if(success){var _squadService23,_squadService23$chat,_squadService24,_squadService24$chat;(_squadService23=squadService)===null||_squadService23===void 0?void 0:(_squadService23$chat=_squadService23.chat)===null||_squadService23$chat===void 0?void 0:_squadService23$chat.chat.sendPresence(PresenceStatus.UNAVAILABLE,\"\".concat(groupJid,\"/\").concat(memberQuit.userId));(_squadService24=squadService)===null||_squadService24===void 0?void 0:(_squadService24$chat=_squadService24.chat)===null||_squadService24$chat===void 0?void 0:_squadService24$chat.chat.sendEvent(groupIdOfLeaveRequest,memberQuit.userId,\"3\",undefined);setChats(chats.filter(function(cht){return cht.groupId!==groupIdOfLeaveRequest;}));setGroups(groups.filter(function(grp){return grp.groupId!==groupIdOfLeaveRequest;}));if(activeChat.groupId===groupIdOfLeaveRequest){setShowChat(false);}}setGroupJid(undefined);setMemberQuit(undefined);setGroupIdOfLeaveRequest(\"\");});}};var showNotification=function showNotification(name){if(Notification.permission===\"granted\"){new Notification(\"Nova mensagem\",{body:name,icon:require(\"../assets/images/logo.png\"),silent:true});}else{Notification.requestPermission();}};var onFavoriteMessage=function onFavoriteMessage(){if(favoriteMessagePayload){var _squadService25;(_squadService25=squadService)===null||_squadService25===void 0?void 0:_squadService25.messages.save(favoriteMessagePayload,function(success){if(success){setFavoriteMessagePayload(undefined);setFlagToLoadFavoriteMessages({contactType:favoriteMessagePayload.contactType});}});}};var onAddingMembers=function onAddingMembers(){var asynchronousFlag=0;if(checkedMembers&&groupToInsertMember){var copiaCheckedMembers=_toConsumableArray(checkedMembers),copiaGroupToInsertMember=_objectSpread({},groupToInsertMember);copiaCheckedMembers.forEach(function(ctt){var _squadService26;(_squadService26=squadService)===null||_squadService26===void 0?void 0:_squadService26.groups.addMember(copiaGroupToInsertMember,ctt,function(success){if(success){var _squadService27,_squadService27$chat;(_squadService27=squadService)===null||_squadService27===void 0?void 0:(_squadService27$chat=_squadService27.chat)===null||_squadService27$chat===void 0?void 0:_squadService27$chat.chat.sendEvent(copiaGroupToInsertMember.jid,ctt.id,\"2\");asynchronousFlag++;if(copiaCheckedMembers.length===asynchronousFlag){var _squadService28;(_squadService28=squadService)===null||_squadService28===void 0?void 0:_squadService28.groups.list(function(grps){setGroups(grps);setChats(chats.map(function(cht){if(cht.groupId===copiaGroupToInsertMember.groupId){var foundedGroup=grps.find(function(grp){return grp.groupId===cht.groupId;});cht.members=foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.members;if(activeChat.groupId===cht.groupId){activeChat.members=foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.members;setActiveChat(activeChat);}}return cht;}));});}}});});setCheckedMembers([]);setToggleAddingContacts(false);setGroupToInsertMember(undefined);}};var onAddingContacts=function onAddingContacts(){var asynchronousFlag=0;if(checkedContacts&&toggleAddingContacts){checkedContacts.forEach(function(ctt){if(!ctt.added){var _squadService29;(_squadService29=squadService)===null||_squadService29===void 0?void 0:_squadService29.contacts.addContacts(ctt,function(success){if(success){asynchronousFlag++;if(checkedContacts.length===asynchronousFlag){var _squadService30;(_squadService30=squadService)===null||_squadService30===void 0?void 0:_squadService30.contacts.list(function(contacts){setContacts(contacts);setCheckedContacts([]);setToggleAddingContacts(false);});}}});}});}};var onAddingContactOnGroupList=function onAddingContactOnGroupList(){if(clickedContact){if(!clickedContact.added){var _squadService31;(_squadService31=squadService)===null||_squadService31===void 0?void 0:_squadService31.contacts.addContacts(clickedContact,function(success){if(success){var _squadService32;(_squadService32=squadService)===null||_squadService32===void 0?void 0:_squadService32.contacts.list(function(contacts){setContacts(contacts);setClickedContact(undefined);});}});}}};var onToggleMemberRole=function onToggleMemberRole(){if(toggleMemberRole){var _squadService33;(_squadService33=squadService)===null||_squadService33===void 0?void 0:_squadService33.groups.list(function(grps){grps.forEach(function(gp){if(gp.groupId===toggleMemberRole.gpId){gp.members.forEach(function(mb){if(mb.userId===toggleMemberRole.mbId){var _squadService34;(_squadService34=squadService)===null||_squadService34===void 0?void 0:_squadService34.contacts.toggleMemberRole(toggleMemberRole.mbId,toggleMemberRole.gpId,toggleMemberRole.mbRole,function(success){if(success){var newRole=toggleMemberRole.mbRole===UserType.USER?UserType.ADMIN:UserType.USER;setToggleMemberRole(undefined);setChats(chats.map(function(cht){if(cht.groupId===toggleMemberRole.gpId){var _cht$members2;cht.members=(_cht$members2=cht.members)===null||_cht$members2===void 0?void 0:_cht$members2.map(function(mb){if(mb.userId===toggleMemberRole.mbId){mb.role=newRole;if(cht.groupId){if(mb.role===UserType.ADMIN){var _squadService35,_squadService35$chat;(_squadService35=squadService)===null||_squadService35===void 0?void 0:(_squadService35$chat=_squadService35.chat)===null||_squadService35$chat===void 0?void 0:_squadService35$chat.chat.sendEvent(cht.groupId,mb.userId,\"8\");}else{var _squadService36,_squadService36$chat;(_squadService36=squadService)===null||_squadService36===void 0?void 0:(_squadService36$chat=_squadService36.chat)===null||_squadService36$chat===void 0?void 0:_squadService36$chat.chat.sendEvent(cht.groupId,mb.userId,\"9\");}}}return mb;});if(activeChat.groupId===cht.groupId)setActiveChat(cht);}return cht;}));setGroups(groups.map(function(grp){if(grp.groupId===toggleMemberRole.gpId){grp.members=grp.members.map(function(member){if(member.userId===toggleMemberRole.mbId)member.role=newRole;return member;});}return grp;}));}});}});}});});}};var onChangeGroupData=function onChangeGroupData(){if(changeGroupData){var _squadService37;(_squadService37=squadService)===null||_squadService37===void 0?void 0:_squadService37.groups.editGroupInfo({groupId:changeGroupData.groupId,groupName:changeGroupData.groupName,members:changeGroupData.members,description:changeGroupData.description},function(success){if(success){var _squadService38;(_squadService38=squadService)===null||_squadService38===void 0?void 0:_squadService38.groups.list(function(grps){var _squadService39,_squadService39$chat;var foundedGroup=grps.find(function(grp){return grp.groupId===changeGroupData.groupId;});setGroups(grps);setChats(chats.map(function(cht){if(cht.groupId===changeGroupData.groupId){if(foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.name){cht.name=foundedGroup.name;}if(activeChat.groupId===cht.groupId){if(foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.name){cht.name=foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.name;}setActiveChat(cht);}}return cht;}));(_squadService39=squadService)===null||_squadService39===void 0?void 0:(_squadService39$chat=_squadService39.chat)===null||_squadService39$chat===void 0?void 0:_squadService39$chat.chat.sendEvent(foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.jid,undefined,\"10\",undefined);setChangeGroupData(undefined);});}});}};var createGroup=function createGroup(){var _squadService40;(_squadService40=squadService)===null||_squadService40===void 0?void 0:_squadService40.groups.create(groupToCreate,function(parsedGroup){if(parsedGroup){var _squadService41,_squadService41$chat,_squadService42,_squadService43,_squadService43$chat;(_squadService41=squadService)===null||_squadService41===void 0?void 0:(_squadService41$chat=_squadService41.chat)===null||_squadService41$chat===void 0?void 0:_squadService41$chat.chat.sendEvent(parsedGroup.jid,parsedGroup.jid,\"1\");(_squadService42=squadService)===null||_squadService42===void 0?void 0:_squadService42.groups.list(function(groups){setGroups(groups);setGroupToCreate(undefined);});(_squadService43=squadService)===null||_squadService43===void 0?void 0:(_squadService43$chat=_squadService43.chat)===null||_squadService43$chat===void 0?void 0:_squadService43$chat.chat.sendEvent(parsedGroup.jid,undefined,\"1\",undefined);}});};var onListRooms=function onListRooms(){if(listRooms){var _squadService44;(_squadService44=squadService)===null||_squadService44===void 0?void 0:_squadService44.conferences.list(function(conferences){var _squadService45,_squadService45$chat;setConferenceList(conferences);(_squadService45=squadService)===null||_squadService45===void 0?void 0:(_squadService45$chat=_squadService45.chat)===null||_squadService45$chat===void 0?void 0:_squadService45$chat.joinGroups(conferences.map(function(conf){return conf.jid;}));});setListRooms(false);}};var onCreateRoom=function onCreateRoom(){if(createConference){var _squadService46;var momentStartDate=moment(\"\".concat(createConference.startDate,\" \").concat(createConference.startTime,\":00\"));var momentFinalDate=moment(momentStartDate).add(createConference.duration.split(\":\")[0],\"hours\").add(createConference.duration.split(\":\")[1],\"minutes\");var parsedConference={name:createConference.name,waitMod:createConference.mdCheck,startDatetime:\"\".concat(momentStartDate.format(\"DD-MM-YYYY hh:mm:ss\")),stopDatetime:\"\".concat(momentFinalDate.format(\"DD-MM-YYYY hh:mm:ss\"))};(_squadService46=squadService)===null||_squadService46===void 0?void 0:_squadService46.conferences.create(parsedConference,function(createdConference){var participantList=[];if(createdConference===null||createdConference===void 0?void 0:createdConference.id){var _createConference$sel,_createConference$ema,_squadService47;(_createConference$sel=createConference.selectedContact)===null||_createConference$sel===void 0?void 0:_createConference$sel.forEach(function(ctc){participantList.push({userUuid:ctc.id,description:\"\",email:ctc.email,name:ctc.name,type:ConferenceRoomParticipantType.PARTICIPANT,userModerator:false});});(_createConference$ema=createConference.emailList)===null||_createConference$ema===void 0?void 0:_createConference$ema.forEach(function(participant){participantList.push({userUuid:null,description:\"\",email:participant.email,name:participant.name,type:ConferenceRoomParticipantType.PARTICIPANT_EXTERNAL,userModerator:false});});(_squadService47=squadService)===null||_squadService47===void 0?void 0:_squadService47.conferences.addParticipants(createdConference.id,participantList,function(s){if(s){setCreateConference(undefined);setListRooms(true);}});}});}};useEffect(onChatsChange,[chats]);useEffect(onNewFavorite,[newFavorite]);useEffect(checkSearchMessages,[activeChat.messageLoaded]);useEffect(onActiveChatChange,[activeChat]);useEffect(onUserDataChange,[changedUserData]);useEffect(onUserPasswordChange,[changedUserPassword]);useEffect(onChangeStatus,[user.status]);useEffect(forwardMessage,[forwardMessageList]);useEffect(onSearchContacts,[contactsSearch]);useEffect(onSearchContactsOutsideUserContacts,[showModalAddContact]);useEffect(onAddingContacts,[toggleAddingContacts]);useEffect(onRemovingMember,[removedMember,groupToRemoveContact]);useEffect(onLeavingGroup,[memberQuit,groupIdOfLeaveRequest,groupJid]);useEffect(onRemovingContact,[removedContact]);useEffect(onAddingMembers,[groupToInsertMember,checkedMembers]);useEffect(onToggleMemberRole,[toggleMemberRole]);useEffect(onChangeGroupData,[changeGroupData]);useEffect(onAddingContactOnGroupList,[clickedContact]);useEffect(createGroup,[groupToCreate]);useEffect(onToggleSidebarMenu,[showChatProfileSidebar]);useEffect(onListRooms,[listRooms]);useEffect(onCreateRoom,[createConference]);useEffect(onFavoriteMessage,[favoriteMessagePayload]);useEffect(onListFavoriteMessages,[flagToLoadFavoriteMessages]);useEffect(onRemoveFavoriteMessage,[deleteFavoriteMessage]);function onRemoveFavoriteMessage(){var _squadService48;(_squadService48=squadService)===null||_squadService48===void 0?void 0:_squadService48.messages.deleteFavorite({messageId:deleteFavoriteMessage===null||deleteFavoriteMessage===void 0?void 0:deleteFavoriteMessage.messageId},function(success){if(success){setFlagToLoadFavoriteMessages({contactType:deleteFavoriteMessage===null||deleteFavoriteMessage===void 0?void 0:deleteFavoriteMessage.contactType});setDeleteFavoriteMessage(undefined);}});}function onListFavoriteMessages(){if(flagToLoadFavoriteMessages){var _squadService49;(_squadService49=squadService)===null||_squadService49===void 0?void 0:_squadService49.messages.listFavorites({contactTo:\"\",contactType:flagToLoadFavoriteMessages.contactType,content:\"\",contentType:\"\",messageDate:\"\",messageId:\"\",message:\"\"},function(success){if(success){setFavoriteMessages(success.messages.map(function(item){return item;}));setFlagToLoadFavoriteMessages(undefined);}});}}function onRemovingContact(){if(removedContact){contacts.forEach(function(ctc){if(ctc.id===removedContact.id){var _squadService50;if(ctc.added)(_squadService50=squadService)===null||_squadService50===void 0?void 0:_squadService50.contacts.remove(ctc,function(success){if(success){var _squadService51;(_squadService51=squadService)===null||_squadService51===void 0?void 0:_squadService51.contacts.list(function(ctcs){setContacts(ctcs);setRemovedContact(undefined);});}});}});}}function onUserPasswordChange(){if(changedUserPassword){var _squadService52;(_squadService52=squadService)===null||_squadService52===void 0?void 0:_squadService52.user.changePassword(changedUserPassword,function(password){if(password){setChangedUserPassword({oldPassword:\"\",newPassword:\"\"});}});}}function onUserDataChange(){if(changedUserData){var _squadService53;(_squadService53=squadService)===null||_squadService53===void 0?void 0:_squadService53.user.changeUserData(changedUserData,function(chgd){if(chgd){setUser(_objectSpread(_objectSpread({},user),{},{email:changedUserData.email,name:changedUserData.name}));}});}}function onNewFavorite(){if(newFavorite){var _squadService54;var newFavoriteLoad=_objectSpread({},newFavorite);(_squadService54=squadService)===null||_squadService54===void 0?void 0:_squadService54.contacts.setFavorite(newFavorite,function(favorite){if(favorite){setChats(chats.map(function(cht){if(cht.jid===newFavoriteLoad.jid){cht.favorite=!newFavoriteLoad.favorite;}return cht;}));setGroups(groups.map(function(grp){if(grp.jid===newFavoriteLoad.jid){return _objectSpread(_objectSpread({},grp),{},{favorite:!newFavoriteLoad.favorite});}return grp;}));setContacts(contacts.map(function(ctt){if(ctt.jid===newFavoriteLoad.jid){return _objectSpread(_objectSpread({},ctt),{},{favorite:!newFavoriteLoad.favorite});}return ctt;}));}});setNewFavorite(undefined);}}function chatCommunicatorSubscribe(evt,data){var _squadService55;switch(evt){case Events.RECONNECTED:setDisconnected(false);// eslint-disable-next-line\ncase Events.ONLINE:(_squadService55=squadService)===null||_squadService55===void 0?void 0:_squadService55.chats.list(function(receivedChats){var _squadService56,_squadService58;var chats=[];receivedChats.forEach(function(cht){if(!chats.find(function(chat){return chat.id===cht.id;})){chats.push(cht);}});setChats(chats);//populating groups\n(_squadService56=squadService)===null||_squadService56===void 0?void 0:_squadService56.groups.list(function(groups){var _squadService57,_squadService57$chat;setGroups(groups);//Joining Groups Rooms in XMPP\n(_squadService57=squadService)===null||_squadService57===void 0?void 0:(_squadService57$chat=_squadService57.chat)===null||_squadService57$chat===void 0?void 0:_squadService57$chat.joinGroups(groups.map(function(group){return group.jid;}));});//populating contacts\n(_squadService58=squadService)===null||_squadService58===void 0?void 0:_squadService58.contacts.list(function(contacts){setContacts(contacts);});//populating conferences\nsetListRooms(true);//populating chat's with messages\n// receivedChats.forEach((chat) => {\n//   squadService?.messages.list(chat, (messages) => {\n//     const chatWithMessages = { ...chat };\n//     chatWithMessages.messages = chatWithMessages.messages.concat(\n//       messages\n//     );\n//     setChats([\n//       ...receivedChats.filter((cht) => chat.id !== cht.id),\n//       chatWithMessages,\n//     ]);\n//   });\n// });\n});break;case Events.ERROR:case Events.OFFLINE:if(localStorage.getItem(\"logout\")!==\"true\"){var _squadService59,_squadService59$chat;(_squadService59=squadService)===null||_squadService59===void 0?void 0:(_squadService59$chat=_squadService59.chat)===null||_squadService59$chat===void 0?void 0:_squadService59$chat.makeChat(chatCommunicatorSubscribe);}localStorage.removeItem(\"logout\");console.log(evt);break;case Events.RECONNECTING:// setShowChat(false);\n// setActiveChat(actChtData);\n// setChats([]);\n// setGroups([]);\n// setContacts([]);\n// setConferenceList([]);\nconsole.log(\"Reconnecting\");setDisconnected(true);break;case Events.MESSAGE:if(data.fromUser===user.jid)break;var find=false;var newChats=[];chats.forEach(function(chat){if(data.fromUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]||data.toUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]){find=true;if(!chat.messages.filter(function(msg){return msg.id===data.id;})[0])chat.messages.push(data);if(chat.id===activeChat.id){var chatTemporary=_objectSpread({},chat);setActiveChat(chatTemporary);}else{chat.unRead++;showNotification(chat.name);}newChats.unshift(chat);}else{newChats.push(chat);}});if(!find){var _squadService60;var _newChat={};(_squadService60=squadService)===null||_squadService60===void 0?void 0:_squadService60.contacts.list(function(listContacts){listContacts.forEach(function(c){if(data.fromUser.split(\"@\")[0]===c.jid.split(\"@\")[0]||data.toUser.split(\"@\")[0]===c.jid.split(\"@\")[0]){if(c.jid===data.fromUser){find=true;_newChat={id:c.id,jid:c.jid,name:c.name,profilePicture:c.profilePicture,status:c.status,unRead:1,chatType:ChatType.USER,inputMessage:\"\",isTyping:false,messages:[],favorite:c.favorite,added:c.added};_newChat.messages.push(data);newChats.unshift(_newChat);}}});});}if(!find){var _squadService61;var _newChat2={};(_squadService61=squadService)===null||_squadService61===void 0?void 0:_squadService61.groups.list(function(listGroups){listGroups.forEach(function(g){if(data.fromUser.split(\"@\")[0]===g.jid.split(\"@\")[0]||data.toUser.split(\"@\")[0]===g.jid.split(\"@\")[0]){if(g.jid===data.fromUser){find=true;_newChat2={id:g.groupId,jid:g.jid,name:g.name,profilePicture:g.profilePicture,attachedFileList:undefined,conferenceRoomParticipants:undefined,department:undefined,email:undefined,groupId:g.groupId,members:g.members,messageLoaded:undefined,userDescription:undefined,status:undefined,unRead:1,chatType:ChatType.GROUP,inputMessage:\"\",isTyping:false,messages:[],favorite:g.favorite,added:g.added};_newChat2.messages.push(data);newChats.unshift(_newChat2);}}});});}setChats(newChats);break;case Events.RECEIVED:setChats(chats.map(function(chat){if(chat.messages.find(function(msg){return msg.id===data.id;}))chat.messages=chat.messages.map(function(message){message.deliverStatus=DeliverStatus.DELIVERED;return message;});return chat;}));break;case Events.DISPLAYED:setChats(chats.map(function(chat){if(chat.messages.find(function(msg){return msg.id===data.id;}))chat.messages=chat.messages.map(function(message){message.readStatus=ReadStatus.READ;return message;});return chat;}));break;case Events.COMPOSING:setChats(chats.map(function(chat){if(chat.jid===data){chat.isTyping=true;if(activeChat.jid===data)setActiveChat(chat);deleteTypingTimeout(chat.jid);setTypingTimeout(chat.jid);}return chat;}));break;case Events.ACTIVE:setChats(chats.map(function(chat){if(chat.jid===data){chat.isTyping=false;if(activeChat.jid===data){var chatUpdate=_objectSpread({},chat);setActiveChat(chatUpdate);}deleteTypingTimeout(chat.jid);}return chat;}));break;case Events.PRESENCE:setChats(chats.map(function(cht){if(cht.jid&&data.from){if(cht.jid===data.from.split(\"/\")[0]&&!cht.jid.includes(\"@conference.\")){cht.status=data.status;}}return cht;}));setContacts(contacts.map(function(ctc){if(ctc.jid&&data.from){if(ctc.jid===data.from.split(\"/\")[0]&&!ctc.jid.includes(\"@conference.\")){ctc.status=data.status;}}return ctc;}));break;case Events.SEND_EVENT:var event=data;var finded;var newChat=[];chats.forEach(function(chat){if(event.fromUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]||event.toUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]){finded=true;if(!chat.messages.filter(function(msg){return msg.id===event.id;})[0])chat.messages.push(event);if(chat.id===activeChat.id){var chatTemporary=_objectSpread({},chat);setActiveChat(chatTemporary);}else{chat.unRead++;showNotification(chat.name);}newChat.unshift(chat);}else{newChat.push(chat);}});if(!finded){groups.forEach(function(grp){if(event.fromUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]||event.toUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]){finded=true;var groupToBeInserted={added:grp.added,chatType:ChatType.GROUP,favorite:grp.favorite,id:grp.groupId,inputMessage:\"\",isTyping:false,jid:grp.jid,messages:[event],name:grp.name,unRead:0,attachedFileList:undefined,department:undefined,email:undefined,groupId:grp.groupId,members:grp.members,messageLoaded:undefined,profilePicture:grp.profilePicture,status:undefined,userDescription:grp.description};newChat.unshift(groupToBeInserted);setActiveChat(groupToBeInserted);}});}if(!finded){var _squadService62;(_squadService62=squadService)===null||_squadService62===void 0?void 0:_squadService62.groups.list(function(grps){setGroups(grps);grps.forEach(function(grp){if(event.fromUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]||event.toUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]){finded=true;var groupToBeInserted={added:grp.added,chatType:ChatType.GROUP,favorite:grp.favorite,id:grp.groupId,inputMessage:\"\",isTyping:false,jid:grp.jid,messages:[event],name:grp.name,unRead:1,attachedFileList:undefined,department:undefined,email:undefined,groupId:grp.groupId,members:grp.members,messageLoaded:undefined,profilePicture:grp.profilePicture,status:undefined,userDescription:grp.description};newChat.unshift(groupToBeInserted);}});});}setChats(newChat);if(event.eventId===6||event.eventId===2){refreshMembers(event);}break;default:console.log(evt);break;}}var refreshMembers=function refreshMembers(event){var _squadService63;(_squadService63=squadService)===null||_squadService63===void 0?void 0:_squadService63.groups.list(function(grps){setGroups(grps);setChats(chats.map(function(chat){if(event.fromUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]||event.toUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]){var _grps$find;chat.members=(_grps$find=grps.find(function(grp){return grp.groupId===chat.id;}))===null||_grps$find===void 0?void 0:_grps$find.members;if(chat.id===activeChat.id){setActiveChat(chat);}}return chat;}));});};var deleteTypingTimeout=function deleteTypingTimeout(jid){var _typingTimeout$get;clearTimeout(((_typingTimeout$get=typingTimeout.get(jid))===null||_typingTimeout$get===void 0?void 0:_typingTimeout$get.timeout)||setTimeout(function(){},1));typingTimeout.delete(jid);};var setTypingTimeout=function setTypingTimeout(jid){var timeoutData={msgStr:\"\",timeout:setTimeout(function(){setChats(chats.map(function(cht){if(cht.jid===jid){cht.isTyping=false;if(activeChat.jid===jid)setActiveChat(cht);}return cht;}));},20000)};typingTimeout.set(jid,timeoutData);};(_squadService64=squadService)===null||_squadService64===void 0?void 0:_squadService64.updateChatSubscribeFuncition(chatCommunicatorSubscribe);// Comentado para evitar warnings no console enquanto não é usado\n// function createGroup(group: INewGroup, callback: CreateGroupCallback) {\n//   squadService?.groups.create(group, (iGroup: IGroup) => {\n//     squadService?.groups.list((groups) => {\n//       setGroups(groups);\n//       callback(true);\n//     });\n//   });\n// }\nfunction sendMessage(chat,message,callback){var _squadService65,_squadService65$chat;(_squadService65=squadService)===null||_squadService65===void 0?void 0:(_squadService65$chat=_squadService65.chat)===null||_squadService65$chat===void 0?void 0:_squadService65$chat.chat.sendMessage(chat.jid,chat.jid.includes(\"@conference.\")?XMPPChatType.GROUPCHAT:XMPPChatType.CHAT,message,callback);}useEffect(init,[]);return/*#__PURE__*/React.createElement(React.Fragment,null);};export default SquadCommunicator;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/SquadCommunicator.tsx"],"names":["React","useEffect","SquadCommunicator","SquadService","useChat","useAuth","Events","ChatType","DeliverStatus","XMPPChatType","getFileName","getUrlBooleans","isUrl","ReadStatus","useGroup","useContact","useModal","UserType","useConference","moment","ConferenceRoomParticipantType","PresenceStatus","DateTime","useLoading","squadService","typingTimeout","Map","chats","setChats","activeChat","replyMsg","setReplyMsg","setActiveChat","forwardMessageList","setForwardMessageList","setShowChat","showChatProfileSidebar","setFavoriteMessagePayload","favoriteMessagePayload","flagToLoadFavoriteMessages","setFlagToLoadFavoriteMessages","setFavoriteMessages","deleteFavoriteMessage","setDeleteFavoriteMessage","contactsSearch","setContactsSearched","newFavorite","setNewFavorite","contacts","setContacts","setContactsOutsideUserContacts","toggleAddingContacts","setToggleAddingContacts","checkedContacts","setCheckedContacts","removedContact","setRemovedContact","checkedMembers","setCheckedMembers","groupToInsertMember","setGroupToInsertMember","clickedContact","setClickedContact","user","setUser","changedUserData","changedUserPassword","setChangedUserPassword","showModalForwardMessageTo","setShowModalForwardMessageTo","showModalAddContact","setDisconnected","setGroups","groups","memberQuit","groupIdOfLeaveRequest","setGroupIdOfLeaveRequest","setMemberQuit","groupToRemoveContact","setGroupToRemoveContact","removedMember","setRemovedMember","toggleMemberRole","setToggleMemberRole","changeGroupData","setChangeGroupData","groupToCreate","setGroupToCreate","groupJid","setGroupJid","listRooms","setListRooms","setConferenceList","setCreateConference","createConference","init","getInstance","chatCommunicatorSubscribe","get","Notification","requestPermission","clearSendFile","chatId","messageId","map","chat","id","messages","message","deliverStatus","QUEUED","sendFile","undefined","onChatsChange","onActiveChatChange","checkSendMessage","checkAttachedFiles","checkNewContact","cht","added","add","success","jid","list","ctcs","attachedFileList","attachments","length","checkSearchMessages","messageLoaded","forEach","msg","find","m","unshift","getFileExtension","url","split","SENDING","files","sendFiles","data","updateMessageFiles","console","log","saveData","createdAt","local","toISO","join","slice","src","dst","fileExtension","fileName","fileUrl","kind","chatType","isForwardMessage","sendMessage","msgId","updateMessage","replyMsgCopy","newChat","booleans","time","Date","toISOString","isFileMessage","isImageMessage","isVideoMessage","isAudioMessage","filter","newChats","push","replyedMsg","isReplyMessage","replyedMessage","replyedMessageId","replyedMessageTo","getContacts","fromUser","name","forwardMessage","chatsFinded","oldChats","ctc","i","userName","toUser","ctcsNotInChat","profilePicture","status","unRead","includes","GROUP","USER","inputMessage","isTyping","email","favorite","newMessage","onChangeStatus","client","changeStatus","onSearchContacts","search","searchList","onSearchContactsOutsideUserContacts","getContactsOutsideUserLists","onToggleSidebarMenu","onRemovingMember","group","grp","groupId","removeMember","members","mb","userId","sendEvent","onLeavingGroup","leftingGroup","memberId","sendPresence","UNAVAILABLE","showNotification","permission","body","icon","require","silent","onFavoriteMessage","save","contactType","onAddingMembers","asynchronousFlag","copiaCheckedMembers","copiaGroupToInsertMember","ctt","addMember","grps","foundedGroup","onAddingContacts","addContacts","onAddingContactOnGroupList","onToggleMemberRole","gp","gpId","mbId","mbRole","newRole","ADMIN","role","member","onChangeGroupData","editGroupInfo","groupName","description","createGroup","create","parsedGroup","onListRooms","conferences","joinGroups","conf","onCreateRoom","momentStartDate","startDate","startTime","momentFinalDate","duration","parsedConference","waitMod","mdCheck","startDatetime","format","stopDatetime","createdConference","participantList","selectedContact","userUuid","type","PARTICIPANT","userModerator","emailList","participant","PARTICIPANT_EXTERNAL","addParticipants","s","onNewFavorite","onUserDataChange","onUserPasswordChange","onRemovingContact","onListFavoriteMessages","onRemoveFavoriteMessage","deleteFavorite","listFavorites","contactTo","content","contentType","messageDate","item","remove","changePassword","password","oldPassword","newPassword","changeUserData","chgd","newFavoriteLoad","setFavorite","evt","RECONNECTED","ONLINE","receivedChats","ERROR","OFFLINE","localStorage","getItem","makeChat","removeItem","RECONNECTING","MESSAGE","chatTemporary","listContacts","c","listGroups","g","conferenceRoomParticipants","department","userDescription","RECEIVED","DELIVERED","DISPLAYED","readStatus","READ","COMPOSING","deleteTypingTimeout","setTypingTimeout","ACTIVE","chatUpdate","PRESENCE","from","SEND_EVENT","event","finded","groupToBeInserted","eventId","refreshMembers","clearTimeout","timeout","setTimeout","delete","timeoutData","msgStr","set","updateChatSubscribeFuncition","callback","GROUPCHAT","CHAT"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\r\nimport { useChat } from \"../contexts/ChatContext\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport IUser from \"../alias/IUser\";\r\nimport { Events, SendImageCallbackReturn } from \"./chat/types/types\";\r\nimport ChatType from \"./../enuns/ChatType\";\r\nimport IChat from \"../alias/IChat\";\r\nimport DeliverStatus from \"../enuns/DeliverStatus\";\r\nimport { ChatType as XMPPChatType } from \"./chat/types/types\";\r\nimport { SendMessageCallback } from \"./types\";\r\nimport IMessage from \"../alias/IMessage\";\r\nimport { getFileName, getUrlBooleans, isUrl } from \"./utils/parseUtils\";\r\nimport ReadStatus from \"../enuns/ReadStatus\";\r\nimport { useGroup } from \"../contexts/GroupContext\";\r\nimport { useContact } from \"../contexts/ContactContext\";\r\nimport { useModal } from \"../contexts/ModalContext\";\r\nimport IContact from \"../alias/IContact\";\r\nimport IGroup from \"../alias/IGroup\";\r\nimport UserType from \"../enuns/UserType\";\r\nimport { useConference } from \"../contexts/ConferenceContext\";\r\nimport moment from \"moment\";\r\nimport { ConferenceRoomParticipantType } from \"./business/Conferences\";\r\nimport { ConferenceRoomParticipant } from \"@digivox/apicommunicator/dist/types/types/types\";\r\nimport PresenceStatus from \"../enuns/PresenceStatus\";\r\nimport { DateTime } from \"luxon\";\r\nimport { useLoading } from \"../contexts/LoadingContext\";\r\n// import { activeChat as actChtData } from \"../data/chat\";\r\n//import { callbackify } from \"util\";\r\n\r\n// import IContact from \"../alias/IContact\";\r\n//Comentar para Evitar Warnings no console\r\ninterface CreateGroupCallback {\r\n  (success: boolean): void;\r\n}\r\ninterface TypingTimeoutData {\r\n  timeout: NodeJS.Timeout;\r\n  msgStr: string;\r\n}\r\nlet squadService: SquadService | undefined;\r\nlet typingTimeout: Map<string, TypingTimeoutData> = new Map<\r\n  string,\r\n  TypingTimeoutData\r\n>();\r\n\r\nconst SquadCommunicator: React.FC = () => {\r\n  const {\r\n    chats,\r\n    setChats,\r\n    activeChat,\r\n    replyMsg,\r\n    setReplyMsg,\r\n    setActiveChat,\r\n    forwardMessageList,\r\n    setForwardMessageList,\r\n    setShowChat,\r\n    showChatProfileSidebar,\r\n    setFavoriteMessagePayload,\r\n    favoriteMessagePayload,\r\n    flagToLoadFavoriteMessages,\r\n    setFlagToLoadFavoriteMessages,\r\n    setFavoriteMessages,\r\n    deleteFavoriteMessage,\r\n    setDeleteFavoriteMessage,\r\n  } = useChat();\r\n  const {\r\n    contactsSearch,\r\n    setContactsSearched,\r\n    newFavorite,\r\n    setNewFavorite,\r\n    contacts,\r\n    setContacts,\r\n    setContactsOutsideUserContacts,\r\n    toggleAddingContacts,\r\n    setToggleAddingContacts,\r\n    checkedContacts,\r\n    setCheckedContacts,\r\n    removedContact,\r\n    setRemovedContact,\r\n    checkedMembers,\r\n    setCheckedMembers,\r\n    groupToInsertMember,\r\n    setGroupToInsertMember,\r\n    clickedContact,\r\n    setClickedContact,\r\n  } = useContact();\r\n  const {\r\n    user,\r\n    setUser,\r\n    changedUserData,\r\n    changedUserPassword,\r\n    setChangedUserPassword,\r\n  } = useAuth();\r\n  const {\r\n    showModalForwardMessageTo,\r\n    setShowModalForwardMessageTo,\r\n    showModalAddContact,\r\n  } = useModal();\r\n  const { setDisconnected } = useLoading();\r\n\r\n  const {\r\n    setGroups,\r\n    groups,\r\n    memberQuit,\r\n    groupIdOfLeaveRequest,\r\n    setGroupIdOfLeaveRequest,\r\n    setMemberQuit,\r\n    groupToRemoveContact,\r\n    setGroupToRemoveContact,\r\n    removedMember,\r\n    setRemovedMember,\r\n    toggleMemberRole,\r\n    setToggleMemberRole,\r\n    changeGroupData,\r\n    setChangeGroupData,\r\n    groupToCreate,\r\n    setGroupToCreate,\r\n    groupJid,\r\n    setGroupJid,\r\n  } = useGroup();\r\n  const {\r\n    listRooms,\r\n    setListRooms,\r\n    setConferenceList,\r\n    setCreateConference,\r\n    createConference,\r\n  } = useConference();\r\n  const init = () => {\r\n    // localStorage.setItem(\r\n    //   \"authorization\",\r\n    //   JSON.stringify({\r\n    //     access_token: \"71e1503a96d94e1e231444bc5c0399ca\",\r\n    //     user_id: \"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",\r\n    //     user_name: \"ZZ Romero 2\",\r\n    //     expires_in: 2592000,\r\n    //     email: \"romero2@digivox.com.br\",\r\n    //     baseUrl: \"https://app.citrussquad.com/api/v1/\",\r\n    //   })\r\n    // );\r\n    squadService = SquadService.getInstance({\r\n      chatCommunicatorSubscribe: chatCommunicatorSubscribe,\r\n    });\r\n    squadService?.user.get((user: IUser) => {\r\n      setUser(user);\r\n      //Ao iniciar o website\r\n      Notification.requestPermission();\r\n    });\r\n  };\r\n\r\n  const clearSendFile = (chatId: string, messageId: string) => {\r\n    setChats(\r\n      chats.map((chat) => {\r\n        if (chat.id === chatId) {\r\n          chat.messages = chat.messages.map((message) => {\r\n            if (message.id === messageId) {\r\n              message.deliverStatus = DeliverStatus.QUEUED;\r\n              message.sendFile = undefined;\r\n            }\r\n            return message;\r\n          });\r\n        }\r\n        return chat;\r\n      })\r\n    );\r\n  };\r\n\r\n  const onChatsChange = () => {\r\n    // chats.forEach((chat) => {\r\n    // });\r\n  };\r\n  const onActiveChatChange = () => {\r\n    checkSendMessage(activeChat);\r\n    checkAttachedFiles(activeChat);\r\n    checkNewContact(activeChat);\r\n    // checkTyping(activeChat)\r\n  };\r\n  // const checkTyping = (chat: IChat) => {\r\n  //   const oldTimeoutData = typingTimeout.get(chat.jid)\r\n  //   if (chat.inputMessage !== \"\" && (!oldTimeoutData || (oldTimeoutData.msgStr !== chat.inputMessage))) {\r\n  //     if (oldTimeoutData)\r\n  //       clearTimeout(oldTimeoutData.timeout)\r\n  //     else\r\n  //       squadService?.chat?.chat.sendTyping(chat.jid)\r\n  //     const timeoutData = {\r\n  //       timeout: setTimeout(() => { squadService?.chat?.chat.sendActive(chat.jid); typingTimeout.delete(chat.jid) }, 3000),\r\n  //       msgStr: `${chat.inputMessage}`\r\n  //     }\r\n  //     typingTimeout.set(chat.jid, timeoutData)\r\n  //   }\r\n  // }\r\n  const checkNewContact = (cht: IChat) => {\r\n    if (!cht.added) {\r\n      squadService?.contacts.add(cht, (success: boolean) => {\r\n        if (success) {\r\n          setChats(\r\n            chats.map((chat) => {\r\n              if (chat.jid === cht.jid) {\r\n                chat.added = true;\r\n              }\r\n              if (activeChat.jid === chat.jid) setActiveChat(chat);\r\n              return chat;\r\n            })\r\n          );\r\n          squadService?.contacts.list((ctcs) => {\r\n            setContacts(ctcs);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const checkAttachedFiles = (cht: IChat) => {\r\n    if (cht.attachedFileList && !cht.attachedFileList[0]) {\r\n      squadService?.attachments.list(cht, (attachments) => {\r\n        if (attachments.length > 0) {\r\n          setActiveChat({ ...cht, attachedFileList: attachments });\r\n        } else setActiveChat({ ...cht, attachedFileList: null });\r\n      });\r\n    }\r\n  };\r\n\r\n  /* getMessageUserProfilePicture = (msg: Message | FileMessage) => {\r\n    if (msg.from.includes(\"@conference.\")) {\r\n      const groups = this.groups.getGroups();\r\n      const group = groups.get(msg.from.split(\"@\")[0]);\r\n      const member = group?.members.filter(\r\n        (member) => member.userId === msg.from.split(\"/\")[1]\r\n      )[0];\r\n      return member?.profilePicture;\r\n    } else {\r\n      return this.contacts.getContacts().get(msg.from.split(\"@\")[0])\r\n        ?.profilePicture;\r\n    }\r\n  }; */\r\n\r\n  const checkSearchMessages = () => {\r\n    if (activeChat.messageLoaded) {\r\n      squadService?.messages.list(activeChat, (messages) => {\r\n        if (messages.length) {\r\n          setChats(\r\n            chats.map((cht) => {\r\n              if (cht.id === activeChat.id) {\r\n                messages.forEach((msg) => {\r\n                  if (!activeChat.messages.find((m) => m.id === msg.id))\r\n                    cht.messages.unshift(msg);\r\n                });\r\n                cht.messageLoaded = false;\r\n                setActiveChat(cht);\r\n              }\r\n              return cht;\r\n            })\r\n          );\r\n        } else {\r\n          const chat = { ...activeChat, messageLoaded: false };\r\n          setActiveChat(chat);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const getFileExtension = (url: string) => {\r\n    return url.split(\".\")[1];\r\n  };\r\n\r\n  const checkSendMessage = (chat: IChat) => {\r\n    chat.messages.forEach((msg) => {\r\n      if (msg.deliverStatus === DeliverStatus.SENDING) {\r\n        if (msg.sendFile && !replyMsg) {\r\n          const files = [msg.sendFile];\r\n          clearSendFile(chat.id, msg.id);\r\n          squadService?.chat?.sendFiles(\r\n            chat,\r\n            files,\r\n            (data: SendImageCallbackReturn) => {\r\n              updateMessageFiles(data, chat, msg);\r\n              console.log(\r\n                \"jidFromUser:\",\r\n                squadService?.user.user?.jid as string\r\n              );\r\n              squadService?.attachments.saveData(\r\n                {\r\n                  createdAt: DateTime.local()\r\n                    .toISO()\r\n                    .split(\"T\")\r\n                    .join(\" \")\r\n                    .slice(0, 18),\r\n                  src: squadService.user.user?.jid as string,\r\n                  dst: chat.jid,\r\n                  fileExtension: getFileExtension(getFileName(data.url)),\r\n                  fileName: getFileName(data.url),\r\n                  fileUrl: data.url,\r\n                  kind: chat.chatType,\r\n                },\r\n                () => true\r\n              );\r\n            }\r\n          );\r\n        } else {\r\n          if (!msg.isForwardMessage && !replyMsg) {\r\n            sendMessage(chat, msg.message, (msgId) =>\r\n              updateMessage(msgId, chat, msg)\r\n            );\r\n          } else if (replyMsg) {\r\n            const replyMsgCopy = { ...replyMsg };\r\n            setReplyMsg(undefined);\r\n            squadService?.chat?.replyMsg(chat, msg, replyMsgCopy, (msgId) => {\r\n              updateMessage(msgId, chat, msg, replyMsgCopy);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  };\r\n  const updateMessageFiles = (\r\n    data: SendImageCallbackReturn,\r\n    chat: IChat,\r\n    msg: IMessage\r\n  ) => {\r\n    const newChat = { ...chat };\r\n    newChat.messages = chat.messages.map((message) => {\r\n      if (msg.id === message.id) {\r\n        const booleans = getUrlBooleans(data.url);\r\n        message.id = data.msgId;\r\n        message.fileUrl = data.url;\r\n        message.deliverStatus = DeliverStatus.QUEUED;\r\n        message.time = new Date().toISOString();\r\n        message.message = getFileName(data.url);\r\n        message.isFileMessage = booleans.isFileMessage;\r\n        message.isImageMessage = booleans.isImageMessage;\r\n        message.isVideoMessage = booleans.isVideoMessage;\r\n        message.isAudioMessage = booleans.isAudioMessage;\r\n      }\r\n      return message;\r\n    });\r\n    setActiveChat(newChat);\r\n    if (!chats.filter((cht) => cht.id === chat.id)[0]) {\r\n      const newChats = [chat, ...chats];\r\n      setChats(newChats);\r\n    } else {\r\n      const newChats: IChat[] = [];\r\n      chats.forEach((cht) => {\r\n        if (cht.id === chat.id) {\r\n          cht.messages = newChat.messages;\r\n          newChats.unshift(cht);\r\n        } else {\r\n          newChats.push(cht);\r\n        }\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const updateMessage = (\r\n    msgId: string,\r\n    chat: IChat,\r\n    msg: IMessage,\r\n    replyedMsg: IMessage | undefined = undefined\r\n  ) => {\r\n    const newChat = { ...chat };\r\n    newChat.messages = chat.messages.map((message) => {\r\n      if (msg.id === message.id) {\r\n        message.id = msgId;\r\n        message.deliverStatus = DeliverStatus.QUEUED;\r\n        message.time = new Date().toISOString();\r\n        if (replyedMsg) {\r\n          message.isReplyMessage = true;\r\n          message.replyedMessage = replyedMsg.message || replyedMsg.fileUrl;\r\n          message.replyedMessageId = replyedMsg.id;\r\n          message.replyedMessageTo =\r\n            squadService?.contacts\r\n              .getContacts()\r\n              .get(replyedMsg.fromUser.split(\"@\")[0])?.name ||\r\n            squadService?.user?.user?.id === replyedMsg.fromUser.split(\"@\")[0]\r\n              ? squadService?.user?.user?.name\r\n              : \"Participant\";\r\n        }\r\n        if (isUrl(message.message)) {\r\n          const booleans = getUrlBooleans(message.message);\r\n          message.isFileMessage = booleans.isFileMessage;\r\n          message.isImageMessage = booleans.isImageMessage;\r\n          message.isAudioMessage = booleans.isAudioMessage;\r\n          message.isVideoMessage = booleans.isVideoMessage;\r\n          message.fileUrl = message.message;\r\n        }\r\n      }\r\n      return message;\r\n    });\r\n    if (activeChat.jid === newChat.jid) setActiveChat(newChat);\r\n    if (!chats.filter((cht) => cht.id === chat.id)[0]) {\r\n      const newChats = [chat, ...chats];\r\n      setChats(newChats);\r\n    } else {\r\n      const newChats: IChat[] = [];\r\n      chats.forEach((cht) => {\r\n        if (cht.id === chat.id) {\r\n          cht.messages = newChat.messages;\r\n          newChats.unshift(cht);\r\n        } else {\r\n          newChats.push(cht);\r\n        }\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const forwardMessage = () => {\r\n    if (forwardMessageList && showModalForwardMessageTo) {\r\n      const ctcs = [...forwardMessageList];\r\n      const message = { ...showModalForwardMessageTo };\r\n      setForwardMessageList(undefined);\r\n      setShowModalForwardMessageTo(undefined);\r\n      const chatsFinded: IChat[] = [];\r\n      const oldChats = [\r\n        ...chats.map((chat) => {\r\n          return { ...chat };\r\n        }),\r\n      ];\r\n      ctcs?.forEach((ctc, i) => {\r\n        const cht = oldChats.find((cht) => cht.jid === ctc.jid);\r\n        if (cht) {\r\n          const msg = {\r\n            ...message,\r\n            id: `${cht.messages.length + 1}`,\r\n            userName: user.name,\r\n            fromUser: user.id,\r\n            toUser: ctc.jid.split(\"@\")[0],\r\n            message: message.fileUrl || message.message,\r\n            deliverStatus: DeliverStatus.QUEUED,\r\n            isForwardMessage: true,\r\n          };\r\n          squadService?.chat?.forwardMessage(cht, msg, (msgId) => {\r\n            msg.id = msgId;\r\n            cht.messages.push(msg);\r\n            chatsFinded.push(cht);\r\n          });\r\n        }\r\n      });\r\n      const newChats = oldChats.map(\r\n        (chat) => chatsFinded.find((cht) => cht.id === chat.id) || chat\r\n      );\r\n      const ctcsNotInChat: (IContact | IGroup)[] = ctcs.filter(\r\n        (ctc) => !newChats.find((cht) => ctc.jid === cht.jid)\r\n      );\r\n      ctcsNotInChat.forEach((ctc, i) => {\r\n        const chat = {\r\n          id: ctc.jid.split(\"@\")[0],\r\n          jid: ctc.jid,\r\n          name: ctc.name,\r\n          profilePicture: ctc.profilePicture,\r\n          status: (ctc as IContact).status || undefined,\r\n          unRead: 0,\r\n          chatType: ctc.jid.includes(\"@conference.\")\r\n            ? ChatType.GROUP\r\n            : ChatType.USER,\r\n          inputMessage: \"\",\r\n          messageLoaded: false,\r\n          isTyping: false,\r\n          messages: [] as IMessage[],\r\n          email: (ctc as IContact).email || undefined,\r\n          favorite: ctc.favorite,\r\n          added: ctc.added,\r\n        };\r\n        const newMessage: IMessage = {\r\n          ...message,\r\n          id: `${1}`,\r\n          userName: user.name,\r\n          fromUser: user.id,\r\n          toUser: ctc.jid.split(\"@\")[0],\r\n          deliverStatus: DeliverStatus.QUEUED,\r\n          isForwardMessage: true,\r\n        };\r\n        squadService?.chat?.forwardMessage(chat, newMessage, (msgId) => {\r\n          newMessage.id = msgId;\r\n          chat.messages.push(newMessage);\r\n          newChats.unshift(chat);\r\n        });\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const onChangeStatus = () => {\r\n    if (squadService?.chat?.chat?.client?.status === \"online\") {\r\n      squadService?.chat?.changeStatus(user.status);\r\n    }\r\n  };\r\n  const onSearchContacts = () => {\r\n    if (contactsSearch.length > 2) {\r\n      squadService?.contacts.search(contactsSearch, (searchList) => {\r\n        setContactsSearched(searchList);\r\n      });\r\n    } else {\r\n      setContactsSearched(undefined);\r\n    }\r\n  };\r\n\r\n  const onSearchContactsOutsideUserContacts = () => {\r\n    squadService?.contacts.getContactsOutsideUserLists((contacts) => {\r\n      if (contacts) {\r\n        setContactsOutsideUserContacts(contacts);\r\n      }\r\n    });\r\n  };\r\n\r\n  const onToggleSidebarMenu = () => {\r\n    squadService?.contacts.getContactsOutsideUserLists((contacts) => {\r\n      if (contacts) {\r\n        setContactsOutsideUserContacts(contacts);\r\n      }\r\n    });\r\n  };\r\n\r\n  const onRemovingMember = () => {\r\n    if (removedMember && groupToRemoveContact) {\r\n      let group = groups.find((grp) => grp.groupId === groupToRemoveContact);\r\n      if (group)\r\n        squadService?.groups.removeMember(\r\n          group.groupId,\r\n          removedMember,\r\n          (success: boolean) => {\r\n            if (success) {\r\n              setGroups(\r\n                groups.map((grp) => {\r\n                  if (grp.groupId === group?.groupId)\r\n                    grp.members = grp.members.filter(\r\n                      (mb) => mb.userId !== removedMember.userId\r\n                    );\r\n                  return grp;\r\n                })\r\n              );\r\n              setChats(\r\n                chats.map((cht) => {\r\n                  if (cht.groupId === group?.groupId) {\r\n                    cht.members = cht.members?.filter(\r\n                      (mb) => mb.userId !== removedMember.userId\r\n                    );\r\n                    if (cht.groupId === activeChat.groupId) setActiveChat(cht);\r\n                  }\r\n                  return cht;\r\n                })\r\n              );\r\n              if (group) {\r\n                squadService?.chat?.chat.sendEvent(\r\n                  group?.jid,\r\n                  removedMember.userId,\r\n                  \"6\"\r\n                );\r\n              }\r\n              setRemovedMember(undefined);\r\n              setGroupToRemoveContact(undefined);\r\n            }\r\n          }\r\n        );\r\n    }\r\n  };\r\n\r\n  const onLeavingGroup = () => {\r\n    if (memberQuit && groupIdOfLeaveRequest && groupJid) {\r\n      squadService?.groups.leftingGroup(\r\n        { groupId: groupIdOfLeaveRequest, memberId: memberQuit.userId },\r\n        (success: boolean) => {\r\n          if (success) {\r\n            squadService?.chat?.chat.sendPresence(\r\n              PresenceStatus.UNAVAILABLE,\r\n              `${groupJid}/${memberQuit.userId}`\r\n            );\r\n            squadService?.chat?.chat.sendEvent(\r\n              groupIdOfLeaveRequest,\r\n              memberQuit.userId,\r\n              \"3\",\r\n              undefined\r\n            );\r\n            setChats(\r\n              chats.filter((cht) => cht.groupId !== groupIdOfLeaveRequest)\r\n            );\r\n            setGroups(\r\n              groups.filter((grp) => grp.groupId !== groupIdOfLeaveRequest)\r\n            );\r\n            if (activeChat.groupId === groupIdOfLeaveRequest) {\r\n              setShowChat(false);\r\n            }\r\n          }\r\n          setGroupJid(undefined);\r\n          setMemberQuit(undefined);\r\n          setGroupIdOfLeaveRequest(\"\");\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const showNotification = (name: string) => {\r\n    if (Notification.permission === \"granted\") {\r\n      new Notification(\"Nova mensagem\", {\r\n        body: name,\r\n        icon: require(\"../assets/images/logo.png\"),\r\n        silent: true,\r\n      });\r\n    } else {\r\n      Notification.requestPermission();\r\n    }\r\n  };\r\n\r\n  const onFavoriteMessage = () => {\r\n    if (favoriteMessagePayload) {\r\n      squadService?.messages.save(favoriteMessagePayload, (success) => {\r\n        if (success) {\r\n          setFavoriteMessagePayload(undefined);\r\n          setFlagToLoadFavoriteMessages({\r\n            contactType: favoriteMessagePayload.contactType as string,\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const onAddingMembers = () => {\r\n    let asynchronousFlag = 0;\r\n    if (checkedMembers && groupToInsertMember) {\r\n      let copiaCheckedMembers = [...checkedMembers],\r\n        copiaGroupToInsertMember = { ...groupToInsertMember };\r\n      copiaCheckedMembers.forEach((ctt) => {\r\n        squadService?.groups.addMember(\r\n          copiaGroupToInsertMember,\r\n          ctt,\r\n          (success: boolean) => {\r\n            if (success) {\r\n              squadService?.chat?.chat.sendEvent(\r\n                copiaGroupToInsertMember.jid,\r\n                ctt.id,\r\n                \"2\"\r\n              );\r\n              asynchronousFlag++;\r\n\r\n              if (copiaCheckedMembers.length === asynchronousFlag) {\r\n                squadService?.groups.list((grps) => {\r\n                  setGroups(grps);\r\n                  setChats(\r\n                    chats.map((cht) => {\r\n                      if (cht.groupId === copiaGroupToInsertMember.groupId) {\r\n                        let foundedGroup = grps.find(\r\n                          (grp) => grp.groupId === cht.groupId\r\n                        );\r\n                        cht.members = foundedGroup?.members;\r\n                        if (activeChat.groupId === cht.groupId) {\r\n                          activeChat.members = foundedGroup?.members;\r\n                          setActiveChat(activeChat);\r\n                        }\r\n                      }\r\n                      return cht;\r\n                    })\r\n                  );\r\n                });\r\n              }\r\n            }\r\n          }\r\n        );\r\n      });\r\n      setCheckedMembers([]);\r\n      setToggleAddingContacts(false);\r\n      setGroupToInsertMember(undefined);\r\n    }\r\n  };\r\n\r\n  const onAddingContacts = () => {\r\n    let asynchronousFlag = 0;\r\n    if (checkedContacts && toggleAddingContacts) {\r\n      checkedContacts.forEach((ctt) => {\r\n        if (!ctt.added) {\r\n          squadService?.contacts.addContacts(ctt, (success: boolean) => {\r\n            if (success) {\r\n              asynchronousFlag++;\r\n              if (checkedContacts.length === asynchronousFlag) {\r\n                squadService?.contacts.list((contacts) => {\r\n                  setContacts(contacts);\r\n                  setCheckedContacts([]);\r\n                  setToggleAddingContacts(false);\r\n                });\r\n              }\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const onAddingContactOnGroupList = () => {\r\n    if (clickedContact) {\r\n      if (!clickedContact.added) {\r\n        squadService?.contacts.addContacts(\r\n          clickedContact,\r\n          (success: boolean) => {\r\n            if (success) {\r\n              squadService?.contacts.list((contacts) => {\r\n                setContacts(contacts);\r\n                setClickedContact(undefined);\r\n              });\r\n            }\r\n          }\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const onToggleMemberRole = () => {\r\n    if (toggleMemberRole) {\r\n      squadService?.groups.list((grps) => {\r\n        grps.forEach((gp) => {\r\n          if (gp.groupId === toggleMemberRole.gpId) {\r\n            gp.members.forEach((mb) => {\r\n              if (mb.userId === toggleMemberRole.mbId) {\r\n                squadService?.contacts.toggleMemberRole(\r\n                  toggleMemberRole.mbId,\r\n                  toggleMemberRole.gpId,\r\n                  toggleMemberRole.mbRole,\r\n                  (success: boolean) => {\r\n                    if (success) {\r\n                      const newRole =\r\n                        toggleMemberRole.mbRole === UserType.USER\r\n                          ? UserType.ADMIN\r\n                          : UserType.USER;\r\n                      setToggleMemberRole(undefined);\r\n                      setChats(\r\n                        chats.map((cht) => {\r\n                          if (cht.groupId === toggleMemberRole.gpId) {\r\n                            cht.members = cht.members?.map((mb) => {\r\n                              if (mb.userId === toggleMemberRole.mbId) {\r\n                                mb.role = newRole;\r\n                                if (cht.groupId) {\r\n                                  if (mb.role === UserType.ADMIN) {\r\n                                    squadService?.chat?.chat.sendEvent(\r\n                                      cht.groupId,\r\n                                      mb.userId,\r\n                                      \"8\"\r\n                                    );\r\n                                  } else {\r\n                                    squadService?.chat?.chat.sendEvent(\r\n                                      cht.groupId,\r\n                                      mb.userId,\r\n                                      \"9\"\r\n                                    );\r\n                                  }\r\n                                }\r\n                              }\r\n                              return mb;\r\n                            });\r\n                            if (activeChat.groupId === cht.groupId)\r\n                              setActiveChat(cht);\r\n                          }\r\n                          return cht;\r\n                        })\r\n                      );\r\n                      setGroups(\r\n                        groups.map((grp) => {\r\n                          if (grp.groupId === toggleMemberRole.gpId) {\r\n                            grp.members = grp.members.map((member) => {\r\n                              if (member.userId === toggleMemberRole.mbId)\r\n                                member.role = newRole;\r\n                              return member;\r\n                            });\r\n                          }\r\n                          return grp;\r\n                        })\r\n                      );\r\n                    }\r\n                  }\r\n                );\r\n              }\r\n            });\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  const onChangeGroupData = () => {\r\n    if (changeGroupData) {\r\n      squadService?.groups.editGroupInfo(\r\n        {\r\n          groupId: changeGroupData.groupId as string,\r\n          groupName: changeGroupData.groupName,\r\n          members: changeGroupData.members,\r\n          description: changeGroupData.description,\r\n        },\r\n        (success: boolean) => {\r\n          if (success) {\r\n            squadService?.groups.list((grps) => {\r\n              let foundedGroup = grps.find(\r\n                (grp) => grp.groupId === changeGroupData.groupId\r\n              );\r\n              setGroups(grps);\r\n              setChats(\r\n                chats.map((cht) => {\r\n                  if (cht.groupId === changeGroupData.groupId) {\r\n                    if (foundedGroup?.name) {\r\n                      cht.name = foundedGroup.name;\r\n                    }\r\n                    if (activeChat.groupId === cht.groupId) {\r\n                      if (foundedGroup?.name) {\r\n                        cht.name = foundedGroup?.name;\r\n                      }\r\n                      setActiveChat(cht);\r\n                    }\r\n                  }\r\n                  return cht;\r\n                })\r\n              );\r\n              squadService?.chat?.chat.sendEvent(\r\n                foundedGroup?.jid as string,\r\n                undefined,\r\n                \"10\",\r\n                undefined\r\n              );\r\n              setChangeGroupData(undefined);\r\n            });\r\n          }\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const createGroup = () => {\r\n    squadService?.groups.create(groupToCreate, (parsedGroup) => {\r\n      if (parsedGroup) {\r\n        squadService?.chat?.chat.sendEvent(\r\n          parsedGroup.jid,\r\n          parsedGroup.jid,\r\n          \"1\"\r\n        );\r\n        squadService?.groups.list((groups) => {\r\n          setGroups(groups);\r\n          setGroupToCreate(undefined);\r\n        });\r\n        squadService?.chat?.chat.sendEvent(\r\n          parsedGroup.jid,\r\n          undefined,\r\n          \"1\",\r\n          undefined\r\n        );\r\n      }\r\n    });\r\n  };\r\n  const onListRooms = () => {\r\n    if (listRooms) {\r\n      squadService?.conferences.list((conferences) => {\r\n        setConferenceList(conferences);\r\n        squadService?.chat?.joinGroups(conferences.map((conf) => conf.jid));\r\n      });\r\n      setListRooms(false);\r\n    }\r\n  };\r\n  const onCreateRoom = () => {\r\n    if (createConference) {\r\n      const momentStartDate = moment(\r\n        `${createConference.startDate} ${createConference.startTime}:00`\r\n      );\r\n      const momentFinalDate = moment(momentStartDate)\r\n        .add(createConference.duration.split(\":\")[0], \"hours\")\r\n        .add(createConference.duration.split(\":\")[1], \"minutes\");\r\n      const parsedConference = {\r\n        name: createConference.name,\r\n        waitMod: createConference.mdCheck,\r\n        startDatetime: `${momentStartDate.format(\"DD-MM-YYYY hh:mm:ss\")}`,\r\n        stopDatetime: `${momentFinalDate.format(\"DD-MM-YYYY hh:mm:ss\")}`,\r\n      };\r\n      squadService?.conferences.create(\r\n        parsedConference,\r\n        (createdConference) => {\r\n          const participantList: ConferenceRoomParticipant[] = [];\r\n          if (createdConference?.id) {\r\n            createConference.selectedContact?.forEach((ctc) => {\r\n              participantList.push({\r\n                userUuid: ctc.id,\r\n                description: \"\",\r\n                email: ctc.email,\r\n                name: ctc.name,\r\n                type: ConferenceRoomParticipantType.PARTICIPANT,\r\n                userModerator: false,\r\n              });\r\n            });\r\n            createConference.emailList?.forEach((participant) => {\r\n              participantList.push({\r\n                userUuid: null,\r\n                description: \"\",\r\n                email: participant.email,\r\n                name: participant.name,\r\n                type: ConferenceRoomParticipantType.PARTICIPANT_EXTERNAL,\r\n                userModerator: false,\r\n              });\r\n            });\r\n            squadService?.conferences.addParticipants(\r\n              createdConference.id,\r\n              participantList,\r\n              (s) => {\r\n                if (s) {\r\n                  setCreateConference(undefined);\r\n                  setListRooms(true);\r\n                }\r\n              }\r\n            );\r\n          }\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  useEffect(onChatsChange, [chats]);\r\n  useEffect(onNewFavorite, [newFavorite]);\r\n  useEffect(checkSearchMessages, [activeChat.messageLoaded]);\r\n  useEffect(onActiveChatChange, [activeChat]);\r\n  useEffect(onUserDataChange, [changedUserData]);\r\n  useEffect(onUserPasswordChange, [changedUserPassword]);\r\n  useEffect(onChangeStatus, [user.status]);\r\n  useEffect(forwardMessage, [forwardMessageList]);\r\n  useEffect(onSearchContacts, [contactsSearch]);\r\n  useEffect(onSearchContactsOutsideUserContacts, [showModalAddContact]);\r\n  useEffect(onAddingContacts, [toggleAddingContacts]);\r\n  useEffect(onRemovingMember, [removedMember, groupToRemoveContact]);\r\n  useEffect(onLeavingGroup, [memberQuit, groupIdOfLeaveRequest, groupJid]);\r\n  useEffect(onRemovingContact, [removedContact]);\r\n  useEffect(onAddingMembers, [groupToInsertMember, checkedMembers]);\r\n  useEffect(onToggleMemberRole, [toggleMemberRole]);\r\n  useEffect(onChangeGroupData, [changeGroupData]);\r\n  useEffect(onAddingContactOnGroupList, [clickedContact]);\r\n  useEffect(createGroup, [groupToCreate]);\r\n  useEffect(onToggleSidebarMenu, [showChatProfileSidebar]);\r\n  useEffect(onListRooms, [listRooms]);\r\n  useEffect(onCreateRoom, [createConference]);\r\n  useEffect(onFavoriteMessage, [favoriteMessagePayload]);\r\n  useEffect(onListFavoriteMessages, [flagToLoadFavoriteMessages]);\r\n  useEffect(onRemoveFavoriteMessage, [deleteFavoriteMessage]);\r\n\r\n  function onRemoveFavoriteMessage() {\r\n    squadService?.messages.deleteFavorite(\r\n      { messageId: deleteFavoriteMessage?.messageId as string },\r\n      (success) => {\r\n        if (success) {\r\n          setFlagToLoadFavoriteMessages({\r\n            contactType: deleteFavoriteMessage?.contactType as string,\r\n          });\r\n          setDeleteFavoriteMessage(undefined);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  function onListFavoriteMessages() {\r\n    if (flagToLoadFavoriteMessages) {\r\n      squadService?.messages.listFavorites(\r\n        {\r\n          contactTo: \"\",\r\n          contactType: flagToLoadFavoriteMessages.contactType,\r\n          content: \"\",\r\n          contentType: \"\",\r\n          messageDate: \"\",\r\n          messageId: \"\",\r\n          message: \"\",\r\n        },\r\n        (success) => {\r\n          if (success) {\r\n            setFavoriteMessages(success.messages.map((item) => item));\r\n            setFlagToLoadFavoriteMessages(undefined);\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  function onRemovingContact() {\r\n    if (removedContact) {\r\n      contacts.forEach((ctc) => {\r\n        if (ctc.id === removedContact.id) {\r\n          if (ctc.added)\r\n            squadService?.contacts.remove(ctc, (success: boolean) => {\r\n              if (success) {\r\n                squadService?.contacts.list((ctcs) => {\r\n                  setContacts(ctcs);\r\n                  setRemovedContact(undefined);\r\n                });\r\n              }\r\n            });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onUserPasswordChange() {\r\n    if (changedUserPassword) {\r\n      squadService?.user.changePassword(changedUserPassword, (password) => {\r\n        if (password) {\r\n          setChangedUserPassword({ oldPassword: \"\", newPassword: \"\" });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onUserDataChange() {\r\n    if (changedUserData) {\r\n      squadService?.user.changeUserData(changedUserData, (chgd) => {\r\n        if (chgd) {\r\n          setUser({\r\n            ...user,\r\n            email: changedUserData.email,\r\n            name: changedUserData.name,\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onNewFavorite() {\r\n    if (newFavorite) {\r\n      const newFavoriteLoad = { ...newFavorite };\r\n      squadService?.contacts.setFavorite(newFavorite, (favorite) => {\r\n        if (favorite) {\r\n          setChats(\r\n            chats.map((cht) => {\r\n              if (cht.jid === newFavoriteLoad.jid) {\r\n                cht.favorite = !newFavoriteLoad.favorite;\r\n              }\r\n              return cht;\r\n            })\r\n          );\r\n          setGroups(\r\n            groups.map((grp) => {\r\n              if (grp.jid === newFavoriteLoad.jid) {\r\n                return {\r\n                  ...grp,\r\n                  favorite: !newFavoriteLoad.favorite,\r\n                };\r\n              }\r\n              return grp;\r\n            })\r\n          );\r\n          setContacts(\r\n            contacts.map((ctt) => {\r\n              if (ctt.jid === newFavoriteLoad.jid) {\r\n                return {\r\n                  ...ctt,\r\n                  favorite: !newFavoriteLoad.favorite,\r\n                };\r\n              }\r\n              return ctt;\r\n            })\r\n          );\r\n        }\r\n      });\r\n      setNewFavorite(undefined);\r\n    }\r\n  }\r\n  function chatCommunicatorSubscribe(evt: string, data: any) {\r\n    switch (evt) {\r\n      case Events.RECONNECTED:\r\n        setDisconnected(false);\r\n      // eslint-disable-next-line\r\n      case Events.ONLINE:\r\n        squadService?.chats.list((receivedChats) => {\r\n          const chats: IChat[] = [];\r\n          receivedChats.forEach((cht) => {\r\n            if (!chats.find((chat) => chat.id === cht.id)) {\r\n              chats.push(cht);\r\n            }\r\n          });\r\n          setChats(chats);\r\n          //populating groups\r\n          squadService?.groups.list((groups) => {\r\n            setGroups(groups);\r\n            //Joining Groups Rooms in XMPP\r\n            squadService?.chat?.joinGroups(groups.map((group) => group.jid));\r\n          });\r\n          //populating contacts\r\n          squadService?.contacts.list((contacts) => {\r\n            setContacts(contacts);\r\n          });\r\n\r\n          //populating conferences\r\n          setListRooms(true);\r\n          //populating chat's with messages\r\n\r\n          // receivedChats.forEach((chat) => {\r\n          //   squadService?.messages.list(chat, (messages) => {\r\n          //     const chatWithMessages = { ...chat };\r\n          //     chatWithMessages.messages = chatWithMessages.messages.concat(\r\n          //       messages\r\n          //     );\r\n          //     setChats([\r\n          //       ...receivedChats.filter((cht) => chat.id !== cht.id),\r\n          //       chatWithMessages,\r\n          //     ]);\r\n          //   });\r\n          // });\r\n        });\r\n        break;\r\n      case Events.ERROR:\r\n      case Events.OFFLINE:\r\n        if (localStorage.getItem(\"logout\") !== \"true\") {\r\n          squadService?.chat?.makeChat(chatCommunicatorSubscribe);\r\n        }\r\n        localStorage.removeItem(\"logout\");\r\n        console.log(evt);\r\n        break;\r\n      case Events.RECONNECTING:\r\n        // setShowChat(false);\r\n        // setActiveChat(actChtData);\r\n        // setChats([]);\r\n        // setGroups([]);\r\n        // setContacts([]);\r\n        // setConferenceList([]);\r\n        console.log(\"Reconnecting\");\r\n        setDisconnected(true);\r\n        break;\r\n      case Events.MESSAGE:\r\n        if (data.fromUser === user.jid) break;\r\n        let find = false;\r\n\r\n        let newChats: IChat[] = [];\r\n        chats.forEach((chat) => {\r\n          if (\r\n            data.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            data.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            find = true;\r\n            if (!chat.messages.filter((msg) => msg.id === data.id)[0])\r\n              chat.messages.push(data);\r\n            if (chat.id === activeChat.id) {\r\n              let chatTemporary = { ...chat };\r\n              setActiveChat(chatTemporary);\r\n            } else {\r\n              chat.unRead++;\r\n              showNotification(chat.name);\r\n            }\r\n            newChats.unshift(chat);\r\n          } else {\r\n            newChats.push(chat);\r\n          }\r\n        });\r\n\r\n        if (!find) {\r\n          let newChat: IChat = {} as IChat;\r\n          squadService?.contacts.list((listContacts) => {\r\n            listContacts.forEach((c) => {\r\n              if (\r\n                data.fromUser.split(\"@\")[0] === c.jid.split(\"@\")[0] ||\r\n                data.toUser.split(\"@\")[0] === c.jid.split(\"@\")[0]\r\n              ) {\r\n                if (c.jid === data.fromUser) {\r\n                  find = true;\r\n                  newChat = {\r\n                    id: c.id,\r\n                    jid: c.jid,\r\n                    name: c.name,\r\n                    profilePicture: c.profilePicture,\r\n                    status: c.status,\r\n                    unRead: 1,\r\n                    chatType: ChatType.USER,\r\n                    inputMessage: \"\",\r\n                    isTyping: false,\r\n                    messages: [],\r\n                    favorite: c.favorite,\r\n                    added: c.added,\r\n                  };\r\n                  newChat.messages.push(data);\r\n                  newChats.unshift(newChat);\r\n                }\r\n              }\r\n            });\r\n          });\r\n        }\r\n\r\n        if (!find) {\r\n          let newChat: IChat = {} as IChat;\r\n\r\n          squadService?.groups.list((listGroups) => {\r\n            listGroups.forEach((g) => {\r\n              if (\r\n                data.fromUser.split(\"@\")[0] === g.jid.split(\"@\")[0] ||\r\n                data.toUser.split(\"@\")[0] === g.jid.split(\"@\")[0]\r\n              ) {\r\n                if (g.jid === data.fromUser) {\r\n                  find = true;\r\n                  newChat = {\r\n                    id: g.groupId,\r\n                    jid: g.jid,\r\n                    name: g.name,\r\n                    profilePicture: g.profilePicture,\r\n                    attachedFileList: undefined,\r\n                    conferenceRoomParticipants: undefined,\r\n                    department: undefined,\r\n                    email: undefined,\r\n                    groupId: g.groupId,\r\n                    members: g.members,\r\n                    messageLoaded: undefined,\r\n                    userDescription: undefined,\r\n                    status: undefined,\r\n                    unRead: 1,\r\n                    chatType: ChatType.GROUP,\r\n                    inputMessage: \"\",\r\n                    isTyping: false,\r\n                    messages: [],\r\n                    favorite: g.favorite,\r\n                    added: g.added,\r\n                  };\r\n                  newChat.messages.push(data);\r\n                  newChats.unshift(newChat);\r\n                }\r\n              }\r\n            });\r\n          });\r\n        }\r\n\r\n        setChats(newChats);\r\n\r\n        break;\r\n      case Events.RECEIVED:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.messages.find((msg) => msg.id === data.id))\r\n              chat.messages = chat.messages.map((message) => {\r\n                message.deliverStatus = DeliverStatus.DELIVERED;\r\n                return message;\r\n              });\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.DISPLAYED:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.messages.find((msg) => msg.id === data.id))\r\n              chat.messages = chat.messages.map((message) => {\r\n                message.readStatus = ReadStatus.READ;\r\n                return message;\r\n              });\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.COMPOSING:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.jid === data) {\r\n              chat.isTyping = true;\r\n              if (activeChat.jid === data) setActiveChat(chat);\r\n              deleteTypingTimeout(chat.jid);\r\n              setTypingTimeout(chat.jid);\r\n            }\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.ACTIVE:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.jid === data) {\r\n              chat.isTyping = false;\r\n              if (activeChat.jid === data) {\r\n                let chatUpdate = { ...chat };\r\n                setActiveChat(chatUpdate);\r\n              }\r\n              deleteTypingTimeout(chat.jid);\r\n            }\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.PRESENCE:\r\n        setChats(\r\n          chats.map((cht) => {\r\n            if (cht.jid && data.from) {\r\n              if (\r\n                cht.jid === data.from.split(\"/\")[0] &&\r\n                !cht.jid.includes(\"@conference.\")\r\n              ) {\r\n                cht.status = data.status;\r\n              }\r\n            }\r\n            return cht;\r\n          })\r\n        );\r\n        setContacts(\r\n          contacts.map((ctc) => {\r\n            if (ctc.jid && data.from) {\r\n              if (\r\n                ctc.jid === data.from.split(\"/\")[0] &&\r\n                !ctc.jid.includes(\"@conference.\")\r\n              ) {\r\n                ctc.status = data.status;\r\n              }\r\n            }\r\n            return ctc;\r\n          })\r\n        );\r\n        break;\r\n\r\n      case Events.SEND_EVENT:\r\n        const event = data as IMessage;\r\n        let finded;\r\n        let newChat: IChat[] = [];\r\n        chats.forEach((chat) => {\r\n          if (\r\n            event.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            event.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            finded = true;\r\n            if (!chat.messages.filter((msg) => msg.id === event.id)[0])\r\n              chat.messages.push(event);\r\n            if (chat.id === activeChat.id) {\r\n              let chatTemporary = { ...chat };\r\n              setActiveChat(chatTemporary);\r\n            } else {\r\n              chat.unRead++;\r\n              showNotification(chat.name);\r\n            }\r\n            newChat.unshift(chat);\r\n          } else {\r\n            newChat.push(chat);\r\n          }\r\n        });\r\n        if (!finded) {\r\n          groups.forEach((grp) => {\r\n            if (\r\n              event.fromUser.split(\"@\")[0] === grp.jid.split(\"@\")[0] ||\r\n              event.toUser.split(\"@\")[0] === grp.jid.split(\"@\")[0]\r\n            ) {\r\n              finded = true;\r\n              let groupToBeInserted: IChat = {\r\n                added: grp.added,\r\n                chatType: ChatType.GROUP,\r\n                favorite: grp.favorite,\r\n                id: grp.groupId,\r\n                inputMessage: \"\",\r\n                isTyping: false,\r\n                jid: grp.jid,\r\n                messages: [event],\r\n                name: grp.name,\r\n                unRead: 0,\r\n                attachedFileList: undefined,\r\n                department: undefined,\r\n                email: undefined,\r\n                groupId: grp.groupId,\r\n                members: grp.members,\r\n                messageLoaded: undefined,\r\n                profilePicture: grp.profilePicture,\r\n                status: undefined,\r\n                userDescription: grp.description,\r\n              };\r\n              newChat.unshift(groupToBeInserted);\r\n              setActiveChat(groupToBeInserted);\r\n            }\r\n          });\r\n        }\r\n        if (!finded) {\r\n          squadService?.groups.list((grps) => {\r\n            setGroups(grps);\r\n            grps.forEach((grp) => {\r\n              if (\r\n                event.fromUser.split(\"@\")[0] === grp.jid.split(\"@\")[0] ||\r\n                event.toUser.split(\"@\")[0] === grp.jid.split(\"@\")[0]\r\n              ) {\r\n                finded = true;\r\n                let groupToBeInserted: IChat = {\r\n                  added: grp.added,\r\n                  chatType: ChatType.GROUP,\r\n                  favorite: grp.favorite,\r\n                  id: grp.groupId,\r\n                  inputMessage: \"\",\r\n                  isTyping: false,\r\n                  jid: grp.jid,\r\n                  messages: [event],\r\n                  name: grp.name,\r\n                  unRead: 1,\r\n                  attachedFileList: undefined,\r\n                  department: undefined,\r\n                  email: undefined,\r\n                  groupId: grp.groupId,\r\n                  members: grp.members,\r\n                  messageLoaded: undefined,\r\n                  profilePicture: grp.profilePicture,\r\n                  status: undefined,\r\n                  userDescription: grp.description,\r\n                };\r\n                newChat.unshift(groupToBeInserted);\r\n              }\r\n            });\r\n          });\r\n        }\r\n        setChats(newChat);\r\n        if (event.eventId === 6 || event.eventId === 2) {\r\n          refreshMembers(event);\r\n        }\r\n        break;\r\n      default:\r\n        console.log(evt);\r\n        break;\r\n    }\r\n  }\r\n\r\n  const refreshMembers = (event: IMessage) => {\r\n    squadService?.groups.list((grps) => {\r\n      setGroups(grps);\r\n      setChats(\r\n        chats.map((chat) => {\r\n          if (\r\n            event.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            event.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            chat.members = grps.find((grp) => grp.groupId === chat.id)?.members;\r\n            if (chat.id === activeChat.id) {\r\n              setActiveChat(chat);\r\n            }\r\n          }\r\n          return chat;\r\n        })\r\n      );\r\n    });\r\n  };\r\n\r\n  const deleteTypingTimeout = (jid: string) => {\r\n    clearTimeout(typingTimeout.get(jid)?.timeout || setTimeout(() => {}, 1));\r\n    typingTimeout.delete(jid);\r\n  };\r\n  const setTypingTimeout = (jid: string) => {\r\n    const timeoutData: TypingTimeoutData = {\r\n      msgStr: \"\",\r\n      timeout: setTimeout(() => {\r\n        setChats(\r\n          chats.map((cht) => {\r\n            if (cht.jid === jid) {\r\n              cht.isTyping = false;\r\n              if (activeChat.jid === jid) setActiveChat(cht);\r\n            }\r\n            return cht;\r\n          })\r\n        );\r\n      }, 20000),\r\n    };\r\n    typingTimeout.set(jid, timeoutData);\r\n  };\r\n\r\n  squadService?.updateChatSubscribeFuncition(chatCommunicatorSubscribe);\r\n  // Comentado para evitar warnings no console enquanto não é usado\r\n  // function createGroup(group: INewGroup, callback: CreateGroupCallback) {\r\n  //   squadService?.groups.create(group, (iGroup: IGroup) => {\r\n  //     squadService?.groups.list((groups) => {\r\n  //       setGroups(groups);\r\n  //       callback(true);\r\n  //     });\r\n  //   });\r\n  // }\r\n\r\n  function sendMessage(\r\n    chat: IChat,\r\n    message: string,\r\n    callback: SendMessageCallback\r\n  ) {\r\n    squadService?.chat?.chat.sendMessage(\r\n      chat.jid,\r\n      chat.jid.includes(\"@conference.\")\r\n        ? XMPPChatType.GROUPCHAT\r\n        : XMPPChatType.CHAT,\r\n      message,\r\n      callback\r\n    );\r\n  }\r\n\r\n  useEffect(init, []);\r\n\r\n  return <></>;\r\n};\r\n\r\nexport default SquadCommunicator;\r\n"]},"metadata":{},"sourceType":"module"}