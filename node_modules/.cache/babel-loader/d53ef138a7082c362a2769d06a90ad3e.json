{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import SimpleBar from\"simplebar-react\";import{Spinner}from\"reactstrap\";import{useChat}from\"../contexts/ChatContext\";import ChatMessage from\"./ChatMessage\";import\"./../assets/css/reply-msg.scss\";import{useAuth}from\"../contexts/AuthContext\";import DeliverStatus from\"../enuns/DeliverStatus\";import ReadStatus from\"../enuns/ReadStatus\";import Swal from\"sweetalert2\";import ChatMessageDivisionData from\"./ChatMessageDivisionData\";import EventNotification from\"./EventNotification\";var scrollableNodeRef=React.createRef();var ChatBody=function ChatBody(){var _useChat=useChat(),activeChat=_useChat.activeChat,replyMsg=_useChat.replyMsg,chats=_useChat.chats,setChats=_useChat.setChats;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showButtonBottom=_useState2[0],setShowButtonBottom=_useState2[1];var _useAuth=useAuth(),user=_useAuth.user;var onAddMessage=function onAddMessage(file){setChats(chats.map(function(item){if(activeChat)if(item.id===(activeChat===null||activeChat===void 0?void 0:activeChat.id)){item.messages.push({id:\"\".concat(item.messages.length+1),userName:user.name,message:\"Carregando...\",time:\"\",isImageMessage:false,isFileMessage:false,isVideoMessage:false,isAudioMessage:false,fileUrl:\"\",sendFile:file,toUser:activeChat.id,fromUser:user.id,deliverStatus:DeliverStatus.SENDING,readStatus:ReadStatus.UNREAD,deliverTimestamp:\"\",readTimestamp:\"\",content:\"metadata\",contentType:\"type\",isReplyMessage:false,isForwardMessage:false});}return item;}));};var onScroll=function onScroll(ev){var _ev$target,_ev$target2;if((ev===null||ev===void 0?void 0:(_ev$target=ev.target)===null||_ev$target===void 0?void 0:_ev$target.scrollTop)<=(ev===null||ev===void 0?void 0:(_ev$target2=ev.target)===null||_ev$target2===void 0?void 0:_ev$target2.scrollHeight)-1000){setShowButtonBottom(true);}else{setShowButtonBottom(false);}};var scrolltoBottom=function scrolltoBottom(){var _scrollableNodeRef$cu;(_scrollableNodeRef$cu=scrollableNodeRef.current)===null||_scrollableNodeRef$cu===void 0?void 0:_scrollableNodeRef$cu.scrollTo({top:99999999});setShowButtonBottom(false);};var checkScroll=function checkScroll(){scrolltoBottom();if(scrollableNodeRef===null||scrollableNodeRef===void 0?void 0:scrollableNodeRef.current){scrollableNodeRef.current.onscroll=onScroll;}};var checkLoading=function checkLoading(){if(!activeChat.messageLoaded){scrolltoBottom();}};useEffect(checkLoading,[activeChat.messageLoaded]);useEffect(checkScroll,[activeChat]);var dropHandler=function dropHandler(ev){console.log(\"File(s) dropped\");// Impedir o comportamento padr達o (impedir que o arquivo seja aberto)\nev.preventDefault();if(ev.dataTransfer.items){// Use a interface DataTransferItemList para acessar o (s) arquivo (s)\nfor(var i=0;i<ev.dataTransfer.items.length;i++){// Se os itens soltos n達o forem arquivos, rejeite-os\nif(ev.dataTransfer.items[i].kind===\"file\"){var file=ev.dataTransfer.items[i].getAsFile();if(file&&file.size>15728640){Swal.fire({icon:\"error\",title:\"Oops...\",text:\"File size must be less than 15mb!\",footer:\"\",customClass:{popup:\"swal-mini-popup-file-size\"}});return;}else{if(file){onAddMessage(file);}}}}}else{// Use a interface DataTransfer para acessar o (s) arquivo (s)\n// eslint-disable-next-line no-redeclare\nfor(var i=0;i<ev.dataTransfer.files.length;i++){console.log(\"ELSE ... file[\"+i+\"].name = \"+ev.dataTransfer.files[i].name);}}};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(SimpleBar,{className:\"chat-conversation \".concat(replyMsg?\"reply\":\"\",\" p-3 p-lg-4\"),id:\"messages\",scrollableNodeProps:{ref:scrollableNodeRef}},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-center\"},/*#__PURE__*/React.createElement(Spinner,{color:\"primary\",className:\"\".concat(activeChat.messageLoaded?\"\":\"d-none\")})),/*#__PURE__*/React.createElement(\"ul\",{onDragOver:function onDragOver(e){return e.preventDefault();},onDrop:dropHandler,className:\"list-unstyled mb-0 \".concat(activeChat.messageLoaded?\"d-none\":\"\")},activeChat.messages.map(function(message,key){return/*#__PURE__*/React.createElement(\"div\",{key:key},/*#__PURE__*/React.createElement(ChatMessageDivisionData,{message:message,messages:activeChat.messages,i:key}),message.eventId?/*#__PURE__*/React.createElement(EventNotification,{msg:message}):/*#__PURE__*/React.createElement(ChatMessage,{activeChat:activeChat,message:message}));}))),showButtonBottom&&/*#__PURE__*/React.createElement(\"div\",{className:\"btn-chat-down\",style:replyMsg?{bottom:\"190px\"}:{},onClick:scrolltoBottom},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-arrow-down-s-line\"})));};export default ChatBody;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/components/ChatBody.tsx"],"names":["React","useState","useEffect","SimpleBar","Spinner","useChat","ChatMessage","useAuth","DeliverStatus","ReadStatus","Swal","ChatMessageDivisionData","EventNotification","scrollableNodeRef","createRef","ChatBody","activeChat","replyMsg","chats","setChats","showButtonBottom","setShowButtonBottom","user","onAddMessage","file","map","item","id","messages","push","length","userName","name","message","time","isImageMessage","isFileMessage","isVideoMessage","isAudioMessage","fileUrl","sendFile","toUser","fromUser","deliverStatus","SENDING","readStatus","UNREAD","deliverTimestamp","readTimestamp","content","contentType","isReplyMessage","isForwardMessage","onScroll","ev","target","scrollTop","scrollHeight","scrolltoBottom","current","scrollTo","top","checkScroll","onscroll","checkLoading","messageLoaded","dropHandler","console","log","preventDefault","dataTransfer","items","i","kind","getAsFile","size","fire","icon","title","text","footer","customClass","popup","files","ref","e","key","eventId","bottom"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport SimpleBar from \"simplebar-react\";\r\nimport { Spinner } from \"reactstrap\";\r\nimport { useChat } from \"../contexts/ChatContext\";\r\nimport ChatMessage from \"./ChatMessage\";\r\nimport \"./../assets/css/reply-msg.scss\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport DeliverStatus from \"../enuns/DeliverStatus\";\r\nimport ReadStatus from \"../enuns/ReadStatus\";\r\nimport Swal from \"sweetalert2\";\r\nimport ChatMessageDivisionData from \"./ChatMessageDivisionData\";\r\nimport EventNotification from \"./EventNotification\";\r\n\r\nconst scrollableNodeRef = React.createRef<HTMLDivElement>();\r\n\r\nconst ChatBody: React.FC = () => {\r\n  const { activeChat, replyMsg, chats, setChats } = useChat();\r\n  const [showButtonBottom, setShowButtonBottom] = useState(false);\r\n  const { user } = useAuth();\r\n\r\n  const onAddMessage = (file: File) => {\r\n    setChats(\r\n      chats.map((item) => {\r\n        if (activeChat)\r\n          if (item.id === activeChat?.id) {\r\n            item.messages.push({\r\n              id: `${item.messages.length + 1}`,\r\n              userName: user.name,\r\n              message: \"Carregando...\",\r\n              time: \"\",\r\n              isImageMessage: false,\r\n              isFileMessage: false,\r\n              isVideoMessage: false,\r\n              isAudioMessage: false,\r\n              fileUrl: \"\",\r\n              sendFile: file,\r\n              toUser: activeChat.id,\r\n              fromUser: user.id,\r\n              deliverStatus: DeliverStatus.SENDING,\r\n              readStatus: ReadStatus.UNREAD,\r\n              deliverTimestamp: \"\",\r\n              readTimestamp: \"\",\r\n              content: \"metadata\",\r\n              contentType: \"type\",\r\n              isReplyMessage: false,\r\n              isForwardMessage: false,\r\n            });\r\n          }\r\n        return item;\r\n      })\r\n    );\r\n  };\r\n\r\n  const onScroll = (ev: any) => {\r\n    if (ev?.target?.scrollTop <= ev?.target?.scrollHeight - 1000) {\r\n      setShowButtonBottom(true);\r\n    } else {\r\n      setShowButtonBottom(false);\r\n    }\r\n  };\r\n\r\n  const scrolltoBottom = () => {\r\n    scrollableNodeRef.current?.scrollTo({\r\n      top: 99999999,\r\n    });\r\n    setShowButtonBottom(false);\r\n  };\r\n\r\n  const checkScroll = () => {\r\n    scrolltoBottom();\r\n    if (scrollableNodeRef?.current) {\r\n      scrollableNodeRef.current.onscroll = onScroll;\r\n    }\r\n  };\r\n\r\n  const checkLoading = () => {\r\n    if (!activeChat.messageLoaded) {\r\n      scrolltoBottom();\r\n    }\r\n  };\r\n\r\n  useEffect(checkLoading, [activeChat.messageLoaded]);\r\n  useEffect(checkScroll, [activeChat]);\r\n\r\n  const dropHandler = (ev: React.DragEvent<HTMLElement>) => {\r\n    console.log(\"File(s) dropped\");\r\n\r\n    // Impedir o comportamento padr達o (impedir que o arquivo seja aberto)\r\n    ev.preventDefault();\r\n\r\n    if (ev.dataTransfer.items) {\r\n      // Use a interface DataTransferItemList para acessar o (s) arquivo (s)\r\n      for (var i = 0; i < ev.dataTransfer.items.length; i++) {\r\n        // Se os itens soltos n達o forem arquivos, rejeite-os\r\n        if (ev.dataTransfer.items[i].kind === \"file\") {\r\n          var file = ev.dataTransfer.items[i].getAsFile();\r\n          if (file && file.size > 15728640) {\r\n            Swal.fire({\r\n              icon: \"error\",\r\n              title: \"Oops...\",\r\n              text: \"File size must be less than 15mb!\",\r\n              footer: \"\",\r\n              customClass: {\r\n                popup: \"swal-mini-popup-file-size\"\r\n              }\r\n            });\r\n            return;\r\n          } else {\r\n            if (file) {\r\n              onAddMessage(file);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      // Use a interface DataTransfer para acessar o (s) arquivo (s)\r\n      // eslint-disable-next-line no-redeclare\r\n      for (var i = 0; i < ev.dataTransfer.files.length; i++) {\r\n        console.log(\r\n          \"ELSE ... file[\" + i + \"].name = \" + ev.dataTransfer.files[i].name\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* <DragNDropCaller /> */}\r\n      <SimpleBar\r\n        className={`chat-conversation ${replyMsg ? \"reply\" : \"\"} p-3 p-lg-4`}\r\n        id=\"messages\"\r\n        scrollableNodeProps={{ ref: scrollableNodeRef }}\r\n      >\r\n        <div className={`d-flex justify-content-center`}>\r\n          <Spinner\r\n            color=\"primary\"\r\n            className={`${activeChat.messageLoaded ? \"\" : \"d-none\"}`}\r\n          />\r\n        </div>\r\n        <ul\r\n          onDragOver={(e) => e.preventDefault()}\r\n          onDrop={dropHandler}\r\n          className={`list-unstyled mb-0 ${\r\n            activeChat.messageLoaded ? \"d-none\" : \"\"\r\n          }`}\r\n        >\r\n          {activeChat.messages.map((message, key) => (\r\n            <div key={key}>\r\n              <ChatMessageDivisionData\r\n                message={message}\r\n                messages={activeChat.messages}\r\n                i={key}\r\n              />\r\n              {message.eventId ? \r\n                <EventNotification msg={message}/>\r\n              :\r\n                <ChatMessage activeChat={activeChat} message={message} />\r\n              }\r\n            </div>\r\n          ))}\r\n        </ul>\r\n      </SimpleBar>\r\n      {showButtonBottom && (\r\n        <div\r\n          className=\"btn-chat-down\"\r\n          style={replyMsg ? { bottom: \"190px\" } : {}}\r\n          onClick={scrolltoBottom}\r\n        >\r\n          <i className=\"ri-arrow-down-s-line\"></i>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ChatBody;\r\n"]},"metadata":{},"sourceType":"module"}