{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\src\\\\services\\\\SquadCommunicator.tsx\";\nimport React, { createContext, useContext, useEffect } from \"react\";\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\nimport { useChat } from \"../contexts/ChatContext\";\nimport { useAuth } from \"../contexts/AuthContext\";\nimport { Events } from \"./chat/types/types\";\nlet squadService;\nexport const SquadCommunicatorContext = createContext({});\n\nconst SquadCommunicator = ({\n  children\n}) => {\n  const {\n    setChats,\n    setGroups,\n    setContacts\n  } = useChat();\n  const {\n    setUser\n  } = useAuth();\n\n  const init = () => {\n    var _squadService;\n\n    localStorage.setItem(\"authorization\", JSON.stringify({\n      access_token: \"e9e34268a0adb4b4f009b508de092e2c\",\n      user_id: \"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",\n      user_name: \"ZZ Romero 2\",\n      email: \"romero2@digivox.com.br\",\n      expires_in: 2592000,\n      baseUrl: \"https://app.citrussquad.com/api/v1/\"\n    }));\n    squadService = SquadService.getInstance(chatCommunicatorSubscribe);\n    (_squadService = squadService) === null || _squadService === void 0 ? void 0 : _squadService.getUser(user => {\n      setUser(user);\n    });\n  };\n\n  function chatCommunicatorSubscribe(event, data) {\n    var _squadService2;\n\n    switch (event) {\n      case Events.ONLINE:\n        (_squadService2 = squadService) === null || _squadService2 === void 0 ? void 0 : _squadService2.getChats(receivedChats => {\n          var _squadService3, _squadService4;\n\n          setChats(receivedChats); //populating groups\n\n          (_squadService3 = squadService) === null || _squadService3 === void 0 ? void 0 : _squadService3.getGroups(groups => setGroups(groups)); //populating contacts\n\n          (_squadService4 = squadService) === null || _squadService4 === void 0 ? void 0 : _squadService4.getContacts(contacts => setContacts(contacts)); //populating chat's with messages\n\n          receivedChats.forEach(chat => {\n            var _squadService5;\n\n            (_squadService5 = squadService) === null || _squadService5 === void 0 ? void 0 : _squadService5.getMessages(chat, messages => {\n              console.log(messages);\n              const chatWithMessages = { ...chat\n              };\n              chatWithMessages.messages = chatWithMessages.messages.concat(messages);\n              setChats([...receivedChats.filter(cht => chat.id !== cht.id), chatWithMessages]);\n            });\n          });\n        });\n        break;\n\n      case Events.MESSAGE:\n        console.log(data);\n        break;\n\n      case Events.PRESENCE:\n        console.log(data);\n        break;\n    }\n  }\n\n  function createGroup(group, callback) {\n    var _squadService6;\n\n    (_squadService6 = squadService) === null || _squadService6 === void 0 ? void 0 : _squadService6.createGroup(group, iGroup => {\n      var _squadService7;\n\n      (_squadService7 = squadService) === null || _squadService7 === void 0 ? void 0 : _squadService7.getGroups(groups => {\n        setGroups(groups);\n        callback(true);\n      });\n    });\n  }\n\n  function sendMessage(chat, message) {\n    var _squadService8;\n\n    (_squadService8 = squadService) === null || _squadService8 === void 0 ? void 0 : _squadService8.sendMessage(chat, message);\n  }\n\n  useEffect(init, []);\n  return /*#__PURE__*/React.createElement(SquadCommunicatorContext.Provider, {\n    value: {\n      createGroup,\n      sendFiles,\n      pasteFiles,\n      sendMessage\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }\n  }, children);\n};\n\nexport function sendFiles(chat, files) {\n  return;\n}\nexport function pasteFiles(chat, files) {\n  return;\n}\nexport function useSquadCommunicator() {\n  return useContext(SquadCommunicatorContext);\n}\nexport default SquadCommunicator;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/SquadCommunicator.tsx"],"names":["React","createContext","useContext","useEffect","SquadCommunicator","SquadService","useChat","useAuth","Events","squadService","SquadCommunicatorContext","children","setChats","setGroups","setContacts","setUser","init","localStorage","setItem","JSON","stringify","access_token","user_id","user_name","email","expires_in","baseUrl","getInstance","chatCommunicatorSubscribe","getUser","user","event","data","ONLINE","getChats","receivedChats","getGroups","groups","getContacts","contacts","forEach","chat","getMessages","messages","console","log","chatWithMessages","concat","filter","cht","id","MESSAGE","PRESENCE","createGroup","group","callback","iGroup","sendMessage","message","sendFiles","pasteFiles","files","useSquadCommunicator"],"mappings":"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","sourcesContent":["import React, { createContext, useContext, useEffect } from \"react\";\r\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\r\nimport { useChat } from \"../contexts/ChatContext\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport IUser from \"../alias/IUser\";\r\nimport IGroup from \"../alias/IGroup\";\r\nimport INewGroup from \"../alias/INewGroup\";\r\n\r\nimport { Events } from \"./chat/types/types\";\r\nimport IChat from \"../alias/IChat\";\r\nimport IFiles from \"../alias/IFiles\";\r\n\r\ninterface CreateGroupCallback {\r\n  (groupCreated: boolean): void;\r\n}\r\ninterface SquadCommunicatorContextData {\r\n  createGroup(group: INewGroup, callback: CreateGroupCallback): void;\r\n  sendMessage(chat: IChat, message: string): void;\r\n  sendFiles(chat: IChat, files: IFiles): void;\r\n  pasteFiles(chat: IChat, files: IFiles): void;\r\n}\r\nlet squadService: SquadService | undefined;\r\nexport const SquadCommunicatorContext = createContext<\r\n  SquadCommunicatorContextData\r\n>({} as SquadCommunicatorContextData);\r\n\r\nconst SquadCommunicator: React.FC = ({ children }) => {\r\n  const { setChats, setGroups, setContacts } = useChat();\r\n  const { setUser } = useAuth();\r\n  const init = () => {\r\n    localStorage.setItem(\r\n      \"authorization\",\r\n      JSON.stringify({\r\n        access_token: \"e9e34268a0adb4b4f009b508de092e2c\",\r\n        user_id: \"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",\r\n        user_name: \"ZZ Romero 2\",\r\n        email: \"romero2@digivox.com.br\",\r\n        expires_in: 2592000,\r\n        baseUrl: \"https://app.citrussquad.com/api/v1/\",\r\n      })\r\n    );\r\n\r\n    squadService = SquadService.getInstance(chatCommunicatorSubscribe);\r\n    squadService?.getUser((user: IUser) => {\r\n      setUser(user);\r\n    });\r\n  };\r\n  function chatCommunicatorSubscribe(event: string, data: any) {\r\n    switch (event) {\r\n      case Events.ONLINE:\r\n        squadService?.getChats((receivedChats) => {\r\n          setChats(receivedChats);\r\n          //populating groups\r\n          squadService?.getGroups((groups) => setGroups(groups));\r\n          //populating contacts\r\n          squadService?.getContacts((contacts) => setContacts(contacts));\r\n          //populating chat's with messages\r\n\r\n          receivedChats.forEach((chat) => {\r\n            squadService?.getMessages(chat, (messages) => {\r\n              console.log(messages);\r\n              const chatWithMessages = { ...chat };\r\n              chatWithMessages.messages = chatWithMessages.messages.concat(\r\n                messages\r\n              );\r\n              setChats([\r\n                ...receivedChats.filter((cht) => chat.id !== cht.id),\r\n                chatWithMessages,\r\n              ]);\r\n            });\r\n          });\r\n        });\r\n        break;\r\n      case Events.MESSAGE:\r\n        console.log(data);\r\n        break;\r\n      case Events.PRESENCE:\r\n        console.log(data);\r\n        break;\r\n    }\r\n  }\r\n  function createGroup(group: INewGroup, callback: CreateGroupCallback) {\r\n    squadService?.createGroup(group, (iGroup: IGroup) => {\r\n      squadService?.getGroups((groups) => {\r\n        setGroups(groups);\r\n        callback(true);\r\n      });\r\n    });\r\n  }\r\n  function sendMessage(chat: IChat, message: string) {\r\n    squadService?.sendMessage(chat, message);\r\n  }\r\n  useEffect(init, []);\r\n\r\n  return (\r\n    <SquadCommunicatorContext.Provider\r\n      value={{ createGroup, sendFiles, pasteFiles, sendMessage }}\r\n    >\r\n      {children}\r\n    </SquadCommunicatorContext.Provider>\r\n  );\r\n};\r\n\r\nexport function sendFiles(chat: IChat, files: IFiles) {\r\n  return;\r\n}\r\n\r\nexport function pasteFiles(chat: IChat, files: IFiles) {\r\n  return;\r\n}\r\n\r\nexport function useSquadCommunicator() {\r\n  return useContext(SquadCommunicatorContext);\r\n}\r\n\r\nexport default SquadCommunicator;\r\n"]},"metadata":{},"sourceType":"module"}