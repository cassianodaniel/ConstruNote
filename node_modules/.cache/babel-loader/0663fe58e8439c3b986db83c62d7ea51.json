{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{Button,Input,Row,Col,UncontrolledTooltip,ButtonDropdown,DropdownToggle,DropdownMenu,Label}from\"reactstrap\";import{Picker,Emoji}from\"emoji-mart\";import\"emoji-mart/css/emoji-mart.css\";import{ReactMic}from\"react-mic\";import{useChat}from\"../contexts/ChatContext\";import DeliverStatus from\"../enuns/DeliverStatus\";import ReadStatus from\"../enuns/ReadStatus\";import{useAuth}from\"../contexts/AuthContext\";import{blobToFile}from\"../helpers/AudioUtils\";import{useTranslation}from\"react-i18next\";import ChatInputAttachedFileButton from\"./ChatInputAttachedFileButton\";var ChatInput=function ChatInput(){var _useChat=useChat(),activeChat=_useChat.activeChat,setActiveChat=_useChat.setActiveChat;var _useAuth=useAuth(),user=_useAuth.user;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),textMessage=_useState2[0],setTextMessage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isOpen=_useState4[0],setisOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),record=_useState6[0],setRecord=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),deleteAudio=_useState8[0],setDeleteAudio=_useState8[1];var _useState9=useState(undefined),_useState10=_slicedToArray(_useState9,2),audioFile=_useState10[0],setAudioFile=_useState10[1];var toggle=function toggle(){return setisOpen(!isOpen);};var _useTranslation=useTranslation(),t=_useTranslation.t;var inputMessage;var handleChange=function handleChange(e){setTextMessage(e.target.value);};var addEmoji=function addEmoji(e){var emoji=e.native;setTextMessage(textMessage+emoji);};var onData=function onData(recordedBlob){console.log(\"chunk of real-time data is: \",recordedBlob);};var onStop=function onStop(recordedBlob){setAudioFile(blobToFile(recordedBlob.blob,\"\".concat(recordedBlob.blob,\".webm\")));};var onKeyPress=function onKeyPress(e){if(e.key===\"Enter\"&&!e.shiftKey){onAddMessage();e.preventDefault();}};var handlePaste=function handlePaste(e){e.persist();console.log(e);var files=e.clipboardData.files;console.log(e.clipboardData.getData(\"Text\"));if(files.length===0)return;var file=files[0];if(file.size>5242880){alert(\"Tamanho de arquivo \"+file.name+\" não suportado. Por favor, envie um arquivo menor do que 5mb!\");return;}else{onPasteMessage(file);}console.log(\"arquivo enviado\");};var onPasteMessage=function onPasteMessage(file){var chat=_objectSpread({},activeChat);chat.messages.push({id:\"\".concat(activeChat.messages.length+1),userName:user.name,message:\"Carregando...\",time:\"\",isImageMessage:false,isFileMessage:false,isVideoMessage:false,isAudioMessage:false,fileUrl:\"\",sendFile:file,toUser:activeChat.id,fromUser:user.id,deliverStatus:DeliverStatus.SENDING,readStatus:ReadStatus.UNREAD,deliverTimestamp:\"\",readTimestamp:\"\",content:\"metadata\",contentType:\"type\",isReplyMessage:false,isForwardMessage:false});setActiveChat(chat);};var onAddMessage=function onAddMessage(){if(textMessage.trim()!==\"\"){var chat=_objectSpread({},activeChat);chat.messages.push({id:\"\".concat(activeChat.messages.length+1),userName:user.name,message:textMessage.trim(),time:\"\",isImageMessage:false,isFileMessage:false,isVideoMessage:false,isAudioMessage:false,fileUrl:\"\",sendFile:undefined,toUser:activeChat.id,fromUser:user.id,deliverStatus:DeliverStatus.SENDING,readStatus:ReadStatus.UNREAD,deliverTimestamp:\"\",readTimestamp:\"\",content:\"metadata\",contentType:\"type\",isReplyMessage:false,isForwardMessage:false});setActiveChat(chat);}setTextMessage(\"\");};var sendAudio=function sendAudio(){if(!deleteAudio){audioFile&&onPasteMessage(audioFile);}else{setDeleteAudio(false);}};var updateFocus=function updateFocus(){var _inputMessage;(_inputMessage=inputMessage)===null||_inputMessage===void 0?void 0:_inputMessage.focus();};useEffect(sendAudio,[audioFile]);useEffect(updateFocus,[activeChat.id]);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"p-3 p-lg-4 border-top mb-0\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Row,{noGutters:true},/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(ReactMic,{record:record,className:\"sound-wave \".concat(record?\"\":\"d-none\"),onStop:onStop,onData:onData,strokeColor:\"#7a7f9a\",backgroundColor:\"#e6ebf5\"}),/*#__PURE__*/React.createElement(Input,{id:\"inputTextMessage\",innerRef:function innerRef(ref){return inputMessage=ref;},type:\"textarea\",style:{height:43,resize:\"none\"},value:textMessage,onKeyPress:onKeyPress,onChange:handleChange,onPaste:handlePaste,className:\"form-control form-control-lg bg-light border-light \".concat(record?\"d-none\":\"\"),placeholder:t(\"Send message...\")}),/*#__PURE__*/React.createElement(\"div\",{style:{color:\"red\",fontSize:12}},textMessage.length>9900?10000-textMessage.length+\" caracteres restantes\":null))),/*#__PURE__*/React.createElement(Col,{xs:\"auto\"},/*#__PURE__*/React.createElement(\"div\",{className:\"chat-input-links ml-md-2\"},/*#__PURE__*/React.createElement(\"ul\",{className:\"list-inline mb-0\"},!record?/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item\"},/*#__PURE__*/React.createElement(ButtonDropdown,{className:\"emoji-dropdown\",direction:\"up\",isOpen:isOpen,toggle:toggle},/*#__PURE__*/React.createElement(DropdownToggle,{id:\"emoji\",color:\"link\",className:\"text-decoration-none font-size-16 btn-lg waves-effect\"},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-emotion-happy-line\"})),/*#__PURE__*/React.createElement(DropdownMenu,{className:\"dropdown-menu-lg-right\"},/*#__PURE__*/React.createElement(Picker,{set:\"apple\",onSelect:addEmoji}),/*#__PURE__*/React.createElement(Emoji,{emoji:\"santa\",set:\"apple\",size:16}))),/*#__PURE__*/React.createElement(UncontrolledTooltip,{target:\"emoji\",placement:\"top\"},t(\"Emoji\"))):/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item input-file\"},/*#__PURE__*/React.createElement(Label,{id:\"audio\",className:\"btn btn-link text-decoration-none font-size-16 btn-lg waves-effect\",onClick:function onClick(){setDeleteAudio(true);setRecord(false);}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-delete-bin-5-line\"})),/*#__PURE__*/React.createElement(UncontrolledTooltip,{target:\"audio\",placement:\"top\"},t(\"Stop audio\"))),/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item input-file\"},/*#__PURE__*/React.createElement(Label,{id:\"audio\",className:\"btn btn-link text-decoration-none font-size-16 btn-lg waves-effect \".concat(record?\"text-record\":\"\"),onClick:function onClick(){return setRecord(!record);}},record?/*#__PURE__*/React.createElement(\"i\",{className:\"ri-stop-circle-line\"}):/*#__PURE__*/React.createElement(\"i\",{className:\"ri-mic-line\"})),/*#__PURE__*/React.createElement(UncontrolledTooltip,{target:\"audio\",placement:\"top\"},t(\"Audio\"))),/*#__PURE__*/React.createElement(ChatInputAttachedFileButton,null),/*#__PURE__*/React.createElement(\"li\",{className:\"list-inline-item\"},/*#__PURE__*/React.createElement(Button,{type:textMessage.length<10000?\"submit\":\"button\",color:\"primary\",className:\"font-size-16 btn-lg chat-send waves-effect waves-light\",onClick:function onClick(){return onAddMessage();}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-send-plane-2-fill\"}))))))))));};export default ChatInput;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/components/ChatInput.tsx"],"names":["React","useEffect","useState","Button","Input","Row","Col","UncontrolledTooltip","ButtonDropdown","DropdownToggle","DropdownMenu","Label","Picker","Emoji","ReactMic","useChat","DeliverStatus","ReadStatus","useAuth","blobToFile","useTranslation","ChatInputAttachedFileButton","ChatInput","activeChat","setActiveChat","user","textMessage","setTextMessage","isOpen","setisOpen","record","setRecord","deleteAudio","setDeleteAudio","undefined","audioFile","setAudioFile","toggle","t","inputMessage","handleChange","e","target","value","addEmoji","emoji","native","onData","recordedBlob","console","log","onStop","blob","onKeyPress","key","shiftKey","onAddMessage","preventDefault","handlePaste","persist","files","clipboardData","getData","length","file","size","alert","name","onPasteMessage","chat","messages","push","id","userName","message","time","isImageMessage","isFileMessage","isVideoMessage","isAudioMessage","fileUrl","sendFile","toUser","fromUser","deliverStatus","SENDING","readStatus","UNREAD","deliverTimestamp","readTimestamp","content","contentType","isReplyMessage","isForwardMessage","trim","sendAudio","updateFocus","focus","ref","height","resize","color","fontSize"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport {\r\n  Button,\r\n  Input,\r\n  Row,\r\n  Col,\r\n  UncontrolledTooltip,\r\n  ButtonDropdown,\r\n  DropdownToggle,\r\n  DropdownMenu,\r\n  Label,\r\n} from \"reactstrap\";\r\nimport { Picker, Emoji } from \"emoji-mart\";\r\nimport \"emoji-mart/css/emoji-mart.css\";\r\nimport { ReactMic, ReactMicStopEvent } from \"react-mic\";\r\nimport { useChat } from \"../contexts/ChatContext\";\r\nimport DeliverStatus from \"../enuns/DeliverStatus\";\r\nimport ReadStatus from \"../enuns/ReadStatus\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport { blobToFile } from \"../helpers/AudioUtils\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport ChatInputAttachedFileButton from \"./ChatInputAttachedFileButton\";\r\n\r\n\r\nconst ChatInput: React.FC = () => {\r\n  const { activeChat, setActiveChat } = useChat();\r\n  const { user } = useAuth();\r\n\r\n  const [textMessage, setTextMessage] = useState(\"\");\r\n  const [isOpen, setisOpen] = useState(false);\r\n  const [record, setRecord] = useState(false);\r\n  const [deleteAudio, setDeleteAudio] = useState(false);\r\n  const [audioFile, setAudioFile] = useState<File | undefined>(undefined);\r\n  const toggle = () => setisOpen(!isOpen);\r\n  const { t } = useTranslation();\r\n\r\n  let inputMessage: HTMLInputElement | HTMLTextAreaElement | null;\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setTextMessage(e.target.value);\r\n  };\r\n\r\n  const addEmoji = (e: any) => {\r\n    let emoji = e.native;\r\n    setTextMessage(textMessage + emoji);\r\n  };\r\n\r\n  const onData = (recordedBlob: any) => {\r\n    console.log(\"chunk of real-time data is: \", recordedBlob);\r\n  };\r\n\r\n  const onStop = (recordedBlob: ReactMicStopEvent) => {\r\n    setAudioFile(blobToFile(recordedBlob.blob, `${recordedBlob.blob}.webm`));\r\n  };\r\n\r\n  const onKeyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === \"Enter\" && !e.shiftKey) {\r\n      onAddMessage();\r\n      e.preventDefault();\r\n    }\r\n  };\r\n\r\n  const handlePaste = (e: React.ClipboardEvent<HTMLInputElement>) => {\r\n    e.persist();\r\n    console.log(e);\r\n    let files = e.clipboardData.files;\r\n    console.log(e.clipboardData.getData(\"Text\"));\r\n\r\n    if (files.length === 0) return;\r\n    let file = files[0];\r\n    if (file.size > 5242880) {\r\n      alert(\r\n        \"Tamanho de arquivo \" +\r\n          file.name +\r\n          \" não suportado. Por favor, envie um arquivo menor do que 5mb!\"\r\n      );\r\n      return;\r\n    } else {\r\n      onPasteMessage(file);\r\n    }\r\n    console.log(\"arquivo enviado\");\r\n  };\r\n\r\n  const onPasteMessage = (file: File) => {\r\n    let chat = { ...activeChat };\r\n\r\n    chat.messages.push({\r\n      id: `${activeChat.messages.length + 1}`,\r\n      userName: user.name,\r\n      message: \"Carregando...\",\r\n      time: \"\",\r\n      isImageMessage: false,\r\n      isFileMessage: false,\r\n      isVideoMessage: false,\r\n      isAudioMessage: false,\r\n      fileUrl: \"\",\r\n      sendFile: file,\r\n      toUser: activeChat.id,\r\n      fromUser: user.id,\r\n      deliverStatus: DeliverStatus.SENDING,\r\n      readStatus: ReadStatus.UNREAD,\r\n      deliverTimestamp: \"\",\r\n      readTimestamp: \"\",\r\n      content: \"metadata\",\r\n      contentType: \"type\",\r\n      isReplyMessage: false,\r\n      isForwardMessage: false,\r\n    });\r\n\r\n    setActiveChat(chat);\r\n  };\r\n\r\n  const onAddMessage = () => {\r\n    if (textMessage.trim() !== \"\") {\r\n      let chat = { ...activeChat };\r\n\r\n      chat.messages.push({\r\n        id: `${activeChat.messages.length + 1}`,\r\n        userName: user.name,\r\n        message: textMessage.trim(),\r\n        time: \"\",\r\n        isImageMessage: false,\r\n        isFileMessage: false,\r\n        isVideoMessage: false,\r\n        isAudioMessage: false,\r\n        fileUrl: \"\",\r\n        sendFile: undefined,\r\n        toUser: activeChat.id,\r\n        fromUser: user.id,\r\n        deliverStatus: DeliverStatus.SENDING,\r\n        readStatus: ReadStatus.UNREAD,\r\n        deliverTimestamp: \"\",\r\n        readTimestamp: \"\",\r\n        content: \"metadata\",\r\n        contentType: \"type\",\r\n        isReplyMessage: false,\r\n        isForwardMessage: false,\r\n      });\r\n      setActiveChat(chat);\r\n    }\r\n\r\n    setTextMessage(\"\");\r\n  };\r\n\r\n  const sendAudio = () => {\r\n    if (!deleteAudio) {\r\n      audioFile && onPasteMessage(audioFile);\r\n    } else {\r\n      setDeleteAudio(false);\r\n    }\r\n  };\r\n  const updateFocus = () => {\r\n    inputMessage?.focus();\r\n  };\r\n  useEffect(sendAudio, [audioFile]);\r\n  useEffect(updateFocus, [activeChat.id]);\r\n  return (\r\n    <React.Fragment>\r\n      <div className=\"p-3 p-lg-4 border-top mb-0\">\r\n        <div>\r\n          <Row noGutters>\r\n            <Col>\r\n              <div>\r\n                <ReactMic\r\n                  record={record}\r\n                  className={`sound-wave ${record ? \"\" : \"d-none\"}`}\r\n                  onStop={onStop}\r\n                  onData={onData}\r\n                  strokeColor=\"#7a7f9a\"\r\n                  backgroundColor=\"#e6ebf5\"\r\n                />\r\n                <Input\r\n                  id=\"inputTextMessage\"\r\n                  innerRef={(ref) => (inputMessage = ref)}\r\n                  type=\"textarea\"\r\n                  style={{ height: 43, resize: \"none\"}}\r\n                  value={textMessage}\r\n                  onKeyPress={onKeyPress}\r\n                  onChange={handleChange}\r\n                  onPaste={handlePaste}\r\n                  className={`form-control form-control-lg bg-light border-light ${\r\n                    record ? \"d-none\" : \"\"\r\n                  }`}\r\n                  placeholder={t(\"Send message...\")}\r\n                >\r\n                </Input>\r\n                  \r\n                <div\r\n                  style={{\r\n                    color: \"red\",\r\n                    fontSize: 12,\r\n                  }}\r\n                >\r\n                  {textMessage.length > 9900\r\n                    ? 10000 - textMessage.length + \" caracteres restantes\"\r\n                    : null}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n            <Col xs=\"auto\">\r\n              <div className=\"chat-input-links ml-md-2\">\r\n                <ul className=\"list-inline mb-0\">\r\n                  {!record ? (\r\n                    <li className=\"list-inline-item\">\r\n                      <ButtonDropdown\r\n                        className=\"emoji-dropdown\"\r\n                        direction=\"up\"\r\n                        isOpen={isOpen}\r\n                        toggle={toggle}\r\n                      >\r\n                        <DropdownToggle\r\n                          id=\"emoji\"\r\n                          color=\"link\"\r\n                          className=\"text-decoration-none font-size-16 btn-lg waves-effect\"\r\n                        >\r\n                          <i className=\"ri-emotion-happy-line\"></i>\r\n                        </DropdownToggle>\r\n                        <DropdownMenu className=\"dropdown-menu-lg-right\">\r\n                          <Picker set=\"apple\" onSelect={addEmoji} />\r\n                          <Emoji emoji=\"santa\" set=\"apple\" size={16} />\r\n                        </DropdownMenu>\r\n                      </ButtonDropdown>\r\n                      <UncontrolledTooltip target=\"emoji\" placement=\"top\">\r\n                        {t(\"Emoji\")}\r\n                      </UncontrolledTooltip>\r\n                    </li>\r\n                  ) : (\r\n                    <li className=\"list-inline-item input-file\">\r\n                      <Label\r\n                        id=\"audio\"\r\n                        className={`btn btn-link text-decoration-none font-size-16 btn-lg waves-effect`}\r\n                        onClick={() => {\r\n                          setDeleteAudio(true);\r\n                          setRecord(false);\r\n                        }}\r\n                      >\r\n                        <i className=\"ri-delete-bin-5-line\" />\r\n                      </Label>\r\n                      <UncontrolledTooltip target=\"audio\" placement=\"top\">\r\n                        {t(\"Stop audio\")}\r\n                      </UncontrolledTooltip>\r\n                    </li>\r\n                  )}\r\n                  <li className=\"list-inline-item input-file\">\r\n                    <Label\r\n                      id=\"audio\"\r\n                      className={`btn btn-link text-decoration-none font-size-16 btn-lg waves-effect ${\r\n                        record ? \"text-record\" : \"\"\r\n                      }`}\r\n                      onClick={() => setRecord(!record)}\r\n                    >\r\n                      {record ? (\r\n                        <i className=\"ri-stop-circle-line\" />\r\n                      ) : (\r\n                        <i className=\"ri-mic-line\" />\r\n                      )}\r\n                    </Label>\r\n                    <UncontrolledTooltip target=\"audio\" placement=\"top\">\r\n                      {t(\"Audio\")}\r\n                    </UncontrolledTooltip>\r\n                  </li>\r\n                  <ChatInputAttachedFileButton/>\r\n\r\n                  <li className=\"list-inline-item\">\r\n                    <Button\r\n                      type={textMessage.length < 10000 ? \"submit\" : \"button\"}\r\n                      color=\"primary\"\r\n                      className=\"font-size-16 btn-lg chat-send waves-effect waves-light\"\r\n                      onClick={() => onAddMessage()}\r\n                    >\r\n                      <i className=\"ri-send-plane-2-fill\"></i>\r\n                    </Button>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default ChatInput;\r\n"]},"metadata":{},"sourceType":"module"}