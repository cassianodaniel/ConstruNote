{"ast":null,"code":"import React, { useEffect, useState } from \"react\";\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\nimport { useGroup } from \"../contexts/GroupContext\";\nimport { useContact } from \"../contexts/ContactContext\";\nimport { Events as VoiceEvents } from \"./voice/types/types\";\nimport { useCall } from \"../contexts/CallContext\";\nimport CallStatus from \"../enuns/CallStatus\";\nimport { useConference } from \"../contexts/ConferenceContext\";\nimport { ConferenceEvents } from \"./SquadEventsCommunicator\";\nimport { IConnectionStatus } from \"../alias/IUser\";\nimport { useAuth } from \"../contexts/AuthContext\";\nimport { useChat } from \"../contexts/ChatContext\"; //import { callbackify } from \"util\";\n// import IContact from \"../alias/IContact\";\n// Comentado para Evitar Warnings no console\n// interface CreateGroupCallback {\n//   (groupCreated: boolean): void;\n// }\n\nlet squadService;\n\nconst SquadSipCommunicator = () => {\n  const {\n    chats,\n    setChats\n  } = useChat();\n  const {\n    contacts\n  } = useContact();\n  const {\n    user,\n    setUser\n  } = useAuth();\n  const {\n    currentCalls,\n    setCurrentCalls,\n    callNumber,\n    setCallNumber,\n    updateConstraints,\n    setUpdateConstraints,\n    blindTransfer,\n    setBlindTransfer,\n    assistedTransfer,\n    setAssistedTransfer,\n    conferenceCommand,\n    setConferenceCommand\n  } = useCall();\n  const {\n    groups,\n    setGroups\n  } = useGroup();\n  const {\n    conferenceList,\n    setConferenceList\n  } = useConference();\n  const [conferenceIds, setConferenceIds] = useState([]);\n\n  const init = () => {\n    squadService = SquadService.getInstance({\n      voiceCB: voiceCommuncatorSubscribe\n    });\n  };\n\n  const setNewCall = call => {\n    const cc = new Map(currentCalls);\n    cc.set(call.callId, call);\n    setCurrentCalls(cc);\n  };\n\n  const removeCall = call => {\n    if (call.interval) clearTimeout(call.interval);\n    const cc = new Map(currentCalls);\n    cc.delete(call.callId);\n    setCurrentCalls(cc);\n  };\n\n  const onMakeCall = () => {\n    if (callNumber === null || callNumber === void 0 ? void 0 : callNumber.number) {\n      var _squadService, _squadService$sip;\n\n      if (currentCalls) {\n        Array.from(currentCalls.values()).forEach(call => {\n          if (!call.hold) {\n            call.holdCall();\n          }\n        });\n      }\n\n      const constraints = {\n        useAudio: callNumber === null || callNumber === void 0 ? void 0 : callNumber.useAudio,\n        useVideo: callNumber === null || callNumber === void 0 ? void 0 : callNumber.useVideo\n      };\n      (_squadService = squadService) === null || _squadService === void 0 ? void 0 : (_squadService$sip = _squadService.sip) === null || _squadService$sip === void 0 ? void 0 : _squadService$sip.makeCall(callNumber === null || callNumber === void 0 ? void 0 : callNumber.number, constraints);\n      setCallNumber(undefined);\n    }\n  };\n\n  const onUpdateConstraints = () => {\n    if (updateConstraints) {\n      var _squadService2;\n\n      (_squadService2 = squadService) === null || _squadService2 === void 0 ? void 0 : _squadService2.sip.updateConstraintsParams(updateConstraints);\n      setUpdateConstraints(undefined);\n    }\n  };\n\n  const onBlindTransfer = () => {\n    if (blindTransfer) {\n      var _squadService3;\n\n      (_squadService3 = squadService) === null || _squadService3 === void 0 ? void 0 : _squadService3.sip.sip.blindTransfer(blindTransfer.callId, blindTransfer.number);\n      setBlindTransfer(undefined);\n    }\n  };\n\n  const onAttendedTransfer = () => {\n    if (assistedTransfer) {\n      var _squadService4;\n\n      (_squadService4 = squadService) === null || _squadService4 === void 0 ? void 0 : _squadService4.sip.sip.attendedTransfer(assistedTransfer.firstCallId, assistedTransfer.secondCallId);\n      setAssistedTransfer(undefined);\n    }\n  };\n\n  const onCallHoldChange = (callId, status) => {\n    const currentCallsCopy = new Map(currentCalls);\n    let cpc = currentCallsCopy.get(callId);\n\n    if (cpc) {\n      cpc = { ...cpc\n      };\n      cpc.hold = status;\n      currentCallsCopy.set(cpc.callId, cpc);\n      setCurrentCalls(currentCallsCopy);\n    }\n  };\n\n  const onAcceptCall = (callId, useVideo) => {\n    const currentCallsCopy = new Map(currentCalls);\n    Array.from(currentCalls.values()).filter(cl => cl.callId !== callId).forEach(cl => {\n      var _squadService5;\n\n      (_squadService5 = squadService) === null || _squadService5 === void 0 ? void 0 : _squadService5.sip.holdCall(cl.callId);\n      cl.hold = true;\n      currentCallsCopy.set(cl.callId, cl);\n    });\n    let callCopy = currentCallsCopy.get(callId);\n\n    if (callCopy) {\n      callCopy = { ...callCopy\n      };\n      callCopy.callStatus = CallStatus.CONNECTING;\n      callCopy.sendingVideo = useVideo;\n      currentCallsCopy.set(callCopy.callId, callCopy);\n      setCurrentCalls(currentCallsCopy);\n    }\n  };\n\n  const onSendConferenceCommand = () => {\n    if (conferenceCommand) {\n      var _squadService6;\n\n      (_squadService6 = squadService) === null || _squadService6 === void 0 ? void 0 : _squadService6.events.sendCommand(conferenceCommand.conferenceId, conferenceCommand.command, conferenceCommand.extraParam);\n      setConferenceCommand(undefined);\n    }\n  };\n\n  const parseConferenceParticipant = m => {\n    return {\n      memberId: m[\"Member-ID\"],\n      callerName: m.Caller_Caller_ID_Name,\n      conferenceName: m.Conference_Name,\n      callName: m.Caller_Name,\n      floor: m.Floor,\n      hear: m.Hear,\n      hold: m.Hold,\n      memberGhost: m[\"Member-Ghost\"],\n      memberType: m[\"Member-Type\"],\n      mute: m.Speak,\n      muteDetect: m[\"Mute-Detect\"],\n      see: m.See,\n      talking: m.Talking,\n      video: m.See\n    };\n  };\n\n  const setConferenceParticipantsCall = data => {\n    let conferenceCall = Array.from(currentCalls.values()).find(c => {\n      var _ref, _ref2, _data$members$;\n\n      return [(_ref = c.callerObject) === null || _ref === void 0 ? void 0 : _ref.id, (_ref2 = c.callerObject) === null || _ref2 === void 0 ? void 0 : _ref2.groupId].includes((_data$members$ = data.members[0]) === null || _data$members$ === void 0 ? void 0 : _data$members$.Conference_Name);\n    });\n\n    if (conferenceCall) {\n      conferenceCall = { ...conferenceCall\n      };\n      if (!conferenceCall.conferenceParticipants) conferenceCall.conferenceParticipants = [];\n      conferenceCall.conferenceParticipants = data.members.map(m => {\n        var _conferenceCall;\n\n        if (m.Caller_Name === ((_conferenceCall = conferenceCall) === null || _conferenceCall === void 0 ? void 0 : _conferenceCall.session.remoteIdentity.uri.aor.split(\"@\")[0])) {\n          conferenceCall.micMuted = !m.Speak;\n          conferenceCall.videoMuted = !m.See;\n        }\n\n        return parseConferenceParticipant(m);\n      });\n      setNewCall({ ...conferenceCall\n      });\n    }\n  };\n\n  const setConferenceParticipantsChat = data => {\n    var _data$members$2;\n\n    console.log(\"---- bateu aq setConferenceparticipants ----\");\n    console.log(data);\n    const objectId = (_data$members$2 = data.members[0]) === null || _data$members$2 === void 0 ? void 0 : _data$members$2.Conference_Name;\n    const members = data.members.map(m => parseConferenceParticipant(m));\n    let object = groups.find(g => g.groupId.includes(objectId)) || conferenceList.find(c => c.id.includes(objectId));\n\n    if (object) {\n      setChats(chats.map(cht => {\n        if (cht.jid === (object === null || object === void 0 ? void 0 : object.jid)) {\n          cht.conferenceParticipants = members;\n        }\n\n        return cht;\n      }));\n      setGroups(groups.map(g => {\n        if (g.jid === (object === null || object === void 0 ? void 0 : object.jid)) {\n          g.conferenceParticipants = members;\n        }\n\n        return g;\n      }));\n      setConferenceList(conferenceList.map(c => {\n        if (c.jid === (object === null || object === void 0 ? void 0 : object.jid)) {\n          c.conferenceParticipants = members;\n        }\n\n        return c;\n      }));\n    }\n  };\n\n  const setConferenceParticipants = data => {\n    setConferenceParticipantsCall(data);\n    setConferenceParticipantsChat(data);\n  };\n\n  const onSetEventsAvailable = () => {\n    console.log(\"---- bateu aq onSetEvents ----\");\n    const updatedConferenceIds = [...conferenceList.map(c => c.jid), ...groups.map(g => g.jid)];\n    let changed = false;\n    updatedConferenceIds.forEach(id => {\n      if (!conferenceIds.includes(id)) changed = true;\n    });\n\n    if (changed) {\n      var _squadService7;\n\n      setConferenceIds(updatedConferenceIds);\n      if ((_squadService7 = squadService) === null || _squadService7 === void 0 ? void 0 : _squadService7.events.currentSocket) hangupEvents();\n      setConferenceEvents([...conferenceList, ...groups]);\n    }\n  };\n\n  const setConferenceEvents = conferences => {\n    var _squadService8;\n\n    const callsId = conferences.map(c => c.jid.split(\"@\")[0]);\n    (_squadService8 = squadService) === null || _squadService8 === void 0 ? void 0 : _squadService8.events.connect(callsId, conferenceEventsSubscribe);\n  };\n\n  const hangupEvents = () => {\n    var _squadService9;\n\n    (_squadService9 = squadService) === null || _squadService9 === void 0 ? void 0 : _squadService9.events.disconnect();\n  };\n\n  function voiceCommuncatorSubscribe(event, data) {\n    var _invitation$remoteIde, _invitation$remoteIde2, _ref3, _ref4, _ref5, _inviter$sessionDescr, _inviter$remoteIdenti, _inviter$remoteIdenti2, _ref6, _ref7, _ref8, _data$invitation, _data$inviter;\n\n    let endCall;\n\n    switch (event) {\n      case VoiceEvents.CONNECTED:\n        setUser({ ...user,\n          connectionStatus: IConnectionStatus.CONNECTED\n        });\n        console.log(\"connected\");\n        break;\n\n      case VoiceEvents.DISCONNECTED:\n        setUser({ ...user,\n          connectionStatus: IConnectionStatus.DISCONNECTED\n        });\n        break;\n\n      case VoiceEvents.RECEIVED_CALL:\n        const invitation = data;\n        const invitation_caller_id_number = (_invitation$remoteIde = invitation.remoteIdentity.uri.aor) === null || _invitation$remoteIde === void 0 ? void 0 : (_invitation$remoteIde2 = _invitation$remoteIde.split(\"@\")[0]) === null || _invitation$remoteIde2 === void 0 ? void 0 : _invitation$remoteIde2.replace(\"sip:\", \"\").replace(\"citrus-conference-authenticated-\", \"\").replace(\"citrus-conference_\", \"\").split(\"_\")[0];\n        const invitation_ctct_of_number = contacts.find(ctc => ctc.number === invitation_caller_id_number) || groups.find(grp => grp.groupId === invitation_caller_id_number) || conferenceList.find(conf => conf.id === invitation_caller_id_number);\n        let receivedCall;\n\n        endCall = () => {\n          var _squadService10;\n\n          (_squadService10 = squadService) === null || _squadService10 === void 0 ? void 0 : _squadService10.sip.sip.endCall(invitation);\n        };\n\n        receivedCall = {\n          callId: invitation.id,\n          callStatus: CallStatus.RINGING,\n          callerNumber: invitation_caller_id_number,\n          callerObject: invitation_ctct_of_number,\n          callerId: ((_ref3 = invitation_ctct_of_number) === null || _ref3 === void 0 ? void 0 : _ref3.id) || ((_ref4 = invitation_ctct_of_number) === null || _ref4 === void 0 ? void 0 : _ref4.groupId),\n          callerName: invitation_ctct_of_number === null || invitation_ctct_of_number === void 0 ? void 0 : invitation_ctct_of_number.name,\n          callerProfilePicture: invitation_ctct_of_number === null || invitation_ctct_of_number === void 0 ? void 0 : invitation_ctct_of_number.profilePicture,\n          session: invitation,\n          isGroup: !!((_ref5 = invitation_ctct_of_number) === null || _ref5 === void 0 ? void 0 : _ref5.groupId),\n          accept: (useVideo = false) => {\n            var _squadService11;\n\n            return (_squadService11 = squadService) === null || _squadService11 === void 0 ? void 0 : _squadService11.sip.acceptCall(invitation, useVideo);\n          },\n          endCall,\n          micMuted: false,\n          videoMuted: false,\n          hold: false,\n          muteMic: () => {\n            var _squadService12;\n\n            return (_squadService12 = squadService) === null || _squadService12 === void 0 ? void 0 : _squadService12.sip.muteMic(invitation.id);\n          },\n          unMuteMic: () => {\n            var _squadService13;\n\n            return (_squadService13 = squadService) === null || _squadService13 === void 0 ? void 0 : _squadService13.sip.unMuteMic(invitation.id);\n          },\n          disableCam: () => {\n            var _squadService14;\n\n            return (_squadService14 = squadService) === null || _squadService14 === void 0 ? void 0 : _squadService14.sip.disableCam(invitation.id);\n          },\n          enableCam: () => {\n            var _squadService15;\n\n            return (_squadService15 = squadService) === null || _squadService15 === void 0 ? void 0 : _squadService15.sip.enableCam(invitation.id);\n          },\n          holdCall: () => {\n            var _squadService16;\n\n            return (_squadService16 = squadService) === null || _squadService16 === void 0 ? void 0 : _squadService16.sip.holdCall(invitation.id);\n          },\n          unHoldCall: () => {\n            var _squadService17;\n\n            return (_squadService17 = squadService) === null || _squadService17 === void 0 ? void 0 : _squadService17.sip.unHoldCall(invitation.id);\n          },\n          sendDTMF: dtmf => {\n            var _squadService18;\n\n            return (_squadService18 = squadService) === null || _squadService18 === void 0 ? void 0 : _squadService18.sip.sip.sendDTMF(invitation.id, dtmf);\n          }\n        };\n        let conferenceId;\n\n        if (invitation_ctct_of_number.groupId) {\n          conferenceId = `${invitation_ctct_of_number.groupId}`;\n        } else if (invitation_ctct_of_number.participantPin) {\n          conferenceId = `${invitation_ctct_of_number.id}`;\n        }\n\n        if (conferenceId) {\n          receivedCall.shareScreen = () => {\n            var _squadService19;\n\n            (_squadService19 = squadService) === null || _squadService19 === void 0 ? void 0 : _squadService19.sip.sip.conferenceScreenShare(conferenceId);\n          };\n        }\n\n        setNewCall(receivedCall);\n        break;\n\n      case VoiceEvents.MAKE_CALL:\n        const inviter = data;\n        const localConstraints = inviter === null || inviter === void 0 ? void 0 : (_inviter$sessionDescr = inviter.sessionDescriptionHandlerOptions) === null || _inviter$sessionDescr === void 0 ? void 0 : _inviter$sessionDescr.constraints;\n        const inviter_caller_id_number = (_inviter$remoteIdenti = inviter.remoteIdentity.uri.aor) === null || _inviter$remoteIdenti === void 0 ? void 0 : (_inviter$remoteIdenti2 = _inviter$remoteIdenti.split(\"@\")[0]) === null || _inviter$remoteIdenti2 === void 0 ? void 0 : _inviter$remoteIdenti2.replace(\"sip:\", \"\").replace(\"citrus-conference-authenticated-\", \"\").replace(\"citrus-conference_\", \"\").split(\"_\")[0];\n        const inviter_ctct_of_number = contacts.find(ctc => ctc.number === inviter_caller_id_number) || groups.find(grp => grp.groupId === inviter_caller_id_number) || conferenceList.find(conf => conf.id === inviter_caller_id_number);\n\n        endCall = () => {\n          var _squadService20;\n\n          (_squadService20 = squadService) === null || _squadService20 === void 0 ? void 0 : _squadService20.sip.sip.endCall(inviter);\n        };\n\n        const sendCall = {\n          callId: inviter.id,\n          callStatus: CallStatus.CALLING,\n          callerNumber: inviter_caller_id_number,\n          callerObject: inviter_ctct_of_number,\n          callerId: ((_ref6 = inviter_ctct_of_number) === null || _ref6 === void 0 ? void 0 : _ref6.id) || ((_ref7 = inviter_ctct_of_number) === null || _ref7 === void 0 ? void 0 : _ref7.groupId),\n          callerName: inviter_ctct_of_number === null || inviter_ctct_of_number === void 0 ? void 0 : inviter_ctct_of_number.name,\n          callerProfilePicture: inviter_ctct_of_number === null || inviter_ctct_of_number === void 0 ? void 0 : inviter_ctct_of_number.profilePicture,\n          session: inviter,\n          isGroup: !!((_ref8 = inviter_ctct_of_number) === null || _ref8 === void 0 ? void 0 : _ref8.groupId),\n          sendingVideo: (localConstraints === null || localConstraints === void 0 ? void 0 : localConstraints.video) !== false,\n          endCall,\n          muteMic: () => {\n            var _squadService21;\n\n            return (_squadService21 = squadService) === null || _squadService21 === void 0 ? void 0 : _squadService21.sip.muteMic(inviter.id);\n          },\n          unMuteMic: () => {\n            var _squadService22;\n\n            return (_squadService22 = squadService) === null || _squadService22 === void 0 ? void 0 : _squadService22.sip.unMuteMic(inviter.id);\n          },\n          disableCam: () => {\n            var _squadService23;\n\n            return (_squadService23 = squadService) === null || _squadService23 === void 0 ? void 0 : _squadService23.sip.disableCam(inviter.id);\n          },\n          enableCam: () => {\n            var _squadService24;\n\n            return (_squadService24 = squadService) === null || _squadService24 === void 0 ? void 0 : _squadService24.sip.enableCam(inviter.id);\n          },\n          holdCall: () => {\n            var _squadService25;\n\n            return (_squadService25 = squadService) === null || _squadService25 === void 0 ? void 0 : _squadService25.sip.holdCall(inviter.id);\n          },\n          unHoldCall: () => {\n            var _squadService26;\n\n            return (_squadService26 = squadService) === null || _squadService26 === void 0 ? void 0 : _squadService26.sip.unHoldCall(inviter.id);\n          },\n          sendDTMF: dtmf => {\n            var _squadService27;\n\n            return (_squadService27 = squadService) === null || _squadService27 === void 0 ? void 0 : _squadService27.sip.sip.sendDTMF(inviter.id, dtmf);\n          }\n        };\n        let conferenceID;\n\n        if (inviter_ctct_of_number.groupId) {\n          conferenceID = `${inviter_ctct_of_number.groupId}`;\n        } else if (inviter_ctct_of_number.participantPin) {\n          conferenceID = `${inviter_ctct_of_number.id}`;\n        }\n\n        if (conferenceID) {\n          sendCall.shareScreen = () => {\n            var _squadService28;\n\n            (_squadService28 = squadService) === null || _squadService28 === void 0 ? void 0 : _squadService28.sip.sip.conferenceScreenShare(conferenceID);\n          };\n\n          sendCall.endCall = () => {\n            var _squadService29, _squadService30;\n\n            (_squadService29 = squadService) === null || _squadService29 === void 0 ? void 0 : _squadService29.sip.sip.endCall(inviter);\n            (_squadService30 = squadService) === null || _squadService30 === void 0 ? void 0 : _squadService30.sip.sip.endScreenShare();\n          };\n        }\n\n        setNewCall(sendCall);\n        console.log(\"make_call\");\n        break;\n\n      case VoiceEvents.CALL_ON_GOING:\n        const callOnGoing = currentCalls.get(data === null || data === void 0 ? void 0 : (_data$invitation = data.invitation) === null || _data$invitation === void 0 ? void 0 : _data$invitation.id) || currentCalls.get(data === null || data === void 0 ? void 0 : (_data$inviter = data.inviter) === null || _data$inviter === void 0 ? void 0 : _data$inviter.id);\n\n        if (callOnGoing) {\n          const cc = { ...callOnGoing\n          };\n          cc.callStatus = CallStatus.ON_GOING;\n          cc.receivingVideo = data.receivingVideo;\n          cc.tagId = data.tagId;\n          setNewCall(cc); // squadService?.sip.sip.screenShare(\n          //   `citrus-conference-authenticated-${\n          //     (cc.callerObject as IGroup)?.groupId\n          //   }`\n          // );\n        }\n\n        break;\n\n      case VoiceEvents.CALL_HANGUP:\n        const hangupCall = currentCalls.get(data.id);\n\n        if (hangupCall) {\n          removeCall(hangupCall);\n        }\n\n        break;\n\n      case VoiceEvents.MUTE_MIC:\n        const currentCallsCopy = new Map(currentCalls);\n        let cc = currentCallsCopy.get(data.callId);\n\n        if (cc) {\n          cc = { ...cc\n          };\n          cc.micMuted = data.status;\n          currentCallsCopy.set(cc.callId, cc);\n          setCurrentCalls(currentCallsCopy);\n        }\n\n        break;\n\n      case VoiceEvents.MUTE_CAM:\n        const currentCallsCp = new Map(currentCalls);\n        let ccp = currentCallsCp.get(data.callId);\n\n        if (ccp) {\n          ccp = { ...ccp\n          };\n          ccp.videoMuted = data.status;\n          currentCallsCp.set(ccp.callId, ccp);\n          setCurrentCalls(currentCallsCp);\n        }\n\n        break;\n\n      case VoiceEvents.HOLD_CALL:\n        onCallHoldChange(data.callId, data.status);\n        break;\n\n      case VoiceEvents.ACCEPTED_CALL:\n        onAcceptCall(data.callId, data.useVideo);\n        break;\n\n      default:\n        console.log(event);\n        break;\n    }\n  }\n\n  const conferenceEventsSubscribe = (event, data) => {\n    switch (event) {\n      case ConferenceEvents.UPDATE:\n        setConferenceParticipants(data);\n        break;\n\n      default:\n        console.error(\"EVENT NOT MAPPED\");\n        console.log(event, data);\n        break;\n    }\n  };\n\n  const updateFunction = () => {\n    var _squadService31, _squadService32;\n\n    (_squadService31 = squadService) === null || _squadService31 === void 0 ? void 0 : _squadService31.updateVoiceSubscribeFunction(voiceCommuncatorSubscribe);\n    (_squadService32 = squadService) === null || _squadService32 === void 0 ? void 0 : _squadService32.updateEventsSubscribeFunction(conferenceEventsSubscribe);\n  };\n\n  useEffect(init, []);\n  useEffect(onSetEventsAvailable, [groups, conferenceList]);\n  useEffect(updateFunction, [contacts, groups, currentCalls, callNumber, user]);\n  useEffect(onMakeCall, [callNumber]);\n  useEffect(onUpdateConstraints, [updateConstraints]);\n  useEffect(onBlindTransfer, [blindTransfer]);\n  useEffect(onAttendedTransfer, [assistedTransfer]);\n  useEffect(onSendConferenceCommand, [conferenceCommand]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null);\n};\n\nexport default SquadSipCommunicator;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/SquadSipCommunicator.tsx"],"names":["React","useEffect","useState","SquadCommunicator","SquadService","useGroup","useContact","Events","VoiceEvents","useCall","CallStatus","useConference","ConferenceEvents","IConnectionStatus","useAuth","useChat","squadService","SquadSipCommunicator","chats","setChats","contacts","user","setUser","currentCalls","setCurrentCalls","callNumber","setCallNumber","updateConstraints","setUpdateConstraints","blindTransfer","setBlindTransfer","assistedTransfer","setAssistedTransfer","conferenceCommand","setConferenceCommand","groups","setGroups","conferenceList","setConferenceList","conferenceIds","setConferenceIds","init","getInstance","voiceCB","voiceCommuncatorSubscribe","setNewCall","call","cc","Map","set","callId","removeCall","interval","clearTimeout","delete","onMakeCall","number","Array","from","values","forEach","hold","holdCall","constraints","useAudio","useVideo","sip","makeCall","undefined","onUpdateConstraints","updateConstraintsParams","onBlindTransfer","onAttendedTransfer","attendedTransfer","firstCallId","secondCallId","onCallHoldChange","status","currentCallsCopy","cpc","get","onAcceptCall","filter","cl","callCopy","callStatus","CONNECTING","sendingVideo","onSendConferenceCommand","events","sendCommand","conferenceId","command","extraParam","parseConferenceParticipant","m","memberId","callerName","Caller_Caller_ID_Name","conferenceName","Conference_Name","callName","Caller_Name","floor","Floor","hear","Hear","Hold","memberGhost","memberType","mute","Speak","muteDetect","see","See","talking","Talking","video","setConferenceParticipantsCall","data","conferenceCall","find","c","callerObject","id","groupId","includes","members","conferenceParticipants","map","session","remoteIdentity","uri","aor","split","micMuted","videoMuted","setConferenceParticipantsChat","console","log","objectId","object","g","cht","jid","setConferenceParticipants","onSetEventsAvailable","updatedConferenceIds","changed","currentSocket","hangupEvents","setConferenceEvents","conferences","callsId","connect","conferenceEventsSubscribe","disconnect","event","endCall","CONNECTED","connectionStatus","DISCONNECTED","RECEIVED_CALL","invitation","invitation_caller_id_number","replace","invitation_ctct_of_number","ctc","grp","conf","receivedCall","RINGING","callerNumber","callerId","name","callerProfilePicture","profilePicture","isGroup","accept","acceptCall","muteMic","unMuteMic","disableCam","enableCam","unHoldCall","sendDTMF","dtmf","participantPin","shareScreen","conferenceScreenShare","MAKE_CALL","inviter","localConstraints","sessionDescriptionHandlerOptions","inviter_caller_id_number","inviter_ctct_of_number","sendCall","CALLING","conferenceID","endScreenShare","CALL_ON_GOING","callOnGoing","ON_GOING","receivingVideo","tagId","CALL_HANGUP","hangupCall","MUTE_MIC","MUTE_CAM","currentCallsCp","ccp","HOLD_CALL","ACCEPTED_CALL","UPDATE","error","updateFunction","updateVoiceSubscribeFunction","updateEventsSubscribeFunction"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\r\nimport { useGroup } from \"../contexts/GroupContext\";\r\nimport { useContact } from \"../contexts/ContactContext\";\r\nimport IContact from \"../alias/IContact\";\r\nimport IGroup from \"../alias/IGroup\";\r\nimport { Events as VoiceEvents } from \"./voice/types/types\";\r\nimport { useCall } from \"../contexts/CallContext\";\r\nimport ICall from \"../alias/ICall\";\r\nimport { Invitation, Inviter } from \"sip.js\";\r\nimport CallStatus from \"../enuns/CallStatus\";\r\nimport { useConference } from \"../contexts/ConferenceContext\";\r\nimport {\r\n  ConferenceEvent,\r\n  ConferenceEventData,\r\n  ConferenceEvents,\r\n} from \"./SquadEventsCommunicator\";\r\nimport { IConference } from \"../alias/IConference\";\r\nimport IUser, { IConnectionStatus } from \"../alias/IUser\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport { useChat } from \"../contexts/ChatContext\";\r\n//import { callbackify } from \"util\";\r\n\r\n// import IContact from \"../alias/IContact\";\r\n// Comentado para Evitar Warnings no console\r\n// interface CreateGroupCallback {\r\n//   (groupCreated: boolean): void;\r\n// }\r\n\r\nlet squadService: SquadService | undefined;\r\n\r\nconst SquadSipCommunicator: React.FC = () => {\r\n  const { chats, setChats } = useChat();\r\n  const { contacts } = useContact();\r\n  const { user, setUser } = useAuth();\r\n  const {\r\n    currentCalls,\r\n    setCurrentCalls,\r\n    callNumber,\r\n    setCallNumber,\r\n    updateConstraints,\r\n    setUpdateConstraints,\r\n    blindTransfer,\r\n    setBlindTransfer,\r\n    assistedTransfer,\r\n    setAssistedTransfer,\r\n    conferenceCommand,\r\n    setConferenceCommand,\r\n  } = useCall();\r\n  const { groups, setGroups } = useGroup();\r\n  const { conferenceList, setConferenceList } = useConference();\r\n  const [conferenceIds, setConferenceIds] = useState<string[]>([]);\r\n  const init = () => {\r\n    squadService = SquadService.getInstance({\r\n      voiceCB: voiceCommuncatorSubscribe,\r\n    });\r\n  };\r\n  const setNewCall = (call: ICall) => {\r\n    const cc = new Map<string, ICall>(currentCalls);\r\n    cc.set(call.callId, call);\r\n    setCurrentCalls(cc);\r\n  };\r\n  const removeCall = (call: ICall) => {\r\n    if (call.interval) clearTimeout(call.interval);\r\n    const cc = new Map<string, ICall>(currentCalls);\r\n    cc.delete(call.callId);\r\n    setCurrentCalls(cc);\r\n  };\r\n  const onMakeCall = () => {\r\n    if (callNumber?.number) {\r\n      if (currentCalls) {\r\n        Array.from(currentCalls.values()).forEach((call) => {\r\n          if (!call.hold) {\r\n            call.holdCall();\r\n          }\r\n        });\r\n      }\r\n      const constraints = {\r\n        useAudio: callNumber?.useAudio,\r\n        useVideo: callNumber?.useVideo,\r\n      };\r\n      squadService?.sip?.makeCall(callNumber?.number, constraints);\r\n      setCallNumber(undefined);\r\n    }\r\n  };\r\n  const onUpdateConstraints = () => {\r\n    if (updateConstraints) {\r\n      squadService?.sip.updateConstraintsParams(updateConstraints);\r\n      setUpdateConstraints(undefined);\r\n    }\r\n  };\r\n  const onBlindTransfer = () => {\r\n    if (blindTransfer) {\r\n      squadService?.sip.sip.blindTransfer(\r\n        blindTransfer.callId,\r\n        blindTransfer.number\r\n      );\r\n      setBlindTransfer(undefined);\r\n    }\r\n  };\r\n  const onAttendedTransfer = () => {\r\n    if (assistedTransfer) {\r\n      squadService?.sip.sip.attendedTransfer(\r\n        assistedTransfer.firstCallId,\r\n        assistedTransfer.secondCallId\r\n      );\r\n      setAssistedTransfer(undefined);\r\n    }\r\n  };\r\n  const onCallHoldChange = (callId: string, status: boolean) => {\r\n    const currentCallsCopy = new Map(currentCalls);\r\n    let cpc = currentCallsCopy.get(callId);\r\n    if (cpc) {\r\n      cpc = { ...cpc };\r\n      cpc.hold = status;\r\n      currentCallsCopy.set(cpc.callId, cpc);\r\n      setCurrentCalls(currentCallsCopy);\r\n    }\r\n  };\r\n  const onAcceptCall = (callId: string, useVideo: boolean) => {\r\n    const currentCallsCopy = new Map(currentCalls);\r\n    Array.from(currentCalls.values())\r\n      .filter((cl) => cl.callId !== callId)\r\n      .forEach((cl) => {\r\n        squadService?.sip.holdCall(cl.callId);\r\n        cl.hold = true;\r\n        currentCallsCopy.set(cl.callId, cl);\r\n      });\r\n    let callCopy = currentCallsCopy.get(callId);\r\n    if (callCopy) {\r\n      callCopy = { ...callCopy };\r\n      callCopy.callStatus = CallStatus.CONNECTING;\r\n      callCopy.sendingVideo = useVideo;\r\n      currentCallsCopy.set(callCopy.callId, callCopy);\r\n      setCurrentCalls(currentCallsCopy);\r\n    }\r\n  };\r\n  const onSendConferenceCommand = () => {\r\n    if (conferenceCommand) {\r\n      squadService?.events.sendCommand(\r\n        conferenceCommand.conferenceId,\r\n        conferenceCommand.command,\r\n        conferenceCommand.extraParam\r\n      );\r\n      setConferenceCommand(undefined);\r\n    }\r\n  };\r\n  const parseConferenceParticipant = (m: ConferenceEventData) => {\r\n    return {\r\n      memberId: m[\"Member-ID\"],\r\n      callerName: m.Caller_Caller_ID_Name,\r\n      conferenceName: m.Conference_Name,\r\n      callName: m.Caller_Name,\r\n      floor: m.Floor,\r\n      hear: m.Hear,\r\n      hold: m.Hold,\r\n      memberGhost: m[\"Member-Ghost\"],\r\n      memberType: m[\"Member-Type\"],\r\n      mute: m.Speak,\r\n      muteDetect: m[\"Mute-Detect\"],\r\n      see: m.See,\r\n      talking: m.Talking,\r\n      video: m.See,\r\n    };\r\n  };\r\n  const setConferenceParticipantsCall = (data: ConferenceEvent) => {\r\n    let conferenceCall = Array.from(currentCalls.values()).find((c) =>\r\n      [\r\n        (c.callerObject as IConference)?.id,\r\n        (c.callerObject as IGroup)?.groupId,\r\n      ].includes(data.members[0]?.Conference_Name)\r\n    );\r\n    if (conferenceCall) {\r\n      conferenceCall = { ...conferenceCall };\r\n      if (!conferenceCall.conferenceParticipants)\r\n        conferenceCall.conferenceParticipants = [];\r\n      conferenceCall.conferenceParticipants = data.members.map((m) => {\r\n        if (\r\n          m.Caller_Name ===\r\n          conferenceCall?.session.remoteIdentity.uri.aor.split(\"@\")[0]\r\n        ) {\r\n          conferenceCall.micMuted = !m.Speak;\r\n          conferenceCall.videoMuted = !m.See;\r\n        }\r\n        return parseConferenceParticipant(m);\r\n      });\r\n\r\n      setNewCall({ ...conferenceCall });\r\n    }\r\n  };\r\n  const setConferenceParticipantsChat = (data: ConferenceEvent) => {\r\n    console.log(\"---- bateu aq setConferenceparticipants ----\");\r\n    console.log(data);\r\n    const objectId = data.members[0]?.Conference_Name;\r\n    const members = data.members.map((m) => parseConferenceParticipant(m));\r\n    let object =\r\n      groups.find((g) => g.groupId.includes(objectId)) ||\r\n      conferenceList.find((c) => c.id.includes(objectId));\r\n    if (object) {\r\n      setChats(\r\n        chats.map((cht) => {\r\n          if (cht.jid === object?.jid) {\r\n            cht.conferenceParticipants = members;\r\n          }\r\n          return cht;\r\n        })\r\n      );\r\n      setGroups(\r\n        groups.map((g) => {\r\n          if (g.jid === object?.jid) {\r\n            g.conferenceParticipants = members;\r\n          }\r\n          return g;\r\n        })\r\n      );\r\n      setConferenceList(\r\n        conferenceList.map((c) => {\r\n          if (c.jid === object?.jid) {\r\n            c.conferenceParticipants = members;\r\n          }\r\n          return c;\r\n        })\r\n      );\r\n    }\r\n  };\r\n  const setConferenceParticipants = (data: ConferenceEvent) => {\r\n    setConferenceParticipantsCall(data);\r\n    setConferenceParticipantsChat(data);\r\n  };\r\n  const onSetEventsAvailable = () => {\r\n    console.log(\"---- bateu aq onSetEvents ----\");\r\n    const updatedConferenceIds = [\r\n      ...conferenceList.map((c) => c.jid),\r\n      ...groups.map((g) => g.jid),\r\n    ];\r\n    let changed = false;\r\n    updatedConferenceIds.forEach((id) => {\r\n      if (!conferenceIds.includes(id)) changed = true;\r\n    });\r\n    if (changed) {\r\n      setConferenceIds(updatedConferenceIds);\r\n      if (squadService?.events.currentSocket) hangupEvents();\r\n      setConferenceEvents([...conferenceList, ...groups]);\r\n    }\r\n  };\r\n  const setConferenceEvents = (conferences: (IGroup | IConference)[]) => {\r\n    const callsId = conferences.map((c) => c.jid.split(\"@\")[0]);\r\n    squadService?.events.connect(callsId, conferenceEventsSubscribe);\r\n  };\r\n  const hangupEvents = () => {\r\n    squadService?.events.disconnect();\r\n  };\r\n  function voiceCommuncatorSubscribe(event: VoiceEvents, data: any) {\r\n    let endCall;\r\n    switch (event) {\r\n      case VoiceEvents.CONNECTED:\r\n        setUser({\r\n          ...user,\r\n          connectionStatus: IConnectionStatus.CONNECTED,\r\n        } as IUser);\r\n        console.log(\"connected\");\r\n        break;\r\n      case VoiceEvents.DISCONNECTED:\r\n        setUser({\r\n          ...user,\r\n          connectionStatus: IConnectionStatus.DISCONNECTED,\r\n        } as IUser);\r\n        break;\r\n      case VoiceEvents.RECEIVED_CALL:\r\n        const invitation = data as Invitation;\r\n        const invitation_caller_id_number = invitation.remoteIdentity.uri.aor\r\n          ?.split(\"@\")[0]\r\n          ?.replace(\"sip:\", \"\")\r\n          .replace(\"citrus-conference-authenticated-\", \"\")\r\n          .replace(\"citrus-conference_\", \"\")\r\n          .split(\"_\")[0];\r\n        const invitation_ctct_of_number =\r\n          contacts.find((ctc) => ctc.number === invitation_caller_id_number) ||\r\n          groups.find((grp) => grp.groupId === invitation_caller_id_number) ||\r\n          conferenceList.find(\r\n            (conf) => conf.id === invitation_caller_id_number\r\n          );\r\n        let receivedCall: ICall;\r\n        endCall = () => {\r\n          squadService?.sip.sip.endCall(invitation);\r\n        };\r\n        receivedCall = {\r\n          callId: invitation.id,\r\n          callStatus: CallStatus.RINGING,\r\n          callerNumber: invitation_caller_id_number,\r\n          callerObject: invitation_ctct_of_number,\r\n          callerId:\r\n            (invitation_ctct_of_number as IContact)?.id ||\r\n            (invitation_ctct_of_number as IGroup)?.groupId,\r\n          callerName: invitation_ctct_of_number?.name,\r\n          callerProfilePicture: invitation_ctct_of_number?.profilePicture,\r\n          session: invitation,\r\n          isGroup: !!(invitation_ctct_of_number as IGroup)?.groupId,\r\n          accept: (useVideo = false) =>\r\n            squadService?.sip.acceptCall(invitation, useVideo),\r\n          endCall,\r\n          micMuted: false,\r\n          videoMuted: false,\r\n          hold: false,\r\n          muteMic: () => squadService?.sip.muteMic(invitation.id),\r\n          unMuteMic: () => squadService?.sip.unMuteMic(invitation.id),\r\n          disableCam: () => squadService?.sip.disableCam(invitation.id),\r\n          enableCam: () => squadService?.sip.enableCam(invitation.id),\r\n          holdCall: () => squadService?.sip.holdCall(invitation.id),\r\n          unHoldCall: () => squadService?.sip.unHoldCall(invitation.id),\r\n          sendDTMF: (dtmf: string) =>\r\n            squadService?.sip.sip.sendDTMF(invitation.id, dtmf),\r\n        };\r\n        let conferenceId: string | undefined;\r\n        if ((invitation_ctct_of_number as IGroup).groupId) {\r\n          conferenceId = `${(invitation_ctct_of_number as IGroup).groupId}`;\r\n        } else if ((invitation_ctct_of_number as IConference).participantPin) {\r\n          conferenceId = `${(invitation_ctct_of_number as IConference).id}`;\r\n        }\r\n        if (conferenceId) {\r\n          receivedCall.shareScreen = () => {\r\n            squadService?.sip.sip.conferenceScreenShare(conferenceId);\r\n          };\r\n        }\r\n        setNewCall(receivedCall);\r\n        break;\r\n      case VoiceEvents.MAKE_CALL:\r\n        const inviter = data as Inviter;\r\n        const localConstraints = inviter?.sessionDescriptionHandlerOptions\r\n          ?.constraints as MediaStreamConstraints;\r\n        const inviter_caller_id_number = inviter.remoteIdentity.uri.aor\r\n          ?.split(\"@\")[0]\r\n          ?.replace(\"sip:\", \"\")\r\n          .replace(\"citrus-conference-authenticated-\", \"\")\r\n          .replace(\"citrus-conference_\", \"\")\r\n          .split(\"_\")[0];\r\n        const inviter_ctct_of_number =\r\n          contacts.find((ctc) => ctc.number === inviter_caller_id_number) ||\r\n          groups.find((grp) => grp.groupId === inviter_caller_id_number) ||\r\n          conferenceList.find((conf) => conf.id === inviter_caller_id_number);\r\n\r\n        endCall = () => {\r\n          squadService?.sip.sip.endCall(inviter);\r\n        };\r\n        const sendCall: ICall = {\r\n          callId: inviter.id,\r\n          callStatus: CallStatus.CALLING,\r\n          callerNumber: inviter_caller_id_number,\r\n          callerObject: inviter_ctct_of_number,\r\n          callerId:\r\n            (inviter_ctct_of_number as IContact)?.id ||\r\n            (inviter_ctct_of_number as IGroup)?.groupId,\r\n          callerName: inviter_ctct_of_number?.name,\r\n          callerProfilePicture: inviter_ctct_of_number?.profilePicture,\r\n          session: inviter,\r\n          isGroup: !!(inviter_ctct_of_number as IGroup)?.groupId,\r\n          sendingVideo: localConstraints?.video !== false,\r\n          endCall,\r\n          muteMic: () => squadService?.sip.muteMic(inviter.id),\r\n          unMuteMic: () => squadService?.sip.unMuteMic(inviter.id),\r\n          disableCam: () => squadService?.sip.disableCam(inviter.id),\r\n          enableCam: () => squadService?.sip.enableCam(inviter.id),\r\n          holdCall: () => squadService?.sip.holdCall(inviter.id),\r\n          unHoldCall: () => squadService?.sip.unHoldCall(inviter.id),\r\n          sendDTMF: (dtmf: string) =>\r\n            squadService?.sip.sip.sendDTMF(inviter.id, dtmf),\r\n        };\r\n        let conferenceID: string | undefined;\r\n        if ((inviter_ctct_of_number as IGroup).groupId) {\r\n          conferenceID = `${(inviter_ctct_of_number as IGroup).groupId}`;\r\n        } else if ((inviter_ctct_of_number as IConference).participantPin) {\r\n          conferenceID = `${(inviter_ctct_of_number as IConference).id}`;\r\n        }\r\n        if (conferenceID) {\r\n          sendCall.shareScreen = () => {\r\n            squadService?.sip.sip.conferenceScreenShare(conferenceID);\r\n          };\r\n          sendCall.endCall = () => {\r\n            squadService?.sip.sip.endCall(inviter);\r\n            squadService?.sip.sip.endScreenShare();\r\n          };\r\n        }\r\n        setNewCall(sendCall);\r\n        console.log(\"make_call\");\r\n        break;\r\n      case VoiceEvents.CALL_ON_GOING:\r\n        const callOnGoing =\r\n          currentCalls.get(data?.invitation?.id) ||\r\n          currentCalls.get(data?.inviter?.id);\r\n        if (callOnGoing) {\r\n          const cc = { ...callOnGoing };\r\n          cc.callStatus = CallStatus.ON_GOING;\r\n          cc.receivingVideo = data.receivingVideo;\r\n          cc.tagId = data.tagId;\r\n          setNewCall(cc);\r\n          // squadService?.sip.sip.screenShare(\r\n          //   `citrus-conference-authenticated-${\r\n          //     (cc.callerObject as IGroup)?.groupId\r\n          //   }`\r\n          // );\r\n        }\r\n        break;\r\n      case VoiceEvents.CALL_HANGUP:\r\n        const hangupCall = currentCalls.get(data.id);\r\n        if (hangupCall) {\r\n          removeCall(hangupCall);\r\n        }\r\n        break;\r\n      case VoiceEvents.MUTE_MIC:\r\n        const currentCallsCopy = new Map(currentCalls);\r\n        let cc = currentCallsCopy.get(data.callId);\r\n        if (cc) {\r\n          cc = { ...cc };\r\n          cc.micMuted = data.status;\r\n          currentCallsCopy.set(cc.callId, cc);\r\n          setCurrentCalls(currentCallsCopy);\r\n        }\r\n        break;\r\n      case VoiceEvents.MUTE_CAM:\r\n        const currentCallsCp = new Map(currentCalls);\r\n        let ccp = currentCallsCp.get(data.callId);\r\n        if (ccp) {\r\n          ccp = { ...ccp };\r\n          ccp.videoMuted = data.status;\r\n          currentCallsCp.set(ccp.callId, ccp);\r\n          setCurrentCalls(currentCallsCp);\r\n        }\r\n        break;\r\n      case VoiceEvents.HOLD_CALL:\r\n        onCallHoldChange(data.callId, data.status);\r\n        break;\r\n      case VoiceEvents.ACCEPTED_CALL:\r\n        onAcceptCall(data.callId, data.useVideo);\r\n        break;\r\n      default:\r\n        console.log(event);\r\n        break;\r\n    }\r\n  }\r\n  const conferenceEventsSubscribe = (\r\n    event: ConferenceEvents,\r\n    data: ConferenceEvent\r\n  ) => {\r\n    switch (event) {\r\n      case ConferenceEvents.UPDATE:\r\n        setConferenceParticipants(data);\r\n        break;\r\n      default:\r\n        console.error(\"EVENT NOT MAPPED\");\r\n        console.log(event, data);\r\n        break;\r\n    }\r\n  };\r\n  const updateFunction = () => {\r\n    squadService?.updateVoiceSubscribeFunction(voiceCommuncatorSubscribe);\r\n    squadService?.updateEventsSubscribeFunction(conferenceEventsSubscribe);\r\n  };\r\n\r\n  useEffect(init, []);\r\n  useEffect(onSetEventsAvailable, [groups, conferenceList]);\r\n  useEffect(updateFunction, [contacts, groups, currentCalls, callNumber, user]);\r\n  useEffect(onMakeCall, [callNumber]);\r\n  useEffect(onUpdateConstraints, [updateConstraints]);\r\n  useEffect(onBlindTransfer, [blindTransfer]);\r\n  useEffect(onAttendedTransfer, [assistedTransfer]);\r\n  useEffect(onSendConferenceCommand, [conferenceCommand]);\r\n  return <></>;\r\n};\r\n\r\nexport default SquadSipCommunicator;\r\n"]},"metadata":{},"sourceType":"module"}