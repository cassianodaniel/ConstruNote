{"ast":null,"code":"/**\n * The MIT License (MIT)\n *\n * Copyright (c) 2017 Jakub Bene≈° <benes@webscope.io>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nimport ReactDOM from 'react-dom';\nimport getCaretCoordinates from 'textarea-caret';\nimport CustomEvent from 'custom-event';\nimport React from 'react';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _typeof2(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof2 = function _typeof2(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof2 = function _typeof2(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof2(obj);\n}\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nvar KEY_CODES = {\n  ESC: 27,\n  UP: 38,\n  DOWN: 40,\n  LEFT: 37,\n  RIGHT: 39,\n  ENTER: 13,\n  TAB: 9\n}; // This is self-made key shortcuts manager, used for caching key strokes\n\nvar Listener = function Listener() {\n  var _this = this;\n\n  _classCallCheck(this, Listener);\n\n  this.startListen = function (ref) {\n    if (!ref) return;\n    ref.addEventListener(\"keydown\", _this.f);\n  };\n\n  this.stopListen = function (ref) {\n    if (!ref) return;\n    ref.removeEventListener(\"keydown\", _this.f);\n  };\n\n  this.add = function (keyCodes, fn) {\n    var keyCode = keyCodes;\n    if (typeof keyCode !== \"object\") keyCode = [keyCode];\n    _this.listeners[_this.index] = {\n      keyCode: keyCode,\n      fn: fn\n    };\n    return _this.index++;\n  };\n\n  this.remove = function (id) {\n    delete _this.listeners[id];\n  };\n\n  this.removeAll = function () {\n    _this.listeners = {};\n    _this.index = 1;\n  };\n\n  this.index = 1;\n  this.listeners = {};\n\n  this.f = function (e) {\n    if (!e) return;\n    var code = e.keyCode || e.which;\n    Object.values(_this.listeners).forEach(function (_ref) {\n      var keyCode = _ref.keyCode,\n          fn = _ref.fn;\n\n      if (keyCode.includes(code)) {\n        e.stopPropagation();\n        e.preventDefault();\n        fn(e);\n      }\n    });\n  };\n};\n\nvar Listeners = new Listener();\n\nvar Item = /*#__PURE__*/function (_React$Component) {\n  _inherits(Item, _React$Component);\n\n  function Item() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Item);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Item)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _this.selectItem = function () {\n      var _this$props = _this.props,\n          item = _this$props.item,\n          onSelectHandler = _this$props.onSelectHandler;\n      onSelectHandler(item);\n    };\n\n    return _this;\n  }\n\n  _createClass(Item, [{\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      if (this.props.item !== nextProps.item || this.props.selected !== nextProps.selected || this.props.style !== nextProps.style || this.props.className !== nextProps.className) {\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props2 = this.props,\n          Component = _this$props2.component,\n          style = _this$props2.style,\n          onClickHandler = _this$props2.onClickHandler,\n          item = _this$props2.item,\n          selected = _this$props2.selected,\n          className = _this$props2.className,\n          innerRef = _this$props2.innerRef;\n      return React.createElement(\"li\", {\n        className: \"rta__item  \".concat(selected === true ? \"rta__item--selected\" : \"\", \" \").concat(className || \"\"),\n        style: style\n      }, React.createElement(\"div\", {\n        className: \"rta__entity \".concat(selected === true ? \"rta__entity--selected\" : \"\"),\n        role: \"button\",\n        tabIndex: 0,\n        onClick: onClickHandler,\n        onFocus: this.selectItem,\n        onMouseEnter: this.selectItem,\n        onTouchStart: function onTouchStart() {\n          _this2.clicked = true;\n\n          _this2.selectItem();\n        },\n        onTouchEnd: function onTouchEnd(e) {\n          e.preventDefault();\n\n          if (_this2.clicked) {\n            onClickHandler(e);\n          }\n        },\n        onTouchMove: function onTouchMove() {\n          _this2.clicked = false;\n        },\n        onTouchCancel: function onTouchCancel() {\n          _this2.clicked = false;\n        }\n        /* $FlowFixMe */\n        ,\n        ref: innerRef\n      }, React.createElement(Component, {\n        selected: selected,\n        entity: item\n      })));\n    }\n  }]);\n\n  return Item;\n}(React.Component);\n\nvar List = /*#__PURE__*/function (_React$Component) {\n  _inherits(List, _React$Component);\n\n  function List() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, List);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(List)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      selectedItem: null\n    };\n    _this.cachedIdOfItems = new Map();\n\n    _this.onPressEnter = function (e) {\n      if (typeof e !== \"undefined\") {\n        e.preventDefault();\n      }\n\n      var values = _this.props.values;\n\n      _this.modifyText(values[_this.getPositionInList()]);\n    };\n\n    _this.getPositionInList = function () {\n      var values = _this.props.values;\n      var selectedItem = _this.state.selectedItem;\n      if (!selectedItem) return 0;\n      return values.findIndex(function (a) {\n        return _this.getId(a) === _this.getId(selectedItem);\n      });\n    };\n\n    _this.getId = function (item) {\n      if (_this.cachedIdOfItems.has(item)) {\n        // $FlowFixMe\n        return _this.cachedIdOfItems.get(item);\n      }\n\n      var textToReplace = _this.props.getTextToReplace(item);\n\n      var computeId = function computeId() {\n        if (textToReplace) {\n          if (textToReplace.key) {\n            return textToReplace.key;\n          }\n\n          if (typeof item === \"string\" || !item.key) {\n            return textToReplace.text;\n          }\n        }\n\n        if (!item.key) {\n          throw new Error(\"Item \".concat(JSON.stringify(item), \" has to have defined \\\"key\\\" property\"));\n        } // $FlowFixMe\n\n\n        return item.key;\n      };\n\n      var id = computeId();\n\n      _this.cachedIdOfItems.set(item, id);\n\n      return id;\n    };\n\n    _this.listeners = [];\n    _this.itemsRef = {};\n\n    _this.modifyText = function (value) {\n      if (!value) return;\n      var onSelect = _this.props.onSelect;\n      onSelect(value);\n    };\n\n    _this.selectItem = function (item) {\n      var keyboard = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var onItemHighlighted = _this.props.onItemHighlighted;\n      if (_this.state.selectedItem === item) return;\n\n      _this.setState({\n        selectedItem: item\n      }, function () {\n        onItemHighlighted(item);\n\n        if (keyboard) {\n          _this.props.dropdownScroll(_this.itemsRef[_this.getId(item)]);\n        }\n      });\n    };\n\n    _this.scroll = function (e) {\n      e.preventDefault();\n      var values = _this.props.values;\n      var code = e.keyCode || e.which;\n\n      var oldPosition = _this.getPositionInList();\n\n      var newPosition;\n\n      switch (code) {\n        case KEY_CODES.DOWN:\n          newPosition = oldPosition + 1;\n          break;\n\n        case KEY_CODES.UP:\n          newPosition = oldPosition - 1;\n          break;\n\n        default:\n          newPosition = oldPosition;\n          break;\n      }\n\n      newPosition = (newPosition % values.length + values.length) % values.length; // eslint-disable-line\n\n      _this.selectItem(values[newPosition], [KEY_CODES.DOWN, KEY_CODES.UP].includes(code));\n    };\n\n    _this.isSelected = function (item) {\n      var selectedItem = _this.state.selectedItem;\n      if (!selectedItem) return false;\n      return _this.getId(selectedItem) === _this.getId(item);\n    };\n\n    return _this;\n  }\n\n  _createClass(List, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.listeners.push(Listeners.add([KEY_CODES.DOWN, KEY_CODES.UP], this.scroll), Listeners.add([KEY_CODES.ENTER, KEY_CODES.TAB], this.onPressEnter));\n      var values = this.props.values;\n      if (values && values[0]) this.selectItem(values[0]);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(_ref) {\n      var _this2 = this;\n\n      var oldValues = _ref.values;\n      var values = this.props.values;\n      var oldValuesSerialized = oldValues.map(function (val) {\n        return _this2.getId(val);\n      }).join(\"\");\n      var newValuesSerialized = values.map(function (val) {\n        return _this2.getId(val);\n      }).join(\"\");\n\n      if (oldValuesSerialized !== newValuesSerialized && values && values[0]) {\n        this.selectItem(values[0]);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var listener;\n\n      while (this.listeners.length) {\n        listener = this.listeners.pop();\n        Listeners.remove(listener);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props = this.props,\n          values = _this$props.values,\n          component = _this$props.component,\n          style = _this$props.style,\n          itemClassName = _this$props.itemClassName,\n          className = _this$props.className,\n          itemStyle = _this$props.itemStyle;\n      return React.createElement(\"ul\", {\n        className: \"rta__list \".concat(className || \"\"),\n        style: style\n      }, values.map(function (item) {\n        return React.createElement(Item, {\n          key: _this3.getId(item),\n          innerRef: function innerRef(ref) {\n            _this3.itemsRef[_this3.getId(item)] = ref;\n          },\n          selected: _this3.isSelected(item),\n          item: item,\n          className: itemClassName,\n          style: itemStyle,\n          onClickHandler: _this3.onPressEnter,\n          onSelectHandler: _this3.selectItem,\n          component: component\n        });\n      }));\n    }\n  }]);\n\n  return List;\n}(React.Component);\n\nfunction defaultScrollToItem(container, item) {\n  var itemHeight = parseInt(getComputedStyle(item).getPropertyValue(\"height\"), 10);\n  var containerHight = parseInt(getComputedStyle(container).getPropertyValue(\"height\"), 10) - itemHeight;\n  var itemOffsetTop = item.offsetTop;\n  var actualScrollTop = container.scrollTop;\n\n  if (itemOffsetTop < actualScrollTop + containerHight && actualScrollTop < itemOffsetTop) {\n    return;\n  } // eslint-disable-next-line\n\n\n  container.scrollTop = itemOffsetTop;\n}\n\nvar DEFAULT_CARET_POSITION = \"next\";\nvar POSITION_CONFIGURATION = {\n  X: {\n    LEFT: \"rta__autocomplete--left\",\n    RIGHT: \"rta__autocomplete--right\"\n  },\n  Y: {\n    TOP: \"rta__autocomplete--top\",\n    BOTTOM: \"rta__autocomplete--bottom\"\n  }\n};\n\nvar errorMessage = function errorMessage(message) {\n  return console.error(\"RTA: dataProvider fails: \".concat(message, \"\\n    \\nCheck the documentation or create issue if you think it's bug. https://github.com/webscopeio/react-textarea-autocomplete/issues\"));\n};\n\nvar reservedRegexChars = [\".\", \"^\", \"$\", \"*\", \"+\", \"-\", \"?\", \"(\", \")\", \"[\", \"]\", \"{\", \"}\", \"\\\\\", \"|\"];\n\nvar escapeRegex = function escapeRegex(text) {\n  return _toConsumableArray(text).map(function (character) {\n    return reservedRegexChars.includes(character) ? \"\\\\\".concat(character) : character;\n  }).join(\"\");\n}; // The main purpose of this component is to figure out to which side the autocomplete should be opened\n\n\nvar Autocomplete = /*#__PURE__*/function (_React$Component) {\n  _inherits(Autocomplete, _React$Component);\n\n  function Autocomplete() {\n    _classCallCheck(this, Autocomplete);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Autocomplete).apply(this, arguments));\n  }\n\n  _createClass(Autocomplete, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var boundariesElement = this.props.boundariesElement;\n\n      if (typeof boundariesElement === \"string\") {\n        var elem = document.querySelector(boundariesElement);\n\n        if (!elem) {\n          throw new Error(\"RTA: Invalid prop boundariesElement: it has to be string or HTMLElement.\");\n        }\n\n        this.containerElem = elem;\n      } else if (boundariesElement instanceof HTMLElement) {\n        this.containerElem = boundariesElement;\n      } else {\n        throw new Error(\"RTA: Invalid prop boundariesElement: it has to be string or HTMLElement.\");\n      }\n\n      if (!this.containerElem || !this.containerElem.contains(this.ref)) {\n        if (process.env.NODE_ENV !== \"test\") {\n          throw new Error(\"RTA: Invalid prop boundariesElement: it has to be one of the parents of the RTA.\");\n        }\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this$ref$classList, _this$ref$classList2;\n\n      var top = this.props.top || 0;\n      var left = this.props.left || 0;\n      var usedClasses = [];\n      var unusedClasses = [];\n      var topPosition = 0;\n      var leftPosition = 0;\n      var containerBounds = this.containerElem.getBoundingClientRect();\n      var dropdownBounds = this.ref.getBoundingClientRect();\n      var textareaBounds = this.props.textareaRef.getBoundingClientRect();\n      var computedStyle = window.getComputedStyle(this.ref);\n      var marginTop = parseInt(computedStyle.getPropertyValue(\"margin-top\"), 10);\n      var marginBottom = parseInt(computedStyle.getPropertyValue(\"margin-bottom\"), 10);\n      var marginLeft = parseInt(computedStyle.getPropertyValue(\"margin-left\"), 10);\n      var marginRight = parseInt(computedStyle.getPropertyValue(\"margin-right\"), 10);\n      var dropdownBottom = marginTop + marginBottom + textareaBounds.top + top + dropdownBounds.height;\n      var dropdownRight = marginLeft + marginRight + textareaBounds.left + left + dropdownBounds.width;\n\n      if (dropdownRight > containerBounds.right) {\n        leftPosition = left - dropdownBounds.width;\n        usedClasses.push(POSITION_CONFIGURATION.X.LEFT);\n        unusedClasses.push(POSITION_CONFIGURATION.X.RIGHT);\n      } else {\n        leftPosition = left;\n        usedClasses.push(POSITION_CONFIGURATION.X.RIGHT);\n        unusedClasses.push(POSITION_CONFIGURATION.X.LEFT);\n      }\n\n      if (dropdownBottom > containerBounds.bottom) {\n        topPosition = top - dropdownBounds.height;\n        usedClasses.push(POSITION_CONFIGURATION.Y.TOP);\n        unusedClasses.push(POSITION_CONFIGURATION.Y.BOTTOM);\n      } else {\n        topPosition = top;\n        usedClasses.push(POSITION_CONFIGURATION.Y.BOTTOM);\n        unusedClasses.push(POSITION_CONFIGURATION.Y.TOP);\n      }\n\n      if (this.props.renderToBody) {\n        topPosition += textareaBounds.top;\n        leftPosition += textareaBounds.left;\n      }\n\n      this.ref.style.top = \"\".concat(topPosition, \"px\");\n      this.ref.style.left = \"\".concat(leftPosition, \"px\");\n\n      (_this$ref$classList = this.ref.classList).remove.apply(_this$ref$classList, unusedClasses);\n\n      (_this$ref$classList2 = this.ref.classList).add.apply(_this$ref$classList2, usedClasses);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this = this;\n\n      var _this$props = this.props,\n          style = _this$props.style,\n          className = _this$props.className,\n          innerRef = _this$props.innerRef,\n          children = _this$props.children,\n          renderToBody = _this$props.renderToBody;\n      var body = document.body;\n      var autocompleteContainer = React.createElement(\"div\", {\n        ref: function ref(_ref) {\n          // $FlowFixMe\n          _this.ref = _ref; // $FlowFixMe\n\n          innerRef(_ref);\n        },\n        className: \"rta__autocomplete \".concat(className || \"\"),\n        style: style\n      }, children);\n      return renderToBody && body !== null ? ReactDOM.createPortal(autocompleteContainer, body) : autocompleteContainer;\n    }\n  }]);\n\n  return Autocomplete;\n}(React.Component);\n\nvar ReactTextareaAutocomplete = /*#__PURE__*/function (_React$Component2) {\n  _inherits(ReactTextareaAutocomplete, _React$Component2);\n\n  function ReactTextareaAutocomplete(_props) {\n    var _this2;\n\n    _classCallCheck(this, ReactTextareaAutocomplete);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ReactTextareaAutocomplete).call(this, _props));\n    _this2.state = {\n      top: null,\n      left: null,\n      currentTrigger: null,\n      actualToken: \"\",\n      data: null,\n      value: \"\",\n      dataLoading: false,\n      selectionEnd: 0,\n      component: null,\n      textToReplace: null\n    };\n\n    _this2.escListenerInit = function () {\n      if (!_this2.escListener) {\n        _this2.escListener = Listeners.add(KEY_CODES.ESC, _this2._closeAutocomplete);\n      }\n    };\n\n    _this2.escListenerDestroy = function () {\n      if (_this2.escListener) {\n        Listeners.remove(_this2.escListener);\n        _this2.escListener = null;\n      }\n    };\n\n    _this2.getSelectionPosition = function () {\n      if (!_this2.textareaRef) return null;\n      return {\n        selectionStart: _this2.textareaRef.selectionStart,\n        selectionEnd: _this2.textareaRef.selectionEnd\n      };\n    };\n\n    _this2.getSelectedText = function () {\n      if (!_this2.textareaRef) return null;\n      var _this2$textareaRef = _this2.textareaRef,\n          selectionStart = _this2$textareaRef.selectionStart,\n          selectionEnd = _this2$textareaRef.selectionEnd;\n      if (selectionStart === selectionEnd) return null;\n      return _this2.state.value.substr(selectionStart, selectionEnd - selectionStart);\n    };\n\n    _this2.setCaretPosition = function () {\n      var position = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      if (!_this2.textareaRef) return;\n\n      _this2.textareaRef.focus();\n\n      _this2.textareaRef.setSelectionRange(position, position);\n    };\n\n    _this2.getCaretPosition = function () {\n      if (!_this2.textareaRef) {\n        return 0;\n      }\n\n      var position = _this2.textareaRef.selectionEnd;\n      return position;\n    };\n\n    _this2._handleCaretChange = function (e) {\n      var cleanLastTrigger = function cleanLastTrigger() {\n        var beforeHandle = _this2.getCaretPosition() - 1;\n        _this2.lastTrigger = _this2.lastTrigger ? beforeHandle : 0;\n      };\n\n      if (e.type === \"keydown\") {\n        // $FlowFixMe\n        var code = e.keyCode || e.which;\n\n        switch (code) {\n          case KEY_CODES.UP:\n          case KEY_CODES.DOWN:\n            if (!_this2._isAutocompleteOpen()) {\n              cleanLastTrigger();\n            }\n\n            break;\n\n          case KEY_CODES.LEFT:\n          case KEY_CODES.RIGHT:\n            cleanLastTrigger();\n            break;\n\n          default:\n        }\n\n        return;\n      }\n\n      cleanLastTrigger();\n    };\n\n    _this2._onSelect = function (item) {\n      var _this2$state = _this2.state,\n          selectionEnd = _this2$state.selectionEnd,\n          currentTrigger = _this2$state.currentTrigger,\n          textareaValue = _this2$state.value;\n      var _this2$props = _this2.props,\n          trigger = _this2$props.trigger,\n          onItemSelected = _this2$props.onItemSelected;\n      if (!currentTrigger) return;\n\n      var getTextToReplaceForCurrentTrigger = _this2._getTextToReplace(currentTrigger);\n\n      if (!getTextToReplaceForCurrentTrigger) {\n        _this2._closeAutocomplete();\n\n        return;\n      }\n\n      var newToken = getTextToReplaceForCurrentTrigger(item);\n\n      if (!newToken) {\n        _this2._closeAutocomplete();\n\n        return;\n      }\n\n      if (onItemSelected) {\n        onItemSelected({\n          currentTrigger: currentTrigger,\n          item: item\n        });\n      }\n\n      var computeCaretPosition = function computeCaretPosition(position, token, startToken) {\n        switch (position) {\n          case \"start\":\n            return startToken;\n\n          case \"next\":\n          case \"end\":\n            return startToken + token.length;\n\n          default:\n            if (!Number.isInteger(position)) {\n              throw new Error('RTA: caretPosition should be \"start\", \"next\", \"end\" or number.');\n            }\n\n            return position;\n        }\n      };\n\n      var textToModify = textareaValue.slice(0, selectionEnd);\n      var startOfTokenPosition = textToModify.search(\n      /**\n       * It's important to escape the currentTrigger char for chars like [, (,...\n       */\n      new RegExp(\"\".concat(escapeRegex(currentTrigger), \"[^\".concat(escapeRegex(currentTrigger)).concat(trigger[currentTrigger].allowWhitespace ? \"\" : \"\\\\s\", \"]\"), \"*$\"))); // we add space after emoji is selected if a caret position is next\n\n      var newTokenString = newToken.caretPosition === \"next\" ? \"\".concat(newToken.text, \" \") : newToken.text;\n      var newCaretPosition = computeCaretPosition(newToken.caretPosition, newTokenString, startOfTokenPosition);\n      var modifiedText = textToModify.substring(0, startOfTokenPosition) + newTokenString;\n      var newValue = textareaValue.replace(textToModify, modifiedText); // set the new textarea value and after that set the caret back to its position\n\n      _this2.setState({\n        value: newValue,\n        dataLoading: false\n      }, function () {\n        var insertedTrigger = _this2.tokenRegExpEnding.exec(newTokenString);\n\n        var insertedTriggerModifier = insertedTrigger ? insertedTrigger[0].length : 1;\n        _this2.lastTrigger = newCaretPosition ? newCaretPosition - insertedTriggerModifier : newCaretPosition;\n        _this2.textareaRef.value = newValue;\n        _this2.textareaRef.selectionEnd = newCaretPosition;\n\n        _this2._changeHandler();\n\n        var scrollTop = _this2.textareaRef.scrollTop;\n\n        _this2.setCaretPosition(newCaretPosition);\n        /*\n          Chrome does not maintain scroll position\n          Relevant discussion https://github.com/webscopeio/react-textarea-autocomplete/pull/97\n        */\n\n\n        if (window.chrome) {\n          _this2.textareaRef.scrollTop = scrollTop;\n        }\n      });\n    };\n\n    _this2._getTextToReplace = function (currentTrigger) {\n      var triggerSettings = _this2.props.trigger[currentTrigger];\n      if (!currentTrigger || !triggerSettings) return null;\n      var output = triggerSettings.output;\n      return function (item) {\n        if (typeof item === \"object\" && (!output || typeof output !== \"function\")) {\n          throw new Error('Output functor is not defined! If you are using items as object you have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n        }\n\n        if (output) {\n          var textToReplace = output(item, currentTrigger);\n\n          if (textToReplace === undefined || typeof textToReplace === \"number\") {\n            throw new Error(\"Output functor should return string or object in shape {text: string, caretPosition: string | number}.\\nGot \\\"\".concat(String(textToReplace), \"\\\". Check the implementation for trigger \\\"\").concat(currentTrigger, \"\\\"\\n\\nSee https://github.com/webscopeio/react-textarea-autocomplete#trigger-type for more information.\\n\"));\n          }\n\n          if (textToReplace === null) return null;\n\n          if (typeof textToReplace === \"string\") {\n            return {\n              text: textToReplace,\n              caretPosition: DEFAULT_CARET_POSITION\n            };\n          }\n\n          if (!textToReplace.text) {\n            throw new Error(\"Output \\\"text\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\".concat(currentTrigger, \"\\\"\\n\"));\n          }\n\n          if (!textToReplace.caretPosition) {\n            throw new Error(\"Output \\\"caretPosition\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\".concat(currentTrigger, \"\\\"\\n\"));\n          }\n\n          return textToReplace;\n        }\n\n        if (typeof item !== \"string\") {\n          throw new Error(\"Output item should be string\\n\");\n        }\n\n        return {\n          text: \"\".concat(currentTrigger).concat(item).concat(currentTrigger),\n          caretPosition: DEFAULT_CARET_POSITION\n        };\n      };\n    };\n\n    _this2._getCurrentTriggerSettings = function () {\n      var currentTrigger = _this2.state.currentTrigger;\n      if (!currentTrigger) return null;\n      return _this2.props.trigger[currentTrigger];\n    };\n\n    _this2._getValuesFromProvider = function () {\n      var _this2$state2 = _this2.state,\n          currentTrigger = _this2$state2.currentTrigger,\n          actualToken = _this2$state2.actualToken;\n\n      var triggerSettings = _this2._getCurrentTriggerSettings();\n\n      if (!currentTrigger || !triggerSettings) {\n        return;\n      }\n\n      var dataProvider = triggerSettings.dataProvider,\n          component = triggerSettings.component;\n\n      if (typeof dataProvider !== \"function\") {\n        throw new Error(\"Trigger provider has to be a function!\");\n      }\n\n      _this2.setState({\n        dataLoading: true\n      });\n\n      var providedData = dataProvider(actualToken);\n\n      if (!(providedData instanceof Promise)) {\n        providedData = Promise.resolve(providedData);\n      }\n\n      providedData.then(function (data) {\n        if (!Array.isArray(data)) {\n          throw new Error(\"Trigger provider has to provide an array!\");\n        }\n\n        if (typeof component !== \"function\") {\n          throw new Error(\"Component should be defined!\");\n        } // throw away if we resolved old trigger\n\n\n        if (currentTrigger !== _this2.state.currentTrigger) return; // if we haven't resolved any data let's close the autocomplete\n\n        if (!data.length) {\n          _this2._closeAutocomplete();\n\n          return;\n        }\n\n        _this2.setState({\n          dataLoading: false,\n          data: data,\n          component: component\n        });\n      }).catch(function (e) {\n        return errorMessage(e.message);\n      });\n    };\n\n    _this2._getSuggestions = function () {\n      var _this2$state3 = _this2.state,\n          currentTrigger = _this2$state3.currentTrigger,\n          data = _this2$state3.data;\n      if (!currentTrigger || !data || data && !data.length) return null;\n      return data;\n    };\n\n    _this2._createRegExp = function () {\n      var trigger = _this2.props.trigger; // negative lookahead to match only the trigger + the actual token = \"bladhwd:adawd:word test\" => \":word\"\n      // https://stackoverflow.com/a/8057827/2719917\n\n      _this2.tokenRegExp = new RegExp(\"(\".concat(Object.keys(trigger) // the sort is important for multi-char combos as \"/kick\", \"/\"\n      .sort(function (a, b) {\n        if (a < b) {\n          return 1;\n        }\n\n        if (a > b) {\n          return -1;\n        }\n\n        return 0;\n      }).map(function (a) {\n        return escapeRegex(a);\n      }).join(\"|\"), \")((?:(?!\\\\1)[^\\\\s])*$)\"));\n      _this2.tokenRegExpEnding = new RegExp(\"(\".concat(Object.keys(trigger) // the sort is important for multi-char combos as \"/kick\", \"/\"\n      .sort(function (a, b) {\n        if (a < b) {\n          return 1;\n        }\n\n        if (a > b) {\n          return -1;\n        }\n\n        return 0;\n      }).map(function (a) {\n        return escapeRegex(a);\n      }).join(\"|\"), \")$\"));\n    };\n\n    _this2._closeAutocomplete = function () {\n      var currentTrigger = _this2.state.currentTrigger;\n\n      _this2.escListenerDestroy();\n\n      _this2.setState({\n        data: null,\n        dataLoading: false,\n        currentTrigger: null\n      }, function () {\n        if (currentTrigger) _this2._onItemHighlightedHandler(null);\n      });\n    };\n\n    _this2._cleanUpProps = function () {\n      var props = _objectSpread({}, _this2.props);\n\n      var notSafe = [\"loadingComponent\", \"boundariesElement\", \"containerStyle\", \"minChar\", \"scrollToItem\", \"ref\", \"innerRef\", \"onChange\", \"onCaretPositionChange\", \"className\", \"value\", \"trigger\", \"listStyle\", \"itemStyle\", \"containerStyle\", \"loaderStyle\", \"className\", \"containerClassName\", \"listClassName\", \"itemClassName\", \"loaderClassName\", \"dropdownStyle\", \"dropdownClassName\", \"movePopupAsYouType\", \"textAreaComponent\", \"renderToBody\", \"onItemSelected\", \"onItemHighlighted\"]; // eslint-disable-next-line\n\n      for (var prop in props) {\n        if (notSafe.includes(prop)) delete props[prop];\n      }\n\n      return props;\n    };\n\n    _this2._changeHandler = function (e) {\n      var _this2$props2 = _this2.props,\n          trigger = _this2$props2.trigger,\n          onChange = _this2$props2.onChange,\n          minChar = _this2$props2.minChar,\n          onCaretPositionChange = _this2$props2.onCaretPositionChange,\n          movePopupAsYouType = _this2$props2.movePopupAsYouType;\n      var _this2$state4 = _this2.state,\n          top = _this2$state4.top,\n          left = _this2$state4.left;\n      var event = e;\n\n      if (!event) {\n        // fire onChange event after successful selection\n        event = new CustomEvent(\"change\", {\n          bubbles: true\n        });\n\n        _this2.textareaRef.dispatchEvent(event);\n      }\n\n      var textarea = event.target;\n      var selectionEnd = textarea.selectionEnd;\n      var value = textarea.value;\n      _this2.lastValueBubbledEvent = value;\n\n      if (onChange && event) {\n        event.persist && event.persist();\n        onChange(event);\n      }\n\n      if (onCaretPositionChange) {\n        var caretPosition = _this2.getCaretPosition();\n\n        onCaretPositionChange(caretPosition);\n      }\n\n      _this2.setState({\n        value: value\n      });\n\n      var setTopLeft = function setTopLeft() {\n        var _getCaretCoordinates = getCaretCoordinates(textarea, selectionEnd),\n            newTop = _getCaretCoordinates.top,\n            newLeft = _getCaretCoordinates.left;\n\n        _this2.setState({\n          // make position relative to textarea\n          top: newTop - _this2.textareaRef.scrollTop || 0,\n          left: newLeft\n        });\n      };\n\n      var cleanLastTrigger = function cleanLastTrigger(triggerLength) {\n        _this2.lastTrigger = selectionEnd - triggerLength;\n\n        _this2._closeAutocomplete();\n\n        setTopLeft();\n      };\n\n      if (selectionEnd <= _this2.lastTrigger) {\n        var _affectedTextareaValue = value.slice(0, selectionEnd);\n\n        var _newTrigger = _this2.tokenRegExp.exec(_affectedTextareaValue);\n\n        cleanLastTrigger(_newTrigger ? _newTrigger[0].length : 0);\n      }\n\n      var affectedTextareaValue = value.slice(_this2.lastTrigger, selectionEnd);\n\n      var tokenMatch = _this2.tokenRegExp.exec(affectedTextareaValue);\n\n      var lastToken = tokenMatch && tokenMatch[0];\n      var currentTrigger = tokenMatch && tokenMatch[1] || null;\n      var currentTriggerLength = currentTrigger ? currentTrigger.length - 1 : 0; // with this approach we want to know if the user just inserted a new trigger sequence\n\n      var newTrigger = _this2.tokenRegExpEnding.exec(affectedTextareaValue);\n\n      if (newTrigger) {\n        cleanLastTrigger(newTrigger[0].length);\n      } else if (!_this2._isAutocompleteOpen()) {\n        _this2._closeAutocomplete();\n      }\n      /*\n       if we lost the trigger token or there is no following character we want to close\n       the autocomplete\n      */\n\n\n      if ((!lastToken || lastToken.length <= minChar + currentTriggerLength) && ( // check if our current trigger disallows whitespace\n      _this2.state.currentTrigger && !trigger[_this2.state.currentTrigger].allowWhitespace || !_this2.state.currentTrigger)) {\n        _this2._closeAutocomplete();\n\n        return;\n      }\n      /**\n       * This code has to be sync that is the reason why we obtain the currentTrigger\n       * from currentTrigger not this.state.currentTrigger\n       *\n       * Check if the currently typed token has to be afterWhitespace, or not.\n       *\n       * This setting means that there has to be whitespace before the token (on it has to be the the first character typed into textarea)\n       */\n\n\n      if (currentTrigger && trigger[currentTrigger].afterWhitespace && !/\\s/.test(value[selectionEnd - lastToken.length - 1]) && value[selectionEnd - lastToken.length - 1] !== undefined) {\n        _this2._closeAutocomplete();\n\n        return;\n      }\n      /**\n        If our current trigger allows whitespace\n        get the correct token for DataProvider, so we need to construct new RegExp\n       */\n\n\n      if (_this2.state.currentTrigger && trigger[_this2.state.currentTrigger].allowWhitespace) {\n        tokenMatch = new RegExp(\"\".concat(escapeRegex(_this2.state.currentTrigger), \".*$\")).exec(value.slice(0, selectionEnd));\n        lastToken = tokenMatch && tokenMatch[0];\n\n        if (!lastToken) {\n          _this2._closeAutocomplete();\n\n          return;\n        }\n\n        currentTrigger = Object.keys(trigger).find(function (a) {\n          return a.slice(0, currentTriggerLength + 1) === lastToken.slice(0, currentTriggerLength + 1);\n        }) || null;\n      }\n\n      var actualToken = lastToken.slice(1); // if trigger is not configured step out from the function, otherwise proceed\n\n      if (!currentTrigger) {\n        return;\n      }\n\n      if (movePopupAsYouType || top === null && left === null || // if the trigger got changed, let's reposition the autocomplete\n      _this2.state.currentTrigger !== currentTrigger) {\n        setTopLeft();\n      }\n\n      _this2.escListenerInit();\n\n      var textToReplace = _this2._getTextToReplace(currentTrigger);\n\n      _this2.setState({\n        selectionEnd: selectionEnd,\n        currentTrigger: currentTrigger,\n        textToReplace: textToReplace,\n        actualToken: actualToken\n      }, function () {\n        try {\n          _this2._getValuesFromProvider();\n        } catch (err) {\n          errorMessage(err.message);\n        }\n      });\n    };\n\n    _this2._selectHandler = function (e) {\n      var _this2$props3 = _this2.props,\n          onCaretPositionChange = _this2$props3.onCaretPositionChange,\n          onSelect = _this2$props3.onSelect;\n\n      if (onCaretPositionChange) {\n        var caretPosition = _this2.getCaretPosition();\n\n        onCaretPositionChange(caretPosition);\n      }\n\n      if (onSelect) {\n        e.persist();\n        onSelect(e);\n      }\n    };\n\n    _this2._shouldStayOpen = function (e) {\n      var el = e.relatedTarget; // IE11 doesn't know about `relatedTarget` // https://stackoverflow.com/a/49325196/2719917\n\n      if (el === null) {\n        el = document.activeElement;\n      }\n\n      if (_this2.dropdownRef && el instanceof Node && _this2.dropdownRef.contains(el)) {\n        return true;\n      }\n\n      return false;\n    };\n\n    _this2._onClick = function (e) {\n      var onClick = _this2.props.onClick;\n\n      if (onClick) {\n        e.persist();\n        onClick(e);\n      }\n\n      if (_this2._shouldStayOpen(e)) {\n        return;\n      }\n\n      _this2._closeAutocomplete();\n    };\n\n    _this2._onBlur = function (e) {\n      var onBlur = _this2.props.onBlur;\n\n      if (onBlur) {\n        e.persist();\n        onBlur(e);\n      }\n\n      if (_this2._shouldStayOpen(e)) {\n        return;\n      }\n\n      _this2._closeAutocomplete();\n    };\n\n    _this2._onScrollHandler = function () {\n      _this2._closeAutocomplete();\n    };\n\n    _this2._onItemHighlightedHandler = function (item) {\n      var onItemHighlighted = _this2.props.onItemHighlighted;\n      var currentTrigger = _this2.state.currentTrigger;\n\n      if (onItemHighlighted) {\n        if (typeof onItemHighlighted === \"function\") {\n          onItemHighlighted({\n            currentTrigger: currentTrigger,\n            item: item\n          });\n        } else {\n          throw new Error(\"`onItemHighlighted` has to be a function\");\n        }\n      }\n    };\n\n    _this2._dropdownScroll = function (item) {\n      var scrollToItem = _this2.props.scrollToItem;\n      if (!scrollToItem) return;\n\n      if (scrollToItem === true) {\n        defaultScrollToItem(_this2.dropdownRef, item);\n        return;\n      }\n\n      if (typeof scrollToItem !== \"function\" || scrollToItem.length !== 2) {\n        throw new Error(\"`scrollToItem` has to be boolean (true for default implementation) or function with two parameters: container, item.\");\n      }\n\n      scrollToItem(_this2.dropdownRef, item);\n    };\n\n    _this2._isAutocompleteOpen = function () {\n      var _this2$state5 = _this2.state,\n          dataLoading = _this2$state5.dataLoading,\n          currentTrigger = _this2$state5.currentTrigger;\n\n      var suggestionData = _this2._getSuggestions();\n\n      return !!((dataLoading || suggestionData) && currentTrigger);\n    };\n\n    _this2._textareaRef = function (ref) {\n      // $FlowFixMe - ref is actually a `?HTMLTextAreaElement`\n      _this2.props.innerRef && _this2.props.innerRef(ref);\n      _this2.textareaRef = ref;\n    };\n\n    _this2.lastTrigger = 0;\n    _this2.escListener = null;\n    var _this2$props4 = _this2.props,\n        loadingComponent = _this2$props4.loadingComponent,\n        _trigger = _this2$props4.trigger,\n        _value = _this2$props4.value;\n    if (_value) _this2.state.value = _value;\n\n    _this2._createRegExp();\n\n    if (!loadingComponent) {\n      throw new Error(\"RTA: loadingComponent is not defined\");\n    }\n\n    if (!_trigger) {\n      throw new Error(\"RTA: trigger is not defined\");\n    }\n\n    return _this2;\n  }\n\n  _createClass(ReactTextareaAutocomplete, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      Listeners.startListen(this.textareaRef); // handle caret change\n\n      this.textareaRef && this.textareaRef.addEventListener(\"focus\", this._handleCaretChange);\n      this.textareaRef && this.textareaRef.addEventListener(\"click\", this._handleCaretChange);\n      this.textareaRef && this.textareaRef.addEventListener(\"keydown\", this._handleCaretChange);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(_ref2) {\n      var oldTrigger = _ref2.trigger,\n          oldValue = _ref2.value;\n      var _this$props2 = this.props,\n          trigger = _this$props2.trigger,\n          value = _this$props2.value;\n\n      if (Object.keys(trigger).join(\"\") !== Object.keys(oldTrigger).join(\"\")) {\n        this._createRegExp();\n      }\n\n      if (oldValue !== value && this.lastValueBubbledEvent !== value) {\n        this.lastTrigger = 0;\n\n        this._changeHandler();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.escListenerDestroy();\n      Listeners.stopListen(this.textareaRef); // handle caret change\n\n      this.textareaRef && this.textareaRef.removeEventListener(\"focus\", this._handleCaretChange);\n      this.textareaRef && this.textareaRef.removeEventListener(\"click\", this._handleCaretChange);\n      this.textareaRef && this.textareaRef.removeEventListener(\"keydown\", this._handleCaretChange);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props3 = this.props,\n          Loader = _this$props3.loadingComponent,\n          style = _this$props3.style,\n          className = _this$props3.className,\n          listStyle = _this$props3.listStyle,\n          itemStyle = _this$props3.itemStyle,\n          boundariesElement = _this$props3.boundariesElement,\n          movePopupAsYouType = _this$props3.movePopupAsYouType,\n          listClassName = _this$props3.listClassName,\n          itemClassName = _this$props3.itemClassName,\n          dropdownClassName = _this$props3.dropdownClassName,\n          dropdownStyle = _this$props3.dropdownStyle,\n          containerStyle = _this$props3.containerStyle,\n          containerClassName = _this$props3.containerClassName,\n          loaderStyle = _this$props3.loaderStyle,\n          loaderClassName = _this$props3.loaderClassName,\n          textAreaComponent = _this$props3.textAreaComponent,\n          renderToBody = _this$props3.renderToBody;\n      var _this$state = this.state,\n          left = _this$state.left,\n          top = _this$state.top,\n          dataLoading = _this$state.dataLoading,\n          component = _this$state.component,\n          value = _this$state.value,\n          textToReplace = _this$state.textToReplace;\n\n      var isAutocompleteOpen = this._isAutocompleteOpen();\n\n      var suggestionData = this._getSuggestions();\n\n      var extraAttrs = {};\n      var TextAreaComponent;\n\n      if (textAreaComponent.component) {\n        TextAreaComponent = textAreaComponent.component;\n        extraAttrs[textAreaComponent.ref] = this._textareaRef;\n      } else {\n        TextAreaComponent = textAreaComponent;\n        extraAttrs.ref = this._textareaRef;\n      }\n\n      return React.createElement(\"div\", {\n        className: \"rta \".concat(dataLoading === true ? \"rta--loading\" : \"\", \" \").concat(containerClassName || \"\"),\n        style: containerStyle\n      }, React.createElement(TextAreaComponent, Object.assign({}, this._cleanUpProps(), {\n        className: \"rta__textarea \".concat(className || \"\"),\n        onChange: this._changeHandler,\n        onSelect: this._selectHandler,\n        onScroll: this._onScrollHandler,\n        onClick: // The textarea itself is outside the autoselect dropdown.\n        this._onClick,\n        onBlur: this._onBlur,\n        value: value,\n        style: style\n      }, extraAttrs)), isAutocompleteOpen && React.createElement(Autocomplete, {\n        innerRef: function innerRef(ref) {\n          // $FlowFixMe\n          _this3.dropdownRef = ref;\n        },\n        top: top,\n        left: left,\n        style: dropdownStyle,\n        className: dropdownClassName,\n        movePopupAsYouType: movePopupAsYouType,\n        boundariesElement: boundariesElement,\n        textareaRef: this.textareaRef,\n        renderToBody: renderToBody\n      }, suggestionData && component && textToReplace && React.createElement(List, {\n        values: suggestionData,\n        component: component,\n        style: listStyle,\n        className: listClassName,\n        itemClassName: itemClassName,\n        itemStyle: itemStyle,\n        getTextToReplace: textToReplace,\n        onItemHighlighted: this._onItemHighlightedHandler,\n        onSelect: this._onSelect,\n        dropdownScroll: this._dropdownScroll\n      }), dataLoading && React.createElement(\"div\", {\n        className: \"rta__loader \".concat(suggestionData !== null ? \"rta__loader--suggestion-data\" : \"rta__loader--empty-suggestion-data\", \" \").concat(loaderClassName || \"\"),\n        style: loaderStyle\n      }, React.createElement(Loader, {\n        data: suggestionData\n      }))));\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(_ref3) {\n      var value = _ref3.value;\n      if (value === null || value === undefined) return null;\n      return {\n        value: value\n      };\n    }\n  }]);\n\n  return ReactTextareaAutocomplete;\n}(React.Component);\n\nReactTextareaAutocomplete.defaultProps = {\n  movePopupAsYouType: false,\n  value: null,\n  minChar: 1,\n  boundariesElement: \"body\",\n  scrollToItem: true,\n  textAreaComponent: \"textarea\",\n  renderToBody: false\n};\nexport default ReactTextareaAutocomplete;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/node_modules/@webscopeio/react-textarea-autocomplete/dist/react-textarea-autocomplete.es.js"],"names":["ReactDOM","getCaretCoordinates","CustomEvent","React","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_objectSpread","target","i","arguments","length","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","forEach","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","prototype","_typeof2","Symbol","iterator","constructor","_typeof","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","call","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","_setPrototypeOf","p","_inherits","subClass","superClass","create","_arrayWithoutHoles","arr","Array","isArray","arr2","_iterableToArray","iter","toString","from","_nonIterableSpread","_toConsumableArray","KEY_CODES","ESC","UP","DOWN","LEFT","RIGHT","ENTER","TAB","Listener","_this","startListen","ref","addEventListener","f","stopListen","removeEventListener","add","keyCodes","fn","keyCode","listeners","index","remove","id","removeAll","e","code","which","values","_ref","includes","stopPropagation","preventDefault","Listeners","Item","_React$Component","_getPrototypeOf2","_len","args","_key","apply","selectItem","_this$props","item","onSelectHandler","shouldComponentUpdate","nextProps","selected","style","className","render","_this2","_this$props2","Component","component","onClickHandler","innerRef","createElement","role","tabIndex","onClick","onFocus","onMouseEnter","onTouchStart","clicked","onTouchEnd","onTouchMove","onTouchCancel","entity","List","state","selectedItem","cachedIdOfItems","Map","onPressEnter","modifyText","getPositionInList","findIndex","a","getId","has","get","textToReplace","getTextToReplace","computeId","text","Error","JSON","stringify","set","itemsRef","onSelect","keyboard","undefined","onItemHighlighted","setState","dropdownScroll","scroll","oldPosition","newPosition","isSelected","componentDidMount","push","componentDidUpdate","oldValues","oldValuesSerialized","map","val","join","newValuesSerialized","componentWillUnmount","listener","pop","_this3","itemClassName","itemStyle","defaultScrollToItem","container","itemHeight","parseInt","getComputedStyle","getPropertyValue","containerHight","itemOffsetTop","offsetTop","actualScrollTop","scrollTop","DEFAULT_CARET_POSITION","POSITION_CONFIGURATION","X","Y","TOP","BOTTOM","errorMessage","message","console","error","reservedRegexChars","escapeRegex","character","Autocomplete","boundariesElement","elem","document","querySelector","containerElem","HTMLElement","contains","process","env","NODE_ENV","_this$ref$classList","_this$ref$classList2","top","left","usedClasses","unusedClasses","topPosition","leftPosition","containerBounds","getBoundingClientRect","dropdownBounds","textareaBounds","textareaRef","computedStyle","window","marginTop","marginBottom","marginLeft","marginRight","dropdownBottom","height","dropdownRight","width","right","bottom","renderToBody","classList","children","body","autocompleteContainer","createPortal","ReactTextareaAutocomplete","_React$Component2","_props","currentTrigger","actualToken","data","dataLoading","selectionEnd","escListenerInit","escListener","_closeAutocomplete","escListenerDestroy","getSelectionPosition","selectionStart","getSelectedText","_this2$textareaRef","substr","setCaretPosition","position","focus","setSelectionRange","getCaretPosition","_handleCaretChange","cleanLastTrigger","beforeHandle","lastTrigger","type","_isAutocompleteOpen","_onSelect","_this2$state","textareaValue","_this2$props","trigger","onItemSelected","getTextToReplaceForCurrentTrigger","_getTextToReplace","newToken","computeCaretPosition","token","startToken","Number","isInteger","textToModify","slice","startOfTokenPosition","search","RegExp","allowWhitespace","newTokenString","caretPosition","newCaretPosition","modifiedText","substring","newValue","replace","insertedTrigger","tokenRegExpEnding","exec","insertedTriggerModifier","_changeHandler","chrome","triggerSettings","output","String","_getCurrentTriggerSettings","_getValuesFromProvider","_this2$state2","dataProvider","providedData","Promise","resolve","then","catch","_getSuggestions","_this2$state3","_createRegExp","tokenRegExp","sort","b","_onItemHighlightedHandler","_cleanUpProps","notSafe","prop","_this2$props2","onChange","minChar","onCaretPositionChange","movePopupAsYouType","_this2$state4","event","bubbles","dispatchEvent","textarea","lastValueBubbledEvent","persist","setTopLeft","_getCaretCoordinates","newTop","newLeft","triggerLength","_affectedTextareaValue","_newTrigger","affectedTextareaValue","tokenMatch","lastToken","currentTriggerLength","newTrigger","afterWhitespace","test","find","err","_selectHandler","_this2$props3","_shouldStayOpen","el","relatedTarget","activeElement","dropdownRef","Node","_onClick","_onBlur","onBlur","_onScrollHandler","_dropdownScroll","scrollToItem","_this2$state5","suggestionData","_textareaRef","_this2$props4","loadingComponent","_trigger","_value","_ref2","oldTrigger","oldValue","_this$props3","Loader","listStyle","listClassName","dropdownClassName","dropdownStyle","containerStyle","containerClassName","loaderStyle","loaderClassName","textAreaComponent","_this$state","isAutocompleteOpen","extraAttrs","TextAreaComponent","assign","onScroll","getDerivedStateFromProps","_ref3","defaultProps"],"mappings":"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","sourcesContent":["/**\n * The MIT License (MIT)\n *\n * Copyright (c) 2017 Jakub Bene≈° <benes@webscope.io>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\nimport ReactDOM from 'react-dom';\nimport getCaretCoordinates from 'textarea-caret';\nimport CustomEvent from 'custom-event';\nimport React from 'react';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _typeof2(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof2 = function _typeof2(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof2 = function _typeof2(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof2(obj);\n}\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nvar KEY_CODES = {\n  ESC: 27,\n  UP: 38,\n  DOWN: 40,\n  LEFT: 37,\n  RIGHT: 39,\n  ENTER: 13,\n  TAB: 9\n}; // This is self-made key shortcuts manager, used for caching key strokes\n\nvar Listener = function Listener() {\n  var _this = this;\n\n  _classCallCheck(this, Listener);\n\n  this.startListen = function (ref) {\n    if (!ref) return;\n    ref.addEventListener(\"keydown\", _this.f);\n  };\n\n  this.stopListen = function (ref) {\n    if (!ref) return;\n    ref.removeEventListener(\"keydown\", _this.f);\n  };\n\n  this.add = function (keyCodes, fn) {\n    var keyCode = keyCodes;\n    if (typeof keyCode !== \"object\") keyCode = [keyCode];\n    _this.listeners[_this.index] = {\n      keyCode: keyCode,\n      fn: fn\n    };\n    return _this.index++;\n  };\n\n  this.remove = function (id) {\n    delete _this.listeners[id];\n  };\n\n  this.removeAll = function () {\n    _this.listeners = {};\n    _this.index = 1;\n  };\n\n  this.index = 1;\n  this.listeners = {};\n\n  this.f = function (e) {\n    if (!e) return;\n    var code = e.keyCode || e.which;\n    Object.values(_this.listeners).forEach(function (_ref) {\n      var keyCode = _ref.keyCode,\n          fn = _ref.fn;\n\n      if (keyCode.includes(code)) {\n        e.stopPropagation();\n        e.preventDefault();\n        fn(e);\n      }\n    });\n  };\n};\n\nvar Listeners = new Listener();\n\nvar Item =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Item, _React$Component);\n\n  function Item() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Item);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Item)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _this.selectItem = function () {\n      var _this$props = _this.props,\n          item = _this$props.item,\n          onSelectHandler = _this$props.onSelectHandler;\n      onSelectHandler(item);\n    };\n\n    return _this;\n  }\n\n  _createClass(Item, [{\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      if (this.props.item !== nextProps.item || this.props.selected !== nextProps.selected || this.props.style !== nextProps.style || this.props.className !== nextProps.className) {\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props2 = this.props,\n          Component = _this$props2.component,\n          style = _this$props2.style,\n          onClickHandler = _this$props2.onClickHandler,\n          item = _this$props2.item,\n          selected = _this$props2.selected,\n          className = _this$props2.className,\n          innerRef = _this$props2.innerRef;\n      return React.createElement(\"li\", {\n        className: \"rta__item  \".concat(selected === true ? \"rta__item--selected\" : \"\", \" \").concat(className || \"\"),\n        style: style\n      }, React.createElement(\"div\", {\n        className: \"rta__entity \".concat(selected === true ? \"rta__entity--selected\" : \"\"),\n        role: \"button\",\n        tabIndex: 0,\n        onClick: onClickHandler,\n        onFocus: this.selectItem,\n        onMouseEnter: this.selectItem,\n        onTouchStart: function onTouchStart() {\n          _this2.clicked = true;\n\n          _this2.selectItem();\n        },\n        onTouchEnd: function onTouchEnd(e) {\n          e.preventDefault();\n\n          if (_this2.clicked) {\n            onClickHandler(e);\n          }\n        },\n        onTouchMove: function onTouchMove() {\n          _this2.clicked = false;\n        },\n        onTouchCancel: function onTouchCancel() {\n          _this2.clicked = false;\n        }\n        /* $FlowFixMe */\n        ,\n        ref: innerRef\n      }, React.createElement(Component, {\n        selected: selected,\n        entity: item\n      })));\n    }\n  }]);\n\n  return Item;\n}(React.Component);\n\nvar List =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(List, _React$Component);\n\n  function List() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, List);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(List)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      selectedItem: null\n    };\n    _this.cachedIdOfItems = new Map();\n\n    _this.onPressEnter = function (e) {\n      if (typeof e !== \"undefined\") {\n        e.preventDefault();\n      }\n\n      var values = _this.props.values;\n\n      _this.modifyText(values[_this.getPositionInList()]);\n    };\n\n    _this.getPositionInList = function () {\n      var values = _this.props.values;\n      var selectedItem = _this.state.selectedItem;\n      if (!selectedItem) return 0;\n      return values.findIndex(function (a) {\n        return _this.getId(a) === _this.getId(selectedItem);\n      });\n    };\n\n    _this.getId = function (item) {\n      if (_this.cachedIdOfItems.has(item)) {\n        // $FlowFixMe\n        return _this.cachedIdOfItems.get(item);\n      }\n\n      var textToReplace = _this.props.getTextToReplace(item);\n\n      var computeId = function computeId() {\n        if (textToReplace) {\n          if (textToReplace.key) {\n            return textToReplace.key;\n          }\n\n          if (typeof item === \"string\" || !item.key) {\n            return textToReplace.text;\n          }\n        }\n\n        if (!item.key) {\n          throw new Error(\"Item \".concat(JSON.stringify(item), \" has to have defined \\\"key\\\" property\"));\n        } // $FlowFixMe\n\n\n        return item.key;\n      };\n\n      var id = computeId();\n\n      _this.cachedIdOfItems.set(item, id);\n\n      return id;\n    };\n\n    _this.listeners = [];\n    _this.itemsRef = {};\n\n    _this.modifyText = function (value) {\n      if (!value) return;\n      var onSelect = _this.props.onSelect;\n      onSelect(value);\n    };\n\n    _this.selectItem = function (item) {\n      var keyboard = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var onItemHighlighted = _this.props.onItemHighlighted;\n      if (_this.state.selectedItem === item) return;\n\n      _this.setState({\n        selectedItem: item\n      }, function () {\n        onItemHighlighted(item);\n\n        if (keyboard) {\n          _this.props.dropdownScroll(_this.itemsRef[_this.getId(item)]);\n        }\n      });\n    };\n\n    _this.scroll = function (e) {\n      e.preventDefault();\n      var values = _this.props.values;\n      var code = e.keyCode || e.which;\n\n      var oldPosition = _this.getPositionInList();\n\n      var newPosition;\n\n      switch (code) {\n        case KEY_CODES.DOWN:\n          newPosition = oldPosition + 1;\n          break;\n\n        case KEY_CODES.UP:\n          newPosition = oldPosition - 1;\n          break;\n\n        default:\n          newPosition = oldPosition;\n          break;\n      }\n\n      newPosition = (newPosition % values.length + values.length) % values.length; // eslint-disable-line\n\n      _this.selectItem(values[newPosition], [KEY_CODES.DOWN, KEY_CODES.UP].includes(code));\n    };\n\n    _this.isSelected = function (item) {\n      var selectedItem = _this.state.selectedItem;\n      if (!selectedItem) return false;\n      return _this.getId(selectedItem) === _this.getId(item);\n    };\n\n    return _this;\n  }\n\n  _createClass(List, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.listeners.push(Listeners.add([KEY_CODES.DOWN, KEY_CODES.UP], this.scroll), Listeners.add([KEY_CODES.ENTER, KEY_CODES.TAB], this.onPressEnter));\n      var values = this.props.values;\n      if (values && values[0]) this.selectItem(values[0]);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(_ref) {\n      var _this2 = this;\n\n      var oldValues = _ref.values;\n      var values = this.props.values;\n      var oldValuesSerialized = oldValues.map(function (val) {\n        return _this2.getId(val);\n      }).join(\"\");\n      var newValuesSerialized = values.map(function (val) {\n        return _this2.getId(val);\n      }).join(\"\");\n\n      if (oldValuesSerialized !== newValuesSerialized && values && values[0]) {\n        this.selectItem(values[0]);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var listener;\n\n      while (this.listeners.length) {\n        listener = this.listeners.pop();\n        Listeners.remove(listener);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props = this.props,\n          values = _this$props.values,\n          component = _this$props.component,\n          style = _this$props.style,\n          itemClassName = _this$props.itemClassName,\n          className = _this$props.className,\n          itemStyle = _this$props.itemStyle;\n      return React.createElement(\"ul\", {\n        className: \"rta__list \".concat(className || \"\"),\n        style: style\n      }, values.map(function (item) {\n        return React.createElement(Item, {\n          key: _this3.getId(item),\n          innerRef: function innerRef(ref) {\n            _this3.itemsRef[_this3.getId(item)] = ref;\n          },\n          selected: _this3.isSelected(item),\n          item: item,\n          className: itemClassName,\n          style: itemStyle,\n          onClickHandler: _this3.onPressEnter,\n          onSelectHandler: _this3.selectItem,\n          component: component\n        });\n      }));\n    }\n  }]);\n\n  return List;\n}(React.Component);\n\nfunction defaultScrollToItem(container, item) {\n  var itemHeight = parseInt(getComputedStyle(item).getPropertyValue(\"height\"), 10);\n  var containerHight = parseInt(getComputedStyle(container).getPropertyValue(\"height\"), 10) - itemHeight;\n  var itemOffsetTop = item.offsetTop;\n  var actualScrollTop = container.scrollTop;\n\n  if (itemOffsetTop < actualScrollTop + containerHight && actualScrollTop < itemOffsetTop) {\n    return;\n  } // eslint-disable-next-line\n\n\n  container.scrollTop = itemOffsetTop;\n}\n\nvar DEFAULT_CARET_POSITION = \"next\";\nvar POSITION_CONFIGURATION = {\n  X: {\n    LEFT: \"rta__autocomplete--left\",\n    RIGHT: \"rta__autocomplete--right\"\n  },\n  Y: {\n    TOP: \"rta__autocomplete--top\",\n    BOTTOM: \"rta__autocomplete--bottom\"\n  }\n};\n\nvar errorMessage = function errorMessage(message) {\n  return console.error(\"RTA: dataProvider fails: \".concat(message, \"\\n    \\nCheck the documentation or create issue if you think it's bug. https://github.com/webscopeio/react-textarea-autocomplete/issues\"));\n};\n\nvar reservedRegexChars = [\".\", \"^\", \"$\", \"*\", \"+\", \"-\", \"?\", \"(\", \")\", \"[\", \"]\", \"{\", \"}\", \"\\\\\", \"|\"];\n\nvar escapeRegex = function escapeRegex(text) {\n  return _toConsumableArray(text).map(function (character) {\n    return reservedRegexChars.includes(character) ? \"\\\\\".concat(character) : character;\n  }).join(\"\");\n}; // The main purpose of this component is to figure out to which side the autocomplete should be opened\n\n\nvar Autocomplete =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Autocomplete, _React$Component);\n\n  function Autocomplete() {\n    _classCallCheck(this, Autocomplete);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Autocomplete).apply(this, arguments));\n  }\n\n  _createClass(Autocomplete, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var boundariesElement = this.props.boundariesElement;\n\n      if (typeof boundariesElement === \"string\") {\n        var elem = document.querySelector(boundariesElement);\n\n        if (!elem) {\n          throw new Error(\"RTA: Invalid prop boundariesElement: it has to be string or HTMLElement.\");\n        }\n\n        this.containerElem = elem;\n      } else if (boundariesElement instanceof HTMLElement) {\n        this.containerElem = boundariesElement;\n      } else {\n        throw new Error(\"RTA: Invalid prop boundariesElement: it has to be string or HTMLElement.\");\n      }\n\n      if (!this.containerElem || !this.containerElem.contains(this.ref)) {\n        if (process.env.NODE_ENV !== \"test\") {\n          throw new Error(\"RTA: Invalid prop boundariesElement: it has to be one of the parents of the RTA.\");\n        }\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this$ref$classList, _this$ref$classList2;\n\n      var top = this.props.top || 0;\n      var left = this.props.left || 0;\n      var usedClasses = [];\n      var unusedClasses = [];\n      var topPosition = 0;\n      var leftPosition = 0;\n      var containerBounds = this.containerElem.getBoundingClientRect();\n      var dropdownBounds = this.ref.getBoundingClientRect();\n      var textareaBounds = this.props.textareaRef.getBoundingClientRect();\n      var computedStyle = window.getComputedStyle(this.ref);\n      var marginTop = parseInt(computedStyle.getPropertyValue(\"margin-top\"), 10);\n      var marginBottom = parseInt(computedStyle.getPropertyValue(\"margin-bottom\"), 10);\n      var marginLeft = parseInt(computedStyle.getPropertyValue(\"margin-left\"), 10);\n      var marginRight = parseInt(computedStyle.getPropertyValue(\"margin-right\"), 10);\n      var dropdownBottom = marginTop + marginBottom + textareaBounds.top + top + dropdownBounds.height;\n      var dropdownRight = marginLeft + marginRight + textareaBounds.left + left + dropdownBounds.width;\n\n      if (dropdownRight > containerBounds.right) {\n        leftPosition = left - dropdownBounds.width;\n        usedClasses.push(POSITION_CONFIGURATION.X.LEFT);\n        unusedClasses.push(POSITION_CONFIGURATION.X.RIGHT);\n      } else {\n        leftPosition = left;\n        usedClasses.push(POSITION_CONFIGURATION.X.RIGHT);\n        unusedClasses.push(POSITION_CONFIGURATION.X.LEFT);\n      }\n\n      if (dropdownBottom > containerBounds.bottom) {\n        topPosition = top - dropdownBounds.height;\n        usedClasses.push(POSITION_CONFIGURATION.Y.TOP);\n        unusedClasses.push(POSITION_CONFIGURATION.Y.BOTTOM);\n      } else {\n        topPosition = top;\n        usedClasses.push(POSITION_CONFIGURATION.Y.BOTTOM);\n        unusedClasses.push(POSITION_CONFIGURATION.Y.TOP);\n      }\n\n      if (this.props.renderToBody) {\n        topPosition += textareaBounds.top;\n        leftPosition += textareaBounds.left;\n      }\n\n      this.ref.style.top = \"\".concat(topPosition, \"px\");\n      this.ref.style.left = \"\".concat(leftPosition, \"px\");\n\n      (_this$ref$classList = this.ref.classList).remove.apply(_this$ref$classList, unusedClasses);\n\n      (_this$ref$classList2 = this.ref.classList).add.apply(_this$ref$classList2, usedClasses);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this = this;\n\n      var _this$props = this.props,\n          style = _this$props.style,\n          className = _this$props.className,\n          innerRef = _this$props.innerRef,\n          children = _this$props.children,\n          renderToBody = _this$props.renderToBody;\n      var body = document.body;\n      var autocompleteContainer = React.createElement(\"div\", {\n        ref: function ref(_ref) {\n          // $FlowFixMe\n          _this.ref = _ref; // $FlowFixMe\n\n          innerRef(_ref);\n        },\n        className: \"rta__autocomplete \".concat(className || \"\"),\n        style: style\n      }, children);\n      return renderToBody && body !== null ? ReactDOM.createPortal(autocompleteContainer, body) : autocompleteContainer;\n    }\n  }]);\n\n  return Autocomplete;\n}(React.Component);\n\nvar ReactTextareaAutocomplete =\n/*#__PURE__*/\nfunction (_React$Component2) {\n  _inherits(ReactTextareaAutocomplete, _React$Component2);\n\n  function ReactTextareaAutocomplete(_props) {\n    var _this2;\n\n    _classCallCheck(this, ReactTextareaAutocomplete);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ReactTextareaAutocomplete).call(this, _props));\n    _this2.state = {\n      top: null,\n      left: null,\n      currentTrigger: null,\n      actualToken: \"\",\n      data: null,\n      value: \"\",\n      dataLoading: false,\n      selectionEnd: 0,\n      component: null,\n      textToReplace: null\n    };\n\n    _this2.escListenerInit = function () {\n      if (!_this2.escListener) {\n        _this2.escListener = Listeners.add(KEY_CODES.ESC, _this2._closeAutocomplete);\n      }\n    };\n\n    _this2.escListenerDestroy = function () {\n      if (_this2.escListener) {\n        Listeners.remove(_this2.escListener);\n        _this2.escListener = null;\n      }\n    };\n\n    _this2.getSelectionPosition = function () {\n      if (!_this2.textareaRef) return null;\n      return {\n        selectionStart: _this2.textareaRef.selectionStart,\n        selectionEnd: _this2.textareaRef.selectionEnd\n      };\n    };\n\n    _this2.getSelectedText = function () {\n      if (!_this2.textareaRef) return null;\n      var _this2$textareaRef = _this2.textareaRef,\n          selectionStart = _this2$textareaRef.selectionStart,\n          selectionEnd = _this2$textareaRef.selectionEnd;\n      if (selectionStart === selectionEnd) return null;\n      return _this2.state.value.substr(selectionStart, selectionEnd - selectionStart);\n    };\n\n    _this2.setCaretPosition = function () {\n      var position = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      if (!_this2.textareaRef) return;\n\n      _this2.textareaRef.focus();\n\n      _this2.textareaRef.setSelectionRange(position, position);\n    };\n\n    _this2.getCaretPosition = function () {\n      if (!_this2.textareaRef) {\n        return 0;\n      }\n\n      var position = _this2.textareaRef.selectionEnd;\n      return position;\n    };\n\n    _this2._handleCaretChange = function (e) {\n      var cleanLastTrigger = function cleanLastTrigger() {\n        var beforeHandle = _this2.getCaretPosition() - 1;\n        _this2.lastTrigger = _this2.lastTrigger ? beforeHandle : 0;\n      };\n\n      if (e.type === \"keydown\") {\n        // $FlowFixMe\n        var code = e.keyCode || e.which;\n\n        switch (code) {\n          case KEY_CODES.UP:\n          case KEY_CODES.DOWN:\n            if (!_this2._isAutocompleteOpen()) {\n              cleanLastTrigger();\n            }\n\n            break;\n\n          case KEY_CODES.LEFT:\n          case KEY_CODES.RIGHT:\n            cleanLastTrigger();\n            break;\n\n          default:\n        }\n\n        return;\n      }\n\n      cleanLastTrigger();\n    };\n\n    _this2._onSelect = function (item) {\n      var _this2$state = _this2.state,\n          selectionEnd = _this2$state.selectionEnd,\n          currentTrigger = _this2$state.currentTrigger,\n          textareaValue = _this2$state.value;\n      var _this2$props = _this2.props,\n          trigger = _this2$props.trigger,\n          onItemSelected = _this2$props.onItemSelected;\n      if (!currentTrigger) return;\n\n      var getTextToReplaceForCurrentTrigger = _this2._getTextToReplace(currentTrigger);\n\n      if (!getTextToReplaceForCurrentTrigger) {\n        _this2._closeAutocomplete();\n\n        return;\n      }\n\n      var newToken = getTextToReplaceForCurrentTrigger(item);\n\n      if (!newToken) {\n        _this2._closeAutocomplete();\n\n        return;\n      }\n\n      if (onItemSelected) {\n        onItemSelected({\n          currentTrigger: currentTrigger,\n          item: item\n        });\n      }\n\n      var computeCaretPosition = function computeCaretPosition(position, token, startToken) {\n        switch (position) {\n          case \"start\":\n            return startToken;\n\n          case \"next\":\n          case \"end\":\n            return startToken + token.length;\n\n          default:\n            if (!Number.isInteger(position)) {\n              throw new Error('RTA: caretPosition should be \"start\", \"next\", \"end\" or number.');\n            }\n\n            return position;\n        }\n      };\n\n      var textToModify = textareaValue.slice(0, selectionEnd);\n      var startOfTokenPosition = textToModify.search(\n      /**\n       * It's important to escape the currentTrigger char for chars like [, (,...\n       */\n      new RegExp(\"\".concat(escapeRegex(currentTrigger), \"[^\".concat(escapeRegex(currentTrigger)).concat(trigger[currentTrigger].allowWhitespace ? \"\" : \"\\\\s\", \"]\"), \"*$\"))); // we add space after emoji is selected if a caret position is next\n\n      var newTokenString = newToken.caretPosition === \"next\" ? \"\".concat(newToken.text, \" \") : newToken.text;\n      var newCaretPosition = computeCaretPosition(newToken.caretPosition, newTokenString, startOfTokenPosition);\n      var modifiedText = textToModify.substring(0, startOfTokenPosition) + newTokenString;\n      var newValue = textareaValue.replace(textToModify, modifiedText); // set the new textarea value and after that set the caret back to its position\n\n      _this2.setState({\n        value: newValue,\n        dataLoading: false\n      }, function () {\n        var insertedTrigger = _this2.tokenRegExpEnding.exec(newTokenString);\n\n        var insertedTriggerModifier = insertedTrigger ? insertedTrigger[0].length : 1;\n        _this2.lastTrigger = newCaretPosition ? newCaretPosition - insertedTriggerModifier : newCaretPosition;\n        _this2.textareaRef.value = newValue;\n        _this2.textareaRef.selectionEnd = newCaretPosition;\n\n        _this2._changeHandler();\n\n        var scrollTop = _this2.textareaRef.scrollTop;\n\n        _this2.setCaretPosition(newCaretPosition);\n        /*\n          Chrome does not maintain scroll position\n          Relevant discussion https://github.com/webscopeio/react-textarea-autocomplete/pull/97\n        */\n\n\n        if (window.chrome) {\n          _this2.textareaRef.scrollTop = scrollTop;\n        }\n      });\n    };\n\n    _this2._getTextToReplace = function (currentTrigger) {\n      var triggerSettings = _this2.props.trigger[currentTrigger];\n      if (!currentTrigger || !triggerSettings) return null;\n      var output = triggerSettings.output;\n      return function (item) {\n        if (typeof item === \"object\" && (!output || typeof output !== \"function\")) {\n          throw new Error('Output functor is not defined! If you are using items as object you have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n        }\n\n        if (output) {\n          var textToReplace = output(item, currentTrigger);\n\n          if (textToReplace === undefined || typeof textToReplace === \"number\") {\n            throw new Error(\"Output functor should return string or object in shape {text: string, caretPosition: string | number}.\\nGot \\\"\".concat(String(textToReplace), \"\\\". Check the implementation for trigger \\\"\").concat(currentTrigger, \"\\\"\\n\\nSee https://github.com/webscopeio/react-textarea-autocomplete#trigger-type for more information.\\n\"));\n          }\n\n          if (textToReplace === null) return null;\n\n          if (typeof textToReplace === \"string\") {\n            return {\n              text: textToReplace,\n              caretPosition: DEFAULT_CARET_POSITION\n            };\n          }\n\n          if (!textToReplace.text) {\n            throw new Error(\"Output \\\"text\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\".concat(currentTrigger, \"\\\"\\n\"));\n          }\n\n          if (!textToReplace.caretPosition) {\n            throw new Error(\"Output \\\"caretPosition\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\".concat(currentTrigger, \"\\\"\\n\"));\n          }\n\n          return textToReplace;\n        }\n\n        if (typeof item !== \"string\") {\n          throw new Error(\"Output item should be string\\n\");\n        }\n\n        return {\n          text: \"\".concat(currentTrigger).concat(item).concat(currentTrigger),\n          caretPosition: DEFAULT_CARET_POSITION\n        };\n      };\n    };\n\n    _this2._getCurrentTriggerSettings = function () {\n      var currentTrigger = _this2.state.currentTrigger;\n      if (!currentTrigger) return null;\n      return _this2.props.trigger[currentTrigger];\n    };\n\n    _this2._getValuesFromProvider = function () {\n      var _this2$state2 = _this2.state,\n          currentTrigger = _this2$state2.currentTrigger,\n          actualToken = _this2$state2.actualToken;\n\n      var triggerSettings = _this2._getCurrentTriggerSettings();\n\n      if (!currentTrigger || !triggerSettings) {\n        return;\n      }\n\n      var dataProvider = triggerSettings.dataProvider,\n          component = triggerSettings.component;\n\n      if (typeof dataProvider !== \"function\") {\n        throw new Error(\"Trigger provider has to be a function!\");\n      }\n\n      _this2.setState({\n        dataLoading: true\n      });\n\n      var providedData = dataProvider(actualToken);\n\n      if (!(providedData instanceof Promise)) {\n        providedData = Promise.resolve(providedData);\n      }\n\n      providedData.then(function (data) {\n        if (!Array.isArray(data)) {\n          throw new Error(\"Trigger provider has to provide an array!\");\n        }\n\n        if (typeof component !== \"function\") {\n          throw new Error(\"Component should be defined!\");\n        } // throw away if we resolved old trigger\n\n\n        if (currentTrigger !== _this2.state.currentTrigger) return; // if we haven't resolved any data let's close the autocomplete\n\n        if (!data.length) {\n          _this2._closeAutocomplete();\n\n          return;\n        }\n\n        _this2.setState({\n          dataLoading: false,\n          data: data,\n          component: component\n        });\n      }).catch(function (e) {\n        return errorMessage(e.message);\n      });\n    };\n\n    _this2._getSuggestions = function () {\n      var _this2$state3 = _this2.state,\n          currentTrigger = _this2$state3.currentTrigger,\n          data = _this2$state3.data;\n      if (!currentTrigger || !data || data && !data.length) return null;\n      return data;\n    };\n\n    _this2._createRegExp = function () {\n      var trigger = _this2.props.trigger; // negative lookahead to match only the trigger + the actual token = \"bladhwd:adawd:word test\" => \":word\"\n      // https://stackoverflow.com/a/8057827/2719917\n\n      _this2.tokenRegExp = new RegExp(\"(\".concat(Object.keys(trigger) // the sort is important for multi-char combos as \"/kick\", \"/\"\n      .sort(function (a, b) {\n        if (a < b) {\n          return 1;\n        }\n\n        if (a > b) {\n          return -1;\n        }\n\n        return 0;\n      }).map(function (a) {\n        return escapeRegex(a);\n      }).join(\"|\"), \")((?:(?!\\\\1)[^\\\\s])*$)\"));\n      _this2.tokenRegExpEnding = new RegExp(\"(\".concat(Object.keys(trigger) // the sort is important for multi-char combos as \"/kick\", \"/\"\n      .sort(function (a, b) {\n        if (a < b) {\n          return 1;\n        }\n\n        if (a > b) {\n          return -1;\n        }\n\n        return 0;\n      }).map(function (a) {\n        return escapeRegex(a);\n      }).join(\"|\"), \")$\"));\n    };\n\n    _this2._closeAutocomplete = function () {\n      var currentTrigger = _this2.state.currentTrigger;\n\n      _this2.escListenerDestroy();\n\n      _this2.setState({\n        data: null,\n        dataLoading: false,\n        currentTrigger: null\n      }, function () {\n        if (currentTrigger) _this2._onItemHighlightedHandler(null);\n      });\n    };\n\n    _this2._cleanUpProps = function () {\n      var props = _objectSpread({}, _this2.props);\n\n      var notSafe = [\"loadingComponent\", \"boundariesElement\", \"containerStyle\", \"minChar\", \"scrollToItem\", \"ref\", \"innerRef\", \"onChange\", \"onCaretPositionChange\", \"className\", \"value\", \"trigger\", \"listStyle\", \"itemStyle\", \"containerStyle\", \"loaderStyle\", \"className\", \"containerClassName\", \"listClassName\", \"itemClassName\", \"loaderClassName\", \"dropdownStyle\", \"dropdownClassName\", \"movePopupAsYouType\", \"textAreaComponent\", \"renderToBody\", \"onItemSelected\", \"onItemHighlighted\"]; // eslint-disable-next-line\n\n      for (var prop in props) {\n        if (notSafe.includes(prop)) delete props[prop];\n      }\n\n      return props;\n    };\n\n    _this2._changeHandler = function (e) {\n      var _this2$props2 = _this2.props,\n          trigger = _this2$props2.trigger,\n          onChange = _this2$props2.onChange,\n          minChar = _this2$props2.minChar,\n          onCaretPositionChange = _this2$props2.onCaretPositionChange,\n          movePopupAsYouType = _this2$props2.movePopupAsYouType;\n      var _this2$state4 = _this2.state,\n          top = _this2$state4.top,\n          left = _this2$state4.left;\n      var event = e;\n\n      if (!event) {\n        // fire onChange event after successful selection\n        event = new CustomEvent(\"change\", {\n          bubbles: true\n        });\n\n        _this2.textareaRef.dispatchEvent(event);\n      }\n\n      var textarea = event.target;\n      var selectionEnd = textarea.selectionEnd;\n      var value = textarea.value;\n      _this2.lastValueBubbledEvent = value;\n\n      if (onChange && event) {\n        event.persist && event.persist();\n        onChange(event);\n      }\n\n      if (onCaretPositionChange) {\n        var caretPosition = _this2.getCaretPosition();\n\n        onCaretPositionChange(caretPosition);\n      }\n\n      _this2.setState({\n        value: value\n      });\n\n      var setTopLeft = function setTopLeft() {\n        var _getCaretCoordinates = getCaretCoordinates(textarea, selectionEnd),\n            newTop = _getCaretCoordinates.top,\n            newLeft = _getCaretCoordinates.left;\n\n        _this2.setState({\n          // make position relative to textarea\n          top: newTop - _this2.textareaRef.scrollTop || 0,\n          left: newLeft\n        });\n      };\n\n      var cleanLastTrigger = function cleanLastTrigger(triggerLength) {\n        _this2.lastTrigger = selectionEnd - triggerLength;\n\n        _this2._closeAutocomplete();\n\n        setTopLeft();\n      };\n\n      if (selectionEnd <= _this2.lastTrigger) {\n        var _affectedTextareaValue = value.slice(0, selectionEnd);\n\n        var _newTrigger = _this2.tokenRegExp.exec(_affectedTextareaValue);\n\n        cleanLastTrigger(_newTrigger ? _newTrigger[0].length : 0);\n      }\n\n      var affectedTextareaValue = value.slice(_this2.lastTrigger, selectionEnd);\n\n      var tokenMatch = _this2.tokenRegExp.exec(affectedTextareaValue);\n\n      var lastToken = tokenMatch && tokenMatch[0];\n      var currentTrigger = tokenMatch && tokenMatch[1] || null;\n      var currentTriggerLength = currentTrigger ? currentTrigger.length - 1 : 0; // with this approach we want to know if the user just inserted a new trigger sequence\n\n      var newTrigger = _this2.tokenRegExpEnding.exec(affectedTextareaValue);\n\n      if (newTrigger) {\n        cleanLastTrigger(newTrigger[0].length);\n      } else if (!_this2._isAutocompleteOpen()) {\n        _this2._closeAutocomplete();\n      }\n      /*\n       if we lost the trigger token or there is no following character we want to close\n       the autocomplete\n      */\n\n\n      if ((!lastToken || lastToken.length <= minChar + currentTriggerLength) && ( // check if our current trigger disallows whitespace\n      _this2.state.currentTrigger && !trigger[_this2.state.currentTrigger].allowWhitespace || !_this2.state.currentTrigger)) {\n        _this2._closeAutocomplete();\n\n        return;\n      }\n      /**\n       * This code has to be sync that is the reason why we obtain the currentTrigger\n       * from currentTrigger not this.state.currentTrigger\n       *\n       * Check if the currently typed token has to be afterWhitespace, or not.\n       *\n       * This setting means that there has to be whitespace before the token (on it has to be the the first character typed into textarea)\n       */\n\n\n      if (currentTrigger && trigger[currentTrigger].afterWhitespace && !/\\s/.test(value[selectionEnd - lastToken.length - 1]) && value[selectionEnd - lastToken.length - 1] !== undefined) {\n        _this2._closeAutocomplete();\n\n        return;\n      }\n      /**\n        If our current trigger allows whitespace\n        get the correct token for DataProvider, so we need to construct new RegExp\n       */\n\n\n      if (_this2.state.currentTrigger && trigger[_this2.state.currentTrigger].allowWhitespace) {\n        tokenMatch = new RegExp(\"\".concat(escapeRegex(_this2.state.currentTrigger), \".*$\")).exec(value.slice(0, selectionEnd));\n        lastToken = tokenMatch && tokenMatch[0];\n\n        if (!lastToken) {\n          _this2._closeAutocomplete();\n\n          return;\n        }\n\n        currentTrigger = Object.keys(trigger).find(function (a) {\n          return a.slice(0, currentTriggerLength + 1) === lastToken.slice(0, currentTriggerLength + 1);\n        }) || null;\n      }\n\n      var actualToken = lastToken.slice(1); // if trigger is not configured step out from the function, otherwise proceed\n\n      if (!currentTrigger) {\n        return;\n      }\n\n      if (movePopupAsYouType || top === null && left === null || // if the trigger got changed, let's reposition the autocomplete\n      _this2.state.currentTrigger !== currentTrigger) {\n        setTopLeft();\n      }\n\n      _this2.escListenerInit();\n\n      var textToReplace = _this2._getTextToReplace(currentTrigger);\n\n      _this2.setState({\n        selectionEnd: selectionEnd,\n        currentTrigger: currentTrigger,\n        textToReplace: textToReplace,\n        actualToken: actualToken\n      }, function () {\n        try {\n          _this2._getValuesFromProvider();\n        } catch (err) {\n          errorMessage(err.message);\n        }\n      });\n    };\n\n    _this2._selectHandler = function (e) {\n      var _this2$props3 = _this2.props,\n          onCaretPositionChange = _this2$props3.onCaretPositionChange,\n          onSelect = _this2$props3.onSelect;\n\n      if (onCaretPositionChange) {\n        var caretPosition = _this2.getCaretPosition();\n\n        onCaretPositionChange(caretPosition);\n      }\n\n      if (onSelect) {\n        e.persist();\n        onSelect(e);\n      }\n    };\n\n    _this2._shouldStayOpen = function (e) {\n      var el = e.relatedTarget; // IE11 doesn't know about `relatedTarget` // https://stackoverflow.com/a/49325196/2719917\n\n      if (el === null) {\n        el = document.activeElement;\n      }\n\n      if (_this2.dropdownRef && el instanceof Node && _this2.dropdownRef.contains(el)) {\n        return true;\n      }\n\n      return false;\n    };\n\n    _this2._onClick = function (e) {\n      var onClick = _this2.props.onClick;\n\n      if (onClick) {\n        e.persist();\n        onClick(e);\n      }\n\n      if (_this2._shouldStayOpen(e)) {\n        return;\n      }\n\n      _this2._closeAutocomplete();\n    };\n\n    _this2._onBlur = function (e) {\n      var onBlur = _this2.props.onBlur;\n\n      if (onBlur) {\n        e.persist();\n        onBlur(e);\n      }\n\n      if (_this2._shouldStayOpen(e)) {\n        return;\n      }\n\n      _this2._closeAutocomplete();\n    };\n\n    _this2._onScrollHandler = function () {\n      _this2._closeAutocomplete();\n    };\n\n    _this2._onItemHighlightedHandler = function (item) {\n      var onItemHighlighted = _this2.props.onItemHighlighted;\n      var currentTrigger = _this2.state.currentTrigger;\n\n      if (onItemHighlighted) {\n        if (typeof onItemHighlighted === \"function\") {\n          onItemHighlighted({\n            currentTrigger: currentTrigger,\n            item: item\n          });\n        } else {\n          throw new Error(\"`onItemHighlighted` has to be a function\");\n        }\n      }\n    };\n\n    _this2._dropdownScroll = function (item) {\n      var scrollToItem = _this2.props.scrollToItem;\n      if (!scrollToItem) return;\n\n      if (scrollToItem === true) {\n        defaultScrollToItem(_this2.dropdownRef, item);\n        return;\n      }\n\n      if (typeof scrollToItem !== \"function\" || scrollToItem.length !== 2) {\n        throw new Error(\"`scrollToItem` has to be boolean (true for default implementation) or function with two parameters: container, item.\");\n      }\n\n      scrollToItem(_this2.dropdownRef, item);\n    };\n\n    _this2._isAutocompleteOpen = function () {\n      var _this2$state5 = _this2.state,\n          dataLoading = _this2$state5.dataLoading,\n          currentTrigger = _this2$state5.currentTrigger;\n\n      var suggestionData = _this2._getSuggestions();\n\n      return !!((dataLoading || suggestionData) && currentTrigger);\n    };\n\n    _this2._textareaRef = function (ref) {\n      // $FlowFixMe - ref is actually a `?HTMLTextAreaElement`\n      _this2.props.innerRef && _this2.props.innerRef(ref);\n      _this2.textareaRef = ref;\n    };\n\n    _this2.lastTrigger = 0;\n    _this2.escListener = null;\n    var _this2$props4 = _this2.props,\n        loadingComponent = _this2$props4.loadingComponent,\n        _trigger = _this2$props4.trigger,\n        _value = _this2$props4.value;\n    if (_value) _this2.state.value = _value;\n\n    _this2._createRegExp();\n\n    if (!loadingComponent) {\n      throw new Error(\"RTA: loadingComponent is not defined\");\n    }\n\n    if (!_trigger) {\n      throw new Error(\"RTA: trigger is not defined\");\n    }\n\n    return _this2;\n  }\n\n  _createClass(ReactTextareaAutocomplete, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      Listeners.startListen(this.textareaRef); // handle caret change\n\n      this.textareaRef && this.textareaRef.addEventListener(\"focus\", this._handleCaretChange);\n      this.textareaRef && this.textareaRef.addEventListener(\"click\", this._handleCaretChange);\n      this.textareaRef && this.textareaRef.addEventListener(\"keydown\", this._handleCaretChange);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(_ref2) {\n      var oldTrigger = _ref2.trigger,\n          oldValue = _ref2.value;\n      var _this$props2 = this.props,\n          trigger = _this$props2.trigger,\n          value = _this$props2.value;\n\n      if (Object.keys(trigger).join(\"\") !== Object.keys(oldTrigger).join(\"\")) {\n        this._createRegExp();\n      }\n\n      if (oldValue !== value && this.lastValueBubbledEvent !== value) {\n        this.lastTrigger = 0;\n\n        this._changeHandler();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.escListenerDestroy();\n      Listeners.stopListen(this.textareaRef); // handle caret change\n\n      this.textareaRef && this.textareaRef.removeEventListener(\"focus\", this._handleCaretChange);\n      this.textareaRef && this.textareaRef.removeEventListener(\"click\", this._handleCaretChange);\n      this.textareaRef && this.textareaRef.removeEventListener(\"keydown\", this._handleCaretChange);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props3 = this.props,\n          Loader = _this$props3.loadingComponent,\n          style = _this$props3.style,\n          className = _this$props3.className,\n          listStyle = _this$props3.listStyle,\n          itemStyle = _this$props3.itemStyle,\n          boundariesElement = _this$props3.boundariesElement,\n          movePopupAsYouType = _this$props3.movePopupAsYouType,\n          listClassName = _this$props3.listClassName,\n          itemClassName = _this$props3.itemClassName,\n          dropdownClassName = _this$props3.dropdownClassName,\n          dropdownStyle = _this$props3.dropdownStyle,\n          containerStyle = _this$props3.containerStyle,\n          containerClassName = _this$props3.containerClassName,\n          loaderStyle = _this$props3.loaderStyle,\n          loaderClassName = _this$props3.loaderClassName,\n          textAreaComponent = _this$props3.textAreaComponent,\n          renderToBody = _this$props3.renderToBody;\n      var _this$state = this.state,\n          left = _this$state.left,\n          top = _this$state.top,\n          dataLoading = _this$state.dataLoading,\n          component = _this$state.component,\n          value = _this$state.value,\n          textToReplace = _this$state.textToReplace;\n\n      var isAutocompleteOpen = this._isAutocompleteOpen();\n\n      var suggestionData = this._getSuggestions();\n\n      var extraAttrs = {};\n      var TextAreaComponent;\n\n      if (textAreaComponent.component) {\n        TextAreaComponent = textAreaComponent.component;\n        extraAttrs[textAreaComponent.ref] = this._textareaRef;\n      } else {\n        TextAreaComponent = textAreaComponent;\n        extraAttrs.ref = this._textareaRef;\n      }\n\n      return React.createElement(\"div\", {\n        className: \"rta \".concat(dataLoading === true ? \"rta--loading\" : \"\", \" \").concat(containerClassName || \"\"),\n        style: containerStyle\n      }, React.createElement(TextAreaComponent, Object.assign({}, this._cleanUpProps(), {\n        className: \"rta__textarea \".concat(className || \"\"),\n        onChange: this._changeHandler,\n        onSelect: this._selectHandler,\n        onScroll: this._onScrollHandler,\n        onClick: // The textarea itself is outside the autoselect dropdown.\n        this._onClick,\n        onBlur: this._onBlur,\n        value: value,\n        style: style\n      }, extraAttrs)), isAutocompleteOpen && React.createElement(Autocomplete, {\n        innerRef: function innerRef(ref) {\n          // $FlowFixMe\n          _this3.dropdownRef = ref;\n        },\n        top: top,\n        left: left,\n        style: dropdownStyle,\n        className: dropdownClassName,\n        movePopupAsYouType: movePopupAsYouType,\n        boundariesElement: boundariesElement,\n        textareaRef: this.textareaRef,\n        renderToBody: renderToBody\n      }, suggestionData && component && textToReplace && React.createElement(List, {\n        values: suggestionData,\n        component: component,\n        style: listStyle,\n        className: listClassName,\n        itemClassName: itemClassName,\n        itemStyle: itemStyle,\n        getTextToReplace: textToReplace,\n        onItemHighlighted: this._onItemHighlightedHandler,\n        onSelect: this._onSelect,\n        dropdownScroll: this._dropdownScroll\n      }), dataLoading && React.createElement(\"div\", {\n        className: \"rta__loader \".concat(suggestionData !== null ? \"rta__loader--suggestion-data\" : \"rta__loader--empty-suggestion-data\", \" \").concat(loaderClassName || \"\"),\n        style: loaderStyle\n      }, React.createElement(Loader, {\n        data: suggestionData\n      }))));\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(_ref3) {\n      var value = _ref3.value;\n      if (value === null || value === undefined) return null;\n      return {\n        value: value\n      };\n    }\n  }]);\n\n  return ReactTextareaAutocomplete;\n}(React.Component);\n\nReactTextareaAutocomplete.defaultProps = {\n  movePopupAsYouType: false,\n  value: null,\n  minChar: 1,\n  boundariesElement: \"body\",\n  scrollToItem: true,\n  textAreaComponent: \"textarea\",\n  renderToBody: false\n};\n\nexport default ReactTextareaAutocomplete;\n"]},"metadata":{},"sourceType":"module"}