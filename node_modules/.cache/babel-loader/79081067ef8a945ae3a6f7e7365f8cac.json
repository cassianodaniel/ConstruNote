{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import React,{useEffect}from\"react\";import{SquadCommunicator as SquadService}from\"./SquadCommunicatorService\";import{useGroup}from\"../contexts/GroupContext\";import{useContact}from\"../contexts/ContactContext\";import{Events as VoiceEvents}from\"./voice/types/types\";import{useCall}from\"../contexts/CallContext\";import CallStatus from\"../enuns/CallStatus\";import{useConference}from\"../contexts/ConferenceContext\";//import { callbackify } from \"util\";\n// import IContact from \"../alias/IContact\";\n// Comentado para Evitar Warnings no console\n// interface CreateGroupCallback {\n//   (groupCreated: boolean): void;\n// }\nvar squadService;var SquadSipCommunicator=function SquadSipCommunicator(){var _useContact=useContact(),contacts=_useContact.contacts;var _useCall=useCall(),currentCalls=_useCall.currentCalls,setCurrentCalls=_useCall.setCurrentCalls,callNumber=_useCall.callNumber,setCallNumber=_useCall.setCallNumber,updateConstraints=_useCall.updateConstraints,setUpdateConstraints=_useCall.setUpdateConstraints,blindTransfer=_useCall.blindTransfer,setBlindTransfer=_useCall.setBlindTransfer,assistedTransfer=_useCall.assistedTransfer,setAssistedTransfer=_useCall.setAssistedTransfer;var _useGroup=useGroup(),groups=_useGroup.groups;var _useConference=useConference(),conferenceList=_useConference.conferenceList;var init=function init(){squadService=SquadService.getInstance({voiceCB:voiceCommuncatorSubscribe});};var setNewCall=function setNewCall(call){var cc=new Map(currentCalls);cc.set(call.callId,call);setCurrentCalls(cc);};var removeCall=function removeCall(call){if(call.interval)clearTimeout(call.interval);var cc=new Map(currentCalls);cc.delete(call.callId);setCurrentCalls(cc);};var onMakeCall=function onMakeCall(){if(currentCalls){Array.from(currentCalls.values()).forEach(function(call){if(!call.hold){call.holdCall();}});}if(callNumber===null||callNumber===void 0?void 0:callNumber.number){var _squadService,_squadService$sip;var constraints={useAudio:callNumber===null||callNumber===void 0?void 0:callNumber.useAudio,useVideo:callNumber===null||callNumber===void 0?void 0:callNumber.useVideo};(_squadService=squadService)===null||_squadService===void 0?void 0:(_squadService$sip=_squadService.sip)===null||_squadService$sip===void 0?void 0:_squadService$sip.makeCall(callNumber===null||callNumber===void 0?void 0:callNumber.number,constraints);setCallNumber(undefined);}};var onUpdateConstraints=function onUpdateConstraints(){if(updateConstraints){var _squadService2;(_squadService2=squadService)===null||_squadService2===void 0?void 0:_squadService2.sip.updateConstraintsParams(updateConstraints);setUpdateConstraints(undefined);}};var onBlindTransfer=function onBlindTransfer(){if(blindTransfer){var _squadService3;(_squadService3=squadService)===null||_squadService3===void 0?void 0:_squadService3.sip.sip.blindTransfer(blindTransfer.callId,blindTransfer.number);setBlindTransfer(undefined);}};var onAttendedTransfer=function onAttendedTransfer(){if(assistedTransfer){var _squadService4;(_squadService4=squadService)===null||_squadService4===void 0?void 0:_squadService4.sip.sip.attendedTransfer(assistedTransfer.firstCallId,assistedTransfer.secondCallId);setAssistedTransfer(undefined);}};var onCallHoldChange=function onCallHoldChange(callId,status){var currentCallsCopy=new Map(currentCalls);var cpc=currentCallsCopy.get(callId);if(cpc){cpc=_objectSpread({},cpc);cpc.hold=status;currentCallsCopy.set(cpc.callId,cpc);setCurrentCalls(currentCallsCopy);}};var onAcceptCall=function onAcceptCall(callId,useVideo){var currentCallsCopy=new Map(currentCalls);Array.from(currentCalls.values()).filter(function(cl){return cl.callId!==callId;}).forEach(function(cl){var _squadService5;(_squadService5=squadService)===null||_squadService5===void 0?void 0:_squadService5.sip.holdCall(cl.callId);cl.hold=true;currentCallsCopy.set(cl.callId,cl);});var callCopy=currentCallsCopy.get(callId);if(callCopy){callCopy=_objectSpread({},callCopy);callCopy.callStatus=CallStatus.CONNECTING;callCopy.sendingVideo=useVideo;currentCallsCopy.set(callCopy.callId,callCopy);setCurrentCalls(currentCallsCopy);}};function voiceCommuncatorSubscribe(event,data){var _invitation$remoteIde,_invitation$remoteIde2,_ref,_ref2,_ref3,_inviter$sessionDescr,_inviter$remoteIdenti,_inviter$remoteIdenti2,_ref4,_ref5,_ref6,_data$invitation,_data$inviter;var endCall;switch(event){case VoiceEvents.CONNECTED:// squadService?.sip.sip.invite(\"2045\");\nconsole.log(\"connected\");break;case VoiceEvents.RECEIVED_CALL:var invitation=data;var invitation_caller_id_number=(_invitation$remoteIde=invitation.remoteIdentity.uri.aor)===null||_invitation$remoteIde===void 0?void 0:(_invitation$remoteIde2=_invitation$remoteIde.split(\"@\")[0])===null||_invitation$remoteIde2===void 0?void 0:_invitation$remoteIde2.replace(\"sip:\",\"\").replace(\"citrus-conference-authenticated-\",\"\").replace(\"citrus-conference_\",\"\").split(\"_\")[0];var invitation_ctct_of_number=contacts.find(function(ctc){return ctc.number===invitation_caller_id_number;})||groups.find(function(grp){return grp.groupId===invitation_caller_id_number;})||conferenceList.find(function(conf){return conf.id===invitation_caller_id_number;});var receivedCall;endCall=function endCall(){var _squadService6;(_squadService6=squadService)===null||_squadService6===void 0?void 0:_squadService6.sip.sip.endCall(invitation);};receivedCall={callId:invitation.id,callStatus:CallStatus.RINGING,callerNumber:invitation_caller_id_number,callerObject:invitation_ctct_of_number,callerId:((_ref=invitation_ctct_of_number)===null||_ref===void 0?void 0:_ref.id)||((_ref2=invitation_ctct_of_number)===null||_ref2===void 0?void 0:_ref2.groupId),callerName:invitation_ctct_of_number===null||invitation_ctct_of_number===void 0?void 0:invitation_ctct_of_number.name,callerProfilePicture:invitation_ctct_of_number===null||invitation_ctct_of_number===void 0?void 0:invitation_ctct_of_number.profilePicture,session:invitation,isGroup:!!((_ref3=invitation_ctct_of_number)===null||_ref3===void 0?void 0:_ref3.groupId),accept:function accept(){var _squadService7;var useVideo=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return(_squadService7=squadService)===null||_squadService7===void 0?void 0:_squadService7.sip.acceptCall(invitation,useVideo);},endCall:endCall,micMuted:false,videoMuted:false,hold:false,muteMic:function muteMic(){var _squadService8;return(_squadService8=squadService)===null||_squadService8===void 0?void 0:_squadService8.sip.muteMic(invitation.id);},unMuteMic:function unMuteMic(){var _squadService9;return(_squadService9=squadService)===null||_squadService9===void 0?void 0:_squadService9.sip.unMuteMic(invitation.id);},disableCam:function disableCam(){var _squadService10;return(_squadService10=squadService)===null||_squadService10===void 0?void 0:_squadService10.sip.disableCam(invitation.id);},enableCam:function enableCam(){var _squadService11;return(_squadService11=squadService)===null||_squadService11===void 0?void 0:_squadService11.sip.enableCam(invitation.id);},holdCall:function holdCall(){var _squadService12;return(_squadService12=squadService)===null||_squadService12===void 0?void 0:_squadService12.sip.holdCall(invitation.id);},unHoldCall:function unHoldCall(){var _squadService13;return(_squadService13=squadService)===null||_squadService13===void 0?void 0:_squadService13.sip.unHoldCall(invitation.id);}};setNewCall(receivedCall);break;case VoiceEvents.MAKE_CALL:var inviter=data;var localConstraints=inviter===null||inviter===void 0?void 0:(_inviter$sessionDescr=inviter.sessionDescriptionHandlerOptions)===null||_inviter$sessionDescr===void 0?void 0:_inviter$sessionDescr.constraints;var inviter_caller_id_number=(_inviter$remoteIdenti=inviter.remoteIdentity.uri.aor)===null||_inviter$remoteIdenti===void 0?void 0:(_inviter$remoteIdenti2=_inviter$remoteIdenti.split(\"@\")[0])===null||_inviter$remoteIdenti2===void 0?void 0:_inviter$remoteIdenti2.replace(\"sip:\",\"\").replace(\"citrus-conference-authenticated-\",\"\").replace(\"citrus-conference_\",\"\").split(\"_\")[0];var inviter_ctct_of_number=contacts.find(function(ctc){return ctc.number===inviter_caller_id_number;})||groups.find(function(grp){return grp.groupId===inviter_caller_id_number;})||conferenceList.find(function(conf){return conf.id===inviter_caller_id_number;});endCall=function endCall(){var _squadService14;(_squadService14=squadService)===null||_squadService14===void 0?void 0:_squadService14.sip.sip.endCall(inviter);};var sendCall={callId:inviter.id,callStatus:CallStatus.CALLING,callerNumber:inviter_caller_id_number,callerObject:inviter_ctct_of_number,callerId:((_ref4=inviter_ctct_of_number)===null||_ref4===void 0?void 0:_ref4.id)||((_ref5=inviter_ctct_of_number)===null||_ref5===void 0?void 0:_ref5.groupId),callerName:inviter_ctct_of_number===null||inviter_ctct_of_number===void 0?void 0:inviter_ctct_of_number.name,callerProfilePicture:inviter_ctct_of_number===null||inviter_ctct_of_number===void 0?void 0:inviter_ctct_of_number.profilePicture,session:inviter,isGroup:!!((_ref6=inviter_ctct_of_number)===null||_ref6===void 0?void 0:_ref6.groupId),sendingVideo:(localConstraints===null||localConstraints===void 0?void 0:localConstraints.video)!==false,endCall:endCall,muteMic:function muteMic(){var _squadService15;return(_squadService15=squadService)===null||_squadService15===void 0?void 0:_squadService15.sip.muteMic(inviter.id);},unMuteMic:function unMuteMic(){var _squadService16;return(_squadService16=squadService)===null||_squadService16===void 0?void 0:_squadService16.sip.unMuteMic(inviter.id);},disableCam:function disableCam(){var _squadService17;return(_squadService17=squadService)===null||_squadService17===void 0?void 0:_squadService17.sip.disableCam(inviter.id);},enableCam:function enableCam(){var _squadService18;return(_squadService18=squadService)===null||_squadService18===void 0?void 0:_squadService18.sip.enableCam(inviter.id);},holdCall:function holdCall(){var _squadService19;return(_squadService19=squadService)===null||_squadService19===void 0?void 0:_squadService19.sip.holdCall(inviter.id);},unHoldCall:function unHoldCall(){var _squadService20;return(_squadService20=squadService)===null||_squadService20===void 0?void 0:_squadService20.sip.unHoldCall(inviter.id);}};setNewCall(sendCall);console.log(\"make_call\");break;case VoiceEvents.CALL_ON_GOING:var callOnGoing=currentCalls.get(data===null||data===void 0?void 0:(_data$invitation=data.invitation)===null||_data$invitation===void 0?void 0:_data$invitation.id)||currentCalls.get(data===null||data===void 0?void 0:(_data$inviter=data.inviter)===null||_data$inviter===void 0?void 0:_data$inviter.id);if(callOnGoing){var _cc=_objectSpread({},callOnGoing);_cc.callStatus=CallStatus.ON_GOING;_cc.receivingVideo=data.receivingVideo;_cc.tagId=data.tagId;setNewCall(_cc);}break;case VoiceEvents.CALL_HANGUP:var hangupCall=currentCalls.get(data.id);if(hangupCall){removeCall(hangupCall);}break;case VoiceEvents.MUTE_MIC:var currentCallsCopy=new Map(currentCalls);var cc=currentCallsCopy.get(data.callId);if(cc){cc=_objectSpread({},cc);cc.micMuted=data.status;currentCallsCopy.set(cc.callId,cc);setCurrentCalls(currentCallsCopy);}break;case VoiceEvents.MUTE_CAM:var currentCallsCp=new Map(currentCalls);var ccp=currentCallsCp.get(data.callId);if(ccp){ccp=_objectSpread({},ccp);ccp.videoMuted=data.status;currentCallsCp.set(ccp.callId,ccp);setCurrentCalls(currentCallsCp);}break;case VoiceEvents.HOLD_CALL:onCallHoldChange(data.callId,data.status);break;case VoiceEvents.ACCEPTED_CALL:onAcceptCall(data.callId,data.useVideo);break;default:console.log(event);break;}}var updateFunction=function updateFunction(){var _squadService21;(_squadService21=squadService)===null||_squadService21===void 0?void 0:_squadService21.updateVoiceSubscribeFunction(voiceCommuncatorSubscribe);};useEffect(init,[]);useEffect(updateFunction,[contacts,groups,currentCalls,callNumber]);useEffect(onMakeCall,[callNumber]);useEffect(onUpdateConstraints,[updateConstraints]);useEffect(onBlindTransfer,[blindTransfer]);useEffect(onAttendedTransfer,[assistedTransfer]);return/*#__PURE__*/React.createElement(React.Fragment,null);};export default SquadSipCommunicator;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/SquadSipCommunicator.tsx"],"names":["React","useEffect","SquadCommunicator","SquadService","useGroup","useContact","Events","VoiceEvents","useCall","CallStatus","useConference","squadService","SquadSipCommunicator","contacts","currentCalls","setCurrentCalls","callNumber","setCallNumber","updateConstraints","setUpdateConstraints","blindTransfer","setBlindTransfer","assistedTransfer","setAssistedTransfer","groups","conferenceList","init","getInstance","voiceCB","voiceCommuncatorSubscribe","setNewCall","call","cc","Map","set","callId","removeCall","interval","clearTimeout","delete","onMakeCall","Array","from","values","forEach","hold","holdCall","number","constraints","useAudio","useVideo","sip","makeCall","undefined","onUpdateConstraints","updateConstraintsParams","onBlindTransfer","onAttendedTransfer","attendedTransfer","firstCallId","secondCallId","onCallHoldChange","status","currentCallsCopy","cpc","get","onAcceptCall","filter","cl","callCopy","callStatus","CONNECTING","sendingVideo","event","data","endCall","CONNECTED","console","log","RECEIVED_CALL","invitation","invitation_caller_id_number","remoteIdentity","uri","aor","split","replace","invitation_ctct_of_number","find","ctc","grp","groupId","conf","id","receivedCall","RINGING","callerNumber","callerObject","callerId","callerName","name","callerProfilePicture","profilePicture","session","isGroup","accept","acceptCall","micMuted","videoMuted","muteMic","unMuteMic","disableCam","enableCam","unHoldCall","MAKE_CALL","inviter","localConstraints","sessionDescriptionHandlerOptions","inviter_caller_id_number","inviter_ctct_of_number","sendCall","CALLING","video","CALL_ON_GOING","callOnGoing","ON_GOING","receivingVideo","tagId","CALL_HANGUP","hangupCall","MUTE_MIC","MUTE_CAM","currentCallsCp","ccp","HOLD_CALL","ACCEPTED_CALL","updateFunction","updateVoiceSubscribeFunction"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\r\nimport { useGroup } from \"../contexts/GroupContext\";\r\nimport { useContact } from \"../contexts/ContactContext\";\r\nimport IContact from \"../alias/IContact\";\r\nimport IGroup from \"../alias/IGroup\";\r\nimport { Events as VoiceEvents } from \"./voice/types/types\";\r\nimport { useCall } from \"../contexts/CallContext\";\r\nimport ICall from \"../alias/ICall\";\r\nimport { Invitation, Inviter } from \"sip.js\";\r\nimport CallStatus from \"../enuns/CallStatus\";\r\nimport { useConference } from \"../contexts/ConferenceContext\";\r\n//import { callbackify } from \"util\";\r\n\r\n// import IContact from \"../alias/IContact\";\r\n// Comentado para Evitar Warnings no console\r\n// interface CreateGroupCallback {\r\n//   (groupCreated: boolean): void;\r\n// }\r\n\r\nlet squadService: SquadService | undefined;\r\n\r\nconst SquadSipCommunicator: React.FC = () => {\r\n  const { contacts } = useContact();\r\n  const {\r\n    currentCalls,\r\n    setCurrentCalls,\r\n    callNumber,\r\n    setCallNumber,\r\n    updateConstraints,\r\n    setUpdateConstraints,\r\n    blindTransfer,\r\n    setBlindTransfer,\r\n    assistedTransfer,\r\n    setAssistedTransfer,\r\n  } = useCall();\r\n  const { groups } = useGroup();\r\n  const { conferenceList } = useConference();\r\n  const init = () => {\r\n    squadService = SquadService.getInstance({\r\n      voiceCB: voiceCommuncatorSubscribe,\r\n    });\r\n  };\r\n  const setNewCall = (call: ICall) => {\r\n    const cc = new Map<string, ICall>(currentCalls);\r\n    cc.set(call.callId, call);\r\n    setCurrentCalls(cc);\r\n  };\r\n  const removeCall = (call: ICall) => {\r\n    if (call.interval) clearTimeout(call.interval);\r\n    const cc = new Map<string, ICall>(currentCalls);\r\n    cc.delete(call.callId);\r\n    setCurrentCalls(cc);\r\n  };\r\n  const onMakeCall = () => {\r\n    if (currentCalls) {\r\n      Array.from(currentCalls.values()).forEach((call) => {\r\n        if (!call.hold) {\r\n          call.holdCall();\r\n        }\r\n      });\r\n    }\r\n    if (callNumber?.number) {\r\n      const constraints = {\r\n        useAudio: callNumber?.useAudio,\r\n        useVideo: callNumber?.useVideo,\r\n      };\r\n      squadService?.sip?.makeCall(callNumber?.number, constraints);\r\n      setCallNumber(undefined);\r\n    }\r\n  };\r\n  const onUpdateConstraints = () => {\r\n    if (updateConstraints) {\r\n      squadService?.sip.updateConstraintsParams(updateConstraints);\r\n      setUpdateConstraints(undefined);\r\n    }\r\n  };\r\n  const onBlindTransfer = () => {\r\n    if (blindTransfer) {\r\n      squadService?.sip.sip.blindTransfer(\r\n        blindTransfer.callId,\r\n        blindTransfer.number\r\n      );\r\n      setBlindTransfer(undefined);\r\n    }\r\n  };\r\n  const onAttendedTransfer = () => {\r\n    if (assistedTransfer) {\r\n      squadService?.sip.sip.attendedTransfer(\r\n        assistedTransfer.firstCallId,\r\n        assistedTransfer.secondCallId\r\n      );\r\n      setAssistedTransfer(undefined);\r\n    }\r\n  };\r\n  const onCallHoldChange = (callId: string, status: boolean) => {\r\n    const currentCallsCopy = new Map(currentCalls);\r\n    let cpc = currentCallsCopy.get(callId);\r\n    if (cpc) {\r\n      cpc = { ...cpc };\r\n      cpc.hold = status;\r\n      currentCallsCopy.set(cpc.callId, cpc);\r\n      setCurrentCalls(currentCallsCopy);\r\n    }\r\n  };\r\n  const onAcceptCall = (callId: string, useVideo: boolean) => {\r\n    const currentCallsCopy = new Map(currentCalls);\r\n    Array.from(currentCalls.values())\r\n      .filter((cl) => cl.callId !== callId)\r\n      .forEach((cl) => {\r\n        squadService?.sip.holdCall(cl.callId);\r\n        cl.hold = true;\r\n        currentCallsCopy.set(cl.callId, cl);\r\n      });\r\n    let callCopy = currentCallsCopy.get(callId);\r\n    if (callCopy) {\r\n      callCopy = { ...callCopy };\r\n      callCopy.callStatus = CallStatus.CONNECTING;\r\n      callCopy.sendingVideo = useVideo;\r\n      currentCallsCopy.set(callCopy.callId, callCopy);\r\n      setCurrentCalls(currentCallsCopy);\r\n    }\r\n  };\r\n  function voiceCommuncatorSubscribe(event: VoiceEvents, data: any) {\r\n    let endCall;\r\n    switch (event) {\r\n      case VoiceEvents.CONNECTED:\r\n        // squadService?.sip.sip.invite(\"2045\");\r\n        console.log(\"connected\");\r\n        break;\r\n      case VoiceEvents.RECEIVED_CALL:\r\n        const invitation = data as Invitation;\r\n        const invitation_caller_id_number = invitation.remoteIdentity.uri.aor\r\n          ?.split(\"@\")[0]\r\n          ?.replace(\"sip:\", \"\")\r\n          .replace(\"citrus-conference-authenticated-\", \"\")\r\n          .replace(\"citrus-conference_\", \"\")\r\n          .split(\"_\")[0];\r\n        const invitation_ctct_of_number =\r\n          contacts.find((ctc) => ctc.number === invitation_caller_id_number) ||\r\n          groups.find((grp) => grp.groupId === invitation_caller_id_number) ||\r\n          conferenceList.find(\r\n            (conf) => conf.id === invitation_caller_id_number\r\n          );\r\n        let receivedCall: ICall;\r\n        endCall = () => {\r\n          squadService?.sip.sip.endCall(invitation);\r\n        };\r\n        receivedCall = {\r\n          callId: invitation.id,\r\n          callStatus: CallStatus.RINGING,\r\n          callerNumber: invitation_caller_id_number,\r\n          callerObject: invitation_ctct_of_number,\r\n          callerId:\r\n            (invitation_ctct_of_number as IContact)?.id ||\r\n            (invitation_ctct_of_number as IGroup)?.groupId,\r\n          callerName: invitation_ctct_of_number?.name,\r\n          callerProfilePicture: invitation_ctct_of_number?.profilePicture,\r\n          session: invitation,\r\n          isGroup: !!(invitation_ctct_of_number as IGroup)?.groupId,\r\n          accept: (useVideo = false) =>\r\n            squadService?.sip.acceptCall(invitation, useVideo),\r\n          endCall,\r\n          micMuted: false,\r\n          videoMuted: false,\r\n          hold: false,\r\n          muteMic: () => squadService?.sip.muteMic(invitation.id),\r\n          unMuteMic: () => squadService?.sip.unMuteMic(invitation.id),\r\n          disableCam: () => squadService?.sip.disableCam(invitation.id),\r\n          enableCam: () => squadService?.sip.enableCam(invitation.id),\r\n          holdCall: () => squadService?.sip.holdCall(invitation.id),\r\n          unHoldCall: () => squadService?.sip.unHoldCall(invitation.id),\r\n        };\r\n        setNewCall(receivedCall);\r\n        break;\r\n      case VoiceEvents.MAKE_CALL:\r\n        const inviter = data as Inviter;\r\n        const localConstraints = inviter?.sessionDescriptionHandlerOptions\r\n          ?.constraints as MediaStreamConstraints;\r\n        const inviter_caller_id_number = inviter.remoteIdentity.uri.aor\r\n          ?.split(\"@\")[0]\r\n          ?.replace(\"sip:\", \"\")\r\n          .replace(\"citrus-conference-authenticated-\", \"\")\r\n          .replace(\"citrus-conference_\", \"\")\r\n          .split(\"_\")[0];\r\n        const inviter_ctct_of_number =\r\n          contacts.find((ctc) => ctc.number === inviter_caller_id_number) ||\r\n          groups.find((grp) => grp.groupId === inviter_caller_id_number) ||\r\n          conferenceList.find((conf) => conf.id === inviter_caller_id_number);\r\n\r\n        endCall = () => {\r\n          squadService?.sip.sip.endCall(inviter);\r\n        };\r\n        const sendCall: ICall = {\r\n          callId: inviter.id,\r\n          callStatus: CallStatus.CALLING,\r\n          callerNumber: inviter_caller_id_number,\r\n          callerObject: inviter_ctct_of_number,\r\n          callerId:\r\n            (inviter_ctct_of_number as IContact)?.id ||\r\n            (inviter_ctct_of_number as IGroup)?.groupId,\r\n          callerName: inviter_ctct_of_number?.name,\r\n          callerProfilePicture: inviter_ctct_of_number?.profilePicture,\r\n          session: inviter,\r\n          isGroup: !!(inviter_ctct_of_number as IGroup)?.groupId,\r\n          sendingVideo: localConstraints?.video !== false,\r\n          endCall,\r\n          muteMic: () => squadService?.sip.muteMic(inviter.id),\r\n          unMuteMic: () => squadService?.sip.unMuteMic(inviter.id),\r\n          disableCam: () => squadService?.sip.disableCam(inviter.id),\r\n          enableCam: () => squadService?.sip.enableCam(inviter.id),\r\n          holdCall: () => squadService?.sip.holdCall(inviter.id),\r\n          unHoldCall: () => squadService?.sip.unHoldCall(inviter.id),\r\n        };\r\n        setNewCall(sendCall);\r\n        console.log(\"make_call\");\r\n        break;\r\n      case VoiceEvents.CALL_ON_GOING:\r\n        const callOnGoing =\r\n          currentCalls.get(data?.invitation?.id) ||\r\n          currentCalls.get(data?.inviter?.id);\r\n        if (callOnGoing) {\r\n          const cc = { ...callOnGoing };\r\n          cc.callStatus = CallStatus.ON_GOING;\r\n          cc.receivingVideo = data.receivingVideo;\r\n          cc.tagId = data.tagId;\r\n          setNewCall(cc);\r\n        }\r\n        break;\r\n      case VoiceEvents.CALL_HANGUP:\r\n        const hangupCall = currentCalls.get(data.id);\r\n        if (hangupCall) {\r\n          removeCall(hangupCall);\r\n        }\r\n        break;\r\n      case VoiceEvents.MUTE_MIC:\r\n        const currentCallsCopy = new Map(currentCalls);\r\n        let cc = currentCallsCopy.get(data.callId);\r\n        if (cc) {\r\n          cc = { ...cc };\r\n          cc.micMuted = data.status;\r\n          currentCallsCopy.set(cc.callId, cc);\r\n          setCurrentCalls(currentCallsCopy);\r\n        }\r\n        break;\r\n      case VoiceEvents.MUTE_CAM:\r\n        const currentCallsCp = new Map(currentCalls);\r\n        let ccp = currentCallsCp.get(data.callId);\r\n        if (ccp) {\r\n          ccp = { ...ccp };\r\n          ccp.videoMuted = data.status;\r\n          currentCallsCp.set(ccp.callId, ccp);\r\n          setCurrentCalls(currentCallsCp);\r\n        }\r\n        break;\r\n      case VoiceEvents.HOLD_CALL:\r\n        onCallHoldChange(data.callId, data.status);\r\n        break;\r\n      case VoiceEvents.ACCEPTED_CALL:\r\n        onAcceptCall(data.callId, data.useVideo);\r\n        break;\r\n      default:\r\n        console.log(event);\r\n        break;\r\n    }\r\n  }\r\n\r\n  const updateFunction = () => {\r\n    squadService?.updateVoiceSubscribeFunction(voiceCommuncatorSubscribe);\r\n  };\r\n\r\n  useEffect(init, []);\r\n  useEffect(updateFunction, [contacts, groups, currentCalls, callNumber]);\r\n  useEffect(onMakeCall, [callNumber]);\r\n  useEffect(onUpdateConstraints, [updateConstraints]);\r\n  useEffect(onBlindTransfer, [blindTransfer]);\r\n  useEffect(onAttendedTransfer, [assistedTransfer]);\r\n  return <></>;\r\n};\r\n\r\nexport default SquadSipCommunicator;\r\n"]},"metadata":{},"sourceType":"module"}