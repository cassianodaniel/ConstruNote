{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{useCall}from\"../contexts/CallContext\";import{tagsRange}from\"../services/voice/voicecommunicator\";import{motion}from\"framer-motion\";import{height,width}from\"../helpers/windowSize\";import{Button}from\"reactstrap\";var VideoBox=function VideoBox(){var _useState=useState(400),_useState2=_slicedToArray(_useState,2),widthBox=_useState2[0],setWidthBox=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),pictureInPictureEnabled=_useState4[0],setPictureInPictureEnabled=_useState4[1];var _useState5=useState(undefined),_useState6=_slicedToArray(_useState5,2),pictureInPictureTag=_useState6[0],setPictureInPictureTag=_useState6[1];var _useCall=useCall(),currentCalls=_useCall.currentCalls;var togglePictureInPicture=function togglePictureInPicture(tagId){var doc=document;if(!doc.pictureInPictureElement&&doc.pictureInPictureEnabled){var _video=document.querySelector(\"#remote-stream-\".concat(tagId));_video===null||_video===void 0?void 0:_video.requestPictureInPicture().catch(function(error){});}else{if(doc.pictureInPictureEnabled){document.exitPictureInPicture().catch(function(error){});}}};var listenPictureInPictureChanges=function listenPictureInPictureChanges(){tagsRange.forEach(function(tagId){var videoEl=document.querySelector(\"#remote-stream-\".concat(tagId));if(videoEl&&!videoEl.disablePictureInPicture){videoEl.addEventListener(\"enterpictureinpicture\",function(){// Video entered Picture-in-Picture mode.\nsetPictureInPictureEnabled(true);setPictureInPictureTag(tagId);});videoEl.addEventListener(\"leavepictureinpicture\",function(){// Video left Picture-in-Picture mode.\nsetPictureInPictureEnabled(false);setPictureInPictureTag(undefined);});}});};var removeListeners=function removeListeners(){tagsRange.forEach(function(tagId){var videoEl=document.querySelector(\"#remote-stream-\".concat(tagId));if(videoEl){videoEl.removeEventListener(\"enterpictureinpicture\",function(){});videoEl.removeEventListener(\"leavepictureinpicture\",function(){});}});};var isVisible=function isVisible(tagId){var callTag=getCallByTag(tagId);return callTag&&pictureInPictureTag!==tagId&&(callTag.sendingVideo||(callTag===null||callTag===void 0?void 0:callTag.receivingVideo));};var getCallByTag=function getCallByTag(tagId){return Array.from(currentCalls.values()).find(function(call){return call.tagId===\"remote-stream-\".concat(tagId);});};removeListeners();listenPictureInPictureChanges();var boxVideo={position:\"fixed\",right:\"50px\",bottom:\"50px\",zIndex:100,maxWidth:\"\".concat(widthBox,\"px\"),borderRadius:\"2px\",backgroundColor:\"#000000\",display:\"flex\",justifyContent:\"center\",alignItems:\"center\"};var video={position:\"relative\",width:\"\".concat(widthBox,\"px\")};var optionBox={position:\"absolute\",zIndex:10,top:\"2%\",right:\"2%\",color:\"#ffffff\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\"};var option={cursor:\"pointer\",marginLeft:\"5px\",fontSize:\"18px\",padding:\"5px\"};var buttonBox={position:\"absolute\",zIndex:10,width:\"100%\",bottom:0,display:\"flex\",justifyContent:\"center\",alignItems:\"center\"};return/*#__PURE__*/React.createElement(React.Fragment,null,tagsRange.map(function(tagId){var _getCallByTag4,_getCallByTag5,_getCallByTag9,_getCallByTag10,_getCallByTag15,_getCallByTag16;return/*#__PURE__*/React.createElement(motion.div,{drag:true,dragConstraints:{top:(height()-300)*-1,bottom:0,left:(width()-400)*-1,right:0},style:_objectSpread(_objectSpread({},boxVideo),{},{display:isVisible(tagId)?boxVideo.display:\"none\"}),key:\"remote-stream-\".concat(tagId)},/*#__PURE__*/React.createElement(\"div\",{style:optionBox},/*#__PURE__*/React.createElement(\"div\",{style:_objectSpread(_objectSpread({},option),{},{fontSize:\"14px\"}),onClick:function onClick(){return setWidthBox(widthBox+100);}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-add-line\"})),/*#__PURE__*/React.createElement(\"div\",{style:_objectSpread(_objectSpread({},option),{},{fontSize:\"14px\"}),onClick:function onClick(){return setWidthBox(widthBox-100);}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-subtract-line\"})),document.pictureInPictureEnabled?/*#__PURE__*/React.createElement(React.Fragment,null,!pictureInPictureEnabled&&/*#__PURE__*/React.createElement(\"div\",{style:option,onClick:function onClick(){return togglePictureInPicture(tagId);}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-picture-in-picture-2-line\"})),pictureInPictureTag===tagId&&/*#__PURE__*/React.createElement(\"div\",{style:option,onClick:function onClick(){return togglePictureInPicture(tagId);}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-picture-in-picture-exit-line\"}))):null,/*#__PURE__*/React.createElement(\"div\",{style:option,onClick:function onClick(){var call=getCallByTag(tagId);(call===null||call===void 0?void 0:call.endCall)&&call.endCall();}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-close-line\"}))),/*#__PURE__*/React.createElement(\"div\",{style:buttonBox},/*#__PURE__*/React.createElement(Button,{type:\"button\",color:\"none\",onClick:function onClick(){var call=getCallByTag(tagId);(call===null||call===void 0?void 0:call.endCall)&&call.endCall();},className:\"nav-btn user-profile-show btn-head-conference red\"},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-phone-line\"})),/*#__PURE__*/React.createElement(Button,{type:\"button\",color:\"none\",onClick:function onClick(){var _getCallByTag,_getCallByTag2,_getCallByTag3;if((_getCallByTag=getCallByTag(tagId))===null||_getCallByTag===void 0?void 0:_getCallByTag.micMuted)(_getCallByTag2=getCallByTag(tagId))===null||_getCallByTag2===void 0?void 0:_getCallByTag2.unMuteMic();else(_getCallByTag3=getCallByTag(tagId))===null||_getCallByTag3===void 0?void 0:_getCallByTag3.muteMic();},className:\"nav-btn user-profile-show btn-head-conference \".concat(((_getCallByTag4=getCallByTag(tagId))===null||_getCallByTag4===void 0?void 0:_getCallByTag4.micMuted)?\"red\":\"white\")},!((_getCallByTag5=getCallByTag(tagId))===null||_getCallByTag5===void 0?void 0:_getCallByTag5.micMuted)?/*#__PURE__*/React.createElement(\"i\",{className:\"ri-mic-line\"}):/*#__PURE__*/React.createElement(\"i\",{className:\"ri-mic-off-line\"})),/*#__PURE__*/React.createElement(Button,{type:\"button\",color:\"none\",onClick:function onClick(){var _getCallByTag6,_getCallByTag7,_getCallByTag8;if((_getCallByTag6=getCallByTag(tagId))===null||_getCallByTag6===void 0?void 0:_getCallByTag6.hold)(_getCallByTag7=getCallByTag(tagId))===null||_getCallByTag7===void 0?void 0:_getCallByTag7.unHoldCall();else(_getCallByTag8=getCallByTag(tagId))===null||_getCallByTag8===void 0?void 0:_getCallByTag8.holdCall();},className:\"nav-btn user-profile-show btn-head-conference \".concat(((_getCallByTag9=getCallByTag(tagId))===null||_getCallByTag9===void 0?void 0:_getCallByTag9.hold)?\"red\":\"white\")},((_getCallByTag10=getCallByTag(tagId))===null||_getCallByTag10===void 0?void 0:_getCallByTag10.hold)?/*#__PURE__*/React.createElement(\"i\",{className:\"ri-play-line\"}):/*#__PURE__*/React.createElement(\"i\",{className:\"ri-pause-line\"})),/*#__PURE__*/React.createElement(Button,{type:\"button\",color:\"none\",onClick:function onClick(){var _getCallByTag11;if((_getCallByTag11=getCallByTag(tagId))===null||_getCallByTag11===void 0?void 0:_getCallByTag11.sendingVideo){var _getCallByTag12,_getCallByTag13,_getCallByTag14;if((_getCallByTag12=getCallByTag(tagId))===null||_getCallByTag12===void 0?void 0:_getCallByTag12.videoMuted)(_getCallByTag13=getCallByTag(tagId))===null||_getCallByTag13===void 0?void 0:_getCallByTag13.enableCam();else(_getCallByTag14=getCallByTag(tagId))===null||_getCallByTag14===void 0?void 0:_getCallByTag14.disableCam();}else{alert(\"Mudança de tipo de chamada ainda não está disponivel :(\");}},className:\"nav-btn user-profile-show btn-head-conference white \".concat(((_getCallByTag15=getCallByTag(tagId))===null||_getCallByTag15===void 0?void 0:_getCallByTag15.videoMuted)?\"red\":\"white\")},((_getCallByTag16=getCallByTag(tagId))===null||_getCallByTag16===void 0?void 0:_getCallByTag16.videoMuted)?/*#__PURE__*/React.createElement(\"i\",{className:\"ri-camera-off-line\"}):/*#__PURE__*/React.createElement(\"i\",{className:\"ri-camera-line\"}))),/*#__PURE__*/React.createElement(\"video\",{style:video,id:\"remote-stream-\".concat(tagId),hidden:!isVisible(tagId)}));}));};export default VideoBox;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/components/VideoBox.tsx"],"names":["React","useState","useCall","tagsRange","motion","height","width","Button","VideoBox","widthBox","setWidthBox","pictureInPictureEnabled","setPictureInPictureEnabled","undefined","pictureInPictureTag","setPictureInPictureTag","currentCalls","togglePictureInPicture","tagId","doc","document","pictureInPictureElement","video","querySelector","requestPictureInPicture","catch","error","exitPictureInPicture","listenPictureInPictureChanges","forEach","videoEl","disablePictureInPicture","addEventListener","removeListeners","removeEventListener","isVisible","callTag","getCallByTag","sendingVideo","receivingVideo","Array","from","values","find","call","boxVideo","position","right","bottom","zIndex","maxWidth","borderRadius","backgroundColor","display","justifyContent","alignItems","optionBox","top","color","option","cursor","marginLeft","fontSize","padding","buttonBox","map","left","endCall","micMuted","unMuteMic","muteMic","hold","unHoldCall","holdCall","videoMuted","enableCam","disableCam","alert"],"mappings":"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","sourcesContent":["import React, { CSSProperties, useState } from \"react\";\r\nimport { useCall } from \"../contexts/CallContext\";\r\nimport { tagsRange } from \"../services/voice/voicecommunicator\";\r\nimport { motion } from \"framer-motion\";\r\nimport { height, width } from \"../helpers/windowSize\";\r\nimport { Button } from \"reactstrap\";\r\n\r\ninterface DocumentPictureInPicture extends Document {\r\n  pictureInPictureEnabled: boolean;\r\n  pictureInPictureElement: HTMLVideoElementPictureInPicture;\r\n  exitPictureInPicture(): Promise<any>;\r\n}\r\n\r\ninterface HTMLVideoElementPictureInPicture extends HTMLVideoElement {\r\n  requestPictureInPicture(): Promise<any>;\r\n  disablePictureInPicture: any;\r\n}\r\n\r\nconst VideoBox: React.FC = () => {\r\n  const [widthBox, setWidthBox] = useState(400);\r\n  const [\r\n    pictureInPictureEnabled,\r\n    setPictureInPictureEnabled,\r\n  ] = useState<boolean>(false);\r\n\r\n  const [pictureInPictureTag, setPictureInPictureTag] = useState<\r\n    number | undefined\r\n  >(undefined);\r\n\r\n  const { currentCalls } = useCall();\r\n\r\n  const togglePictureInPicture = (tagId: number) => {\r\n    const doc = document as DocumentPictureInPicture;\r\n    if (!doc.pictureInPictureElement && doc.pictureInPictureEnabled) {\r\n      const video = document.querySelector(\r\n        `#remote-stream-${tagId}`\r\n      ) as HTMLVideoElementPictureInPicture;\r\n      video?.requestPictureInPicture().catch((error) => {});\r\n    } else {\r\n      if (doc.pictureInPictureEnabled) {\r\n        (document as DocumentPictureInPicture)\r\n          .exitPictureInPicture()\r\n          .catch((error) => {});\r\n      }\r\n    }\r\n  };\r\n\r\n  const listenPictureInPictureChanges = () => {\r\n    tagsRange.forEach((tagId) => {\r\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\r\n      if (\r\n        videoEl &&\r\n        !(videoEl as HTMLVideoElementPictureInPicture).disablePictureInPicture\r\n      ) {\r\n        videoEl.addEventListener(\"enterpictureinpicture\", () => {\r\n          // Video entered Picture-in-Picture mode.\r\n          setPictureInPictureEnabled(true);\r\n          setPictureInPictureTag(tagId);\r\n        });\r\n        videoEl.addEventListener(\"leavepictureinpicture\", () => {\r\n          // Video left Picture-in-Picture mode.\r\n          setPictureInPictureEnabled(false);\r\n          setPictureInPictureTag(undefined);\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  const removeListeners = () => {\r\n    tagsRange.forEach((tagId) => {\r\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\r\n      if (videoEl) {\r\n        videoEl.removeEventListener(\"enterpictureinpicture\", () => {});\r\n        videoEl.removeEventListener(\"leavepictureinpicture\", () => {});\r\n      }\r\n    });\r\n  };\r\n\r\n  const isVisible = (tagId: number) => {\r\n    const callTag = getCallByTag(tagId);\r\n    return (\r\n      callTag &&\r\n      pictureInPictureTag !== tagId &&\r\n      (callTag.sendingVideo || callTag?.receivingVideo)\r\n    );\r\n  };\r\n  const getCallByTag = (tagId: number) => {\r\n    return Array.from(currentCalls.values()).find(\r\n      (call) => call.tagId === `remote-stream-${tagId}`\r\n    );\r\n  };\r\n  removeListeners();\r\n  listenPictureInPictureChanges();\r\n\r\n  const boxVideo: CSSProperties = {\r\n    position: \"fixed\",\r\n    right: \"50px\",\r\n    bottom: \"50px\",\r\n    zIndex: 100,\r\n    maxWidth: `${widthBox}px`,\r\n    borderRadius: \"2px\",\r\n    backgroundColor: \"#000000\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  };\r\n\r\n  const video: CSSProperties = {\r\n    position: \"relative\",\r\n    width: `${widthBox}px`,\r\n  };\r\n\r\n  const optionBox: CSSProperties = {\r\n    position: \"absolute\",\r\n    zIndex: 10,\r\n    top: \"2%\",\r\n    right: \"2%\",\r\n    color: \"#ffffff\",\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  };\r\n\r\n  const option: CSSProperties = {\r\n    cursor: \"pointer\",\r\n    marginLeft: \"5px\",\r\n    fontSize: \"18px\",\r\n    padding: \"5px\",\r\n  };\r\n\r\n  const buttonBox: CSSProperties = {\r\n    position: \"absolute\",\r\n    zIndex: 10,\r\n    width: \"100%\",\r\n    bottom: 0,\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {tagsRange.map((tagId) => (\r\n        <motion.div\r\n          drag\r\n          dragConstraints={{\r\n            top: (height() - 300) * -1,\r\n            bottom: 0,\r\n            left: (width() - 400) * -1,\r\n            right: 0,\r\n          }}\r\n          style={{\r\n            ...boxVideo,\r\n            display: isVisible(tagId) ? boxVideo.display : \"none\",\r\n          }}\r\n          key={`remote-stream-${tagId}`}\r\n        >\r\n          <div style={optionBox}>\r\n            <div\r\n              style={{ ...option, fontSize: \"14px\" }}\r\n              onClick={() => setWidthBox(widthBox + 100)}\r\n            >\r\n              <i className=\"ri-add-line\"></i>\r\n            </div>\r\n\r\n            <div\r\n              style={{ ...option, fontSize: \"14px\" }}\r\n              onClick={() => setWidthBox(widthBox - 100)}\r\n            >\r\n              <i className=\"ri-subtract-line\"></i>\r\n            </div>\r\n\r\n            {(document as DocumentPictureInPicture).pictureInPictureEnabled ? (\r\n              <>\r\n                {!pictureInPictureEnabled && (\r\n                  <div\r\n                    style={option}\r\n                    onClick={() => togglePictureInPicture(tagId)}\r\n                  >\r\n                    <i className=\"ri-picture-in-picture-2-line\"></i>\r\n                  </div>\r\n                )}\r\n                {pictureInPictureTag === tagId && (\r\n                  <div\r\n                    style={option}\r\n                    onClick={() => togglePictureInPicture(tagId)}\r\n                  >\r\n                    <i className=\"ri-picture-in-picture-exit-line\"></i>\r\n                  </div>\r\n                )}\r\n              </>\r\n            ) : null}\r\n\r\n            <div\r\n              style={option}\r\n              onClick={() => {\r\n                const call = getCallByTag(tagId);\r\n                call?.endCall && call.endCall();\r\n              }}\r\n            >\r\n              <i className=\"ri-close-line\"></i>\r\n            </div>\r\n          </div>\r\n\r\n          <div style={buttonBox}>\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                const call = getCallByTag(tagId);\r\n                call?.endCall && call.endCall();\r\n              }}\r\n              className=\"nav-btn user-profile-show btn-head-conference red\"\r\n            >\r\n              <i className=\"ri-phone-line\"></i>\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                if (getCallByTag(tagId)?.micMuted)\r\n                  getCallByTag(tagId)?.unMuteMic();\r\n                else getCallByTag(tagId)?.muteMic();\r\n              }}\r\n              className={`nav-btn user-profile-show btn-head-conference ${\r\n                getCallByTag(tagId)?.micMuted ? \"red\" : \"white\"\r\n              }`}\r\n            >\r\n              {!getCallByTag(tagId)?.micMuted ? (\r\n                <i className=\"ri-mic-line\"></i>\r\n              ) : (\r\n                <i className=\"ri-mic-off-line\"></i>\r\n              )}\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                if (getCallByTag(tagId)?.hold)\r\n                  getCallByTag(tagId)?.unHoldCall();\r\n                else getCallByTag(tagId)?.holdCall();\r\n              }}\r\n              className={`nav-btn user-profile-show btn-head-conference ${\r\n                getCallByTag(tagId)?.hold ? \"red\" : \"white\"\r\n              }`}\r\n            >\r\n              {getCallByTag(tagId)?.hold ? (\r\n                <i className=\"ri-play-line\"></i>\r\n              ) : (\r\n                <i className=\"ri-pause-line\"></i>\r\n              )}\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                if (getCallByTag(tagId)?.sendingVideo) {\r\n                  if (getCallByTag(tagId)?.videoMuted)\r\n                    getCallByTag(tagId)?.enableCam();\r\n                  else getCallByTag(tagId)?.disableCam();\r\n                } else {\r\n                  alert(\r\n                    \"Mudança de tipo de chamada ainda não está disponivel :(\"\r\n                  );\r\n                }\r\n              }}\r\n              className={`nav-btn user-profile-show btn-head-conference white ${\r\n                getCallByTag(tagId)?.videoMuted ? \"red\" : \"white\"\r\n              }`}\r\n            >\r\n              {getCallByTag(tagId)?.videoMuted ? (\r\n                <i className=\"ri-camera-off-line\"></i>\r\n              ) : (\r\n                <i className=\"ri-camera-line\"></i>\r\n              )}\r\n            </Button>\r\n          </div>\r\n\r\n          <video\r\n            style={video}\r\n            id={`remote-stream-${tagId}`}\r\n            hidden={!isVisible(tagId)}\r\n          />\r\n        </motion.div>\r\n      ))}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default VideoBox;\r\n"]},"metadata":{},"sourceType":"module"}