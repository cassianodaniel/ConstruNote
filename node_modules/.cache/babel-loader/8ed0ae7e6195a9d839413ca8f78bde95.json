{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\src\\\\components\\\\VideoBox.tsx\";\nimport React, { useState } from \"react\";\nimport { useCall } from \"../contexts/CallContext\";\nimport { tagsRange } from \"../services/voice/voicecommunicator\";\nimport { motion } from \"framer-motion\";\nimport { height, width } from \"../helpers/windowSize\";\nimport { Button } from \"reactstrap\";\n\nconst VideoBox = () => {\n  const [widthBox, setWidthBox] = useState(400);\n  const [pictureInPictureEnabled, setPictureInPictureEnabled] = useState(false);\n  const [pictureInPictureTag, setPictureInPictureTag] = useState(undefined);\n  const {\n    currentCalls\n  } = useCall();\n\n  const togglePictureInPicture = tagId => {\n    const doc = document;\n\n    if (!doc.pictureInPictureElement && doc.pictureInPictureEnabled) {\n      const video = document.querySelector(`#remote-stream-${tagId}`);\n      video === null || video === void 0 ? void 0 : video.requestPictureInPicture().catch(error => {});\n    } else {\n      if (doc.pictureInPictureEnabled) {\n        document.exitPictureInPicture().catch(error => {});\n      }\n    }\n  };\n\n  const listenPictureInPictureChanges = () => {\n    tagsRange.forEach(tagId => {\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\n\n      if (videoEl && !videoEl.disablePictureInPicture) {\n        videoEl.addEventListener(\"enterpictureinpicture\", () => {\n          // Video entered Picture-in-Picture mode.\n          setPictureInPictureEnabled(true);\n          setPictureInPictureTag(tagId);\n        });\n        videoEl.addEventListener(\"leavepictureinpicture\", () => {\n          // Video left Picture-in-Picture mode.\n          setPictureInPictureEnabled(false);\n          setPictureInPictureTag(undefined);\n        });\n      }\n    });\n  };\n\n  const removeListeners = () => {\n    tagsRange.forEach(tagId => {\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\n\n      if (videoEl) {\n        videoEl.removeEventListener(\"enterpictureinpicture\", () => {});\n        videoEl.removeEventListener(\"leavepictureinpicture\", () => {});\n      }\n    });\n  };\n\n  const isVisible = tagId => {\n    const callTag = getCallByTag(tagId);\n    return callTag && pictureInPictureTag !== tagId && (callTag.sendingVideo || (callTag === null || callTag === void 0 ? void 0 : callTag.receivingVideo));\n  };\n\n  const getCallByTag = tagId => {\n    return Array.from(currentCalls.values()).find(call => call.tagId === `remote-stream-${tagId}`);\n  };\n\n  removeListeners();\n  listenPictureInPictureChanges();\n  const boxVideo = {\n    position: \"fixed\",\n    right: \"50px\",\n    bottom: \"50px\",\n    zIndex: 100,\n    maxWidth: `${widthBox}px`,\n    borderRadius: \"2px\",\n    backgroundColor: \"#000000\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  };\n  const video = {\n    position: \"relative\",\n    width: `${widthBox}px`\n  };\n  const optionBox = {\n    position: \"absolute\",\n    zIndex: 10,\n    top: \"2%\",\n    right: \"2%\",\n    color: \"#ffffff\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  };\n  const option = {\n    cursor: \"pointer\",\n    marginLeft: \"200px\",\n    marginTop: \"200px\",\n    fontSize: \"18px\",\n    padding: \"5px\"\n  };\n  const buttonBox = {\n    position: \"absolute\",\n    zIndex: 10,\n    width: \"100%\",\n    bottom: 0,\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  };\n  return /*#__PURE__*/React.createElement(React.Fragment, null, tagsRange.map(tagId => {\n    var _getCallByTag4, _getCallByTag5, _getCallByTag9, _getCallByTag10, _getCallByTag15, _getCallByTag16;\n\n    return /*#__PURE__*/React.createElement(motion.div, {\n      drag: true,\n      dragConstraints: {\n        top: (height() - 300) * -1,\n        bottom: 0,\n        left: (width() - 400) * -1,\n        right: 0\n      },\n      style: { ...boxVideo,\n        display: isVisible(tagId) ? boxVideo.display : \"none\"\n      },\n      key: `remote-stream-${tagId}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: optionBox,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: { ...option,\n        fontSize: \"14px\"\n      },\n      onClick: () => setWidthBox(widthBox + 100),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-add-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      style: { ...option,\n        fontSize: \"14px\"\n      },\n      onClick: () => setWidthBox(widthBox - 100),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-subtract-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 15\n      }\n    })), document.pictureInPictureEnabled ? /*#__PURE__*/React.createElement(React.Fragment, null, !pictureInPictureEnabled && /*#__PURE__*/React.createElement(\"div\", {\n      style: option,\n      onClick: () => togglePictureInPicture(tagId),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-picture-in-picture-2-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 21\n      }\n    })), pictureInPictureTag === tagId && /*#__PURE__*/React.createElement(\"div\", {\n      style: option,\n      onClick: () => togglePictureInPicture(tagId),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-picture-in-picture-exit-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 21\n      }\n    }))) : null, /*#__PURE__*/React.createElement(\"div\", {\n      style: option,\n      onClick: () => {\n        const call = getCallByTag(tagId);\n        (call === null || call === void 0 ? void 0 : call.endCall) && call.endCall();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-close-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 15\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      style: buttonBox,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      type: \"button\",\n      color: \"none\",\n      onClick: () => {\n        const call = getCallByTag(tagId);\n        (call === null || call === void 0 ? void 0 : call.endCall) && call.endCall();\n      },\n      className: \"nav-btn user-profile-show btn-head-conference red\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-phone-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      type: \"button\",\n      color: \"none\",\n      onClick: () => {\n        var _getCallByTag, _getCallByTag2, _getCallByTag3;\n\n        if ((_getCallByTag = getCallByTag(tagId)) === null || _getCallByTag === void 0 ? void 0 : _getCallByTag.micMuted) (_getCallByTag2 = getCallByTag(tagId)) === null || _getCallByTag2 === void 0 ? void 0 : _getCallByTag2.unMuteMic();else (_getCallByTag3 = getCallByTag(tagId)) === null || _getCallByTag3 === void 0 ? void 0 : _getCallByTag3.muteMic();\n      },\n      className: `nav-btn user-profile-show btn-head-conference ${((_getCallByTag4 = getCallByTag(tagId)) === null || _getCallByTag4 === void 0 ? void 0 : _getCallByTag4.micMuted) ? \"red\" : \"white\"}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 13\n      }\n    }, !((_getCallByTag5 = getCallByTag(tagId)) === null || _getCallByTag5 === void 0 ? void 0 : _getCallByTag5.micMuted) ? /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-mic-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 17\n      }\n    }) : /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-mic-off-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      type: \"button\",\n      color: \"none\",\n      onClick: () => {\n        var _getCallByTag6, _getCallByTag7, _getCallByTag8;\n\n        if ((_getCallByTag6 = getCallByTag(tagId)) === null || _getCallByTag6 === void 0 ? void 0 : _getCallByTag6.hold) (_getCallByTag7 = getCallByTag(tagId)) === null || _getCallByTag7 === void 0 ? void 0 : _getCallByTag7.unHoldCall();else (_getCallByTag8 = getCallByTag(tagId)) === null || _getCallByTag8 === void 0 ? void 0 : _getCallByTag8.holdCall();\n      },\n      className: `nav-btn user-profile-show btn-head-conference ${((_getCallByTag9 = getCallByTag(tagId)) === null || _getCallByTag9 === void 0 ? void 0 : _getCallByTag9.hold) ? \"red\" : \"white\"}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 13\n      }\n    }, ((_getCallByTag10 = getCallByTag(tagId)) === null || _getCallByTag10 === void 0 ? void 0 : _getCallByTag10.hold) ? /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-play-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 17\n      }\n    }) : /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-pause-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      type: \"button\",\n      color: \"none\",\n      onClick: () => {\n        var _getCallByTag11;\n\n        if ((_getCallByTag11 = getCallByTag(tagId)) === null || _getCallByTag11 === void 0 ? void 0 : _getCallByTag11.sendingVideo) {\n          var _getCallByTag12, _getCallByTag13, _getCallByTag14;\n\n          if ((_getCallByTag12 = getCallByTag(tagId)) === null || _getCallByTag12 === void 0 ? void 0 : _getCallByTag12.videoMuted) (_getCallByTag13 = getCallByTag(tagId)) === null || _getCallByTag13 === void 0 ? void 0 : _getCallByTag13.enableCam();else (_getCallByTag14 = getCallByTag(tagId)) === null || _getCallByTag14 === void 0 ? void 0 : _getCallByTag14.disableCam();\n        } else {\n          alert(\"Mudança de tipo de chamada ainda não está disponivel :(\");\n        }\n      },\n      className: `nav-btn user-profile-show btn-head-conference white ${((_getCallByTag15 = getCallByTag(tagId)) === null || _getCallByTag15 === void 0 ? void 0 : _getCallByTag15.videoMuted) ? \"red\" : \"white\"}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 13\n      }\n    }, ((_getCallByTag16 = getCallByTag(tagId)) === null || _getCallByTag16 === void 0 ? void 0 : _getCallByTag16.videoMuted) ? /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-camera-off-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 17\n      }\n    }) : /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ri-camera-line\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 17\n      }\n    }))), /*#__PURE__*/React.createElement(\"video\", {\n      style: video,\n      id: `remote-stream-${tagId}`,\n      hidden: !isVisible(tagId),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 11\n      }\n    }));\n  }));\n};\n\nexport default VideoBox;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/components/VideoBox.tsx"],"names":["React","useState","useCall","tagsRange","motion","height","width","Button","VideoBox","widthBox","setWidthBox","pictureInPictureEnabled","setPictureInPictureEnabled","pictureInPictureTag","setPictureInPictureTag","undefined","currentCalls","togglePictureInPicture","tagId","doc","document","pictureInPictureElement","video","querySelector","requestPictureInPicture","catch","error","exitPictureInPicture","listenPictureInPictureChanges","forEach","videoEl","disablePictureInPicture","addEventListener","removeListeners","removeEventListener","isVisible","callTag","getCallByTag","sendingVideo","receivingVideo","Array","from","values","find","call","boxVideo","position","right","bottom","zIndex","maxWidth","borderRadius","backgroundColor","display","justifyContent","alignItems","optionBox","top","color","option","cursor","marginLeft","marginTop","fontSize","padding","buttonBox","map","left","endCall","micMuted","unMuteMic","muteMic","hold","unHoldCall","holdCall","videoMuted","enableCam","disableCam","alert"],"mappings":"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","sourcesContent":["import React, { CSSProperties, useState } from \"react\";\r\nimport { useCall } from \"../contexts/CallContext\";\r\nimport { tagsRange } from \"../services/voice/voicecommunicator\";\r\nimport { motion } from \"framer-motion\";\r\nimport { height, width } from \"../helpers/windowSize\";\r\nimport { Button } from \"reactstrap\";\r\n\r\ninterface DocumentPictureInPicture extends Document {\r\n  pictureInPictureEnabled: boolean;\r\n  pictureInPictureElement: HTMLVideoElementPictureInPicture;\r\n  exitPictureInPicture(): Promise<any>;\r\n}\r\n\r\ninterface HTMLVideoElementPictureInPicture extends HTMLVideoElement {\r\n  requestPictureInPicture(): Promise<any>;\r\n  disablePictureInPicture: any;\r\n}\r\n\r\nconst VideoBox: React.FC = () => {\r\n  const [widthBox, setWidthBox] = useState(400);\r\n  const [\r\n    pictureInPictureEnabled,\r\n    setPictureInPictureEnabled,\r\n  ] = useState<boolean>(false);\r\n\r\n  const [pictureInPictureTag, setPictureInPictureTag] = useState<\r\n    number | undefined\r\n  >(undefined);\r\n\r\n  const { currentCalls } = useCall();\r\n\r\n  const togglePictureInPicture = (tagId: number) => {\r\n    const doc = document as DocumentPictureInPicture;\r\n    if (!doc.pictureInPictureElement && doc.pictureInPictureEnabled) {\r\n      const video = document.querySelector(\r\n        `#remote-stream-${tagId}`\r\n      ) as HTMLVideoElementPictureInPicture;\r\n      video?.requestPictureInPicture().catch((error) => {});\r\n    } else {\r\n      if (doc.pictureInPictureEnabled) {\r\n        (document as DocumentPictureInPicture)\r\n          .exitPictureInPicture()\r\n          .catch((error) => {});\r\n      }\r\n    }\r\n  };\r\n\r\n  const listenPictureInPictureChanges = () => {\r\n    tagsRange.forEach((tagId) => {\r\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\r\n      if (\r\n        videoEl &&\r\n        !(videoEl as HTMLVideoElementPictureInPicture).disablePictureInPicture\r\n      ) {\r\n        videoEl.addEventListener(\"enterpictureinpicture\", () => {\r\n          // Video entered Picture-in-Picture mode.\r\n          setPictureInPictureEnabled(true);\r\n          setPictureInPictureTag(tagId);\r\n        });\r\n        videoEl.addEventListener(\"leavepictureinpicture\", () => {\r\n          // Video left Picture-in-Picture mode.\r\n          setPictureInPictureEnabled(false);\r\n          setPictureInPictureTag(undefined);\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  const removeListeners = () => {\r\n    tagsRange.forEach((tagId) => {\r\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\r\n      if (videoEl) {\r\n        videoEl.removeEventListener(\"enterpictureinpicture\", () => {});\r\n        videoEl.removeEventListener(\"leavepictureinpicture\", () => {});\r\n      }\r\n    });\r\n  };\r\n\r\n  const isVisible = (tagId: number) => {\r\n    const callTag = getCallByTag(tagId);\r\n    return (\r\n      callTag &&\r\n      pictureInPictureTag !== tagId &&\r\n      (callTag.sendingVideo || callTag?.receivingVideo)\r\n    );\r\n  };\r\n  const getCallByTag = (tagId: number) => {\r\n    return Array.from(currentCalls.values()).find(\r\n      (call) => call.tagId === `remote-stream-${tagId}`\r\n    );\r\n  };\r\n  removeListeners();\r\n  listenPictureInPictureChanges();\r\n\r\n  const boxVideo: CSSProperties = {\r\n    position: \"fixed\",\r\n    right: \"50px\",\r\n    bottom: \"50px\",\r\n    zIndex: 100,\r\n    maxWidth: `${widthBox}px`,\r\n    borderRadius: \"2px\",\r\n    backgroundColor: \"#000000\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  };\r\n\r\n  const video: CSSProperties = {\r\n    position: \"relative\",\r\n    width: `${widthBox}px`,\r\n  };\r\n\r\n  const optionBox: CSSProperties = {\r\n    position: \"absolute\",\r\n    zIndex: 10,\r\n    top: \"2%\",\r\n    right: \"2%\",\r\n    color: \"#ffffff\",\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  };\r\n\r\n  const option: CSSProperties = {\r\n    cursor: \"pointer\",\r\n    marginLeft: \"200px\",\r\n    marginTop: \"200px\",\r\n    fontSize: \"18px\",\r\n    padding: \"5px\",\r\n  };\r\n\r\n  const buttonBox: CSSProperties = {\r\n    position: \"absolute\",\r\n    zIndex: 10,\r\n    width: \"100%\",\r\n    bottom: 0,\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {tagsRange.map((tagId) => (\r\n        <motion.div\r\n          drag\r\n          dragConstraints={{\r\n            top: (height() - 300) * -1,\r\n            bottom: 0,\r\n            left: (width() - 400) * -1,\r\n            right: 0,\r\n          }}\r\n          style={{\r\n            ...boxVideo,\r\n            display: isVisible(tagId) ? boxVideo.display : \"none\",\r\n          }}\r\n          key={`remote-stream-${tagId}`}\r\n        >\r\n          <div style={optionBox}>\r\n            <div\r\n              style={{ ...option, fontSize: \"14px\" }}\r\n              onClick={() => setWidthBox(widthBox + 100)}\r\n            >\r\n              <i className=\"ri-add-line\"></i>\r\n            </div>\r\n\r\n            <div\r\n              style={{ ...option, fontSize: \"14px\" }}\r\n              onClick={() => setWidthBox(widthBox - 100)}\r\n            >\r\n              <i className=\"ri-subtract-line\"></i>\r\n            </div>\r\n\r\n            {(document as DocumentPictureInPicture).pictureInPictureEnabled ? (\r\n              <>\r\n                {!pictureInPictureEnabled && (\r\n                  <div\r\n                    style={option}\r\n                    onClick={() => togglePictureInPicture(tagId)}\r\n                  >\r\n                    <i className=\"ri-picture-in-picture-2-line\"></i>\r\n                  </div>\r\n                )}\r\n                {pictureInPictureTag === tagId && (\r\n                  <div\r\n                    style={option}\r\n                    onClick={() => togglePictureInPicture(tagId)}\r\n                  >\r\n                    <i className=\"ri-picture-in-picture-exit-line\"></i>\r\n                  </div>\r\n                )}\r\n              </>\r\n            ) : null}\r\n\r\n            <div\r\n              style={option}\r\n              onClick={() => {\r\n                const call = getCallByTag(tagId);\r\n                call?.endCall && call.endCall();\r\n              }}\r\n            >\r\n              <i className=\"ri-close-line\"></i>\r\n            </div>\r\n          </div>\r\n\r\n          <div style={buttonBox}>\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                const call = getCallByTag(tagId);\r\n                call?.endCall && call.endCall();\r\n              }}\r\n              className=\"nav-btn user-profile-show btn-head-conference red\"\r\n            >\r\n              <i className=\"ri-phone-line\"></i>\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                if (getCallByTag(tagId)?.micMuted)\r\n                  getCallByTag(tagId)?.unMuteMic();\r\n                else getCallByTag(tagId)?.muteMic();\r\n              }}\r\n              className={`nav-btn user-profile-show btn-head-conference ${\r\n                getCallByTag(tagId)?.micMuted ? \"red\" : \"white\"\r\n              }`}\r\n            >\r\n              {!getCallByTag(tagId)?.micMuted ? (\r\n                <i className=\"ri-mic-line\"></i>\r\n              ) : (\r\n                <i className=\"ri-mic-off-line\"></i>\r\n              )}\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                if (getCallByTag(tagId)?.hold)\r\n                  getCallByTag(tagId)?.unHoldCall();\r\n                else getCallByTag(tagId)?.holdCall();\r\n              }}\r\n              className={`nav-btn user-profile-show btn-head-conference ${\r\n                getCallByTag(tagId)?.hold ? \"red\" : \"white\"\r\n              }`}\r\n            >\r\n              {getCallByTag(tagId)?.hold ? (\r\n                <i className=\"ri-play-line\"></i>\r\n              ) : (\r\n                <i className=\"ri-pause-line\"></i>\r\n              )}\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                if (getCallByTag(tagId)?.sendingVideo) {\r\n                  if (getCallByTag(tagId)?.videoMuted)\r\n                    getCallByTag(tagId)?.enableCam();\r\n                  else getCallByTag(tagId)?.disableCam();\r\n                } else {\r\n                  alert(\r\n                    \"Mudança de tipo de chamada ainda não está disponivel :(\"\r\n                  );\r\n                }\r\n              }}\r\n              className={`nav-btn user-profile-show btn-head-conference white ${\r\n                getCallByTag(tagId)?.videoMuted ? \"red\" : \"white\"\r\n              }`}\r\n            >\r\n              {getCallByTag(tagId)?.videoMuted ? (\r\n                <i className=\"ri-camera-off-line\"></i>\r\n              ) : (\r\n                <i className=\"ri-camera-line\"></i>\r\n              )}\r\n            </Button>\r\n          </div>\r\n\r\n          <video\r\n            style={video}\r\n            id={`remote-stream-${tagId}`}\r\n            hidden={!isVisible(tagId)}\r\n          />\r\n        </motion.div>\r\n      ))}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default VideoBox;\r\n"]},"metadata":{},"sourceType":"module"}