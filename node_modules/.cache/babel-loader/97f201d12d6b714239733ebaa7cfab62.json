{"ast":null,"code":"import React, { useEffect } from \"react\";\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\nimport { useChat } from \"../contexts/ChatContext\";\nimport { useAuth } from \"../contexts/AuthContext\";\nimport { Events } from \"./chat/types/types\";\nimport ChatType from \"./../enuns/ChatType\";\nimport DeliverStatus from \"../enuns/DeliverStatus\";\nimport { ChatType as XMPPChatType } from \"./chat/types/types\";\nimport { getFileName, getUrlBooleans, isUrl } from \"./utils/parseUtils\";\nimport ReadStatus from \"../enuns/ReadStatus\";\nimport { useGroup } from \"../contexts/GroupContext\";\nimport { useContact } from \"../contexts/ContactContext\";\nimport { useModal } from \"../contexts/ModalContext\";\nlet squadService;\nlet typingTimeout = new Map();\n\nconst SquadCommunicator = ({\n  children\n}) => {\n  var _squadService23;\n\n  const {\n    chats,\n    setChats,\n    activeChat,\n    replyMsg,\n    setReplyMsg,\n    setActiveChat,\n    forwardMessageList,\n    setForwardMessageList\n  } = useChat();\n  const {\n    contactsSearch,\n    setContactsSearched,\n    newFavorite,\n    setNewFavorite,\n    contacts,\n    setContacts,\n    setContactsOutsideUserContacts,\n    contactChecks,\n    setContactChecks\n  } = useContact();\n  const {\n    user,\n    setUser,\n    changedUserData,\n    changedUserPassword,\n    setChangedUserPassword\n  } = useAuth();\n  const {\n    showModalForwardMessageTo,\n    setShowModalForwardMessageTo,\n    showModalAddContact\n  } = useModal();\n  const {\n    setGroups,\n    groups\n  } = useGroup();\n\n  const init = () => {\n    var _squadService;\n\n    localStorage.setItem(\"authorization\", JSON.stringify({\n      access_token: \"b4c1fa651399a3eb63aee51777d3d508\",\n      user_id: \"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",\n      email: \"romero2@digivox.com.br\",\n      user_name: \"ZZ Romero 2\",\n      expires_in: 2592000,\n      baseUrl: \"https://app.citrussquad.com/api/v1/\"\n    }));\n    squadService = SquadService.getInstance(chatCommunicatorSubscribe);\n    (_squadService = squadService) === null || _squadService === void 0 ? void 0 : _squadService.user.get(user => {\n      setUser(user);\n    });\n  };\n\n  const clearSendFile = (chatId, messageId) => {\n    setChats(chats.map(chat => {\n      if (chat.id === chatId) {\n        chat.messages = chat.messages.map(message => {\n          if (message.id === messageId) {\n            message.deliverStatus = DeliverStatus.QUEUED;\n            message.sendFile = undefined;\n          }\n\n          return message;\n        });\n      }\n\n      return chat;\n    }));\n  };\n\n  const onChatsChange = () => {// chats.forEach((chat) => {\n    // });\n  };\n\n  const onActiveChatChange = () => {\n    checkSendMessage(activeChat);\n    checkAttachedFiles(activeChat);\n    checkNewContact(activeChat); // checkTyping(activeChat)\n  }; // const checkTyping = (chat: IChat) => {\n  //   const oldTimeoutData = typingTimeout.get(chat.jid)\n  //   if (chat.inputMessage !== \"\" && (!oldTimeoutData || (oldTimeoutData.msgStr !== chat.inputMessage))) {\n  //     if (oldTimeoutData)\n  //       clearTimeout(oldTimeoutData.timeout)\n  //     else\n  //       squadService?.chat?.chat.sendTyping(chat.jid)\n  //     const timeoutData = {\n  //       timeout: setTimeout(() => { squadService?.chat?.chat.sendActive(chat.jid); typingTimeout.delete(chat.jid) }, 3000),\n  //       msgStr: `${chat.inputMessage}`\n  //     }\n  //     typingTimeout.set(chat.jid, timeoutData)\n  //   }\n  // }\n\n\n  const checkNewContact = cht => {\n    if (!cht.added) {\n      var _squadService2;\n\n      (_squadService2 = squadService) === null || _squadService2 === void 0 ? void 0 : _squadService2.contacts.add(cht, success => {\n        if (success) {\n          var _squadService3;\n\n          setChats(chats.map(chat => {\n            if (chat.jid === cht.jid) {\n              chat.added = true;\n            }\n\n            if (activeChat.jid === chat.jid) setActiveChat(chat);\n            return chat;\n          }));\n          (_squadService3 = squadService) === null || _squadService3 === void 0 ? void 0 : _squadService3.contacts.list(ctcs => {\n            setContacts(ctcs);\n          });\n        }\n      });\n    }\n  };\n\n  const onCheckAddNewContact = ctt => {\n    if (!ctt.added) {\n      var _squadService4;\n\n      (_squadService4 = squadService) === null || _squadService4 === void 0 ? void 0 : _squadService4.contacts.addContacts(ctt, success => {\n        if (success) {\n          setContacts([...contacts, ctt]);\n          return contacts;\n        }\n      });\n    }\n\n    ;\n  };\n\n  const checkAttachedFiles = cht => {\n    if (cht.attachedFileList && !cht.attachedFileList[0]) {\n      var _squadService5;\n\n      (_squadService5 = squadService) === null || _squadService5 === void 0 ? void 0 : _squadService5.attachments.list(cht, attachments => {\n        if (attachments.length > 0) setActiveChat({ ...cht,\n          attachedFileList: attachments\n        });else setActiveChat({ ...cht,\n          attachedFileList: null\n        });\n      });\n    }\n  };\n  /* getMessageUserProfilePicture = (msg: Message | FileMessage) => {\r\n    if (msg.from.includes(\"@conference.\")) {\r\n      const groups = this.groups.getGroups();\r\n      const group = groups.get(msg.from.split(\"@\")[0]);\r\n      const member = group?.members.filter(\r\n        (member) => member.userId === msg.from.split(\"/\")[1]\r\n      )[0];\r\n      return member?.profilePicture;\r\n    } else {\r\n      return this.contacts.getContacts().get(msg.from.split(\"@\")[0])\r\n        ?.profilePicture;\r\n    }\r\n  }; */\n\n\n  const checkSearchMessages = () => {\n    if (activeChat.messageLoaded) {\n      var _squadService6;\n\n      (_squadService6 = squadService) === null || _squadService6 === void 0 ? void 0 : _squadService6.messages.list(activeChat, messages => {\n        if (messages.length) {\n          setChats(chats.map(cht => {\n            if (cht.id === activeChat.id) {\n              messages.forEach(msg => {\n                if (!activeChat.messages.find(m => m.id === msg.id)) cht.messages.unshift(msg);\n              });\n              cht.messageLoaded = false;\n              setActiveChat(cht);\n            }\n\n            return cht;\n          }));\n        } else {\n          const chat = { ...activeChat,\n            messageLoaded: false\n          };\n          setActiveChat(chat);\n        }\n      });\n    }\n  };\n\n  const checkSendMessage = chat => {\n    chat.messages.forEach(msg => {\n      if (msg.deliverStatus === DeliverStatus.SENDING) {\n        if (msg.sendFile && !replyMsg) {\n          var _squadService7, _squadService7$chat;\n\n          const files = [msg.sendFile];\n          clearSendFile(chat.id, msg.id);\n          (_squadService7 = squadService) === null || _squadService7 === void 0 ? void 0 : (_squadService7$chat = _squadService7.chat) === null || _squadService7$chat === void 0 ? void 0 : _squadService7$chat.sendFiles(chat, files, data => {\n            updateMessageFiles(data, chat, msg);\n          });\n        } else {\n          if (!msg.isForwardMessage && !replyMsg) {\n            sendMessage(chat, msg.message, msgId => updateMessage(msgId, chat, msg));\n          } else if (replyMsg) {\n            var _squadService8, _squadService8$chat;\n\n            const replyMsgCopy = { ...replyMsg\n            };\n            setReplyMsg(undefined);\n            (_squadService8 = squadService) === null || _squadService8 === void 0 ? void 0 : (_squadService8$chat = _squadService8.chat) === null || _squadService8$chat === void 0 ? void 0 : _squadService8$chat.replyMsg(chat, msg, replyMsgCopy, msgId => {\n              updateMessage(msgId, chat, msg, replyMsgCopy);\n            });\n          }\n        }\n      }\n    });\n  };\n\n  const updateMessageFiles = (data, chat, msg) => {\n    const newChat = { ...chat\n    };\n    newChat.messages = chat.messages.map(message => {\n      if (msg.id === message.id) {\n        const booleans = getUrlBooleans(data.url);\n        message.id = data.msgId;\n        message.fileUrl = data.url;\n        message.deliverStatus = DeliverStatus.QUEUED;\n        message.time = new Date().toISOString();\n        message.message = getFileName(data.url);\n        message.isFileMessage = booleans.isFileMessage;\n        message.isImageMessage = booleans.isImageMessage;\n        message.isVideoMessage = booleans.isVideoMessage;\n        message.isAudioMessage = booleans.isAudioMessage;\n      }\n\n      return message;\n    });\n    setActiveChat(newChat);\n\n    if (!chats.filter(cht => cht.id === chat.id)[0]) {\n      const newChats = [chat, ...chats];\n      setChats(newChats);\n    } else {\n      setChats(chats.map(cht => {\n        if (cht.id === chat.id) {\n          cht.messages = newChat.messages;\n        }\n\n        return cht;\n      }));\n    }\n  };\n\n  const updateMessage = (msgId, chat, msg, replyedMsg = undefined) => {\n    const newChat = { ...chat\n    };\n    newChat.messages = chat.messages.map(message => {\n      if (msg.id === message.id) {\n        message.id = msgId;\n        message.deliverStatus = DeliverStatus.QUEUED;\n        message.time = new Date().toISOString();\n\n        if (replyedMsg) {\n          message.isReplyMessage = true;\n          message.replyedMessage = replyedMsg.message || replyedMsg.fileUrl;\n          message.replyedMessageId = replyedMsg.id;\n          message.replyedMessageTo = replyedMsg.fromUser;\n        }\n\n        if (isUrl(message.message)) {\n          const booleans = getUrlBooleans(message.message);\n          message.isFileMessage = booleans.isFileMessage;\n          message.isImageMessage = booleans.isImageMessage;\n          message.isAudioMessage = booleans.isAudioMessage;\n          message.isVideoMessage = booleans.isVideoMessage;\n          message.fileUrl = message.message;\n        }\n      }\n\n      return message;\n    });\n    if (activeChat.jid === newChat.jid) setActiveChat(newChat);\n\n    if (!chats.filter(cht => cht.id === chat.id)[0]) {\n      const newChats = [chat, ...chats];\n      setChats(newChats);\n    } else {\n      setChats(chats.map(cht => {\n        if (cht.id === chat.id) {\n          cht.messages = newChat.messages;\n        }\n\n        return cht;\n      }));\n    }\n  };\n\n  const forwardMessage = () => {\n    if (forwardMessageList && showModalForwardMessageTo) {\n      const ctcs = [...forwardMessageList];\n      const message = { ...showModalForwardMessageTo\n      };\n      setForwardMessageList(undefined);\n      setShowModalForwardMessageTo(undefined);\n      const chatsFinded = [];\n      const oldChats = [...chats.map(chat => {\n        return { ...chat\n        };\n      })];\n      ctcs === null || ctcs === void 0 ? void 0 : ctcs.forEach((ctc, i) => {\n        const cht = oldChats.find(cht => cht.jid === ctc.jid);\n\n        if (cht) {\n          var _squadService9, _squadService9$chat;\n\n          const msg = { ...message,\n            id: `${cht.messages.length + 1}`,\n            userName: user.name,\n            fromUser: user.id,\n            toUser: ctc.jid.split(\"@\")[0],\n            message: message.fileUrl || message.message,\n            deliverStatus: DeliverStatus.QUEUED,\n            isForwardMessage: true\n          };\n          (_squadService9 = squadService) === null || _squadService9 === void 0 ? void 0 : (_squadService9$chat = _squadService9.chat) === null || _squadService9$chat === void 0 ? void 0 : _squadService9$chat.forwardMessage(cht, msg, msgId => {\n            msg.id = msgId;\n            cht.messages.push(msg);\n            chatsFinded.push(cht);\n          });\n        }\n      });\n      const newChats = oldChats.map(chat => chatsFinded.find(cht => cht.id === chat.id) || chat);\n      const ctcsNotInChat = ctcs.filter(ctc => !newChats.find(cht => ctc.jid === cht.jid));\n      ctcsNotInChat.forEach((ctc, i) => {\n        var _squadService10, _squadService10$chat;\n\n        const chat = {\n          id: ctc.jid.split(\"@\")[0],\n          jid: ctc.jid,\n          name: ctc.name,\n          profilePicture: ctc.profilePicture,\n          status: ctc.status || undefined,\n          unRead: 0,\n          chatType: ctc.jid.includes(\"@conference.\") ? ChatType.GROUP : ChatType.USER,\n          inputMessage: \"\",\n          messageLoaded: false,\n          isTyping: false,\n          messages: [],\n          email: ctc.email || undefined,\n          favorite: ctc.favorite,\n          added: ctc.added\n        };\n        const newMessage = { ...message,\n          id: `${1}`,\n          userName: user.name,\n          fromUser: user.id,\n          toUser: ctc.jid.split(\"@\")[0],\n          deliverStatus: DeliverStatus.QUEUED,\n          isForwardMessage: true\n        };\n        (_squadService10 = squadService) === null || _squadService10 === void 0 ? void 0 : (_squadService10$chat = _squadService10.chat) === null || _squadService10$chat === void 0 ? void 0 : _squadService10$chat.forwardMessage(chat, newMessage, msgId => {\n          newMessage.id = msgId;\n          chat.messages.push(newMessage);\n          newChats.unshift(chat);\n        });\n      });\n      setChats(newChats);\n    }\n  };\n\n  const onChangeStatus = () => {\n    var _squadService11, _squadService11$chat;\n\n    if (((_squadService11 = squadService) === null || _squadService11 === void 0 ? void 0 : (_squadService11$chat = _squadService11.chat) === null || _squadService11$chat === void 0 ? void 0 : _squadService11$chat.chat.client.status) === \"online\") {\n      var _squadService12, _squadService12$chat;\n\n      (_squadService12 = squadService) === null || _squadService12 === void 0 ? void 0 : (_squadService12$chat = _squadService12.chat) === null || _squadService12$chat === void 0 ? void 0 : _squadService12$chat.changeStatus(user.status);\n    }\n  };\n\n  const onSearchContacts = () => {\n    if (contactsSearch.length > 2) {\n      var _squadService13;\n\n      (_squadService13 = squadService) === null || _squadService13 === void 0 ? void 0 : _squadService13.contacts.search(contactsSearch, searchList => {\n        setContactsSearched(searchList);\n      });\n    } else {\n      setContactsSearched(undefined);\n    }\n  };\n\n  const onSearchContactsOutsideUserContacts = () => {\n    var _squadService14;\n\n    (_squadService14 = squadService) === null || _squadService14 === void 0 ? void 0 : _squadService14.contacts.getContactsOutsideUserLists(contacts => {\n      if (contacts) {\n        setContactsOutsideUserContacts(contacts);\n      }\n    });\n  };\n\n  useEffect(onChatsChange, [chats]);\n  useEffect(onNewFavorite, [newFavorite]);\n  useEffect(checkSearchMessages, [activeChat.messageLoaded]);\n  useEffect(onActiveChatChange, [activeChat]);\n  useEffect(onUserDataChange, [changedUserData]);\n  useEffect(onUserPasswordChange, [changedUserPassword]);\n  useEffect(onChangeStatus, [user.status]);\n  useEffect(forwardMessage, [forwardMessageList]);\n  useEffect(onSearchContacts, [contactsSearch]);\n  useEffect(onSearchContactsOutsideUserContacts, [showModalAddContact]);\n  useEffect(onCheckAddNewContact, [contactChecks]);\n\n  function onUserPasswordChange() {\n    if (changedUserPassword) {\n      var _squadService15;\n\n      (_squadService15 = squadService) === null || _squadService15 === void 0 ? void 0 : _squadService15.user.changePassword(changedUserPassword, password => {\n        if (password) {\n          setChangedUserPassword({\n            oldPassword: \"\",\n            newPassword: \"\"\n          });\n        }\n      });\n    }\n  }\n\n  function onUserDataChange() {\n    if (changedUserData) {\n      var _squadService16;\n\n      (_squadService16 = squadService) === null || _squadService16 === void 0 ? void 0 : _squadService16.user.changeUserData(changedUserData, chgd => {\n        if (chgd) {\n          setUser({ ...user,\n            email: changedUserData.email,\n            name: changedUserData.name\n          });\n        }\n      });\n    }\n  }\n\n  function onNewFavorite() {\n    if (newFavorite) {\n      var _squadService17;\n\n      const newFavoriteLoad = { ...newFavorite\n      };\n      (_squadService17 = squadService) === null || _squadService17 === void 0 ? void 0 : _squadService17.contacts.setFavorite(newFavorite, favorite => {\n        if (favorite) {\n          setChats(chats.map(cht => {\n            if (cht.jid === newFavoriteLoad.jid) {\n              cht.favorite = !newFavoriteLoad.favorite;\n            }\n\n            return cht;\n          }));\n          setGroups(groups.map(grp => {\n            if (grp.jid === newFavoriteLoad.jid) {\n              return { ...grp,\n                favorite: !newFavoriteLoad.favorite\n              };\n            }\n\n            return grp;\n          }));\n          setContacts(contacts.map(ctt => {\n            if (ctt.jid === newFavoriteLoad.jid) {\n              return { ...ctt,\n                favorite: !newFavoriteLoad.favorite\n              };\n            }\n\n            return ctt;\n          }));\n        }\n      });\n      setNewFavorite(undefined);\n    }\n  }\n\n  function chatCommunicatorSubscribe(event, data) {\n    var _squadService18;\n\n    switch (event) {\n      case Events.ONLINE:\n        (_squadService18 = squadService) === null || _squadService18 === void 0 ? void 0 : _squadService18.chats.list(receivedChats => {\n          var _squadService19, _squadService21;\n\n          const chats = [];\n          receivedChats.forEach(cht => {\n            if (!chats.find(chat => chat.id === cht.id)) {\n              chats.push(cht);\n            }\n          });\n          setChats(chats); //populating groups\n\n          (_squadService19 = squadService) === null || _squadService19 === void 0 ? void 0 : _squadService19.groups.list(groups => {\n            var _squadService20, _squadService20$chat;\n\n            setGroups(groups); //Joining Groups Rooms in XMPP\n\n            (_squadService20 = squadService) === null || _squadService20 === void 0 ? void 0 : (_squadService20$chat = _squadService20.chat) === null || _squadService20$chat === void 0 ? void 0 : _squadService20$chat.joinGroups(groups.map(group => group.jid));\n          }); //populating contacts\n\n          (_squadService21 = squadService) === null || _squadService21 === void 0 ? void 0 : _squadService21.contacts.list(contacts => setContacts(contacts)); //populating chat's with messages\n          // receivedChats.forEach((chat) => {\n          //   squadService?.messages.list(chat, (messages) => {\n          //     const chatWithMessages = { ...chat };\n          //     chatWithMessages.messages = chatWithMessages.messages.concat(\n          //       messages\n          //     );\n          //     setChats([\n          //       ...receivedChats.filter((cht) => chat.id !== cht.id),\n          //       chatWithMessages,\n          //     ]);\n          //   });\n          // });\n        });\n        break;\n\n      case Events.MESSAGE:\n        if (data.fromUser === user.jid) break;\n        let find = false;\n        let newChats = chats.map(chat => {\n          if (data.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] || data.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]) {\n            find = true;\n            if (!chat.messages.filter(msg => msg.id === data.id)[0]) chat.messages.push(data);\n\n            if (chat.id === activeChat.id) {\n              let chatTemporary = { ...chat\n              };\n              setActiveChat(chatTemporary);\n            } else {\n              chat.unRead++;\n            }\n          }\n\n          return chat;\n        });\n\n        if (!find) {\n          var _squadService22;\n\n          let newChat = {};\n          (_squadService22 = squadService) === null || _squadService22 === void 0 ? void 0 : _squadService22.contacts.list(listContacts => {\n            listContacts.forEach(c => {\n              if (c.jid === data.fromUser) {\n                newChat = {\n                  id: c.id,\n                  jid: c.jid,\n                  name: c.name,\n                  profilePicture: c.profilePicture,\n                  status: c.status,\n                  unRead: 1,\n                  chatType: ChatType.USER,\n                  inputMessage: \"\",\n                  isTyping: false,\n                  messages: [],\n                  favorite: c.favorite,\n                  added: c.added\n                };\n                newChat.messages.push(data);\n                newChats.unshift(newChat);\n                setChats(newChats);\n              }\n            });\n          });\n        } else {\n          setChats(newChats);\n        }\n\n        break;\n\n      case Events.RECEIVED:\n        setChats(chats.map(chat => {\n          if (chat.messages.find(msg => msg.id === data.id)) chat.messages = chat.messages.map(message => {\n            message.deliverStatus = DeliverStatus.DELIVERED;\n            return message;\n          });\n          return chat;\n        }));\n        break;\n\n      case Events.DISPLAYED:\n        setChats(chats.map(chat => {\n          chat.messages = chat.messages.map(message => {\n            if (message.id === data.id) {\n              message.readStatus = ReadStatus.READ;\n            }\n\n            return message;\n          });\n          return chat;\n        }));\n        break;\n\n      case Events.COMPOSING:\n        setChats(chats.map(chat => {\n          if (chat.jid === data) {\n            chat.isTyping = true;\n            if (activeChat.jid === data) setActiveChat(chat);\n            deleteTypingTimeout(chat.jid);\n            setTypingTimeout(chat.jid);\n          }\n\n          return chat;\n        }));\n        break;\n\n      case Events.ACTIVE:\n        setChats(chats.map(chat => {\n          if (chat.jid === data) {\n            chat.isTyping = false;\n\n            if (activeChat.jid === data) {\n              let chatUpdate = { ...chat\n              };\n              setActiveChat(chatUpdate);\n            }\n\n            deleteTypingTimeout(chat.jid);\n          }\n\n          return chat;\n        }));\n        break;\n\n      case Events.PRESENCE:\n        setChats(chats.map(cht => {\n          if (cht.jid === data.from.split(\"/\")[0] && !cht.jid.includes(\"@conference.\")) {\n            cht.status = data.status;\n          }\n\n          return cht;\n        }));\n        setContacts(contacts.map(ctc => {\n          if (ctc.jid === data.from.split(\"/\")[0] && !ctc.jid.includes(\"@conference.\")) {\n            ctc.status = data.status;\n          }\n\n          return ctc;\n        }));\n        break;\n    }\n  }\n\n  const deleteTypingTimeout = jid => {\n    var _typingTimeout$get;\n\n    clearTimeout(((_typingTimeout$get = typingTimeout.get(jid)) === null || _typingTimeout$get === void 0 ? void 0 : _typingTimeout$get.timeout) || setTimeout(() => {}, 1));\n    typingTimeout.delete(jid);\n  };\n\n  const setTypingTimeout = jid => {\n    const timeoutData = {\n      msgStr: \"\",\n      timeout: setTimeout(() => {\n        setChats(chats.map(cht => {\n          if (cht.jid === jid) {\n            cht.isTyping = false;\n            if (activeChat.jid === jid) setActiveChat(cht);\n          }\n\n          return cht;\n        }));\n      }, 20000)\n    };\n    typingTimeout.set(jid, timeoutData);\n  };\n\n  (_squadService23 = squadService) === null || _squadService23 === void 0 ? void 0 : _squadService23.updateSubscribeFunction(chatCommunicatorSubscribe); // Comentado para evitar warnings no console enquanto não é usado\n  // function createGroup(group: INewGroup, callback: CreateGroupCallback) {\n  //   squadService?.groups.create(group, (iGroup: IGroup) => {\n  //     squadService?.groups.list((groups) => {\n  //       setGroups(groups);\n  //       callback(true);\n  //     });\n  //   });\n  // }\n\n  function sendMessage(chat, message, callback) {\n    var _squadService24, _squadService24$chat;\n\n    (_squadService24 = squadService) === null || _squadService24 === void 0 ? void 0 : (_squadService24$chat = _squadService24.chat) === null || _squadService24$chat === void 0 ? void 0 : _squadService24$chat.chat.sendMessage(chat.jid, chat.jid.includes(\"@conference.\") ? XMPPChatType.GROUPCHAT : XMPPChatType.CHAT, message, callback);\n  }\n\n  useEffect(init, []);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, children);\n};\n\nexport default SquadCommunicator;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/SquadCommunicator.tsx"],"names":["React","useEffect","SquadCommunicator","SquadService","useChat","useAuth","Events","ChatType","DeliverStatus","XMPPChatType","getFileName","getUrlBooleans","isUrl","ReadStatus","useGroup","useContact","useModal","squadService","typingTimeout","Map","children","chats","setChats","activeChat","replyMsg","setReplyMsg","setActiveChat","forwardMessageList","setForwardMessageList","contactsSearch","setContactsSearched","newFavorite","setNewFavorite","contacts","setContacts","setContactsOutsideUserContacts","contactChecks","setContactChecks","user","setUser","changedUserData","changedUserPassword","setChangedUserPassword","showModalForwardMessageTo","setShowModalForwardMessageTo","showModalAddContact","setGroups","groups","init","localStorage","setItem","JSON","stringify","access_token","user_id","email","user_name","expires_in","baseUrl","getInstance","chatCommunicatorSubscribe","get","clearSendFile","chatId","messageId","map","chat","id","messages","message","deliverStatus","QUEUED","sendFile","undefined","onChatsChange","onActiveChatChange","checkSendMessage","checkAttachedFiles","checkNewContact","cht","added","add","success","jid","list","ctcs","onCheckAddNewContact","ctt","addContacts","attachedFileList","attachments","length","checkSearchMessages","messageLoaded","forEach","msg","find","m","unshift","SENDING","files","sendFiles","data","updateMessageFiles","isForwardMessage","sendMessage","msgId","updateMessage","replyMsgCopy","newChat","booleans","url","fileUrl","time","Date","toISOString","isFileMessage","isImageMessage","isVideoMessage","isAudioMessage","filter","newChats","replyedMsg","isReplyMessage","replyedMessage","replyedMessageId","replyedMessageTo","fromUser","forwardMessage","chatsFinded","oldChats","ctc","i","userName","name","toUser","split","push","ctcsNotInChat","profilePicture","status","unRead","chatType","includes","GROUP","USER","inputMessage","isTyping","favorite","newMessage","onChangeStatus","client","changeStatus","onSearchContacts","search","searchList","onSearchContactsOutsideUserContacts","getContactsOutsideUserLists","onNewFavorite","onUserDataChange","onUserPasswordChange","changePassword","password","oldPassword","newPassword","changeUserData","chgd","newFavoriteLoad","setFavorite","grp","event","ONLINE","receivedChats","joinGroups","group","MESSAGE","chatTemporary","listContacts","c","RECEIVED","DELIVERED","DISPLAYED","readStatus","READ","COMPOSING","deleteTypingTimeout","setTypingTimeout","ACTIVE","chatUpdate","PRESENCE","from","clearTimeout","timeout","setTimeout","delete","timeoutData","msgStr","set","updateSubscribeFunction","callback","GROUPCHAT","CHAT"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\r\nimport { useChat } from \"../contexts/ChatContext\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport IUser from \"../alias/IUser\";\r\n\r\nimport { Events, SendImageCallbackReturn } from \"./chat/types/types\";\r\nimport ChatType from \"./../enuns/ChatType\";\r\nimport IChat from \"../alias/IChat\";\r\nimport DeliverStatus from \"../enuns/DeliverStatus\";\r\nimport { ChatType as XMPPChatType } from \"./chat/types/types\";\r\nimport { SendMessageCallback } from \"./types\";\r\nimport IMessage from \"../alias/IMessage\";\r\nimport { getFileName, getUrlBooleans, isUrl } from \"./utils/parseUtils\";\r\nimport ReadStatus from \"../enuns/ReadStatus\";\r\nimport { useGroup } from \"../contexts/GroupContext\";\r\nimport { useContact } from \"../contexts/ContactContext\";\r\nimport { useModal } from \"../contexts/ModalContext\";\r\nimport IContact from \"../alias/IContact\";\r\nimport IGroup from \"../alias/IGroup\";\r\n//import { callbackify } from \"util\";\r\n\r\n// import IContact from \"../alias/IContact\";\r\n// Comentado para Evitar Warnings no console\r\n// interface CreateGroupCallback {\r\n//   (groupCreated: boolean): void;\r\n// }\r\ninterface TypingTimeoutData {\r\n  timeout: NodeJS.Timeout;\r\n  msgStr: string;\r\n}\r\nlet squadService: SquadService | undefined;\r\nlet typingTimeout: Map<string, TypingTimeoutData> = new Map<\r\n  string,\r\n  TypingTimeoutData\r\n>();\r\n\r\nconst SquadCommunicator: React.FC = ({ children }) => {\r\n  const {\r\n    chats,\r\n    setChats,\r\n    activeChat,\r\n    replyMsg,\r\n    setReplyMsg,\r\n    setActiveChat,\r\n    forwardMessageList,\r\n    setForwardMessageList,\r\n  } = useChat();\r\n  const {\r\n    contactsSearch,\r\n    setContactsSearched,\r\n    newFavorite,\r\n    setNewFavorite,\r\n    contacts,\r\n    setContacts,\r\n    setContactsOutsideUserContacts,\r\n    contactChecks,\r\n    setContactChecks\r\n  } = useContact();\r\n  const {\r\n    user,\r\n    setUser,\r\n    changedUserData,\r\n    changedUserPassword,\r\n    setChangedUserPassword,\r\n  } = useAuth();\r\n  const {\r\n    showModalForwardMessageTo,\r\n    setShowModalForwardMessageTo,\r\n    showModalAddContact\r\n  } = useModal();\r\n  const { setGroups, groups } = useGroup();\r\n  \r\n  const init = () => {\r\n    localStorage.setItem(\r\n      \"authorization\",\r\n      JSON.stringify({\r\n        access_token: \"b4c1fa651399a3eb63aee51777d3d508\",\r\n        user_id: \"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",\r\n        email: \"romero2@digivox.com.br\",\r\n        user_name: \"ZZ Romero 2\",\r\n        expires_in: 2592000,\r\n        baseUrl: \"https://app.citrussquad.com/api/v1/\",\r\n      })\r\n    );\r\n    squadService = SquadService.getInstance(chatCommunicatorSubscribe);\r\n    squadService?.user.get((user: IUser) => {\r\n      setUser(user);\r\n    });\r\n  };\r\n\r\n  const clearSendFile = (chatId: string, messageId: string) => {\r\n    setChats(\r\n      chats.map((chat) => {\r\n        if (chat.id === chatId) {\r\n          chat.messages = chat.messages.map((message) => {\r\n            if (message.id === messageId) {\r\n              message.deliverStatus = DeliverStatus.QUEUED;\r\n              message.sendFile = undefined;\r\n            }\r\n            return message;\r\n          });\r\n        }\r\n        return chat;\r\n      })\r\n    );\r\n  };\r\n\r\n  const onChatsChange = () => {\r\n    // chats.forEach((chat) => {\r\n    // });\r\n  };\r\n  const onActiveChatChange = () => {\r\n    checkSendMessage(activeChat);\r\n    checkAttachedFiles(activeChat);\r\n    checkNewContact(activeChat);\r\n    // checkTyping(activeChat)\r\n  };\r\n  // const checkTyping = (chat: IChat) => {\r\n  //   const oldTimeoutData = typingTimeout.get(chat.jid)\r\n  //   if (chat.inputMessage !== \"\" && (!oldTimeoutData || (oldTimeoutData.msgStr !== chat.inputMessage))) {\r\n  //     if (oldTimeoutData)\r\n  //       clearTimeout(oldTimeoutData.timeout)\r\n  //     else\r\n  //       squadService?.chat?.chat.sendTyping(chat.jid)\r\n  //     const timeoutData = {\r\n  //       timeout: setTimeout(() => { squadService?.chat?.chat.sendActive(chat.jid); typingTimeout.delete(chat.jid) }, 3000),\r\n  //       msgStr: `${chat.inputMessage}`\r\n  //     }\r\n  //     typingTimeout.set(chat.jid, timeoutData)\r\n  //   }\r\n  // }\r\n  const checkNewContact = (cht: IChat) => {\r\n    if (!cht.added) {\r\n      squadService?.contacts.add(cht, (success: boolean) => {\r\n        if (success) {\r\n          setChats(\r\n            chats.map((chat) => {\r\n              if (chat.jid === cht.jid) {\r\n                chat.added = true;\r\n              }\r\n              if (activeChat.jid === chat.jid) setActiveChat(chat);\r\n              return chat;\r\n            })\r\n          );\r\n          squadService?.contacts.list((ctcs) => {\r\n            setContacts(ctcs);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const onCheckAddNewContact = (ctt: IContact) => {\r\n    if (!ctt.added) {\r\n      squadService?.contacts.addContacts(ctt, (success: boolean) => {\r\n        if (success) {\r\n          setContacts([...contacts, ctt]);\r\n          return contacts\r\n        }\r\n      });\r\n    };\r\n  }\r\n\r\n  const checkAttachedFiles = (cht: IChat) => {\r\n    if (cht.attachedFileList && !cht.attachedFileList[0]) {\r\n      squadService?.attachments.list(cht, (attachments) => {\r\n        if (attachments.length > 0)\r\n          setActiveChat({ ...cht, attachedFileList: attachments });\r\n        else setActiveChat({ ...cht, attachedFileList: null });\r\n      });\r\n    }\r\n  };\r\n\r\n  /* getMessageUserProfilePicture = (msg: Message | FileMessage) => {\r\n    if (msg.from.includes(\"@conference.\")) {\r\n      const groups = this.groups.getGroups();\r\n      const group = groups.get(msg.from.split(\"@\")[0]);\r\n      const member = group?.members.filter(\r\n        (member) => member.userId === msg.from.split(\"/\")[1]\r\n      )[0];\r\n      return member?.profilePicture;\r\n    } else {\r\n      return this.contacts.getContacts().get(msg.from.split(\"@\")[0])\r\n        ?.profilePicture;\r\n    }\r\n  }; */\r\n\r\n  const checkSearchMessages = () => {\r\n    if (activeChat.messageLoaded) {\r\n      squadService?.messages.list(activeChat, (messages) => {\r\n        if (messages.length) {\r\n          setChats(\r\n            chats.map((cht) => {\r\n              if (cht.id === activeChat.id) {\r\n                messages.forEach((msg) => {\r\n                  if (!activeChat.messages.find((m) => m.id === msg.id))\r\n                    cht.messages.unshift(msg);\r\n                });\r\n                cht.messageLoaded = false;\r\n                setActiveChat(cht);\r\n              }\r\n              return cht;\r\n            })\r\n          );\r\n        } else {\r\n          const chat = { ...activeChat, messageLoaded: false };\r\n          setActiveChat(chat);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const checkSendMessage = (chat: IChat) => {\r\n    chat.messages.forEach((msg) => {\r\n      if (msg.deliverStatus === DeliverStatus.SENDING) {\r\n        if (msg.sendFile && !replyMsg) {\r\n          const files = [msg.sendFile];\r\n          clearSendFile(chat.id, msg.id);\r\n          squadService?.chat?.sendFiles(\r\n            chat,\r\n            files,\r\n            (data: SendImageCallbackReturn) => {\r\n              updateMessageFiles(data, chat, msg);\r\n            }\r\n          );\r\n        } else {\r\n          if (!msg.isForwardMessage && !replyMsg) {\r\n            sendMessage(chat, msg.message, (msgId) =>\r\n              updateMessage(msgId, chat, msg)\r\n            );\r\n          }else if(replyMsg){\r\n            const replyMsgCopy = {...replyMsg}\r\n            setReplyMsg(undefined);\r\n            squadService?.chat?.replyMsg(chat, msg, replyMsgCopy, (msgId) => {\r\n              updateMessage(msgId, chat, msg, replyMsgCopy)\r\n            })            \r\n          }\r\n        }\r\n      }\r\n    });\r\n  };\r\n  const updateMessageFiles = (\r\n    data: SendImageCallbackReturn,\r\n    chat: IChat,\r\n    msg: IMessage\r\n  ) => {\r\n    const newChat = { ...chat };\r\n    newChat.messages = chat.messages.map((message) => {\r\n      if (msg.id === message.id) {\r\n        const booleans = getUrlBooleans(data.url);\r\n        message.id = data.msgId;\r\n        message.fileUrl = data.url;\r\n        message.deliverStatus = DeliverStatus.QUEUED;\r\n        message.time = new Date().toISOString();\r\n        message.message = getFileName(data.url);\r\n        message.isFileMessage = booleans.isFileMessage;\r\n        message.isImageMessage = booleans.isImageMessage;\r\n        message.isVideoMessage = booleans.isVideoMessage;\r\n        message.isAudioMessage = booleans.isAudioMessage;\r\n      }\r\n      return message;\r\n    });\r\n    setActiveChat(newChat);\r\n    if (!chats.filter((cht) => cht.id === chat.id)[0]) {\r\n      const newChats = [chat, ...chats];\r\n      setChats(newChats);\r\n    } else {\r\n      setChats(\r\n        chats.map((cht) => {\r\n          if (cht.id === chat.id) {\r\n            cht.messages = newChat.messages;\r\n          }\r\n          return cht;\r\n        })\r\n      );\r\n    }\r\n  };\r\n  const updateMessage = (msgId: string, chat: IChat, msg: IMessage, replyedMsg:IMessage | undefined = undefined) => {\r\n    const newChat = { ...chat };\r\n    newChat.messages = chat.messages.map((message) => {\r\n      if (msg.id === message.id) {\r\n        message.id = msgId;\r\n        message.deliverStatus = DeliverStatus.QUEUED;\r\n        message.time = new Date().toISOString();\r\n        if(replyedMsg){\r\n          message.isReplyMessage = true;\r\n          message.replyedMessage = replyedMsg.message || replyedMsg.fileUrl\r\n          message.replyedMessageId = replyedMsg.id\r\n          message.replyedMessageTo = replyedMsg.fromUser\r\n        }\r\n        if (isUrl(message.message)) {\r\n          const booleans = getUrlBooleans(message.message);\r\n          message.isFileMessage = booleans.isFileMessage;\r\n          message.isImageMessage = booleans.isImageMessage;\r\n          message.isAudioMessage = booleans.isAudioMessage;\r\n          message.isVideoMessage = booleans.isVideoMessage;\r\n          message.fileUrl = message.message;\r\n        }\r\n      }\r\n      return message;\r\n    });\r\n    if (activeChat.jid === newChat.jid) setActiveChat(newChat);\r\n    if (!chats.filter((cht) => cht.id === chat.id)[0]) {\r\n      const newChats = [chat, ...chats];\r\n      setChats(newChats);\r\n    } else {\r\n      setChats(\r\n        chats.map((cht) => {\r\n          if (cht.id === chat.id) {\r\n            cht.messages = newChat.messages;\r\n          }\r\n          return cht;\r\n        })\r\n      );\r\n    }\r\n  };\r\n  const forwardMessage = () => {\r\n    if (forwardMessageList && showModalForwardMessageTo) {\r\n      const ctcs = [...forwardMessageList];\r\n      const message = { ...showModalForwardMessageTo };\r\n      setForwardMessageList(undefined);\r\n      setShowModalForwardMessageTo(undefined);\r\n      const chatsFinded: IChat[] = [];\r\n      const oldChats = [\r\n        ...chats.map((chat) => {\r\n          return { ...chat };\r\n        }),\r\n      ];\r\n      ctcs?.forEach((ctc, i) => {\r\n        const cht = oldChats.find((cht) => cht.jid === ctc.jid);\r\n        if (cht) {\r\n          const msg = {\r\n            ...message,\r\n            id: `${cht.messages.length + 1}`,\r\n            userName: user.name,\r\n            fromUser: user.id,\r\n            toUser: ctc.jid.split(\"@\")[0],\r\n            message: message.fileUrl || message.message,\r\n            deliverStatus: DeliverStatus.QUEUED,\r\n            isForwardMessage: true,\r\n          };\r\n          squadService?.chat?.forwardMessage(cht, msg, (msgId) => {\r\n            msg.id = msgId;\r\n            cht.messages.push(msg);\r\n            chatsFinded.push(cht);\r\n          });\r\n        }\r\n      });\r\n      const newChats = oldChats.map(\r\n        (chat) => chatsFinded.find((cht) => cht.id === chat.id) || chat\r\n      );\r\n      const ctcsNotInChat: (IContact | IGroup)[] = ctcs.filter(\r\n        (ctc) => !newChats.find((cht) => ctc.jid === cht.jid)\r\n      );\r\n      ctcsNotInChat.forEach((ctc, i) => {\r\n        const chat = {\r\n          id: ctc.jid.split(\"@\")[0],\r\n          jid: ctc.jid,\r\n          name: ctc.name,\r\n          profilePicture: ctc.profilePicture,\r\n          status: (ctc as IContact).status || undefined,\r\n          unRead: 0,\r\n          chatType: ctc.jid.includes(\"@conference.\")\r\n            ? ChatType.GROUP\r\n            : ChatType.USER,\r\n          inputMessage: \"\",\r\n          messageLoaded: false,\r\n          isTyping: false,\r\n          messages: [] as IMessage[],\r\n          email: (ctc as IContact).email || undefined,\r\n          favorite: ctc.favorite,\r\n          added: ctc.added,\r\n        };\r\n        const newMessage: IMessage = {\r\n          ...message,\r\n          id: `${1}`,\r\n          userName: user.name,\r\n          fromUser: user.id,\r\n          toUser: ctc.jid.split(\"@\")[0],\r\n          deliverStatus: DeliverStatus.QUEUED,\r\n          isForwardMessage: true,\r\n        };\r\n        squadService?.chat?.forwardMessage(chat, newMessage, (msgId) => {\r\n          newMessage.id = msgId;\r\n          chat.messages.push(newMessage);\r\n          newChats.unshift(chat);\r\n        });\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const onChangeStatus = () => {\r\n    if (squadService?.chat?.chat.client.status === \"online\") {\r\n      squadService?.chat?.changeStatus(user.status);\r\n    }\r\n  };\r\n  const onSearchContacts = () => {\r\n    if (contactsSearch.length > 2) {\r\n      squadService?.contacts.search(contactsSearch, (searchList) => {\r\n        setContactsSearched(searchList);\r\n      });\r\n    } else {\r\n      setContactsSearched(undefined);\r\n    }\r\n  };\r\n\r\n  const onSearchContactsOutsideUserContacts = () => {\r\n    squadService?.contacts.getContactsOutsideUserLists(contacts => {\r\n      if(contacts){\r\n        setContactsOutsideUserContacts(contacts);\r\n      }\r\n    });\r\n  }\r\n\r\n  useEffect(onChatsChange, [chats]);\r\n  useEffect(onNewFavorite, [newFavorite]);\r\n  useEffect(checkSearchMessages, [activeChat.messageLoaded]);\r\n  useEffect(onActiveChatChange, [activeChat]);\r\n  useEffect(onUserDataChange, [changedUserData]);\r\n  useEffect(onUserPasswordChange, [changedUserPassword]);\r\n  useEffect(onChangeStatus, [user.status]);\r\n  useEffect(forwardMessage, [forwardMessageList]);\r\n  useEffect(onSearchContacts, [contactsSearch]);\r\n  useEffect(onSearchContactsOutsideUserContacts, [showModalAddContact]);\r\n  useEffect(onCheckAddNewContact, [contactChecks]);\r\n\r\n  function onUserPasswordChange() {\r\n    if (changedUserPassword) {\r\n      squadService?.user.changePassword(changedUserPassword, (password) => {\r\n        if (password) {\r\n          setChangedUserPassword({ oldPassword: \"\", newPassword: \"\" });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onUserDataChange() {\r\n    if (changedUserData) {\r\n      squadService?.user.changeUserData(changedUserData, (chgd) => {\r\n        if (chgd) {\r\n          setUser({\r\n            ...user,\r\n            email: changedUserData.email,\r\n            name: changedUserData.name,\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onNewFavorite() {\r\n    if (newFavorite) {\r\n      const newFavoriteLoad = { ...newFavorite };\r\n      squadService?.contacts.setFavorite(newFavorite, (favorite) => {\r\n        if (favorite) {\r\n          setChats(\r\n            chats.map((cht) => {\r\n              if (cht.jid === newFavoriteLoad.jid) {\r\n                cht.favorite = !newFavoriteLoad.favorite;\r\n              }\r\n              return cht;\r\n            })\r\n          );\r\n          setGroups(\r\n            groups.map((grp) => {\r\n              if (grp.jid === newFavoriteLoad.jid) {\r\n                return {\r\n                  ...grp,\r\n                  favorite: !newFavoriteLoad.favorite,\r\n                };\r\n              }\r\n              return grp;\r\n            })\r\n          );\r\n          setContacts(\r\n            contacts.map((ctt) => {\r\n              if (ctt.jid === newFavoriteLoad.jid) {\r\n                return {\r\n                  ...ctt,\r\n                  favorite: !newFavoriteLoad.favorite,\r\n                };\r\n              }\r\n              return ctt;\r\n            })\r\n          );\r\n        }\r\n      });\r\n      setNewFavorite(undefined);\r\n    }\r\n  }\r\n\r\n  function chatCommunicatorSubscribe(event: string, data: any) {\r\n    switch (event) {\r\n      case Events.ONLINE:\r\n        squadService?.chats.list((receivedChats) => {\r\n          const chats: IChat[] = [];\r\n          receivedChats.forEach((cht) => {\r\n            if (!chats.find((chat) => chat.id === cht.id)) {\r\n              chats.push(cht);\r\n            }\r\n          });\r\n          setChats(chats);\r\n          //populating groups\r\n          squadService?.groups.list((groups) => {\r\n            setGroups(groups);\r\n            //Joining Groups Rooms in XMPP\r\n            squadService?.chat?.joinGroups(groups.map((group) => group.jid));\r\n          });\r\n          //populating contacts\r\n          squadService?.contacts.list((contacts) => setContacts(contacts));\r\n          \r\n          //populating chat's with messages\r\n\r\n          // receivedChats.forEach((chat) => {\r\n          //   squadService?.messages.list(chat, (messages) => {\r\n          //     const chatWithMessages = { ...chat };\r\n          //     chatWithMessages.messages = chatWithMessages.messages.concat(\r\n          //       messages\r\n          //     );\r\n          //     setChats([\r\n          //       ...receivedChats.filter((cht) => chat.id !== cht.id),\r\n          //       chatWithMessages,\r\n          //     ]);\r\n          //   });\r\n          // });\r\n        });\r\n        break;\r\n      case Events.MESSAGE:\r\n        if (data.fromUser === user.jid) break;\r\n        let find = false;\r\n\r\n        let newChats = chats.map((chat) => {\r\n          if (\r\n            data.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            data.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            find = true;\r\n            if (!chat.messages.filter((msg) => msg.id === data.id)[0])\r\n              chat.messages.push(data);\r\n            if (chat.id === activeChat.id) {\r\n              let chatTemporary = { ...chat };\r\n              setActiveChat(chatTemporary);\r\n            } else {\r\n              chat.unRead++;\r\n            }\r\n          }\r\n          return chat;\r\n        });\r\n\r\n        if (!find) {\r\n          let newChat: IChat = {} as IChat;\r\n\r\n          squadService?.contacts.list((listContacts) => {\r\n            listContacts.forEach((c) => {\r\n              if (c.jid === data.fromUser) {\r\n                newChat = {\r\n                  id: c.id,\r\n                  jid: c.jid,\r\n                  name: c.name,\r\n                  profilePicture: c.profilePicture,\r\n                  status: c.status,\r\n                  unRead: 1,\r\n                  chatType: ChatType.USER,\r\n                  inputMessage: \"\",\r\n                  isTyping: false,\r\n                  messages: [],\r\n                  favorite: c.favorite,\r\n                  added: c.added,\r\n                };\r\n                newChat.messages.push(data);\r\n                newChats.unshift(newChat);\r\n                setChats(newChats);\r\n              }\r\n            });\r\n          });\r\n        } else {\r\n          setChats(newChats);\r\n        }\r\n\r\n        break;\r\n      case Events.RECEIVED:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.messages.find((msg) => msg.id === data.id))\r\n              chat.messages = chat.messages.map((message) => {\r\n                message.deliverStatus = DeliverStatus.DELIVERED;\r\n                return message;\r\n              });\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.DISPLAYED:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            chat.messages = chat.messages.map((message) => {\r\n              if (message.id === data.id) {\r\n                message.readStatus = ReadStatus.READ;\r\n              }\r\n              return message;\r\n            });\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.COMPOSING:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.jid === data) {\r\n              chat.isTyping = true;\r\n              if (activeChat.jid === data) setActiveChat(chat);\r\n              deleteTypingTimeout(chat.jid);\r\n              setTypingTimeout(chat.jid);\r\n            }\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.ACTIVE:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.jid === data) {\r\n              chat.isTyping = false;\r\n              if (activeChat.jid === data) {\r\n                let chatUpdate = { ...chat };\r\n                setActiveChat(chatUpdate);\r\n              }\r\n              deleteTypingTimeout(chat.jid);\r\n            }\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.PRESENCE:\r\n        setChats(\r\n          chats.map((cht) => {\r\n            if (\r\n              cht.jid === data.from.split(\"/\")[0] &&\r\n              !cht.jid.includes(\"@conference.\")\r\n            ) {\r\n              cht.status = data.status;\r\n            }\r\n            return cht;\r\n          })\r\n        );\r\n        setContacts(\r\n          contacts.map((ctc) => {\r\n            if (\r\n              ctc.jid === data.from.split(\"/\")[0] &&\r\n              !ctc.jid.includes(\"@conference.\")\r\n            ) {\r\n              ctc.status = data.status;\r\n            }\r\n            return ctc;\r\n          })\r\n        );\r\n        break;\r\n    }\r\n  }\r\n  const deleteTypingTimeout = (jid: string) => {\r\n    clearTimeout(typingTimeout.get(jid)?.timeout || setTimeout(() => {}, 1));\r\n    typingTimeout.delete(jid);\r\n  };\r\n  const setTypingTimeout = (jid: string) => {\r\n    const timeoutData: TypingTimeoutData = {\r\n      msgStr: \"\",\r\n      timeout: setTimeout(() => {\r\n        setChats(\r\n          chats.map((cht) => {\r\n            if (cht.jid === jid) {\r\n              cht.isTyping = false;\r\n              if (activeChat.jid === jid) setActiveChat(cht);\r\n            }\r\n            return cht;\r\n          })\r\n        );\r\n      }, 20000),\r\n    };\r\n    typingTimeout.set(jid, timeoutData);\r\n  };\r\n\r\n  squadService?.updateSubscribeFunction(chatCommunicatorSubscribe);\r\n  // Comentado para evitar warnings no console enquanto não é usado\r\n  // function createGroup(group: INewGroup, callback: CreateGroupCallback) {\r\n  //   squadService?.groups.create(group, (iGroup: IGroup) => {\r\n  //     squadService?.groups.list((groups) => {\r\n  //       setGroups(groups);\r\n  //       callback(true);\r\n  //     });\r\n  //   });\r\n  // }\r\n\r\n  function sendMessage(\r\n    chat: IChat,\r\n    message: string,\r\n    callback: SendMessageCallback\r\n  ) {\r\n    squadService?.chat?.chat.sendMessage(\r\n      chat.jid,\r\n      chat.jid.includes(\"@conference.\")\r\n        ? XMPPChatType.GROUPCHAT\r\n        : XMPPChatType.CHAT,\r\n      message,\r\n      callback\r\n    );\r\n  }\r\n\r\n  useEffect(init, []);\r\n\r\n  return <>{children}</>;\r\n};\r\n\r\nexport default SquadCommunicator;\r\n"]},"metadata":{},"sourceType":"module"}