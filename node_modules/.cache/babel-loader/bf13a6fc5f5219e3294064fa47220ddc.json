{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Digivox\\\\dev\\\\DathApp\\\\ConstruNote\\\\src\\\\components\\\\VideoBox.tsx\";\nimport React, { useState, useEffect } from \"react\";\nimport { useCall } from \"../contexts/CallContext\";\nimport { tagsRange } from \"../services/voice/voicecommunicator\";\nimport { motion } from \"framer-motion\";\nimport { getWidth, getHeight } from \"../helpers/windowSize\";\nimport { DropdownItem } from \"reactstrap\";\nimport { useTranslation } from \"react-i18next\";\nimport VideoBoxButton from \"./VideoBoxButton\";\n\nconst VideoBox = () => {\n  const {\n    t\n  } = useTranslation();\n  const {\n    currentCalls,\n    setConferenceCommand\n  } = useCall();\n  const [widthScreen, setWidthScreen] = useState(0);\n  const [heightScreen, setHeightScreen] = useState(0);\n  const [widthBox, setWidthBox] = useState(400);\n  const [flagToOpacity, setFlagToOpacity] = useState(false);\n  const [flagToTimeOut, setFlagToTimeOut] = useState(true);\n  const [pictureInPictureEnabled, setPictureInPictureEnabled] = useState(false);\n  const [pictureInPictureTag, setPictureInPictureTag] = useState(undefined);\n\n  const toggleOpacity = () => {\n    if (flagToTimeOut === true) {\n      setFlagToOpacity(true);\n      setFlagToTimeOut(false);\n      setTimeout(() => {\n        setFlagToOpacity(false);\n        setFlagToTimeOut(true);\n      }, 6000);\n    }\n  };\n\n  const togglePictureInPicture = tagId => {\n    const doc = document;\n\n    if (!doc.pictureInPictureElement && doc.pictureInPictureEnabled) {\n      const video = document.querySelector(`#remote-stream-${tagId}`);\n      video === null || video === void 0 ? void 0 : video.requestPictureInPicture().catch(error => {});\n    } else {\n      if (doc.pictureInPictureEnabled) {\n        document.exitPictureInPicture().catch(error => {});\n      }\n    }\n  };\n\n  const listenPictureInPictureChanges = () => {\n    tagsRange.forEach(tagId => {\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\n\n      if (videoEl && !videoEl.disablePictureInPicture) {\n        videoEl.addEventListener(\"enterpictureinpicture\", () => {\n          // Video entered Picture-in-Picture mode.\n          setPictureInPictureEnabled(true);\n          setPictureInPictureTag(tagId);\n        });\n        videoEl.addEventListener(\"leavepictureinpicture\", () => {\n          // Video left Picture-in-Picture mode.\n          setPictureInPictureEnabled(false);\n          setPictureInPictureTag(undefined);\n        });\n      }\n    });\n  };\n\n  const removeListeners = () => {\n    tagsRange.forEach(tagId => {\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\n\n      if (videoEl) {\n        videoEl.removeEventListener(\"enterpictureinpicture\", () => {});\n        videoEl.removeEventListener(\"leavepictureinpicture\", () => {});\n      }\n    });\n  };\n\n  const isVisible = tagId => {\n    const callTag = getCallByTag(tagId);\n    return callTag && pictureInPictureTag !== tagId && (callTag.sendingVideo || (callTag === null || callTag === void 0 ? void 0 : callTag.receivingVideo));\n  };\n\n  const getCallByTag = tagId => {\n    return Array.from(currentCalls.values()).find(call => call.tagId === `remote-stream-${tagId}`);\n  };\n\n  const getCallerObjectId = callerObject => {\n    return callerObject.id || callerObject.groupId || callerObject.id;\n  };\n\n  const isConference = call => {\n    if (call) return !!(call.callerObject.participantPin || call.callerObject.groupId);\n    return false;\n  };\n\n  const sendConfCommand = (call, command) => {\n    if (call) {\n      if (command === \"tmute\") {\n        call.sendDTMF(\"0\");\n      } else if (command === \"tvmute\") {\n        call.sendDTMF(\"*\");\n      }\n    }\n  };\n\n  removeListeners();\n  listenPictureInPictureChanges();\n\n  const layouts = call => {\n    if ((call === null || call === void 0 ? void 0 : call.callerObject) && isConference(call)) {\n      const conferenceId = getCallerObjectId(call.callerObject);\n      const layoutsName = {\n        \"group:grid\": \"Distribute in degree\",\n        \"group:grid-zoom\": \"Highlight users\",\n        \"1up_top_left+9\": \"Highlight who talks to others around\",\n        overlaps: \"Highlight who talks to others below\",\n        \"presenter-overlap-small-bot-right\": \"Highlight presentation\"\n      };\n      return Object.keys(layoutsName).map(k => /*#__PURE__*/React.createElement(DropdownItem, {\n        onClick: () => {\n          setConferenceCommand({\n            command: \"setLayout\",\n            conferenceId,\n            extraParam: k\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"text-muted\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 11\n        }\n      }, t(layoutsName[k]))));\n    }\n  };\n\n  const boxVideo = {\n    position: \"fixed\",\n    top: heightScreen / 2 - widthBox * 0.5625 / 2 + \"px\",\n    left: widthScreen / 2 - widthBox / 2 + \"px\",\n    zIndex: 100,\n    width: widthBox + \"px\",\n    borderRadius: \"2px\",\n    backgroundColor: \"#000000\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  };\n  const video = {\n    position: \"relative\",\n    width: widthBox + \"px\"\n  };\n\n  function resize() {\n    setWidthScreen(getWidth());\n    setHeightScreen(getHeight());\n  }\n\n  useEffect(() => {\n    setWidthScreen(getWidth());\n    setHeightScreen(getHeight());\n    window.addEventListener(\"resize\", () => resize());\n    return window.removeEventListener(\"resize\", () => resize());\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 5\n    }\n  }, tagsRange.map(tagId => /*#__PURE__*/React.createElement(motion.div, {\n    drag: true,\n    dragConstraints: {\n      top: (heightScreen / 2 - widthBox * 0.5625 / 2) * -1,\n      bottom: heightScreen / 2 - widthBox * 0.5625 / 2,\n      left: (widthScreen / 2 - widthBox / 2) * -1,\n      right: widthScreen / 2 - widthBox / 2\n    },\n    style: { ...boxVideo,\n      display: isVisible(tagId) ? boxVideo.display : \"none\"\n    },\n    key: `remote-stream-${tagId}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    style: video,\n    onMouseOver: toggleOpacity,\n    id: `remote-stream-${tagId}`,\n    hidden: !isVisible(tagId),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(VideoBoxButton, {\n    key: `remote-stream-${tagId}`,\n    tagId: tagId,\n    pictureInPictureTag: pictureInPictureTag,\n    widthBox: widthBox,\n    setWidthBox: setWidthBox,\n    width: () => widthScreen,\n    height: () => heightScreen,\n    flagToOpacity: flagToOpacity,\n    pictureInPictureEnabled: pictureInPictureEnabled,\n    togglePictureInPicture: togglePictureInPicture,\n    sendConfCommand: sendConfCommand,\n    layouts: layouts,\n    getCallByTag: getCallByTag,\n    isConference: isConference,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport default VideoBox;","map":{"version":3,"sources":["C:/Users/Digivox/dev/DathApp/ConstruNote/src/components/VideoBox.tsx"],"names":["React","useState","useEffect","useCall","tagsRange","motion","getWidth","getHeight","DropdownItem","useTranslation","VideoBoxButton","VideoBox","t","currentCalls","setConferenceCommand","widthScreen","setWidthScreen","heightScreen","setHeightScreen","widthBox","setWidthBox","flagToOpacity","setFlagToOpacity","flagToTimeOut","setFlagToTimeOut","pictureInPictureEnabled","setPictureInPictureEnabled","pictureInPictureTag","setPictureInPictureTag","undefined","toggleOpacity","setTimeout","togglePictureInPicture","tagId","doc","document","pictureInPictureElement","video","querySelector","requestPictureInPicture","catch","error","exitPictureInPicture","listenPictureInPictureChanges","forEach","videoEl","disablePictureInPicture","addEventListener","removeListeners","removeEventListener","isVisible","callTag","getCallByTag","sendingVideo","receivingVideo","Array","from","values","find","call","getCallerObjectId","callerObject","id","groupId","isConference","participantPin","sendConfCommand","command","sendDTMF","layouts","conferenceId","layoutsName","overlaps","Object","keys","map","k","extraParam","boxVideo","position","top","left","zIndex","width","borderRadius","backgroundColor","display","justifyContent","alignItems","resize","window","bottom","right"],"mappings":"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","sourcesContent":["import React, { CSSProperties, useState, useEffect } from \"react\";\r\nimport { useCall } from \"../contexts/CallContext\";\r\nimport { tagsRange } from \"../services/voice/voicecommunicator\";\r\nimport { motion } from \"framer-motion\";\r\nimport { getWidth, getHeight } from \"../helpers/windowSize\";\r\nimport { DropdownItem } from \"reactstrap\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport ICall from \"../alias/ICall\";\r\nimport { IConference } from \"../alias/IConference\";\r\nimport IGroup from \"../alias/IGroup\";\r\nimport IContact from \"../alias/IContact\";\r\nimport { DocumentPictureInPicture } from \"../alias/IDocumentPictureInPicture\";\r\nimport { HTMLVideoElementPictureInPicture } from \"../alias/IHTMLVideoElementPictureInPicture\";\r\nimport VideoBoxButton from \"./VideoBoxButton\";\r\n\r\nconst VideoBox: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  const { currentCalls, setConferenceCommand } = useCall();\r\n\r\n  const [widthScreen, setWidthScreen] = useState(0);\r\n  const [heightScreen, setHeightScreen] = useState(0);\r\n  const [widthBox, setWidthBox] = useState(400);\r\n  const [flagToOpacity, setFlagToOpacity] = useState<boolean>(false);\r\n  const [flagToTimeOut, setFlagToTimeOut] = useState<boolean>(true);\r\n  const [\r\n    pictureInPictureEnabled,\r\n    setPictureInPictureEnabled,\r\n  ] = useState<boolean>(false);\r\n  const [pictureInPictureTag, setPictureInPictureTag] = useState<\r\n    number | undefined\r\n  >(undefined);\r\n\r\n  const toggleOpacity = () => {\r\n    if (flagToTimeOut === true) {\r\n      setFlagToOpacity(true);\r\n      setFlagToTimeOut(false);\r\n      setTimeout(() => {\r\n        setFlagToOpacity(false);\r\n        setFlagToTimeOut(true);\r\n      }, 6000);\r\n    }\r\n  };\r\n\r\n  const togglePictureInPicture = (tagId: number) => {\r\n    const doc = document as DocumentPictureInPicture;\r\n    if (!doc.pictureInPictureElement && doc.pictureInPictureEnabled) {\r\n      const video = document.querySelector(\r\n        `#remote-stream-${tagId}`\r\n      ) as HTMLVideoElementPictureInPicture;\r\n      video?.requestPictureInPicture().catch((error) => {});\r\n    } else {\r\n      if (doc.pictureInPictureEnabled) {\r\n        (document as DocumentPictureInPicture)\r\n          .exitPictureInPicture()\r\n          .catch((error) => {});\r\n      }\r\n    }\r\n  };\r\n\r\n  const listenPictureInPictureChanges = () => {\r\n    tagsRange.forEach((tagId) => {\r\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\r\n      if (\r\n        videoEl &&\r\n        !(videoEl as HTMLVideoElementPictureInPicture).disablePictureInPicture\r\n      ) {\r\n        videoEl.addEventListener(\"enterpictureinpicture\", () => {\r\n          // Video entered Picture-in-Picture mode.\r\n          setPictureInPictureEnabled(true);\r\n          setPictureInPictureTag(tagId);\r\n        });\r\n        videoEl.addEventListener(\"leavepictureinpicture\", () => {\r\n          // Video left Picture-in-Picture mode.\r\n          setPictureInPictureEnabled(false);\r\n          setPictureInPictureTag(undefined);\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  const removeListeners = () => {\r\n    tagsRange.forEach((tagId) => {\r\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\r\n      if (videoEl) {\r\n        videoEl.removeEventListener(\"enterpictureinpicture\", () => {});\r\n        videoEl.removeEventListener(\"leavepictureinpicture\", () => {});\r\n      }\r\n    });\r\n  };\r\n\r\n  const isVisible = (tagId: number) => {\r\n    const callTag = getCallByTag(tagId);\r\n    return (\r\n      callTag &&\r\n      pictureInPictureTag !== tagId &&\r\n      (callTag.sendingVideo || callTag?.receivingVideo)\r\n    );\r\n  };\r\n\r\n  const getCallByTag = (tagId: number) => {\r\n    return Array.from(currentCalls.values()).find(\r\n      (call) => call.tagId === `remote-stream-${tagId}`\r\n    );\r\n  };\r\n\r\n  const getCallerObjectId = (callerObject: IConference | IGroup | IContact) => {\r\n    return (\r\n      (callerObject as IConference).id ||\r\n      (callerObject as IGroup).groupId ||\r\n      (callerObject as IContact).id\r\n    );\r\n  };\r\n\r\n  const isConference = (call: ICall | undefined) => {\r\n    if (call)\r\n      return !!(\r\n        (call.callerObject as IConference).participantPin ||\r\n        (call.callerObject as IGroup).groupId\r\n      );\r\n    return false;\r\n  };\r\n\r\n  const sendConfCommand = (\r\n    call: ICall | undefined,\r\n    command: \"tvmute\" | \"tmute\"\r\n  ) => {\r\n    if (call) {\r\n      if (command === \"tmute\") {\r\n        call.sendDTMF(\"0\");\r\n      } else if (command === \"tvmute\") {\r\n        call.sendDTMF(\"*\");\r\n      }\r\n    }\r\n  };\r\n\r\n  removeListeners();\r\n\r\n  listenPictureInPictureChanges();\r\n\r\n  const layouts = (call: ICall | undefined) => {\r\n    if (call?.callerObject && isConference(call)) {\r\n      const conferenceId = getCallerObjectId(call.callerObject);\r\n      const layoutsName: any = {\r\n        \"group:grid\": \"Distribute in degree\",\r\n        \"group:grid-zoom\": \"Highlight users\",\r\n        \"1up_top_left+9\": \"Highlight who talks to others around\",\r\n        overlaps: \"Highlight who talks to others below\",\r\n        \"presenter-overlap-small-bot-right\": \"Highlight presentation\",\r\n      };\r\n      return Object.keys(layoutsName).map((k) => (\r\n        <DropdownItem\r\n          onClick={() => {\r\n            setConferenceCommand({\r\n              command: \"setLayout\",\r\n              conferenceId,\r\n              extraParam: k,\r\n            });\r\n          }}\r\n        >\r\n          <span className=\"text-muted\">{t(layoutsName[k])}</span>\r\n        </DropdownItem>\r\n      ));\r\n    }\r\n  };\r\n\r\n  const boxVideo: CSSProperties = {\r\n    position: \"fixed\",\r\n    top: heightScreen / 2 - (widthBox * 0.5625) / 2 + \"px\",\r\n    left: widthScreen / 2 - widthBox / 2 + \"px\",\r\n    zIndex: 100,\r\n    width: widthBox + \"px\",\r\n    borderRadius: \"2px\",\r\n    backgroundColor: \"#000000\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  };\r\n\r\n  const video: CSSProperties = {\r\n    position: \"relative\",\r\n    width: widthBox + \"px\",\r\n  };\r\n\r\n  function resize() {\r\n    setWidthScreen(getWidth());\r\n    setHeightScreen(getHeight());\r\n  }\r\n\r\n  useEffect(() => {\r\n    setWidthScreen(getWidth());\r\n    setHeightScreen(getHeight());\r\n    window.addEventListener(\"resize\", () => resize());\r\n    return window.removeEventListener(\"resize\", () => resize());\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      {tagsRange.map((tagId) => (\r\n        <motion.div\r\n          drag\r\n          dragConstraints={{\r\n            top: (heightScreen / 2 - (widthBox * 0.5625) / 2) * -1,\r\n            bottom: heightScreen / 2 - (widthBox * 0.5625) / 2,\r\n            left: (widthScreen / 2 - widthBox / 2) * -1,\r\n            right: widthScreen / 2 - widthBox / 2,\r\n          }}\r\n          style={{\r\n            ...boxVideo,\r\n            display: isVisible(tagId) ? boxVideo.display : \"none\",\r\n          }}\r\n          key={`remote-stream-${tagId}`}\r\n        >\r\n          <video\r\n            style={video}\r\n            onMouseOver={toggleOpacity}\r\n            id={`remote-stream-${tagId}`}\r\n            hidden={!isVisible(tagId)}\r\n          />\r\n\r\n          <VideoBoxButton\r\n            key={`remote-stream-${tagId}`}\r\n            tagId={tagId}\r\n            pictureInPictureTag={pictureInPictureTag}\r\n            widthBox={widthBox}\r\n            setWidthBox={setWidthBox}\r\n            width={() => widthScreen}\r\n            height={() => heightScreen}\r\n            flagToOpacity={flagToOpacity}\r\n            pictureInPictureEnabled={pictureInPictureEnabled}\r\n            togglePictureInPicture={togglePictureInPicture}\r\n            sendConfCommand={sendConfCommand}\r\n            layouts={layouts}\r\n            getCallByTag={getCallByTag}\r\n            isConference={isConference}\r\n          />\r\n        </motion.div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoBox;\r\n"]},"metadata":{},"sourceType":"module"}