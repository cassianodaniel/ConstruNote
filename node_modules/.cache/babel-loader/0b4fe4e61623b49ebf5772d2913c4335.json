{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import React,{useEffect}from\"react\";import{SquadCommunicator as SquadService}from\"./SquadCommunicatorService\";import{useChat}from\"../contexts/ChatContext\";import{useAuth}from\"../contexts/AuthContext\";import{Events}from\"./chat/types/types\";import ChatType from\"./../enuns/ChatType\";import DeliverStatus from\"../enuns/DeliverStatus\";import{ChatType as XMPPChatType}from\"./chat/types/types\";import{getFileName,getUrlBooleans,isUrl}from\"./utils/parseUtils\";import ReadStatus from\"../enuns/ReadStatus\";import{useGroup}from\"../contexts/GroupContext\";import{useContact}from\"../contexts/ContactContext\";import{useModal}from\"../contexts/ModalContext\";import UserType from\"../enuns/UserType\";import{useConference}from\"../contexts/ConferenceContext\";import moment from\"moment\";import{ConferenceRoomParticipantType}from\"./business/Conferences\";import PresenceStatus from\"../enuns/PresenceStatus\";import{DateTime}from\"luxon\";import{useLoading}from\"../contexts/LoadingContext\";import{ParseUserTag}from\"../helpers/TextMessageTagParse\";// import { activeChat as actChtData } from \"../data/chat\";\n//import { callbackify } from \"util\";\n// import IContact from \"../alias/IContact\";\n//Comentar para Evitar Warnings no console\nvar squadService;var typingTimeout=new Map();var SquadCommunicator=function SquadCommunicator(){var _squadService66;var _useChat=useChat(),chats=_useChat.chats,setChats=_useChat.setChats,activeChat=_useChat.activeChat,replyMsg=_useChat.replyMsg,setReplyMsg=_useChat.setReplyMsg,setActiveChat=_useChat.setActiveChat,forwardMessageList=_useChat.forwardMessageList,setForwardMessageList=_useChat.setForwardMessageList,setShowChat=_useChat.setShowChat,showChatProfileSidebar=_useChat.showChatProfileSidebar,setFavoriteMessagePayload=_useChat.setFavoriteMessagePayload,favoriteMessagePayload=_useChat.favoriteMessagePayload,flagToLoadFavoriteMessages=_useChat.flagToLoadFavoriteMessages,setFlagToLoadFavoriteMessages=_useChat.setFlagToLoadFavoriteMessages,setFavoriteMessages=_useChat.setFavoriteMessages,deleteFavoriteMessage=_useChat.deleteFavoriteMessage,setDeleteFavoriteMessage=_useChat.setDeleteFavoriteMessage;var _useContact=useContact(),contactsSearch=_useContact.contactsSearch,setContactsSearched=_useContact.setContactsSearched,newFavorite=_useContact.newFavorite,setNewFavorite=_useContact.setNewFavorite,contacts=_useContact.contacts,setContacts=_useContact.setContacts,setContactsOutsideUserContacts=_useContact.setContactsOutsideUserContacts,toggleAddingContacts=_useContact.toggleAddingContacts,setToggleAddingContacts=_useContact.setToggleAddingContacts,checkedContacts=_useContact.checkedContacts,setCheckedContacts=_useContact.setCheckedContacts,removedContact=_useContact.removedContact,setRemovedContact=_useContact.setRemovedContact,checkedMembers=_useContact.checkedMembers,setCheckedMembers=_useContact.setCheckedMembers,groupToInsertMember=_useContact.groupToInsertMember,setGroupToInsertMember=_useContact.setGroupToInsertMember,clickedContact=_useContact.clickedContact,setClickedContact=_useContact.setClickedContact;var _useAuth=useAuth(),user=_useAuth.user,setUser=_useAuth.setUser,changedUserData=_useAuth.changedUserData,changedUserPassword=_useAuth.changedUserPassword,setChangedUserPassword=_useAuth.setChangedUserPassword;var _useModal=useModal(),showModalForwardMessageTo=_useModal.showModalForwardMessageTo,setShowModalForwardMessageTo=_useModal.setShowModalForwardMessageTo,showModalAddContact=_useModal.showModalAddContact;var _useLoading=useLoading(),setDisconnected=_useLoading.setDisconnected;var _useGroup=useGroup(),setGroups=_useGroup.setGroups,groups=_useGroup.groups,memberQuit=_useGroup.memberQuit,groupIdOfLeaveRequest=_useGroup.groupIdOfLeaveRequest,setGroupIdOfLeaveRequest=_useGroup.setGroupIdOfLeaveRequest,setMemberQuit=_useGroup.setMemberQuit,groupToRemoveContact=_useGroup.groupToRemoveContact,setGroupToRemoveContact=_useGroup.setGroupToRemoveContact,removedMember=_useGroup.removedMember,setRemovedMember=_useGroup.setRemovedMember,toggleMemberRole=_useGroup.toggleMemberRole,setToggleMemberRole=_useGroup.setToggleMemberRole,changeGroupData=_useGroup.changeGroupData,setChangeGroupData=_useGroup.setChangeGroupData,groupToCreate=_useGroup.groupToCreate,setGroupToCreate=_useGroup.setGroupToCreate,groupJid=_useGroup.groupJid,setGroupJid=_useGroup.setGroupJid;var _useConference=useConference(),listRooms=_useConference.listRooms,setListRooms=_useConference.setListRooms,setConferenceList=_useConference.setConferenceList,setCreateConference=_useConference.setCreateConference,createConference=_useConference.createConference,conferenceToUpdate=_useConference.conferenceToUpdate,setConferenceToUpdate=_useConference.setConferenceToUpdate,conferenceToRemove=_useConference.conferenceToRemove,setConferenceToRemove=_useConference.setConferenceToRemove;var init=function init(){var _squadService;/* localStorage.setItem(\r\n        \"authorization\",\r\n        JSON.stringify({\r\n          access_token: \"c9b0dbe6bd8d38110a9a76d2bbed2b48\",\r\n          baseUrl: \"https://app.citrussquad.com/api/v1/\",\r\n          email: \"romero2@digivox.com.br\",\r\n          expires_in: 2592000,\r\n          user_id: \"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",\r\n          user_name: \"ZZ Romero 2\",\r\n        })\r\n      ); */squadService=SquadService.getInstance({chatCommunicatorSubscribe:chatCommunicatorSubscribe});(_squadService=squadService)===null||_squadService===void 0?void 0:_squadService.user.get(function(user){setUser(user);//Ao iniciar o website\nNotification.requestPermission();});};var clearSendFile=function clearSendFile(chatId,messageId){setChats(chats.map(function(chat){if(chat.id===chatId){chat.messages=chat.messages.map(function(message){if(message.id===messageId){message.deliverStatus=DeliverStatus.QUEUED;message.sendFile=undefined;}return message;});}return chat;}));};var onChatsChange=function onChatsChange(){// chats.forEach((chat) => {\n// });\n};var onActiveChatChange=function onActiveChatChange(){checkSendMessage(activeChat);checkAttachedFiles(activeChat);checkNewContact(activeChat);// checkTyping(activeChat)\n};// const checkTyping = (chat: IChat) => {\n//   const oldTimeoutData = typingTimeout.get(chat.jid)\n//   if (chat.inputMessage !== \"\" && (!oldTimeoutData || (oldTimeoutData.msgStr !== chat.inputMessage))) {\n//     if (oldTimeoutData)\n//       clearTimeout(oldTimeoutData.timeout)\n//     else\n//       squadService?.chat?.chat.sendTyping(chat.jid)\n//     const timeoutData = {\n//       timeout: setTimeout(() => { squadService?.chat?.chat.sendActive(chat.jid); typingTimeout.delete(chat.jid) }, 3000),\n//       msgStr: `${chat.inputMessage}`\n//     }\n//     typingTimeout.set(chat.jid, timeoutData)\n//   }\n// }\nvar checkNewContact=function checkNewContact(cht){if(!cht.added){var _squadService2;(_squadService2=squadService)===null||_squadService2===void 0?void 0:_squadService2.contacts.add(cht,function(success){if(success){var _squadService3;setChats(chats.map(function(chat){if(chat.jid===cht.jid){chat.added=true;}if(activeChat.jid===chat.jid)setActiveChat(chat);return chat;}));(_squadService3=squadService)===null||_squadService3===void 0?void 0:_squadService3.contacts.list(function(ctcs){setContacts(ctcs);});}});}};var checkAttachedFiles=function checkAttachedFiles(cht){if(cht.attachedFileList&&!cht.attachedFileList[0]){var _squadService4;(_squadService4=squadService)===null||_squadService4===void 0?void 0:_squadService4.attachments.list(cht,function(attachments){if(attachments.length>0){setActiveChat(_objectSpread(_objectSpread({},cht),{},{attachedFileList:attachments}));}else setActiveChat(_objectSpread(_objectSpread({},cht),{},{attachedFileList:null}));});}};/* getMessageUserProfilePicture = (msg: Message | FileMessage) => {\r\n    if (msg.from.includes(\"@conference.\")) {\r\n      const groups = this.groups.getGroups();\r\n      const group = groups.get(msg.from.split(\"@\")[0]);\r\n      const member = group?.members.filter(\r\n        (member) => member.userId === msg.from.split(\"/\")[1]\r\n      )[0];\r\n      return member?.profilePicture;\r\n    } else {\r\n      return this.contacts.getContacts().get(msg.from.split(\"@\")[0])\r\n        ?.profilePicture;\r\n    }\r\n  }; */var checkSearchMessages=function checkSearchMessages(){if(activeChat.messageLoaded){var _squadService5;(_squadService5=squadService)===null||_squadService5===void 0?void 0:_squadService5.messages.list(activeChat,function(messages){if(messages.length){setChats(chats.map(function(cht){if(cht.id===activeChat.id){messages.forEach(function(msg){if(!activeChat.messages.find(function(m){return m.id===msg.id;}))cht.messages.unshift(msg);});cht.messageLoaded=false;setActiveChat(cht);}return cht;}));}else{var chat=_objectSpread(_objectSpread({},activeChat),{},{messageLoaded:false});setActiveChat(chat);}});}};var getFileExtension=function getFileExtension(url){return url.split(\".\")[1];};var checkSendMessage=function checkSendMessage(chat){chat.messages.forEach(function(msg){if(msg.deliverStatus===DeliverStatus.SENDING){if(msg.sendFile&&!replyMsg){var _squadService6,_squadService6$chat;var files=[msg.sendFile];clearSendFile(chat.id,msg.id);(_squadService6=squadService)===null||_squadService6===void 0?void 0:(_squadService6$chat=_squadService6.chat)===null||_squadService6$chat===void 0?void 0:_squadService6$chat.sendFiles(chat,files,function(data){var _squadService7,_squadService7$user$u,_squadService8,_squadService$user$us;updateMessageFiles(data,chat,msg);console.log(\"jidFromUser:\",(_squadService7=squadService)===null||_squadService7===void 0?void 0:(_squadService7$user$u=_squadService7.user.user)===null||_squadService7$user$u===void 0?void 0:_squadService7$user$u.jid);(_squadService8=squadService)===null||_squadService8===void 0?void 0:_squadService8.attachments.saveData({createdAt:DateTime.local().toISO().split(\"T\").join(\" \").slice(0,18),src:(_squadService$user$us=squadService.user.user)===null||_squadService$user$us===void 0?void 0:_squadService$user$us.jid,dst:chat.jid,fileExtension:getFileExtension(getFileName(data.url)),fileName:getFileName(data.url),fileUrl:data.url,kind:chat.chatType},function(){return true;});});}else{if(!msg.isForwardMessage&&!replyMsg){sendMessage(chat,msg.message,function(msgId){return updateMessage(msgId,chat,msg);});}else if(replyMsg){var _squadService9,_squadService9$chat;var replyMsgCopy=_objectSpread({},replyMsg);setReplyMsg(undefined);(_squadService9=squadService)===null||_squadService9===void 0?void 0:(_squadService9$chat=_squadService9.chat)===null||_squadService9$chat===void 0?void 0:_squadService9$chat.replyMsg(chat,msg,replyMsgCopy,function(msgId){updateMessage(msgId,chat,msg,replyMsgCopy);});}}}});};var updateMessageFiles=function updateMessageFiles(data,chat,msg){var newChat=_objectSpread({},chat);newChat.messages=chat.messages.map(function(message){if(msg.id===message.id){var booleans=getUrlBooleans(data.url);message.id=data.msgId;message.fileUrl=data.url;message.deliverStatus=DeliverStatus.QUEUED;message.time=new Date().toISOString();message.message=getFileName(data.url);message.isFileMessage=booleans.isFileMessage;message.isImageMessage=booleans.isImageMessage;message.isVideoMessage=booleans.isVideoMessage;message.isAudioMessage=booleans.isAudioMessage;}return message;});setActiveChat(newChat);if(!chats.filter(function(cht){return cht.id===chat.id;})[0]){var newChats=[chat].concat(_toConsumableArray(chats));setChats(newChats);}else{var _newChats=[];chats.forEach(function(cht){if(cht.id===chat.id){cht.messages=newChat.messages;_newChats.unshift(cht);}else{_newChats.push(cht);}});setChats(_newChats);}};var updateMessage=function updateMessage(msgId,chat,msg){var replyedMsg=arguments.length>3&&arguments[3]!==undefined?arguments[3]:undefined;var newChat=_objectSpread({},chat);newChat.messages=chat.messages.map(function(message){if(msg.id===message.id){message.id=msgId;message.deliverStatus=DeliverStatus.QUEUED;message.time=new Date().toISOString();if(replyedMsg){var _squadService10,_squadService10$conta,_squadService11,_squadService11$user,_squadService11$user$,_squadService12,_squadService12$user,_squadService12$user$;message.isReplyMessage=true;message.replyedMessage=replyedMsg.message||replyedMsg.fileUrl;message.replyedMessageId=replyedMsg.id;message.replyedMessageTo=((_squadService10=squadService)===null||_squadService10===void 0?void 0:(_squadService10$conta=_squadService10.contacts.getContacts().get(replyedMsg.fromUser.split(\"@\")[0]))===null||_squadService10$conta===void 0?void 0:_squadService10$conta.name)||((_squadService11=squadService)===null||_squadService11===void 0?void 0:(_squadService11$user=_squadService11.user)===null||_squadService11$user===void 0?void 0:(_squadService11$user$=_squadService11$user.user)===null||_squadService11$user$===void 0?void 0:_squadService11$user$.id)===replyedMsg.fromUser.split(\"@\")[0]?(_squadService12=squadService)===null||_squadService12===void 0?void 0:(_squadService12$user=_squadService12.user)===null||_squadService12$user===void 0?void 0:(_squadService12$user$=_squadService12$user.user)===null||_squadService12$user$===void 0?void 0:_squadService12$user$.name:\"Participant\";}if(isUrl(message.message)){var booleans=getUrlBooleans(message.message);message.isFileMessage=booleans.isFileMessage;message.isImageMessage=booleans.isImageMessage;message.isAudioMessage=booleans.isAudioMessage;message.isVideoMessage=booleans.isVideoMessage;message.fileUrl=message.message;}}return message;});if(activeChat.jid===newChat.jid)setActiveChat(newChat);if(!chats.filter(function(cht){return cht.id===chat.id;})[0]){var newChats=[chat].concat(_toConsumableArray(chats));setChats(newChats);}else{var _newChats2=[];chats.forEach(function(cht){if(cht.id===chat.id){cht.messages=newChat.messages;_newChats2.unshift(cht);}else{_newChats2.push(cht);}});setChats(_newChats2);}};var forwardMessage=function forwardMessage(){if(forwardMessageList&&showModalForwardMessageTo){var ctcs=_toConsumableArray(forwardMessageList);var message=_objectSpread({},showModalForwardMessageTo);setForwardMessageList(undefined);setShowModalForwardMessageTo(undefined);var chatsFinded=[];var oldChats=_toConsumableArray(chats.map(function(chat){return _objectSpread({},chat);}));ctcs===null||ctcs===void 0?void 0:ctcs.forEach(function(ctc,i){var cht=oldChats.find(function(cht){return cht.jid===ctc.jid;});if(cht){var _squadService13,_squadService13$chat;var msg=_objectSpread(_objectSpread({},message),{},{id:\"\".concat(cht.messages.length+1),userName:user.name,fromUser:user.id,toUser:ctc.jid.split(\"@\")[0],message:message.fileUrl||message.message,deliverStatus:DeliverStatus.QUEUED,isForwardMessage:true});(_squadService13=squadService)===null||_squadService13===void 0?void 0:(_squadService13$chat=_squadService13.chat)===null||_squadService13$chat===void 0?void 0:_squadService13$chat.forwardMessage(cht,msg,function(msgId){msg.id=msgId;cht.messages.push(msg);chatsFinded.push(cht);});}});var newChats=oldChats.map(function(chat){return chatsFinded.find(function(cht){return cht.id===chat.id;})||chat;});var ctcsNotInChat=ctcs.filter(function(ctc){return!newChats.find(function(cht){return ctc.jid===cht.jid;});});ctcsNotInChat.forEach(function(ctc,i){var _squadService14,_squadService14$chat;var chat={id:ctc.jid.split(\"@\")[0],jid:ctc.jid,name:ctc.name,profilePicture:ctc.profilePicture,status:ctc.status||undefined,unRead:0,chatType:ctc.jid.includes(\"@conference.\")?ChatType.GROUP:ChatType.USER,inputMessage:\"\",messageLoaded:false,isTyping:false,messages:[],email:ctc.email||undefined,favorite:ctc.favorite,added:ctc.added,mencioned:0};var newMessage=_objectSpread(_objectSpread({},message),{},{id:\"\".concat(1),userName:user.name,fromUser:user.id,toUser:ctc.jid.split(\"@\")[0],deliverStatus:DeliverStatus.QUEUED,isForwardMessage:true});(_squadService14=squadService)===null||_squadService14===void 0?void 0:(_squadService14$chat=_squadService14.chat)===null||_squadService14$chat===void 0?void 0:_squadService14$chat.forwardMessage(chat,newMessage,function(msgId){newMessage.id=msgId;chat.messages.push(newMessage);newChats.unshift(chat);});});setChats(newChats);}};var onChangeStatus=function onChangeStatus(){var _squadService15,_squadService15$chat,_squadService15$chat$,_squadService15$chat$2;if(((_squadService15=squadService)===null||_squadService15===void 0?void 0:(_squadService15$chat=_squadService15.chat)===null||_squadService15$chat===void 0?void 0:(_squadService15$chat$=_squadService15$chat.chat)===null||_squadService15$chat$===void 0?void 0:(_squadService15$chat$2=_squadService15$chat$.client)===null||_squadService15$chat$2===void 0?void 0:_squadService15$chat$2.status)===\"online\"){var _squadService16,_squadService16$chat;(_squadService16=squadService)===null||_squadService16===void 0?void 0:(_squadService16$chat=_squadService16.chat)===null||_squadService16$chat===void 0?void 0:_squadService16$chat.changeStatus(user.status);}};var onSearchContacts=function onSearchContacts(){if(contactsSearch.length>2){var _squadService17;(_squadService17=squadService)===null||_squadService17===void 0?void 0:_squadService17.contacts.search(contactsSearch,function(searchList){setContactsSearched(searchList);});}else{setContactsSearched(undefined);}};var onSearchContactsOutsideUserContacts=function onSearchContactsOutsideUserContacts(){var _squadService18;(_squadService18=squadService)===null||_squadService18===void 0?void 0:_squadService18.contacts.getContactsOutsideUserLists(function(contacts){if(contacts){setContactsOutsideUserContacts(contacts);}});};var onToggleSidebarMenu=function onToggleSidebarMenu(){var _squadService19;(_squadService19=squadService)===null||_squadService19===void 0?void 0:_squadService19.contacts.getContactsOutsideUserLists(function(contacts){if(contacts){setContactsOutsideUserContacts(contacts);}});};var onRemovingMember=function onRemovingMember(){if(removedMember&&groupToRemoveContact){var _squadService20;var group=groups.find(function(grp){return grp.groupId===groupToRemoveContact;});if(group)(_squadService20=squadService)===null||_squadService20===void 0?void 0:_squadService20.groups.removeMember(group.groupId,removedMember,function(success){if(success){setGroups(groups.map(function(grp){if(grp.groupId===(group===null||group===void 0?void 0:group.groupId))grp.members=grp.members.filter(function(mb){return mb.userId!==removedMember.userId;});return grp;}));setChats(chats.map(function(cht){if(cht.groupId===(group===null||group===void 0?void 0:group.groupId)){var _cht$members;cht.members=(_cht$members=cht.members)===null||_cht$members===void 0?void 0:_cht$members.filter(function(mb){return mb.userId!==removedMember.userId;});if(cht.groupId===activeChat.groupId)setActiveChat(cht);}return cht;}));if(group){var _squadService21,_squadService21$chat;(_squadService21=squadService)===null||_squadService21===void 0?void 0:(_squadService21$chat=_squadService21.chat)===null||_squadService21$chat===void 0?void 0:_squadService21$chat.chat.sendEvent(group===null||group===void 0?void 0:group.jid,removedMember.userId,\"6\");}setRemovedMember(undefined);setGroupToRemoveContact(undefined);}});}};var onLeavingGroup=function onLeavingGroup(){if(memberQuit&&groupIdOfLeaveRequest&&groupJid){var _squadService22;(_squadService22=squadService)===null||_squadService22===void 0?void 0:_squadService22.groups.leftingGroup({groupId:groupIdOfLeaveRequest,memberId:memberQuit.userId},function(success){if(success){var _squadService23,_squadService23$chat,_squadService24,_squadService24$chat;(_squadService23=squadService)===null||_squadService23===void 0?void 0:(_squadService23$chat=_squadService23.chat)===null||_squadService23$chat===void 0?void 0:_squadService23$chat.chat.sendPresence(PresenceStatus.UNAVAILABLE,\"\".concat(groupJid,\"/\").concat(memberQuit.userId));(_squadService24=squadService)===null||_squadService24===void 0?void 0:(_squadService24$chat=_squadService24.chat)===null||_squadService24$chat===void 0?void 0:_squadService24$chat.chat.sendEvent(groupIdOfLeaveRequest,memberQuit.userId,\"3\",undefined);setChats(chats.filter(function(cht){return cht.groupId!==groupIdOfLeaveRequest;}));setGroups(groups.filter(function(grp){return grp.groupId!==groupIdOfLeaveRequest;}));if(activeChat.groupId===groupIdOfLeaveRequest){setShowChat(false);}}setGroupJid(undefined);setMemberQuit(undefined);setGroupIdOfLeaveRequest(\"\");});}};var showNotification=function showNotification(name){if(Notification.permission===\"granted\"){new Notification(\"Nova mensagem\",{body:name,icon:require(\"../assets/images/logo.png\"),silent:true});}else{Notification.requestPermission();}};var onFavoriteMessage=function onFavoriteMessage(){if(favoriteMessagePayload){var _squadService25;(_squadService25=squadService)===null||_squadService25===void 0?void 0:_squadService25.messages.save(favoriteMessagePayload,function(success){if(success){setFavoriteMessagePayload(undefined);setFlagToLoadFavoriteMessages({contactType:favoriteMessagePayload.contactType});}});}};var onAddingMembers=function onAddingMembers(){var asynchronousFlag=0;if(checkedMembers&&groupToInsertMember){var copiaCheckedMembers=_toConsumableArray(checkedMembers),copiaGroupToInsertMember=_objectSpread({},groupToInsertMember);copiaCheckedMembers.forEach(function(ctt){var _squadService26;(_squadService26=squadService)===null||_squadService26===void 0?void 0:_squadService26.groups.addMember(copiaGroupToInsertMember,ctt,function(success){if(success){var _squadService27,_squadService27$chat;(_squadService27=squadService)===null||_squadService27===void 0?void 0:(_squadService27$chat=_squadService27.chat)===null||_squadService27$chat===void 0?void 0:_squadService27$chat.chat.sendEvent(copiaGroupToInsertMember.jid,ctt.id,\"2\");asynchronousFlag++;if(copiaCheckedMembers.length===asynchronousFlag){var _squadService28;(_squadService28=squadService)===null||_squadService28===void 0?void 0:_squadService28.groups.list(function(grps){setGroups(grps);setChats(chats.map(function(cht){if(cht.groupId===copiaGroupToInsertMember.groupId){var foundedGroup=grps.find(function(grp){return grp.groupId===cht.groupId;});cht.members=foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.members;if(activeChat.groupId===cht.groupId){activeChat.members=foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.members;setActiveChat(activeChat);}}return cht;}));});}}});});setCheckedMembers([]);setToggleAddingContacts(false);setGroupToInsertMember(undefined);}};var onAddingContacts=function onAddingContacts(){var asynchronousFlag=0;if(checkedContacts&&toggleAddingContacts){checkedContacts.forEach(function(ctt){if(!ctt.added){var _squadService29;(_squadService29=squadService)===null||_squadService29===void 0?void 0:_squadService29.contacts.addContacts(ctt,function(success){if(success){asynchronousFlag++;if(checkedContacts.length===asynchronousFlag){var _squadService30;(_squadService30=squadService)===null||_squadService30===void 0?void 0:_squadService30.contacts.list(function(contacts){setContacts(contacts);setCheckedContacts([]);setToggleAddingContacts(false);});}}});}});}};var onAddingContactOnGroupList=function onAddingContactOnGroupList(){if(clickedContact){if(!clickedContact.added){var _squadService31;(_squadService31=squadService)===null||_squadService31===void 0?void 0:_squadService31.contacts.addContacts(clickedContact,function(success){if(success){var _squadService32;(_squadService32=squadService)===null||_squadService32===void 0?void 0:_squadService32.contacts.list(function(contacts){setContacts(contacts);setClickedContact(undefined);});}});}}};var onToggleMemberRole=function onToggleMemberRole(){if(toggleMemberRole){var _squadService33;(_squadService33=squadService)===null||_squadService33===void 0?void 0:_squadService33.groups.list(function(grps){grps.forEach(function(gp){if(gp.groupId===toggleMemberRole.gpId){gp.members.forEach(function(mb){if(mb.userId===toggleMemberRole.mbId){var _squadService34;(_squadService34=squadService)===null||_squadService34===void 0?void 0:_squadService34.contacts.toggleMemberRole(toggleMemberRole.mbId,toggleMemberRole.gpId,toggleMemberRole.mbRole,function(success){if(success){var newRole=toggleMemberRole.mbRole===UserType.USER?UserType.ADMIN:UserType.USER;setToggleMemberRole(undefined);setChats(chats.map(function(cht){if(cht.groupId===toggleMemberRole.gpId){var _cht$members2;cht.members=(_cht$members2=cht.members)===null||_cht$members2===void 0?void 0:_cht$members2.map(function(mb){if(mb.userId===toggleMemberRole.mbId){mb.role=newRole;if(cht.groupId){if(mb.role===UserType.ADMIN){var _squadService35,_squadService35$chat;(_squadService35=squadService)===null||_squadService35===void 0?void 0:(_squadService35$chat=_squadService35.chat)===null||_squadService35$chat===void 0?void 0:_squadService35$chat.chat.sendEvent(cht.groupId,mb.userId,\"8\");}else{var _squadService36,_squadService36$chat;(_squadService36=squadService)===null||_squadService36===void 0?void 0:(_squadService36$chat=_squadService36.chat)===null||_squadService36$chat===void 0?void 0:_squadService36$chat.chat.sendEvent(cht.groupId,mb.userId,\"9\");}}}return mb;});if(activeChat.groupId===cht.groupId)setActiveChat(cht);}return cht;}));setGroups(groups.map(function(grp){if(grp.groupId===toggleMemberRole.gpId){grp.members=grp.members.map(function(member){if(member.userId===toggleMemberRole.mbId)member.role=newRole;return member;});}return grp;}));}});}});}});});}};var onChangeGroupData=function onChangeGroupData(){if(changeGroupData){var _squadService37;(_squadService37=squadService)===null||_squadService37===void 0?void 0:_squadService37.groups.editGroupInfo({groupId:changeGroupData.groupId,groupName:changeGroupData.groupName,members:changeGroupData.members,description:changeGroupData.description},function(success){if(success){var _squadService38;(_squadService38=squadService)===null||_squadService38===void 0?void 0:_squadService38.groups.list(function(grps){var _squadService39,_squadService39$chat;var foundedGroup=grps.find(function(grp){return grp.groupId===changeGroupData.groupId;});setGroups(grps);setChats(chats.map(function(cht){if(cht.groupId===changeGroupData.groupId){if(foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.name){cht.name=foundedGroup.name;}if(activeChat.groupId===cht.groupId){if(foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.name){cht.name=foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.name;}setActiveChat(cht);}}return cht;}));(_squadService39=squadService)===null||_squadService39===void 0?void 0:(_squadService39$chat=_squadService39.chat)===null||_squadService39$chat===void 0?void 0:_squadService39$chat.chat.sendEvent(foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.jid,undefined,\"10\",undefined);setChangeGroupData(undefined);});}});}};var createGroup=function createGroup(){var _squadService40;(_squadService40=squadService)===null||_squadService40===void 0?void 0:_squadService40.groups.create(groupToCreate,function(parsedGroup){if(parsedGroup){var _squadService41,_squadService41$chat,_squadService42,_squadService43,_squadService43$chat;(_squadService41=squadService)===null||_squadService41===void 0?void 0:(_squadService41$chat=_squadService41.chat)===null||_squadService41$chat===void 0?void 0:_squadService41$chat.chat.sendEvent(parsedGroup.jid,parsedGroup.jid,\"1\");(_squadService42=squadService)===null||_squadService42===void 0?void 0:_squadService42.groups.list(function(groups){setGroups(groups);setGroupToCreate(undefined);});(_squadService43=squadService)===null||_squadService43===void 0?void 0:(_squadService43$chat=_squadService43.chat)===null||_squadService43$chat===void 0?void 0:_squadService43$chat.chat.sendEvent(parsedGroup.jid,undefined,\"1\",undefined);}});};var onListRooms=function onListRooms(){if(listRooms){var _squadService44;(_squadService44=squadService)===null||_squadService44===void 0?void 0:_squadService44.conferences.list(function(conferences){var _squadService45,_squadService45$chat;setConferenceList(conferences);(_squadService45=squadService)===null||_squadService45===void 0?void 0:(_squadService45$chat=_squadService45.chat)===null||_squadService45$chat===void 0?void 0:_squadService45$chat.joinGroups(conferences.map(function(conf){return conf.jid;}));});setListRooms(false);}};var onCreateRoom=function onCreateRoom(){if(createConference){var _squadService46;var momentStartDate=moment(\"\".concat(createConference.startDate,\" \").concat(createConference.startTime,\":00\"));var momentFinalDate=moment(momentStartDate).add(parseInt(createConference.duration.split(\":\")[0]),\"hours\").add(parseInt(createConference.duration.split(\":\")[1]),\"minutes\");var parsedConference={name:createConference.name,waitMod:createConference.mdCheck,startDatetime:\"\".concat(momentStartDate.format(\"DD/MM/YYYY HH:mm:ss\")),stopDatetime:\"\".concat(momentFinalDate.format(\"DD/MM/YYYY HH:mm:ss\"))};(_squadService46=squadService)===null||_squadService46===void 0?void 0:_squadService46.conferences.create(parsedConference,function(createdConference){var participantList=[];if(createdConference===null||createdConference===void 0?void 0:createdConference.id){var _createConference$sel,_createConference$ema,_squadService47;(_createConference$sel=createConference.selectedContact)===null||_createConference$sel===void 0?void 0:_createConference$sel.forEach(function(ctc){participantList.push({userUuid:ctc.id,description:\"\",email:ctc.email,name:ctc.name,type:ConferenceRoomParticipantType.PARTICIPANT,userModerator:false});});(_createConference$ema=createConference.emailList)===null||_createConference$ema===void 0?void 0:_createConference$ema.forEach(function(participant){participantList.push({userUuid:null,description:\"\",email:participant.email,name:participant.name,type:ConferenceRoomParticipantType.PARTICIPANT_EXTERNAL,userModerator:false});});(_squadService47=squadService)===null||_squadService47===void 0?void 0:_squadService47.conferences.addParticipants(createdConference.id,participantList,function(s){if(s){setCreateConference(undefined);setListRooms(true);}});}});}};useEffect(onChatsChange,[chats]);useEffect(onNewFavorite,[newFavorite]);useEffect(checkSearchMessages,[activeChat.messageLoaded]);useEffect(onActiveChatChange,[activeChat]);useEffect(onUserDataChange,[changedUserData]);useEffect(onUserPasswordChange,[changedUserPassword]);useEffect(onChangeStatus,[user.status]);useEffect(forwardMessage,[forwardMessageList]);useEffect(onSearchContacts,[contactsSearch]);useEffect(onSearchContactsOutsideUserContacts,[showModalAddContact]);useEffect(onAddingContacts,[toggleAddingContacts]);useEffect(onRemovingMember,[removedMember,groupToRemoveContact]);useEffect(onLeavingGroup,[memberQuit,groupIdOfLeaveRequest,groupJid]);useEffect(onRemovingContact,[removedContact]);useEffect(onAddingMembers,[groupToInsertMember,checkedMembers]);useEffect(onToggleMemberRole,[toggleMemberRole]);useEffect(onChangeGroupData,[changeGroupData]);useEffect(onAddingContactOnGroupList,[clickedContact]);useEffect(createGroup,[groupToCreate]);useEffect(onToggleSidebarMenu,[showChatProfileSidebar]);useEffect(onListRooms,[listRooms]);useEffect(onCreateRoom,[createConference]);useEffect(onFavoriteMessage,[favoriteMessagePayload]);useEffect(onListFavoriteMessages,[flagToLoadFavoriteMessages]);useEffect(onRemoveFavoriteMessage,[deleteFavoriteMessage]);useEffect(onUpdatingConference,[conferenceToUpdate]);useEffect(onRemovingConference,[conferenceToRemove]);function onUpdatingConference(){if(conferenceToUpdate){var _squadService48;/* const parsedConference = {\r\n        name: createConference.name,\r\n        waitMod: createConference.mdCheck,\r\n        startDatetime: `${momentStartDate.format(\"DD/MM/YYYY HH:mm:ss\")}`,\r\n        stopDatetime: `${momentFinalDate.format(\"DD/MM/YYYY HH:mm:ss\")}`,\r\n      }; */(_squadService48=squadService)===null||_squadService48===void 0?void 0:_squadService48.conferences.update(conferenceToUpdate.id,{name:conferenceToUpdate.name,waitMod:conferenceToUpdate.waitMod,startDatetime:conferenceToUpdate.startDatetime,stopDatetime:conferenceToUpdate.stopDatetime},function(successOnUpdate){if(successOnUpdate){setListRooms(true);setConferenceToUpdate(undefined);}});}}function onRemovingConference(){if(conferenceToRemove){var _squadService49;(_squadService49=squadService)===null||_squadService49===void 0?void 0:_squadService49.conferences.remove(conferenceToRemove.id,function(successOnRemove){if(successOnRemove){setListRooms(true);setConferenceToRemove(undefined);}});}}function onRemoveFavoriteMessage(){if(deleteFavoriteMessage){var _squadService50;(_squadService50=squadService)===null||_squadService50===void 0?void 0:_squadService50.messages.deleteFavorite({messageId:deleteFavoriteMessage===null||deleteFavoriteMessage===void 0?void 0:deleteFavoriteMessage.messageId},function(success){if(success){setFlagToLoadFavoriteMessages({contactType:deleteFavoriteMessage===null||deleteFavoriteMessage===void 0?void 0:deleteFavoriteMessage.contactType});setDeleteFavoriteMessage(undefined);}});}}function onListFavoriteMessages(){if(flagToLoadFavoriteMessages){var _squadService51;(_squadService51=squadService)===null||_squadService51===void 0?void 0:_squadService51.messages.listFavorites({contactTo:\"\",contactType:\"\",content:\"\",contentType:\"\",messageDate:\"\",messageId:\"\",message:\"\"},function(success){if(success){setFavoriteMessages(success.messages.map(function(item){return item;}));setFlagToLoadFavoriteMessages(undefined);}});}}function onRemovingContact(){if(removedContact){contacts.forEach(function(ctc){if(ctc.id===removedContact.id){var _squadService52;if(ctc.added)(_squadService52=squadService)===null||_squadService52===void 0?void 0:_squadService52.contacts.remove(ctc,function(success){if(success){var _squadService53;(_squadService53=squadService)===null||_squadService53===void 0?void 0:_squadService53.contacts.list(function(ctcs){setContacts(ctcs);setRemovedContact(undefined);});}});}});}}function onUserPasswordChange(){if(changedUserPassword){var _squadService54;(_squadService54=squadService)===null||_squadService54===void 0?void 0:_squadService54.user.changePassword(changedUserPassword,function(password){if(password){setChangedUserPassword({oldPassword:\"\",newPassword:\"\"});}});}}function onUserDataChange(){if(changedUserData){var _squadService55;(_squadService55=squadService)===null||_squadService55===void 0?void 0:_squadService55.user.changeUserData(changedUserData,function(chgd){if(chgd){setUser(_objectSpread(_objectSpread({},user),{},{email:changedUserData.email,name:changedUserData.name}));}});}}function onNewFavorite(){if(newFavorite){var _squadService56;var newFavoriteLoad=_objectSpread({},newFavorite);(_squadService56=squadService)===null||_squadService56===void 0?void 0:_squadService56.contacts.setFavorite(newFavorite,function(favorite){if(favorite){setChats(chats.map(function(cht){if(cht.jid===newFavoriteLoad.jid){cht.favorite=!newFavoriteLoad.favorite;}return cht;}));setGroups(groups.map(function(grp){if(grp.jid===newFavoriteLoad.jid){return _objectSpread(_objectSpread({},grp),{},{favorite:!newFavoriteLoad.favorite});}return grp;}));setContacts(contacts.map(function(ctt){if(ctt.jid===newFavoriteLoad.jid){return _objectSpread(_objectSpread({},ctt),{},{favorite:!newFavoriteLoad.favorite});}return ctt;}));}});setNewFavorite(undefined);}}function chatCommunicatorSubscribe(evt,data){var _squadService57;switch(evt){case Events.RECONNECTED:setDisconnected(false);// eslint-disable-next-line\ncase Events.ONLINE:(_squadService57=squadService)===null||_squadService57===void 0?void 0:_squadService57.chats.list(function(receivedChats){var _squadService58,_squadService60;var chats=[];receivedChats.forEach(function(cht){if(!chats.find(function(chat){return chat.id===cht.id;})){chats.push(cht);}});setChats(chats);//populating groups\n(_squadService58=squadService)===null||_squadService58===void 0?void 0:_squadService58.groups.list(function(groups){var _squadService59,_squadService59$chat;setGroups(groups);//Joining Groups Rooms in XMPP\n(_squadService59=squadService)===null||_squadService59===void 0?void 0:(_squadService59$chat=_squadService59.chat)===null||_squadService59$chat===void 0?void 0:_squadService59$chat.joinGroups(groups.map(function(group){return group.jid;}));});//populating contacts\n(_squadService60=squadService)===null||_squadService60===void 0?void 0:_squadService60.contacts.list(function(contacts){setContacts(contacts);});//populating conferences\nsetListRooms(true);setFlagToLoadFavoriteMessages({contactType:\"\"});});break;case Events.ERROR:case Events.OFFLINE:if(localStorage.getItem(\"logout\")!==\"true\"){var _squadService61,_squadService61$chat;(_squadService61=squadService)===null||_squadService61===void 0?void 0:(_squadService61$chat=_squadService61.chat)===null||_squadService61$chat===void 0?void 0:_squadService61$chat.makeChat(chatCommunicatorSubscribe);}localStorage.removeItem(\"logout\");console.log(evt);break;case Events.RECONNECTING:// setShowChat(false);\n// setActiveChat(actChtData);\n// setChats([]);\n// setGroups([]);\n// setContacts([]);\n// setConferenceList([]);\nconsole.log(\"Reconnecting\");setDisconnected(true);break;case Events.MESSAGE:if(data.fromUser===user.jid)break;var find=false;var newChats=[];chats.forEach(function(chat){if(data.fromUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]||data.toUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]){find=true;if(!chat.messages.filter(function(msg){return msg.id===data.id;})[0])chat.messages.push(data);if(chat.id===activeChat.id){var chatTemporary=_objectSpread({},chat);setActiveChat(chatTemporary);}else{chat.unRead++;chat.mencioned+=ParseUserTag(user.id,data.message);showNotification(chat.name);}newChats.unshift(chat);}else{newChats.push(chat);}});if(!find){var _squadService62;var _newChat={};(_squadService62=squadService)===null||_squadService62===void 0?void 0:_squadService62.contacts.list(function(listContacts){listContacts.forEach(function(c){if(data.fromUser.split(\"@\")[0]===c.jid.split(\"@\")[0]||data.toUser.split(\"@\")[0]===c.jid.split(\"@\")[0]){if(c.jid===data.fromUser){find=true;_newChat={id:c.id,jid:c.jid,name:c.name,profilePicture:c.profilePicture,status:c.status,unRead:1,chatType:ChatType.USER,inputMessage:\"\",isTyping:false,messages:[],favorite:c.favorite,added:c.added,mencioned:0};_newChat.messages.push(data);newChats.unshift(_newChat);}}});});}if(!find){var _squadService63;var _newChat2={};(_squadService63=squadService)===null||_squadService63===void 0?void 0:_squadService63.groups.list(function(listGroups){listGroups.forEach(function(g){if(data.fromUser.split(\"@\")[0]===g.jid.split(\"@\")[0]||data.toUser.split(\"@\")[0]===g.jid.split(\"@\")[0]){if(g.jid===data.fromUser){find=true;_newChat2={id:g.groupId,jid:g.jid,name:g.name,profilePicture:g.profilePicture,attachedFileList:undefined,conferenceRoomParticipants:undefined,department:undefined,email:undefined,groupId:g.groupId,members:g.members,messageLoaded:undefined,userDescription:undefined,status:undefined,unRead:1,chatType:ChatType.GROUP,inputMessage:\"\",isTyping:false,messages:[],favorite:g.favorite,added:g.added,mencioned:0};_newChat2.messages.push(data);newChats.unshift(_newChat2);}}});});}setChats(newChats);break;case Events.RECEIVED:setChats(chats.map(function(chat){if(chat.messages.find(function(msg){return msg.id===data.id;}))chat.messages=chat.messages.map(function(message){message.deliverStatus=DeliverStatus.DELIVERED;return message;});return chat;}));break;case Events.DISPLAYED:setChats(chats.map(function(chat){if(chat.messages.find(function(msg){return msg.id===data.id;}))chat.messages=chat.messages.map(function(message){message.readStatus=ReadStatus.READ;return message;});return chat;}));break;case Events.COMPOSING:setChats(chats.map(function(chat){if(chat.jid===data){chat.isTyping=true;if(activeChat.jid===data)setActiveChat(chat);deleteTypingTimeout(chat.jid);setTypingTimeout(chat.jid);}return chat;}));break;case Events.ACTIVE:setChats(chats.map(function(chat){if(chat.jid===data){chat.isTyping=false;if(activeChat.jid===data){var chatUpdate=_objectSpread({},chat);setActiveChat(chatUpdate);}deleteTypingTimeout(chat.jid);}return chat;}));break;case Events.PRESENCE:setChats(chats.map(function(cht){if(cht.jid&&data.from){if(cht.jid===data.from.split(\"/\")[0]&&!cht.jid.includes(\"@conference.\")){cht.status=data.status;}}return cht;}));setContacts(contacts.map(function(ctc){if(ctc.jid&&data.from){if(ctc.jid===data.from.split(\"/\")[0]&&!ctc.jid.includes(\"@conference.\")){ctc.status=data.status;}}return ctc;}));break;case Events.SEND_EVENT:var event=data;var finded;var newChat=[];chats.forEach(function(chat){if(event.fromUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]||event.toUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]){finded=true;if(!chat.messages.filter(function(msg){return msg.id===event.id;})[0])chat.messages.push(event);if(chat.id===activeChat.id){var chatTemporary=_objectSpread({},chat);setActiveChat(chatTemporary);}else{chat.unRead++;chat.mencioned+=ParseUserTag(user.id,data.message);showNotification(chat.name);}newChat.unshift(chat);}else{newChat.push(chat);}});if(!finded){groups.forEach(function(grp){if(event.fromUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]||event.toUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]){finded=true;var groupToBeInserted={added:grp.added,chatType:ChatType.GROUP,favorite:grp.favorite,id:grp.groupId,inputMessage:\"\",isTyping:false,jid:grp.jid,messages:[event],name:grp.name,unRead:0,attachedFileList:undefined,department:undefined,email:undefined,groupId:grp.groupId,members:grp.members,messageLoaded:undefined,profilePicture:grp.profilePicture,status:undefined,userDescription:grp.description,mencioned:0};newChat.unshift(groupToBeInserted);setActiveChat(groupToBeInserted);}});}if(!finded){var _squadService64;(_squadService64=squadService)===null||_squadService64===void 0?void 0:_squadService64.groups.list(function(grps){setGroups(grps);grps.forEach(function(grp){if(event.fromUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]||event.toUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]){finded=true;var groupToBeInserted={added:grp.added,chatType:ChatType.GROUP,favorite:grp.favorite,id:grp.groupId,inputMessage:\"\",isTyping:false,jid:grp.jid,messages:[event],name:grp.name,unRead:1,attachedFileList:undefined,department:undefined,email:undefined,groupId:grp.groupId,members:grp.members,messageLoaded:undefined,profilePicture:grp.profilePicture,status:undefined,userDescription:grp.description,mencioned:0};newChat.unshift(groupToBeInserted);}});});}setChats(newChat);if(event.eventId===6||event.eventId===2){refreshMembers(event);}break;default:console.log(evt);break;}}var refreshMembers=function refreshMembers(event){var _squadService65;(_squadService65=squadService)===null||_squadService65===void 0?void 0:_squadService65.groups.list(function(grps){setGroups(grps);setChats(chats.map(function(chat){if(event.fromUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]||event.toUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]){var _grps$find;chat.members=(_grps$find=grps.find(function(grp){return grp.groupId===chat.id;}))===null||_grps$find===void 0?void 0:_grps$find.members;if(chat.id===activeChat.id){setActiveChat(chat);}}return chat;}));});};var deleteTypingTimeout=function deleteTypingTimeout(jid){var _typingTimeout$get;clearTimeout(((_typingTimeout$get=typingTimeout.get(jid))===null||_typingTimeout$get===void 0?void 0:_typingTimeout$get.timeout)||setTimeout(function(){},1));typingTimeout.delete(jid);};var setTypingTimeout=function setTypingTimeout(jid){var timeoutData={msgStr:\"\",timeout:setTimeout(function(){setChats(chats.map(function(cht){if(cht.jid===jid){cht.isTyping=false;if(activeChat.jid===jid)setActiveChat(cht);}return cht;}));},20000)};typingTimeout.set(jid,timeoutData);};(_squadService66=squadService)===null||_squadService66===void 0?void 0:_squadService66.updateChatSubscribeFuncition(chatCommunicatorSubscribe);// Comentado para evitar warnings no console enquanto não é usado\n// function createGroup(group: INewGroup, callback: CreateGroupCallback) {\n//   squadService?.groups.create(group, (iGroup: IGroup) => {\n//     squadService?.groups.list((groups) => {\n//       setGroups(groups);\n//       callback(true);\n//     });\n//   });\n// }\nfunction sendMessage(chat,message,callback){var _squadService67,_squadService67$chat;(_squadService67=squadService)===null||_squadService67===void 0?void 0:(_squadService67$chat=_squadService67.chat)===null||_squadService67$chat===void 0?void 0:_squadService67$chat.chat.sendMessage(chat.jid,chat.jid.includes(\"@conference.\")?XMPPChatType.GROUPCHAT:XMPPChatType.CHAT,message,callback);}useEffect(init,[]);return/*#__PURE__*/React.createElement(React.Fragment,null);};export default SquadCommunicator;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/SquadCommunicator.tsx"],"names":["React","useEffect","SquadCommunicator","SquadService","useChat","useAuth","Events","ChatType","DeliverStatus","XMPPChatType","getFileName","getUrlBooleans","isUrl","ReadStatus","useGroup","useContact","useModal","UserType","useConference","moment","ConferenceRoomParticipantType","PresenceStatus","DateTime","useLoading","ParseUserTag","squadService","typingTimeout","Map","chats","setChats","activeChat","replyMsg","setReplyMsg","setActiveChat","forwardMessageList","setForwardMessageList","setShowChat","showChatProfileSidebar","setFavoriteMessagePayload","favoriteMessagePayload","flagToLoadFavoriteMessages","setFlagToLoadFavoriteMessages","setFavoriteMessages","deleteFavoriteMessage","setDeleteFavoriteMessage","contactsSearch","setContactsSearched","newFavorite","setNewFavorite","contacts","setContacts","setContactsOutsideUserContacts","toggleAddingContacts","setToggleAddingContacts","checkedContacts","setCheckedContacts","removedContact","setRemovedContact","checkedMembers","setCheckedMembers","groupToInsertMember","setGroupToInsertMember","clickedContact","setClickedContact","user","setUser","changedUserData","changedUserPassword","setChangedUserPassword","showModalForwardMessageTo","setShowModalForwardMessageTo","showModalAddContact","setDisconnected","setGroups","groups","memberQuit","groupIdOfLeaveRequest","setGroupIdOfLeaveRequest","setMemberQuit","groupToRemoveContact","setGroupToRemoveContact","removedMember","setRemovedMember","toggleMemberRole","setToggleMemberRole","changeGroupData","setChangeGroupData","groupToCreate","setGroupToCreate","groupJid","setGroupJid","listRooms","setListRooms","setConferenceList","setCreateConference","createConference","conferenceToUpdate","setConferenceToUpdate","conferenceToRemove","setConferenceToRemove","init","getInstance","chatCommunicatorSubscribe","get","Notification","requestPermission","clearSendFile","chatId","messageId","map","chat","id","messages","message","deliverStatus","QUEUED","sendFile","undefined","onChatsChange","onActiveChatChange","checkSendMessage","checkAttachedFiles","checkNewContact","cht","added","add","success","jid","list","ctcs","attachedFileList","attachments","length","checkSearchMessages","messageLoaded","forEach","msg","find","m","unshift","getFileExtension","url","split","SENDING","files","sendFiles","data","updateMessageFiles","console","log","saveData","createdAt","local","toISO","join","slice","src","dst","fileExtension","fileName","fileUrl","kind","chatType","isForwardMessage","sendMessage","msgId","updateMessage","replyMsgCopy","newChat","booleans","time","Date","toISOString","isFileMessage","isImageMessage","isVideoMessage","isAudioMessage","filter","newChats","push","replyedMsg","isReplyMessage","replyedMessage","replyedMessageId","replyedMessageTo","getContacts","fromUser","name","forwardMessage","chatsFinded","oldChats","ctc","i","userName","toUser","ctcsNotInChat","profilePicture","status","unRead","includes","GROUP","USER","inputMessage","isTyping","email","favorite","mencioned","newMessage","onChangeStatus","client","changeStatus","onSearchContacts","search","searchList","onSearchContactsOutsideUserContacts","getContactsOutsideUserLists","onToggleSidebarMenu","onRemovingMember","group","grp","groupId","removeMember","members","mb","userId","sendEvent","onLeavingGroup","leftingGroup","memberId","sendPresence","UNAVAILABLE","showNotification","permission","body","icon","require","silent","onFavoriteMessage","save","contactType","onAddingMembers","asynchronousFlag","copiaCheckedMembers","copiaGroupToInsertMember","ctt","addMember","grps","foundedGroup","onAddingContacts","addContacts","onAddingContactOnGroupList","onToggleMemberRole","gp","gpId","mbId","mbRole","newRole","ADMIN","role","member","onChangeGroupData","editGroupInfo","groupName","description","createGroup","create","parsedGroup","onListRooms","conferences","joinGroups","conf","onCreateRoom","momentStartDate","startDate","startTime","momentFinalDate","parseInt","duration","parsedConference","waitMod","mdCheck","startDatetime","format","stopDatetime","createdConference","participantList","selectedContact","userUuid","type","PARTICIPANT","userModerator","emailList","participant","PARTICIPANT_EXTERNAL","addParticipants","s","onNewFavorite","onUserDataChange","onUserPasswordChange","onRemovingContact","onListFavoriteMessages","onRemoveFavoriteMessage","onUpdatingConference","onRemovingConference","update","successOnUpdate","remove","successOnRemove","deleteFavorite","listFavorites","contactTo","content","contentType","messageDate","item","changePassword","password","oldPassword","newPassword","changeUserData","chgd","newFavoriteLoad","setFavorite","evt","RECONNECTED","ONLINE","receivedChats","ERROR","OFFLINE","localStorage","getItem","makeChat","removeItem","RECONNECTING","MESSAGE","chatTemporary","listContacts","c","listGroups","g","conferenceRoomParticipants","department","userDescription","RECEIVED","DELIVERED","DISPLAYED","readStatus","READ","COMPOSING","deleteTypingTimeout","setTypingTimeout","ACTIVE","chatUpdate","PRESENCE","from","SEND_EVENT","event","finded","groupToBeInserted","eventId","refreshMembers","clearTimeout","timeout","setTimeout","delete","timeoutData","msgStr","set","updateChatSubscribeFuncition","callback","GROUPCHAT","CHAT"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\r\nimport { useChat } from \"../contexts/ChatContext\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport IUser from \"../alias/IUser\";\r\nimport { Events, SendImageCallbackReturn } from \"./chat/types/types\";\r\nimport ChatType from \"./../enuns/ChatType\";\r\nimport IChat from \"../alias/IChat\";\r\nimport DeliverStatus from \"../enuns/DeliverStatus\";\r\nimport { ChatType as XMPPChatType } from \"./chat/types/types\";\r\nimport { SendMessageCallback } from \"./types\";\r\nimport IMessage from \"../alias/IMessage\";\r\nimport { getFileName, getUrlBooleans, isUrl } from \"./utils/parseUtils\";\r\nimport ReadStatus from \"../enuns/ReadStatus\";\r\nimport { useGroup } from \"../contexts/GroupContext\";\r\nimport { useContact } from \"../contexts/ContactContext\";\r\nimport { useModal } from \"../contexts/ModalContext\";\r\nimport IContact from \"../alias/IContact\";\r\nimport IGroup from \"../alias/IGroup\";\r\nimport UserType from \"../enuns/UserType\";\r\nimport { useConference } from \"../contexts/ConferenceContext\";\r\nimport moment from \"moment\";\r\nimport { ConferenceRoomParticipantType } from \"./business/Conferences\";\r\nimport { ConferenceRoomParticipant } from \"@digivox/apicommunicator/dist/types/types/types\";\r\nimport PresenceStatus from \"../enuns/PresenceStatus\";\r\nimport { DateTime } from \"luxon\";\r\nimport { useLoading } from \"../contexts/LoadingContext\";\r\nimport { ParseUserTag } from \"../helpers/TextMessageTagParse\";\r\n// import { activeChat as actChtData } from \"../data/chat\";\r\n//import { callbackify } from \"util\";\r\n\r\n// import IContact from \"../alias/IContact\";\r\n//Comentar para Evitar Warnings no console\r\ninterface CreateGroupCallback {\r\n  (success: boolean): void;\r\n}\r\ninterface TypingTimeoutData {\r\n  timeout: NodeJS.Timeout;\r\n  msgStr: string;\r\n}\r\nlet squadService: SquadService | undefined;\r\nlet typingTimeout: Map<string, TypingTimeoutData> = new Map<\r\n  string,\r\n  TypingTimeoutData\r\n>();\r\nconst SquadCommunicator: React.FC = () => {\r\n  const {\r\n    chats,\r\n    setChats,\r\n    activeChat,\r\n    replyMsg,\r\n    setReplyMsg,\r\n    setActiveChat,\r\n    forwardMessageList,\r\n    setForwardMessageList,\r\n    setShowChat,\r\n    showChatProfileSidebar,\r\n    setFavoriteMessagePayload,\r\n    favoriteMessagePayload,\r\n    flagToLoadFavoriteMessages,\r\n    setFlagToLoadFavoriteMessages,\r\n    setFavoriteMessages,\r\n    deleteFavoriteMessage,\r\n    setDeleteFavoriteMessage,\r\n  } = useChat();\r\n  const {\r\n    contactsSearch,\r\n    setContactsSearched,\r\n    newFavorite,\r\n    setNewFavorite,\r\n    contacts,\r\n    setContacts,\r\n    setContactsOutsideUserContacts,\r\n    toggleAddingContacts,\r\n    setToggleAddingContacts,\r\n    checkedContacts,\r\n    setCheckedContacts,\r\n    removedContact,\r\n    setRemovedContact,\r\n    checkedMembers,\r\n    setCheckedMembers,\r\n    groupToInsertMember,\r\n    setGroupToInsertMember,\r\n    clickedContact,\r\n    setClickedContact,\r\n  } = useContact();\r\n  const {\r\n    user,\r\n    setUser,\r\n    changedUserData,\r\n    changedUserPassword,\r\n    setChangedUserPassword,\r\n  } = useAuth();\r\n  const {\r\n    showModalForwardMessageTo,\r\n    setShowModalForwardMessageTo,\r\n    showModalAddContact,\r\n  } = useModal();\r\n  const { setDisconnected } = useLoading();\r\n\r\n  const {\r\n    setGroups,\r\n    groups,\r\n    memberQuit,\r\n    groupIdOfLeaveRequest,\r\n    setGroupIdOfLeaveRequest,\r\n    setMemberQuit,\r\n    groupToRemoveContact,\r\n    setGroupToRemoveContact,\r\n    removedMember,\r\n    setRemovedMember,\r\n    toggleMemberRole,\r\n    setToggleMemberRole,\r\n    changeGroupData,\r\n    setChangeGroupData,\r\n    groupToCreate,\r\n    setGroupToCreate,\r\n    groupJid,\r\n    setGroupJid,\r\n  } = useGroup();\r\n  const {\r\n    listRooms,\r\n    setListRooms,\r\n    setConferenceList,\r\n    setCreateConference,\r\n    createConference,\r\n    conferenceToUpdate,\r\n    setConferenceToUpdate,\r\n    conferenceToRemove,\r\n    setConferenceToRemove\r\n  } = useConference();\r\n  const init = () => {\r\n      /* localStorage.setItem(\r\n        \"authorization\",\r\n        JSON.stringify({\r\n          access_token: \"c9b0dbe6bd8d38110a9a76d2bbed2b48\",\r\n          baseUrl: \"https://app.citrussquad.com/api/v1/\",\r\n          email: \"romero2@digivox.com.br\",\r\n          expires_in: 2592000,\r\n          user_id: \"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",\r\n          user_name: \"ZZ Romero 2\",\r\n        })\r\n      ); */\r\n    squadService = SquadService.getInstance({\r\n      chatCommunicatorSubscribe: chatCommunicatorSubscribe,\r\n    });\r\n    squadService?.user.get((user: IUser) => {\r\n      setUser(user);\r\n      //Ao iniciar o website\r\n      Notification.requestPermission();\r\n    });\r\n  };\r\n\r\n  const clearSendFile = (chatId: string, messageId: string) => {\r\n    setChats(\r\n      chats.map((chat) => {\r\n        if (chat.id === chatId) {\r\n          chat.messages = chat.messages.map((message) => {\r\n            if (message.id === messageId) {\r\n              message.deliverStatus = DeliverStatus.QUEUED;\r\n              message.sendFile = undefined;\r\n            }\r\n            return message;\r\n          });\r\n        }\r\n        return chat;\r\n      })\r\n    );\r\n  };\r\n\r\n  const onChatsChange = () => {\r\n    // chats.forEach((chat) => {\r\n    // });\r\n  };\r\n  const onActiveChatChange = () => {\r\n    checkSendMessage(activeChat);\r\n    checkAttachedFiles(activeChat);\r\n    checkNewContact(activeChat);\r\n    // checkTyping(activeChat)\r\n  };\r\n  // const checkTyping = (chat: IChat) => {\r\n  //   const oldTimeoutData = typingTimeout.get(chat.jid)\r\n  //   if (chat.inputMessage !== \"\" && (!oldTimeoutData || (oldTimeoutData.msgStr !== chat.inputMessage))) {\r\n  //     if (oldTimeoutData)\r\n  //       clearTimeout(oldTimeoutData.timeout)\r\n  //     else\r\n  //       squadService?.chat?.chat.sendTyping(chat.jid)\r\n  //     const timeoutData = {\r\n  //       timeout: setTimeout(() => { squadService?.chat?.chat.sendActive(chat.jid); typingTimeout.delete(chat.jid) }, 3000),\r\n  //       msgStr: `${chat.inputMessage}`\r\n  //     }\r\n  //     typingTimeout.set(chat.jid, timeoutData)\r\n  //   }\r\n  // }\r\n  const checkNewContact = (cht: IChat) => {\r\n    if (!cht.added) {\r\n      squadService?.contacts.add(cht, (success: boolean) => {\r\n        if (success) {\r\n          setChats(\r\n            chats.map((chat) => {\r\n              if (chat.jid === cht.jid) {\r\n                chat.added = true;\r\n              }\r\n              if (activeChat.jid === chat.jid) setActiveChat(chat);\r\n              return chat;\r\n            })\r\n          );\r\n          squadService?.contacts.list((ctcs) => {\r\n            setContacts(ctcs);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const checkAttachedFiles = (cht: IChat) => {\r\n    if (cht.attachedFileList && !cht.attachedFileList[0]) {\r\n      squadService?.attachments.list(cht, (attachments) => {\r\n        if (attachments.length > 0) {\r\n          setActiveChat({ ...cht, attachedFileList: attachments });\r\n        } else setActiveChat({ ...cht, attachedFileList: null });\r\n      });\r\n    }\r\n  };\r\n\r\n  /* getMessageUserProfilePicture = (msg: Message | FileMessage) => {\r\n    if (msg.from.includes(\"@conference.\")) {\r\n      const groups = this.groups.getGroups();\r\n      const group = groups.get(msg.from.split(\"@\")[0]);\r\n      const member = group?.members.filter(\r\n        (member) => member.userId === msg.from.split(\"/\")[1]\r\n      )[0];\r\n      return member?.profilePicture;\r\n    } else {\r\n      return this.contacts.getContacts().get(msg.from.split(\"@\")[0])\r\n        ?.profilePicture;\r\n    }\r\n  }; */\r\n\r\n  const checkSearchMessages = () => {\r\n    if (activeChat.messageLoaded) {\r\n      squadService?.messages.list(activeChat, (messages) => {\r\n        if (messages.length) {\r\n          setChats(\r\n            chats.map((cht) => {\r\n              if (cht.id === activeChat.id) {\r\n                messages.forEach((msg) => {\r\n                  if (!activeChat.messages.find((m) => m.id === msg.id))\r\n                    cht.messages.unshift(msg);\r\n                });\r\n                cht.messageLoaded = false;\r\n                setActiveChat(cht);\r\n              }\r\n              return cht;\r\n            })\r\n          );\r\n        } else {\r\n          const chat = { ...activeChat, messageLoaded: false };\r\n          setActiveChat(chat);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const getFileExtension = (url: string) => {\r\n    return url.split(\".\")[1];\r\n  };\r\n\r\n  const checkSendMessage = (chat: IChat) => {\r\n    chat.messages.forEach((msg) => {\r\n      if (msg.deliverStatus === DeliverStatus.SENDING) {\r\n        if (msg.sendFile && !replyMsg) {\r\n          const files = [msg.sendFile];\r\n          clearSendFile(chat.id, msg.id);\r\n          squadService?.chat?.sendFiles(\r\n            chat,\r\n            files,\r\n            (data: SendImageCallbackReturn) => {\r\n              updateMessageFiles(data, chat, msg);\r\n              console.log(\r\n                \"jidFromUser:\",\r\n                squadService?.user.user?.jid as string\r\n              );\r\n              squadService?.attachments.saveData(\r\n                {\r\n                  createdAt: DateTime.local()\r\n                    .toISO()\r\n                    .split(\"T\")\r\n                    .join(\" \")\r\n                    .slice(0, 18),\r\n                  src: squadService.user.user?.jid as string,\r\n                  dst: chat.jid,\r\n                  fileExtension: getFileExtension(getFileName(data.url)),\r\n                  fileName: getFileName(data.url),\r\n                  fileUrl: data.url,\r\n                  kind: chat.chatType,\r\n                },\r\n                () => true\r\n              );\r\n            }\r\n          );\r\n        } else {\r\n          if (!msg.isForwardMessage && !replyMsg) {\r\n            sendMessage(chat, msg.message, (msgId) =>\r\n              updateMessage(msgId, chat, msg)\r\n            );\r\n          } else if (replyMsg) {\r\n            const replyMsgCopy = { ...replyMsg };\r\n            setReplyMsg(undefined);\r\n            squadService?.chat?.replyMsg(chat, msg, replyMsgCopy, (msgId) => {\r\n              updateMessage(msgId, chat, msg, replyMsgCopy);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  };\r\n  const updateMessageFiles = (\r\n    data: SendImageCallbackReturn,\r\n    chat: IChat,\r\n    msg: IMessage\r\n  ) => {\r\n    const newChat = { ...chat };\r\n    newChat.messages = chat.messages.map((message) => {\r\n      if (msg.id === message.id) {\r\n        const booleans = getUrlBooleans(data.url);\r\n        message.id = data.msgId;\r\n        message.fileUrl = data.url;\r\n        message.deliverStatus = DeliverStatus.QUEUED;\r\n        message.time = new Date().toISOString();\r\n        message.message = getFileName(data.url);\r\n        message.isFileMessage = booleans.isFileMessage;\r\n        message.isImageMessage = booleans.isImageMessage;\r\n        message.isVideoMessage = booleans.isVideoMessage;\r\n        message.isAudioMessage = booleans.isAudioMessage;\r\n      }\r\n      return message;\r\n    });\r\n    setActiveChat(newChat);\r\n    if (!chats.filter((cht) => cht.id === chat.id)[0]) {\r\n      const newChats = [chat, ...chats];\r\n      setChats(newChats);\r\n    } else {\r\n      const newChats: IChat[] = [];\r\n      chats.forEach((cht) => {\r\n        if (cht.id === chat.id) {\r\n          cht.messages = newChat.messages;\r\n          newChats.unshift(cht);\r\n        } else {\r\n          newChats.push(cht);\r\n        }\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const updateMessage = (\r\n    msgId: string,\r\n    chat: IChat,\r\n    msg: IMessage,\r\n    replyedMsg: IMessage | undefined = undefined\r\n  ) => {\r\n    const newChat = { ...chat };\r\n    newChat.messages = chat.messages.map((message) => {\r\n      if (msg.id === message.id) {\r\n        message.id = msgId;\r\n        message.deliverStatus = DeliverStatus.QUEUED;\r\n        message.time = new Date().toISOString();\r\n        if (replyedMsg) {\r\n          message.isReplyMessage = true;\r\n          message.replyedMessage = replyedMsg.message || replyedMsg.fileUrl;\r\n          message.replyedMessageId = replyedMsg.id;\r\n          message.replyedMessageTo =\r\n            squadService?.contacts\r\n              .getContacts()\r\n              .get(replyedMsg.fromUser.split(\"@\")[0])?.name ||\r\n            squadService?.user?.user?.id === replyedMsg.fromUser.split(\"@\")[0]\r\n              ? squadService?.user?.user?.name\r\n              : \"Participant\";\r\n        }\r\n        if (isUrl(message.message)) {\r\n          const booleans = getUrlBooleans(message.message);\r\n          message.isFileMessage = booleans.isFileMessage;\r\n          message.isImageMessage = booleans.isImageMessage;\r\n          message.isAudioMessage = booleans.isAudioMessage;\r\n          message.isVideoMessage = booleans.isVideoMessage;\r\n          message.fileUrl = message.message;\r\n        }\r\n      }\r\n      return message;\r\n    });\r\n    if (activeChat.jid === newChat.jid) setActiveChat(newChat);\r\n    if (!chats.filter((cht) => cht.id === chat.id)[0]) {\r\n      const newChats = [chat, ...chats];\r\n      setChats(newChats);\r\n    } else {\r\n      const newChats: IChat[] = [];\r\n      chats.forEach((cht) => {\r\n        if (cht.id === chat.id) {\r\n          cht.messages = newChat.messages;\r\n          newChats.unshift(cht);\r\n        } else {\r\n          newChats.push(cht);\r\n        }\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const forwardMessage = () => {\r\n    if (forwardMessageList && showModalForwardMessageTo) {\r\n      const ctcs = [...forwardMessageList];\r\n      const message = { ...showModalForwardMessageTo };\r\n      setForwardMessageList(undefined);\r\n      setShowModalForwardMessageTo(undefined);\r\n      const chatsFinded: IChat[] = [];\r\n      const oldChats = [\r\n        ...chats.map((chat) => {\r\n          return { ...chat };\r\n        }),\r\n      ];\r\n      ctcs?.forEach((ctc, i) => {\r\n        const cht = oldChats.find((cht) => cht.jid === ctc.jid);\r\n        if (cht) {\r\n          const msg = {\r\n            ...message,\r\n            id: `${cht.messages.length + 1}`,\r\n            userName: user.name,\r\n            fromUser: user.id,\r\n            toUser: ctc.jid.split(\"@\")[0],\r\n            message: message.fileUrl || message.message,\r\n            deliverStatus: DeliverStatus.QUEUED,\r\n            isForwardMessage: true,\r\n          };\r\n          squadService?.chat?.forwardMessage(cht, msg, (msgId) => {\r\n            msg.id = msgId;\r\n            cht.messages.push(msg);\r\n            chatsFinded.push(cht);\r\n          });\r\n        }\r\n      });\r\n      const newChats = oldChats.map(\r\n        (chat) => chatsFinded.find((cht) => cht.id === chat.id) || chat\r\n      );\r\n      const ctcsNotInChat: (IContact | IGroup)[] = ctcs.filter(\r\n        (ctc) => !newChats.find((cht) => ctc.jid === cht.jid)\r\n      );\r\n      ctcsNotInChat.forEach((ctc, i) => {\r\n        const chat = {\r\n          id: ctc.jid.split(\"@\")[0],\r\n          jid: ctc.jid,\r\n          name: ctc.name,\r\n          profilePicture: ctc.profilePicture,\r\n          status: (ctc as IContact).status || undefined,\r\n          unRead: 0,\r\n          chatType: ctc.jid.includes(\"@conference.\")\r\n            ? ChatType.GROUP\r\n            : ChatType.USER,\r\n          inputMessage: \"\",\r\n          messageLoaded: false,\r\n          isTyping: false,\r\n          messages: [] as IMessage[],\r\n          email: (ctc as IContact).email || undefined,\r\n          favorite: ctc.favorite,\r\n          added: ctc.added,\r\n          mencioned: 0,\r\n        };\r\n        const newMessage: IMessage = {\r\n          ...message,\r\n          id: `${1}`,\r\n          userName: user.name,\r\n          fromUser: user.id,\r\n          toUser: ctc.jid.split(\"@\")[0],\r\n          deliverStatus: DeliverStatus.QUEUED,\r\n          isForwardMessage: true,\r\n        };\r\n        squadService?.chat?.forwardMessage(chat, newMessage, (msgId) => {\r\n          newMessage.id = msgId;\r\n          chat.messages.push(newMessage);\r\n          newChats.unshift(chat);\r\n        });\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const onChangeStatus = () => {\r\n    if (squadService?.chat?.chat?.client?.status === \"online\") {\r\n      squadService?.chat?.changeStatus(user.status);\r\n    }\r\n  };\r\n  const onSearchContacts = () => {\r\n    if (contactsSearch.length > 2) {\r\n      squadService?.contacts.search(contactsSearch, (searchList) => {\r\n        setContactsSearched(searchList);\r\n      });\r\n    } else {\r\n      setContactsSearched(undefined);\r\n    }\r\n  };\r\n\r\n  const onSearchContactsOutsideUserContacts = () => {\r\n    squadService?.contacts.getContactsOutsideUserLists((contacts) => {\r\n      if (contacts) {\r\n        setContactsOutsideUserContacts(contacts);\r\n      }\r\n    });\r\n  };\r\n\r\n  const onToggleSidebarMenu = () => {\r\n    squadService?.contacts.getContactsOutsideUserLists((contacts) => {\r\n      if (contacts) {\r\n        setContactsOutsideUserContacts(contacts);\r\n      }\r\n    });\r\n  };\r\n\r\n  const onRemovingMember = () => {\r\n    if (removedMember && groupToRemoveContact) {\r\n      let group = groups.find((grp) => grp.groupId === groupToRemoveContact);\r\n      if (group)\r\n        squadService?.groups.removeMember(\r\n          group.groupId,\r\n          removedMember,\r\n          (success: boolean) => {\r\n            if (success) {\r\n              setGroups(\r\n                groups.map((grp) => {\r\n                  if (grp.groupId === group?.groupId)\r\n                    grp.members = grp.members.filter(\r\n                      (mb) => mb.userId !== removedMember.userId\r\n                    );\r\n                  return grp;\r\n                })\r\n              );\r\n              setChats(\r\n                chats.map((cht) => {\r\n                  if (cht.groupId === group?.groupId) {\r\n                    cht.members = cht.members?.filter(\r\n                      (mb) => mb.userId !== removedMember.userId\r\n                    );\r\n                    if (cht.groupId === activeChat.groupId) setActiveChat(cht);\r\n                  }\r\n                  return cht;\r\n                })\r\n              );\r\n              if (group) {\r\n                squadService?.chat?.chat.sendEvent(\r\n                  group?.jid,\r\n                  removedMember.userId,\r\n                  \"6\"\r\n                );\r\n              }\r\n              setRemovedMember(undefined);\r\n              setGroupToRemoveContact(undefined);\r\n            }\r\n          }\r\n        );\r\n    }\r\n  };\r\n\r\n  const onLeavingGroup = () => {\r\n    if (memberQuit && groupIdOfLeaveRequest && groupJid) {\r\n      squadService?.groups.leftingGroup(\r\n        { groupId: groupIdOfLeaveRequest, memberId: memberQuit.userId },\r\n        (success: boolean) => {\r\n          if (success) {\r\n            squadService?.chat?.chat.sendPresence(\r\n              PresenceStatus.UNAVAILABLE,\r\n              `${groupJid}/${memberQuit.userId}`\r\n            );\r\n            squadService?.chat?.chat.sendEvent(\r\n              groupIdOfLeaveRequest,\r\n              memberQuit.userId,\r\n              \"3\",\r\n              undefined\r\n            );\r\n            setChats(\r\n              chats.filter((cht) => cht.groupId !== groupIdOfLeaveRequest)\r\n            );\r\n            setGroups(\r\n              groups.filter((grp) => grp.groupId !== groupIdOfLeaveRequest)\r\n            );\r\n            if (activeChat.groupId === groupIdOfLeaveRequest) {\r\n              setShowChat(false);\r\n            }\r\n          }\r\n          setGroupJid(undefined);\r\n          setMemberQuit(undefined);\r\n          setGroupIdOfLeaveRequest(\"\");\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const showNotification = (name: string) => {\r\n    if (Notification.permission === \"granted\") {\r\n      new Notification(\"Nova mensagem\", {\r\n        body: name,\r\n        icon: require(\"../assets/images/logo.png\"),\r\n        silent: true,\r\n      });\r\n    } else {\r\n      Notification.requestPermission();\r\n    }\r\n  };\r\n\r\n  const onFavoriteMessage = () => {\r\n    if (favoriteMessagePayload) {\r\n      squadService?.messages.save(favoriteMessagePayload, (success) => {\r\n        if (success) {\r\n          setFavoriteMessagePayload(undefined);\r\n          setFlagToLoadFavoriteMessages({\r\n            contactType: favoriteMessagePayload.contactType as string,\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const onAddingMembers = () => {\r\n    let asynchronousFlag = 0;\r\n    if (checkedMembers && groupToInsertMember) {\r\n      let copiaCheckedMembers = [...checkedMembers],\r\n        copiaGroupToInsertMember = { ...groupToInsertMember };\r\n      copiaCheckedMembers.forEach((ctt) => {\r\n        squadService?.groups.addMember(\r\n          copiaGroupToInsertMember,\r\n          ctt,\r\n          (success: boolean) => {\r\n            if (success) {\r\n              squadService?.chat?.chat.sendEvent(\r\n                copiaGroupToInsertMember.jid,\r\n                ctt.id,\r\n                \"2\"\r\n              );\r\n              asynchronousFlag++;\r\n\r\n              if (copiaCheckedMembers.length === asynchronousFlag) {\r\n                squadService?.groups.list((grps) => {\r\n                  setGroups(grps);\r\n                  setChats(\r\n                    chats.map((cht) => {\r\n                      if (cht.groupId === copiaGroupToInsertMember.groupId) {\r\n                        let foundedGroup = grps.find(\r\n                          (grp) => grp.groupId === cht.groupId\r\n                        );\r\n                        cht.members = foundedGroup?.members;\r\n                        if (activeChat.groupId === cht.groupId) {\r\n                          activeChat.members = foundedGroup?.members;\r\n                          setActiveChat(activeChat);\r\n                        }\r\n                      }\r\n                      return cht;\r\n                    })\r\n                  );\r\n                });\r\n              }\r\n            }\r\n          }\r\n        );\r\n      });\r\n      setCheckedMembers([]);\r\n      setToggleAddingContacts(false);\r\n      setGroupToInsertMember(undefined);\r\n    }\r\n  };\r\n\r\n  const onAddingContacts = () => {\r\n    let asynchronousFlag = 0;\r\n    if (checkedContacts && toggleAddingContacts) {\r\n      checkedContacts.forEach((ctt) => {\r\n        if (!ctt.added) {\r\n          squadService?.contacts.addContacts(ctt, (success: boolean) => {\r\n            if (success) {\r\n              asynchronousFlag++;\r\n              if (checkedContacts.length === asynchronousFlag) {\r\n                squadService?.contacts.list((contacts) => {\r\n                  setContacts(contacts);\r\n                  setCheckedContacts([]);\r\n                  setToggleAddingContacts(false);\r\n                });\r\n              }\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const onAddingContactOnGroupList = () => {\r\n    if (clickedContact) {\r\n      if (!clickedContact.added) {\r\n        squadService?.contacts.addContacts(\r\n          clickedContact,\r\n          (success: boolean) => {\r\n            if (success) {\r\n              squadService?.contacts.list((contacts) => {\r\n                setContacts(contacts);\r\n                setClickedContact(undefined);\r\n              });\r\n            }\r\n          }\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const onToggleMemberRole = () => {\r\n    if (toggleMemberRole) {\r\n      squadService?.groups.list((grps) => {\r\n        grps.forEach((gp) => {\r\n          if (gp.groupId === toggleMemberRole.gpId) {\r\n            gp.members.forEach((mb) => {\r\n              if (mb.userId === toggleMemberRole.mbId) {\r\n                squadService?.contacts.toggleMemberRole(\r\n                  toggleMemberRole.mbId,\r\n                  toggleMemberRole.gpId,\r\n                  toggleMemberRole.mbRole,\r\n                  (success: boolean) => {\r\n                    if (success) {\r\n                      const newRole =\r\n                        toggleMemberRole.mbRole === UserType.USER\r\n                          ? UserType.ADMIN\r\n                          : UserType.USER;\r\n                      setToggleMemberRole(undefined);\r\n                      setChats(\r\n                        chats.map((cht) => {\r\n                          if (cht.groupId === toggleMemberRole.gpId) {\r\n                            cht.members = cht.members?.map((mb) => {\r\n                              if (mb.userId === toggleMemberRole.mbId) {\r\n                                mb.role = newRole;\r\n                                if (cht.groupId) {\r\n                                  if (mb.role === UserType.ADMIN) {\r\n                                    squadService?.chat?.chat.sendEvent(\r\n                                      cht.groupId,\r\n                                      mb.userId,\r\n                                      \"8\"\r\n                                    );\r\n                                  } else {\r\n                                    squadService?.chat?.chat.sendEvent(\r\n                                      cht.groupId,\r\n                                      mb.userId,\r\n                                      \"9\"\r\n                                    );\r\n                                  }\r\n                                }\r\n                              }\r\n                              return mb;\r\n                            });\r\n                            if (activeChat.groupId === cht.groupId)\r\n                              setActiveChat(cht);\r\n                          }\r\n                          return cht;\r\n                        })\r\n                      );\r\n                      setGroups(\r\n                        groups.map((grp) => {\r\n                          if (grp.groupId === toggleMemberRole.gpId) {\r\n                            grp.members = grp.members.map((member) => {\r\n                              if (member.userId === toggleMemberRole.mbId)\r\n                                member.role = newRole;\r\n                              return member;\r\n                            });\r\n                          }\r\n                          return grp;\r\n                        })\r\n                      );\r\n                    }\r\n                  }\r\n                );\r\n              }\r\n            });\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  const onChangeGroupData = () => {\r\n    if (changeGroupData) {\r\n      squadService?.groups.editGroupInfo(\r\n        {\r\n          groupId: changeGroupData.groupId as string,\r\n          groupName: changeGroupData.groupName,\r\n          members: changeGroupData.members,\r\n          description: changeGroupData.description,\r\n        },\r\n        (success: boolean) => {\r\n          if (success) {\r\n            squadService?.groups.list((grps) => {\r\n              let foundedGroup = grps.find(\r\n                (grp) => grp.groupId === changeGroupData.groupId\r\n              );\r\n              setGroups(grps);\r\n              setChats(\r\n                chats.map((cht) => {\r\n                  if (cht.groupId === changeGroupData.groupId) {\r\n                    if (foundedGroup?.name) {\r\n                      cht.name = foundedGroup.name;\r\n                    }\r\n                    if (activeChat.groupId === cht.groupId) {\r\n                      if (foundedGroup?.name) {\r\n                        cht.name = foundedGroup?.name;\r\n                      }\r\n                      setActiveChat(cht);\r\n                    }\r\n                  }\r\n                  return cht;\r\n                })\r\n              );\r\n              squadService?.chat?.chat.sendEvent(\r\n                foundedGroup?.jid as string,\r\n                undefined,\r\n                \"10\",\r\n                undefined\r\n              );\r\n              setChangeGroupData(undefined);\r\n            });\r\n          }\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const createGroup = () => {\r\n    squadService?.groups.create(groupToCreate, (parsedGroup) => {\r\n      if (parsedGroup) {\r\n        squadService?.chat?.chat.sendEvent(\r\n          parsedGroup.jid,\r\n          parsedGroup.jid,\r\n          \"1\"\r\n        );\r\n        squadService?.groups.list((groups) => {\r\n          setGroups(groups);\r\n          setGroupToCreate(undefined);\r\n        });\r\n        squadService?.chat?.chat.sendEvent(\r\n          parsedGroup.jid,\r\n          undefined,\r\n          \"1\",\r\n          undefined\r\n        );\r\n      }\r\n    });\r\n  };\r\n  const onListRooms = () => {\r\n    if (listRooms) {\r\n      squadService?.conferences.list((conferences) => {\r\n        setConferenceList(conferences);\r\n        squadService?.chat?.joinGroups(conferences.map((conf) => conf.jid));\r\n      });\r\n      setListRooms(false);\r\n    }\r\n  };\r\n\r\n  const onCreateRoom = () => {\r\n    if (createConference) {\r\n      const momentStartDate = moment(\r\n        `${createConference.startDate} ${createConference.startTime}:00`\r\n      );\r\n      const momentFinalDate = moment(momentStartDate)\r\n        .add(parseInt(createConference.duration.split(\":\")[0]), \"hours\")\r\n        .add(parseInt(createConference.duration.split(\":\")[1]), \"minutes\");\r\n      const parsedConference = {\r\n        name: createConference.name,\r\n        waitMod: createConference.mdCheck,\r\n        startDatetime: `${momentStartDate.format(\"DD/MM/YYYY HH:mm:ss\")}`,\r\n        stopDatetime: `${momentFinalDate.format(\"DD/MM/YYYY HH:mm:ss\")}`,\r\n      };\r\n      squadService?.conferences.create(\r\n        parsedConference,\r\n        (createdConference) => {\r\n          const participantList: ConferenceRoomParticipant[] = [];\r\n          if (createdConference?.id) {\r\n            createConference.selectedContact?.forEach((ctc) => {\r\n              participantList.push({\r\n                userUuid: ctc.id,\r\n                description: \"\",\r\n                email: ctc.email,\r\n                name: ctc.name,\r\n                type: ConferenceRoomParticipantType.PARTICIPANT,\r\n                userModerator: false,\r\n              });\r\n            });\r\n            createConference.emailList?.forEach((participant) => {\r\n              participantList.push({\r\n                userUuid: null,\r\n                description: \"\",\r\n                email: participant.email,\r\n                name: participant.name,\r\n                type: ConferenceRoomParticipantType.PARTICIPANT_EXTERNAL,\r\n                userModerator: false,\r\n              });\r\n            });\r\n            squadService?.conferences.addParticipants(\r\n              createdConference.id,\r\n              participantList,\r\n              (s) => {\r\n                if (s) {\r\n                  setCreateConference(undefined);\r\n                  setListRooms(true);\r\n                }\r\n              }\r\n            );\r\n          }\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  useEffect(onChatsChange, [chats]);\r\n  useEffect(onNewFavorite, [newFavorite]);\r\n  useEffect(checkSearchMessages, [activeChat.messageLoaded]);\r\n  useEffect(onActiveChatChange, [activeChat]);\r\n  useEffect(onUserDataChange, [changedUserData]);\r\n  useEffect(onUserPasswordChange, [changedUserPassword]);\r\n  useEffect(onChangeStatus, [user.status]);\r\n  useEffect(forwardMessage, [forwardMessageList]);\r\n  useEffect(onSearchContacts, [contactsSearch]);\r\n  useEffect(onSearchContactsOutsideUserContacts, [showModalAddContact]);\r\n  useEffect(onAddingContacts, [toggleAddingContacts]);\r\n  useEffect(onRemovingMember, [removedMember, groupToRemoveContact]);\r\n  useEffect(onLeavingGroup, [memberQuit, groupIdOfLeaveRequest, groupJid]);\r\n  useEffect(onRemovingContact, [removedContact]);\r\n  useEffect(onAddingMembers, [groupToInsertMember, checkedMembers]);\r\n  useEffect(onToggleMemberRole, [toggleMemberRole]);\r\n  useEffect(onChangeGroupData, [changeGroupData]);\r\n  useEffect(onAddingContactOnGroupList, [clickedContact]);\r\n  useEffect(createGroup, [groupToCreate]);\r\n  useEffect(onToggleSidebarMenu, [showChatProfileSidebar]);\r\n  useEffect(onListRooms, [listRooms]);\r\n  useEffect(onCreateRoom, [createConference]);\r\n  useEffect(onFavoriteMessage, [favoriteMessagePayload]);\r\n  useEffect(onListFavoriteMessages, [flagToLoadFavoriteMessages]);\r\n  useEffect(onRemoveFavoriteMessage, [deleteFavoriteMessage]);\r\n  useEffect(onUpdatingConference, [conferenceToUpdate]);\r\n  useEffect(onRemovingConference, [conferenceToRemove]);\r\n\r\n  function onUpdatingConference() {\r\n    if(conferenceToUpdate){\r\n      /* const parsedConference = {\r\n        name: createConference.name,\r\n        waitMod: createConference.mdCheck,\r\n        startDatetime: `${momentStartDate.format(\"DD/MM/YYYY HH:mm:ss\")}`,\r\n        stopDatetime: `${momentFinalDate.format(\"DD/MM/YYYY HH:mm:ss\")}`,\r\n      }; */\r\n      squadService?.conferences.update(conferenceToUpdate.id, {\r\n        name: conferenceToUpdate.name,\r\n        waitMod: conferenceToUpdate.waitMod,\r\n        startDatetime: conferenceToUpdate.startDatetime,\r\n        stopDatetime: conferenceToUpdate.stopDatetime,\r\n      }, (successOnUpdate) => {\r\n        if(successOnUpdate){\r\n          setListRooms(true)\r\n          setConferenceToUpdate(undefined);\r\n        }\r\n      })\r\n    }\r\n  }\r\n  \r\n  function onRemovingConference() {\r\n    if(conferenceToRemove){\r\n      squadService?.conferences.remove(conferenceToRemove.id, (successOnRemove) => {\r\n        if(successOnRemove){\r\n          setListRooms(true);\r\n          setConferenceToRemove(undefined);\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  function onRemoveFavoriteMessage() {\r\n    if (deleteFavoriteMessage) {\r\n      squadService?.messages.deleteFavorite(\r\n        { messageId: deleteFavoriteMessage?.messageId as string },\r\n        (success) => {\r\n          if (success) {\r\n            setFlagToLoadFavoriteMessages({\r\n              contactType: deleteFavoriteMessage?.contactType as string,\r\n            });\r\n            setDeleteFavoriteMessage(undefined);\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  function onListFavoriteMessages() {\r\n    if (flagToLoadFavoriteMessages) {\r\n      squadService?.messages.listFavorites(\r\n        {\r\n          contactTo: \"\",\r\n          contactType: \"\",\r\n          content: \"\",\r\n          contentType: \"\",\r\n          messageDate: \"\",\r\n          messageId: \"\",\r\n          message: \"\",\r\n        },\r\n        (success) => {\r\n          if (success) {\r\n            setFavoriteMessages(success.messages.map((item) => item));\r\n            setFlagToLoadFavoriteMessages(undefined);\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  function onRemovingContact() {\r\n    if (removedContact) {\r\n      contacts.forEach((ctc) => {\r\n        if (ctc.id === removedContact.id) {\r\n          if (ctc.added)\r\n            squadService?.contacts.remove(ctc, (success: boolean) => {\r\n              if (success) {\r\n                squadService?.contacts.list((ctcs) => {\r\n                  setContacts(ctcs);\r\n                  setRemovedContact(undefined);\r\n                });\r\n              }\r\n            });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onUserPasswordChange() {\r\n    if (changedUserPassword) {\r\n      squadService?.user.changePassword(changedUserPassword, (password) => {\r\n        if (password) {\r\n          setChangedUserPassword({ oldPassword: \"\", newPassword: \"\" });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onUserDataChange() {\r\n    if (changedUserData) {\r\n      squadService?.user.changeUserData(changedUserData, (chgd) => {\r\n        if (chgd) {\r\n          setUser({\r\n            ...user,\r\n            email: changedUserData.email,\r\n            name: changedUserData.name,\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onNewFavorite() {\r\n    if (newFavorite) {\r\n      const newFavoriteLoad = { ...newFavorite };\r\n      squadService?.contacts.setFavorite(newFavorite, (favorite) => {\r\n        if (favorite) {\r\n          setChats(\r\n            chats.map((cht) => {\r\n              if (cht.jid === newFavoriteLoad.jid) {\r\n                cht.favorite = !newFavoriteLoad.favorite;\r\n              }\r\n              return cht;\r\n            })\r\n          );\r\n          setGroups(\r\n            groups.map((grp) => {\r\n              if (grp.jid === newFavoriteLoad.jid) {\r\n                return {\r\n                  ...grp,\r\n                  favorite: !newFavoriteLoad.favorite,\r\n                };\r\n              }\r\n              return grp;\r\n            })\r\n          );\r\n          setContacts(\r\n            contacts.map((ctt) => {\r\n              if (ctt.jid === newFavoriteLoad.jid) {\r\n                return {\r\n                  ...ctt,\r\n                  favorite: !newFavoriteLoad.favorite,\r\n                };\r\n              }\r\n              return ctt;\r\n            })\r\n          );\r\n        }\r\n      });\r\n      setNewFavorite(undefined);\r\n    }\r\n  }\r\n  function chatCommunicatorSubscribe(evt: string, data: any) {\r\n    switch (evt) {\r\n      case Events.RECONNECTED:\r\n        setDisconnected(false);\r\n      // eslint-disable-next-line\r\n      case Events.ONLINE:\r\n        squadService?.chats.list((receivedChats) => {\r\n          const chats: IChat[] = [];\r\n          receivedChats.forEach((cht) => {\r\n            if (!chats.find((chat) => chat.id === cht.id)) {\r\n              chats.push(cht);\r\n            }\r\n          });\r\n          setChats(chats);\r\n          //populating groups\r\n          squadService?.groups.list((groups) => {\r\n            setGroups(groups);\r\n            //Joining Groups Rooms in XMPP\r\n            squadService?.chat?.joinGroups(groups.map((group) => group.jid));\r\n          });\r\n          //populating contacts\r\n          squadService?.contacts.list((contacts) => {\r\n            setContacts(contacts);\r\n          });\r\n\r\n          //populating conferences\r\n          setListRooms(true);\r\n          setFlagToLoadFavoriteMessages({ contactType: \"\" });\r\n        });\r\n        break;\r\n      case Events.ERROR:\r\n      case Events.OFFLINE:\r\n        if (localStorage.getItem(\"logout\") !== \"true\") {\r\n          squadService?.chat?.makeChat(chatCommunicatorSubscribe);\r\n        }\r\n        localStorage.removeItem(\"logout\");\r\n        console.log(evt);\r\n        break;\r\n      case Events.RECONNECTING:\r\n        // setShowChat(false);\r\n        // setActiveChat(actChtData);\r\n        // setChats([]);\r\n        // setGroups([]);\r\n        // setContacts([]);\r\n        // setConferenceList([]);\r\n        console.log(\"Reconnecting\");\r\n        setDisconnected(true);\r\n        break;\r\n      case Events.MESSAGE:\r\n        if (data.fromUser === user.jid) break;\r\n        let find = false;\r\n\r\n        let newChats: IChat[] = [];\r\n        chats.forEach((chat) => {\r\n          if (\r\n            data.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            data.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            find = true;\r\n            if (!chat.messages.filter((msg) => msg.id === data.id)[0])\r\n              chat.messages.push(data);\r\n            if (chat.id === activeChat.id) {\r\n              let chatTemporary = { ...chat };\r\n              setActiveChat(chatTemporary);\r\n            } else {\r\n              chat.unRead++;\r\n              chat.mencioned += ParseUserTag(user.id, data.message);\r\n              showNotification(chat.name);\r\n            }\r\n            newChats.unshift(chat);\r\n          } else {\r\n            newChats.push(chat);\r\n          }\r\n        });\r\n\r\n        if (!find) {\r\n          let newChat: IChat = {} as IChat;\r\n          squadService?.contacts.list((listContacts) => {\r\n            listContacts.forEach((c) => {\r\n              if (\r\n                data.fromUser.split(\"@\")[0] === c.jid.split(\"@\")[0] ||\r\n                data.toUser.split(\"@\")[0] === c.jid.split(\"@\")[0]\r\n              ) {\r\n                if (c.jid === data.fromUser) {\r\n                  find = true;\r\n                  newChat = {\r\n                    id: c.id,\r\n                    jid: c.jid,\r\n                    name: c.name,\r\n                    profilePicture: c.profilePicture,\r\n                    status: c.status,\r\n                    unRead: 1,\r\n                    chatType: ChatType.USER,\r\n                    inputMessage: \"\",\r\n                    isTyping: false,\r\n                    messages: [],\r\n                    favorite: c.favorite,\r\n                    added: c.added,\r\n                    mencioned: 0,\r\n                  };\r\n                  newChat.messages.push(data);\r\n                  newChats.unshift(newChat);\r\n                }\r\n              }\r\n            });\r\n          });\r\n        }\r\n\r\n        if (!find) {\r\n          let newChat: IChat = {} as IChat;\r\n\r\n          squadService?.groups.list((listGroups) => {\r\n            listGroups.forEach((g) => {\r\n              if (\r\n                data.fromUser.split(\"@\")[0] === g.jid.split(\"@\")[0] ||\r\n                data.toUser.split(\"@\")[0] === g.jid.split(\"@\")[0]\r\n              ) {\r\n                if (g.jid === data.fromUser) {\r\n                  find = true;\r\n                  newChat = {\r\n                    id: g.groupId,\r\n                    jid: g.jid,\r\n                    name: g.name,\r\n                    profilePicture: g.profilePicture,\r\n                    attachedFileList: undefined,\r\n                    conferenceRoomParticipants: undefined,\r\n                    department: undefined,\r\n                    email: undefined,\r\n                    groupId: g.groupId,\r\n                    members: g.members,\r\n                    messageLoaded: undefined,\r\n                    userDescription: undefined,\r\n                    status: undefined,\r\n                    unRead: 1,\r\n                    chatType: ChatType.GROUP,\r\n                    inputMessage: \"\",\r\n                    isTyping: false,\r\n                    messages: [],\r\n                    favorite: g.favorite,\r\n                    added: g.added,\r\n                    mencioned: 0,\r\n                  };\r\n                  newChat.messages.push(data);\r\n                  newChats.unshift(newChat);\r\n                }\r\n              }\r\n            });\r\n          });\r\n        }\r\n\r\n        setChats(newChats);\r\n\r\n        break;\r\n      case Events.RECEIVED:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.messages.find((msg) => msg.id === data.id))\r\n              chat.messages = chat.messages.map((message) => {\r\n                message.deliverStatus = DeliverStatus.DELIVERED;\r\n                return message;\r\n              });\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.DISPLAYED:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.messages.find((msg) => msg.id === data.id))\r\n              chat.messages = chat.messages.map((message) => {\r\n                message.readStatus = ReadStatus.READ;\r\n                return message;\r\n              });\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.COMPOSING:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.jid === data) {\r\n              chat.isTyping = true;\r\n              if (activeChat.jid === data) setActiveChat(chat);\r\n              deleteTypingTimeout(chat.jid);\r\n              setTypingTimeout(chat.jid);\r\n            }\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.ACTIVE:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.jid === data) {\r\n              chat.isTyping = false;\r\n              if (activeChat.jid === data) {\r\n                let chatUpdate = { ...chat };\r\n                setActiveChat(chatUpdate);\r\n              }\r\n              deleteTypingTimeout(chat.jid);\r\n            }\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.PRESENCE:\r\n        setChats(\r\n          chats.map((cht) => {\r\n            if (cht.jid && data.from) {\r\n              if (\r\n                cht.jid === data.from.split(\"/\")[0] &&\r\n                !cht.jid.includes(\"@conference.\")\r\n              ) {\r\n                cht.status = data.status;\r\n              }\r\n            }\r\n            return cht;\r\n          })\r\n        );\r\n        setContacts(\r\n          contacts.map((ctc) => {\r\n            if (ctc.jid && data.from) {\r\n              if (\r\n                ctc.jid === data.from.split(\"/\")[0] &&\r\n                !ctc.jid.includes(\"@conference.\")\r\n              ) {\r\n                ctc.status = data.status;\r\n              }\r\n            }\r\n            return ctc;\r\n          })\r\n        );\r\n        break;\r\n\r\n      case Events.SEND_EVENT:\r\n        const event = data as IMessage;\r\n        let finded;\r\n        let newChat: IChat[] = [];\r\n        chats.forEach((chat) => {\r\n          if (\r\n            event.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            event.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            finded = true;\r\n            if (!chat.messages.filter((msg) => msg.id === event.id)[0])\r\n              chat.messages.push(event);\r\n            if (chat.id === activeChat.id) {\r\n              let chatTemporary = { ...chat };\r\n              setActiveChat(chatTemporary);\r\n            } else {\r\n              chat.unRead++;\r\n              chat.mencioned += ParseUserTag(user.id, data.message);\r\n              showNotification(chat.name);\r\n            }\r\n            newChat.unshift(chat);\r\n          } else {\r\n            newChat.push(chat);\r\n          }\r\n        });\r\n        if (!finded) {\r\n          groups.forEach((grp) => {\r\n            if (\r\n              event.fromUser.split(\"@\")[0] === grp.jid.split(\"@\")[0] ||\r\n              event.toUser.split(\"@\")[0] === grp.jid.split(\"@\")[0]\r\n            ) {\r\n              finded = true;\r\n              let groupToBeInserted: IChat = {\r\n                added: grp.added,\r\n                chatType: ChatType.GROUP,\r\n                favorite: grp.favorite,\r\n                id: grp.groupId,\r\n                inputMessage: \"\",\r\n                isTyping: false,\r\n                jid: grp.jid,\r\n                messages: [event],\r\n                name: grp.name,\r\n                unRead: 0,\r\n                attachedFileList: undefined,\r\n                department: undefined,\r\n                email: undefined,\r\n                groupId: grp.groupId,\r\n                members: grp.members,\r\n                messageLoaded: undefined,\r\n                profilePicture: grp.profilePicture,\r\n                status: undefined,\r\n                userDescription: grp.description,\r\n                mencioned: 0,\r\n              };\r\n              newChat.unshift(groupToBeInserted);\r\n              setActiveChat(groupToBeInserted);\r\n            }\r\n          });\r\n        }\r\n        if (!finded) {\r\n          squadService?.groups.list((grps) => {\r\n            setGroups(grps);\r\n            grps.forEach((grp) => {\r\n              if (\r\n                event.fromUser.split(\"@\")[0] === grp.jid.split(\"@\")[0] ||\r\n                event.toUser.split(\"@\")[0] === grp.jid.split(\"@\")[0]\r\n              ) {\r\n                finded = true;\r\n                let groupToBeInserted: IChat = {\r\n                  added: grp.added,\r\n                  chatType: ChatType.GROUP,\r\n                  favorite: grp.favorite,\r\n                  id: grp.groupId,\r\n                  inputMessage: \"\",\r\n                  isTyping: false,\r\n                  jid: grp.jid,\r\n                  messages: [event],\r\n                  name: grp.name,\r\n                  unRead: 1,\r\n                  attachedFileList: undefined,\r\n                  department: undefined,\r\n                  email: undefined,\r\n                  groupId: grp.groupId,\r\n                  members: grp.members,\r\n                  messageLoaded: undefined,\r\n                  profilePicture: grp.profilePicture,\r\n                  status: undefined,\r\n                  userDescription: grp.description,\r\n                  mencioned: 0,\r\n                };\r\n                newChat.unshift(groupToBeInserted);\r\n              }\r\n            });\r\n          });\r\n        }\r\n        setChats(newChat);\r\n        if (event.eventId === 6 || event.eventId === 2) {\r\n          refreshMembers(event);\r\n        }\r\n        break;\r\n      default:\r\n        console.log(evt);\r\n        break;\r\n    }\r\n  }\r\n\r\n  const refreshMembers = (event: IMessage) => {\r\n    squadService?.groups.list((grps) => {\r\n      setGroups(grps);\r\n      setChats(\r\n        chats.map((chat) => {\r\n          if (\r\n            event.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            event.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            chat.members = grps.find((grp) => grp.groupId === chat.id)?.members;\r\n            if (chat.id === activeChat.id) {\r\n              setActiveChat(chat);\r\n            }\r\n          }\r\n          return chat;\r\n        })\r\n      );\r\n    });\r\n  };\r\n\r\n  const deleteTypingTimeout = (jid: string) => {\r\n    clearTimeout(typingTimeout.get(jid)?.timeout || setTimeout(() => {}, 1));\r\n    typingTimeout.delete(jid);\r\n  };\r\n  const setTypingTimeout = (jid: string) => {\r\n    const timeoutData: TypingTimeoutData = {\r\n      msgStr: \"\",\r\n      timeout: setTimeout(() => {\r\n        setChats(\r\n          chats.map((cht) => {\r\n            if (cht.jid === jid) {\r\n              cht.isTyping = false;\r\n              if (activeChat.jid === jid) setActiveChat(cht);\r\n            }\r\n            return cht;\r\n          })\r\n        );\r\n      }, 20000),\r\n    };\r\n    typingTimeout.set(jid, timeoutData);\r\n  };\r\n\r\n  squadService?.updateChatSubscribeFuncition(chatCommunicatorSubscribe);\r\n  // Comentado para evitar warnings no console enquanto não é usado\r\n  // function createGroup(group: INewGroup, callback: CreateGroupCallback) {\r\n  //   squadService?.groups.create(group, (iGroup: IGroup) => {\r\n  //     squadService?.groups.list((groups) => {\r\n  //       setGroups(groups);\r\n  //       callback(true);\r\n  //     });\r\n  //   });\r\n  // }\r\n\r\n  function sendMessage(\r\n    chat: IChat,\r\n    message: string,\r\n    callback: SendMessageCallback\r\n  ) {\r\n    squadService?.chat?.chat.sendMessage(\r\n      chat.jid,\r\n      chat.jid.includes(\"@conference.\")\r\n        ? XMPPChatType.GROUPCHAT\r\n        : XMPPChatType.CHAT,\r\n      message,\r\n      callback\r\n    );\r\n  }\r\n\r\n  useEffect(init, []);\r\n\r\n  return <></>;\r\n};\r\n\r\nexport default SquadCommunicator;\r\n"]},"metadata":{},"sourceType":"module"}