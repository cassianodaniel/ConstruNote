{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import{parseContact}from\"../utils/parseUtils\";import debounce from\"lodash/debounce\";var ContactsBusiness=/*#__PURE__*/function(){function ContactsBusiness(api,settings){var _this=this;_classCallCheck(this,ContactsBusiness);this.api=api;this.settings=settings;this.contacts=void 0;this.chat=void 0;this.add=function(ctc,callback){_this.api.addContact({contactType:\"contact\",contactId:ctc.id,favorite:false,blocked:false},callback);};this.remove=function(ctc,callback){_this.api.removeContact({contactId:ctc.id,contactType:\"contact\"},callback);};this.addContacts=function(ctc,callback){_this.api.addContact({contactType:\"contact\",contactId:ctc.id,favorite:false,blocked:false},callback);};this.toggleMemberRole=function(usrId,grpId,mbRole,callback){mbRole===\"admin\"?_this.api.toggleMemberRole({admin:false,groupId:grpId,memberId:usrId},callback):_this.api.toggleMemberRole({admin:true,groupId:grpId,memberId:usrId},callback);};this.search=debounce(function(strSearch,callback){_this.settings.get(function(settings){_this.api.getContacts({paramsUrl:{limit:5000,contactType:\"contact\",domain:settings.sipDomain,name:strSearch}},function(apiContacts,err){if(!err){if(!_this.api)return;var searchList=apiContacts.contacts.map(function(contact){var _this$chat;return parseContact(contact,(_this$chat=_this.chat)===null||_this$chat===void 0?void 0:_this$chat.chat.presences);});callback(searchList);}});});},250);this.contacts=new Map();}_createClass(ContactsBusiness,[{key:\"setChat\",value:function setChat(chat){this.chat=chat;}},{key:\"getContacts\",value:function getContacts(){return this.contacts;}},{key:\"getContactsOutsideUserLists\",value:function getContactsOutsideUserLists(callback){var _this2=this;this.settings.get(function(settings){_this2.api.getContacts({paramsUrl:{limit:5000,contactType:\"contact\",domain:settings.sipDomain,added:false}},function(apiContacts,err){if(!err){if(!_this2.api)return;var searchList=apiContacts.contacts.map(function(contact){var _this2$chat;return parseContact(contact,(_this2$chat=_this2.chat)===null||_this2$chat===void 0?void 0:_this2$chat.chat.presences);});callback(searchList);}});});}},{key:\"list\",value:function list(callback){var _this3=this;this.settings.get(function(settings){_this3.api.getContacts({paramsUrl:{added:true,limit:5000,contactType:\"contact\",domain:settings.sipDomain}},function(apiContacts,err){// Populando o Map de contatos\nif(!err){if(!_this3.api)return;_this3.populate(apiContacts);//Favoritar o contato dentro da população com\n//favoriteCallback()\ncallback(Array.from(_this3.contacts.values()));}});});}},{key:\"populate\",value:function populate(apiContacts){var _this4=this;apiContacts.contacts.forEach(function(contact){var _this4$chat;_this4.contacts.set(contact.id,parseContact(contact,(_this4$chat=_this4.chat)===null||_this4$chat===void 0?void 0:_this4$chat.chat.presences));});}},{key:\"setFavorite\",value:function setFavorite(favorited,callback){this.api.setFavoriteUser({contactID:favorited.jid.split(\"@\")[0],contactType:favorited.jid.includes(\"@conference.\")?\"group\":\"contact\",favorite:!favorited.favorite},callback);}}]);return ContactsBusiness;}();export{ContactsBusiness as default};","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/business/Contacts.ts"],"names":["parseContact","debounce","ContactsBusiness","api","settings","contacts","chat","add","ctc","callback","addContact","contactType","contactId","id","favorite","blocked","remove","removeContact","addContacts","toggleMemberRole","usrId","grpId","mbRole","admin","groupId","memberId","search","strSearch","get","getContacts","paramsUrl","limit","domain","sipDomain","name","apiContacts","err","searchList","map","contact","presences","Map","added","populate","Array","from","values","forEach","set","favorited","setFavoriteUser","contactID","jid","split","includes"],"mappings":"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","sourcesContent":["import API from \"@digivox/apicommunicator\";\r\nimport IContact from \"../../alias/IContact\";\r\nimport IChat from \"../../alias/IChat\";\r\nimport IGroup from \"../../alias/IGroup\";\r\nimport { parseContact } from \"../utils/parseUtils\";\r\nimport SettingsBusiness from \"./Settings\";\r\nimport {\r\n  AddContactCallback,\r\n  FavoriteUserCallback,\r\n  RemoveContactCallback,\r\n  toggleMemberRoleCallback,\r\n} from \"@digivox/apicommunicator/dist/types/types/types\";\r\nimport debounce from \"lodash/debounce\";\r\nimport UserType from \"./../../enuns/UserType\";\r\nimport SquadChatCommunicator from \"../SquadChatCommunicator\";\r\ninterface ContactsCallBack {\r\n  (contacts: IContact[]): void;\r\n}\r\n\r\nexport default interface ContactsBusiness {}\r\nexport default class ContactsBusiness {\r\n  private contacts: Map<string, IContact>;\r\n  private chat: SquadChatCommunicator | undefined;\r\n  constructor(private api: API, private settings: SettingsBusiness) {\r\n    this.contacts = new Map<string, IContact>();\r\n  }\r\n  setChat(chat: SquadChatCommunicator) {\r\n    this.chat = chat;\r\n  }\r\n  getContacts() {\r\n    return this.contacts;\r\n  }\r\n\r\n  getContactsOutsideUserLists(callback: ContactsCallBack) {\r\n    this.settings.get((settings) => {\r\n      this.api.getContacts(\r\n        {\r\n          paramsUrl: {\r\n            limit: 5000,\r\n            contactType: \"contact\",\r\n            domain: settings.sipDomain,\r\n            added: false,\r\n          },\r\n        },\r\n        (apiContacts: any, err: any) => {\r\n          if (!err) {\r\n            if (!this.api) return;\r\n            const searchList = apiContacts.contacts.map((contact: any) => {\r\n              return parseContact(contact, this.chat?.chat.presences);\r\n            });\r\n            callback(searchList);\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  list(callback: ContactsCallBack) {\r\n    this.settings.get((settings) => {\r\n      this.api.getContacts(\r\n        {\r\n          paramsUrl: {\r\n            added: true,\r\n            limit: 5000,\r\n            contactType: \"contact\",\r\n            domain: settings.sipDomain,\r\n          },\r\n        },\r\n        (apiContacts: any, err: any) => {\r\n          // Populando o Map de contatos\r\n          if (!err) {\r\n            if (!this.api) return;\r\n            this.populate(apiContacts);\r\n\r\n            //Favoritar o contato dentro da população com\r\n            //favoriteCallback()\r\n\r\n            callback(Array.from(this.contacts.values()));\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n  populate(apiContacts: any) {\r\n    apiContacts.contacts.forEach((contact: any) => {\r\n      this.contacts.set(\r\n        contact.id,\r\n        parseContact(contact, this.chat?.chat.presences)\r\n      );\r\n    });\r\n  }\r\n  setFavorite(\r\n    favorited: IGroup | IChat | IContact,\r\n    callback: FavoriteUserCallback\r\n  ) {\r\n    this.api.setFavoriteUser(\r\n      {\r\n        contactID: favorited.jid.split(\"@\")[0],\r\n        contactType: favorited.jid.includes(\"@conference.\")\r\n          ? \"group\"\r\n          : \"contact\",\r\n        favorite: !favorited.favorite,\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  add = (ctc: IChat, callback: AddContactCallback) => {\r\n    this.api.addContact(\r\n      {\r\n        contactType: \"contact\",\r\n        contactId: ctc.id,\r\n        favorite: false,\r\n        blocked: false,\r\n      },\r\n      callback\r\n    );\r\n  };\r\n\r\n  remove = (ctc: IContact, callback: RemoveContactCallback) => {\r\n    this.api.removeContact(\r\n      {\r\n        contactId: ctc.id,\r\n        contactType: \"contact\",\r\n      },\r\n      callback\r\n    );\r\n  };\r\n\r\n  addContacts = (ctc: IContact, callback: AddContactCallback) => {\r\n    this.api.addContact(\r\n      {\r\n        contactType: \"contact\",\r\n        contactId: ctc.id,\r\n        favorite: false,\r\n        blocked: false,\r\n      },\r\n      callback\r\n    );\r\n  };\r\n\r\n  toggleMemberRole = (\r\n    usrId: string,\r\n    grpId: string,\r\n    mbRole: UserType,\r\n    callback: toggleMemberRoleCallback\r\n  ) => {\r\n    mbRole === \"admin\"\r\n      ? this.api.toggleMemberRole(\r\n          {\r\n            admin: false,\r\n            groupId: grpId,\r\n            memberId: usrId,\r\n          },\r\n          callback\r\n        )\r\n      : this.api.toggleMemberRole(\r\n          {\r\n            admin: true,\r\n            groupId: grpId,\r\n            memberId: usrId,\r\n          },\r\n          callback\r\n        );\r\n  };\r\n\r\n  search = debounce((strSearch: string, callback: ContactsCallBack) => {\r\n    this.settings.get((settings) => {\r\n      this.api.getContacts(\r\n        {\r\n          paramsUrl: {\r\n            limit: 5000,\r\n            contactType: \"contact\",\r\n            domain: settings.sipDomain,\r\n            name: strSearch,\r\n          },\r\n        },\r\n        (apiContacts: any, err: any) => {\r\n          if (!err) {\r\n            if (!this.api) return;\r\n            const searchList = apiContacts.contacts.map((contact: any) => {\r\n              return parseContact(contact, this.chat?.chat.presences);\r\n            });\r\n\r\n            callback(searchList);\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }, 250);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}