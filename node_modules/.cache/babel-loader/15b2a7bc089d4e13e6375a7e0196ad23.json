{"ast":null,"code":"import { parseContact } from \"../utils/parseUtils\";\nimport debounce from \"lodash/debounce\";\nexport default class ContactsBusiness {\n  constructor(api, settings) {\n    this.api = api;\n    this.settings = settings;\n    this.contacts = void 0;\n    this.search = debounce((strSearch, callback) => {\n      this.settings.get(settings => {\n        this.api.getContacts({\n          paramsUrl: {\n            limit: 5000,\n            contactType: \"contact\",\n            domain: settings.sipDomain,\n            name: strSearch\n          }\n        }, (apiContacts, err) => {\n          if (!err) {\n            if (!this.api) return;\n            const searchList = apiContacts.contacts.map(contact => {\n              return parseContact(contact);\n            });\n            callback(searchList);\n          }\n        });\n      });\n    }, 250);\n    this.contacts = new Map();\n  }\n\n  getContacts() {\n    return this.contacts;\n  }\n\n  getContactsOutsideUserLists(callback) {\n    this.settings.get(settings => {\n      this.api.getContacts({\n        paramsUrl: {\n          limit: 5000,\n          contactType: \"contact\",\n          domain: settings.sipDomain,\n          added: false\n        }\n      }, (apiContacts, err) => {\n        if (!err) {\n          if (!this.api) return;\n          const searchList = apiContacts.contacts.map(contact => {\n            return parseContact(contact);\n          });\n          callback(searchList);\n        }\n      });\n    });\n  }\n\n  list(callback) {\n    this.settings.get(settings => {\n      this.api.getContacts({\n        paramsUrl: {\n          added: true,\n          limit: 5000,\n          contactType: \"contact\",\n          domain: settings.sipDomain\n        }\n      }, (apiContacts, err) => {\n        // Populando o Map de contatos\n        if (!err) {\n          if (!this.api) return;\n          this.populate(apiContacts); //Favoritar o contato dentro da população com\n          //favoriteCallback()\n\n          callback(Array.from(this.contacts.values()));\n        }\n      });\n    });\n  }\n\n  populate(apiContacts) {\n    apiContacts.contacts.forEach(contact => {\n      this.contacts.set(contact.id, parseContact(contact));\n    });\n  }\n\n  setFavorite(favorited, callback) {\n    this.api.setFavoriteUser({\n      contactID: favorited.jid.split(\"@\")[0],\n      contactType: favorited.jid.includes(\"@conference.\") ? \"group\" : \"contact\",\n      favorite: !favorited.favorite\n    }, callback);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/business/Contacts.ts"],"names":["parseContact","debounce","ContactsBusiness","constructor","api","settings","contacts","search","strSearch","callback","get","getContacts","paramsUrl","limit","contactType","domain","sipDomain","name","apiContacts","err","searchList","map","contact","Map","getContactsOutsideUserLists","added","list","populate","Array","from","values","forEach","set","id","setFavorite","favorited","setFavoriteUser","contactID","jid","split","includes","favorite"],"mappings":"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","sourcesContent":["import API from \"@digivox/apicommunicator\";\r\nimport IContact from \"../../alias/IContact\";\r\nimport IChat from \"../../alias/IChat\";\r\nimport IGroup from \"../../alias/IGroup\";\r\nimport { parseContact } from \"../utils/parseUtils\";\r\nimport SettingsBusiness from \"./Settings\";\r\nimport { FavoriteUserCallback } from \"@digivox/apicommunicator/dist/types/types/types\";\r\nimport debounce from \"lodash/debounce\";\r\n\r\ninterface ContactsCallBack {\r\n  (contacts: IContact[]): void;\r\n}\r\n\r\nexport default interface ContactsBusiness {}\r\nexport default class ContactsBusiness {\r\n  private contacts: Map<string, IContact>;\r\n  constructor(private api: API, private settings: SettingsBusiness) {\r\n    this.contacts = new Map<string, IContact>();\r\n  }\r\n  getContacts() {\r\n    return this.contacts;\r\n  }\r\n\r\n  getContactsOutsideUserLists(callback: ContactsCallBack){\r\n    this.settings.get((settings) => {\r\n      this.api.getContacts(\r\n        {\r\n          paramsUrl: {\r\n            limit: 5000,\r\n            contactType: \"contact\",\r\n            domain: settings.sipDomain,\r\n            added: false\r\n          },\r\n        }, (apiContacts: any, err: any) => {\r\n          if (!err) {\r\n            if (!this.api) return;\r\n            const searchList = apiContacts.contacts.map((contact: any) => {\r\n              return parseContact(contact);\r\n            });\r\n            callback(searchList);\r\n        }\r\n      });\r\n    })\r\n  };\r\n\r\n\r\n  list(callback: ContactsCallBack) {\r\n    this.settings.get((settings) => {\r\n      this.api.getContacts(\r\n        {\r\n          paramsUrl: {\r\n            added: true,\r\n            limit: 5000,\r\n            contactType: \"contact\",\r\n            domain: settings.sipDomain,\r\n          },\r\n        },\r\n        (apiContacts: any, err: any) => {\r\n          // Populando o Map de contatos\r\n          if (!err) {\r\n            if (!this.api) return;\r\n            this.populate(apiContacts);\r\n\r\n            //Favoritar o contato dentro da população com\r\n            //favoriteCallback()\r\n\r\n            callback(Array.from(this.contacts.values()));\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n  populate(apiContacts: any) {\r\n    apiContacts.contacts.forEach((contact: any) => {\r\n      this.contacts.set(contact.id, parseContact(contact));\r\n    });\r\n  }\r\n  setFavorite(\r\n    favorited: IGroup | IChat | IContact,\r\n    callback: FavoriteUserCallback\r\n  ) {\r\n    this.api.setFavoriteUser(\r\n      {\r\n        contactID: favorited.jid.split(\"@\")[0],\r\n        contactType: favorited.jid.includes(\"@conference.\")\r\n          ? \"group\"\r\n          : \"contact\",\r\n        favorite: !favorited.favorite,\r\n      },\r\n      callback\r\n    );\r\n  }\r\n  search = debounce((strSearch: string, callback: ContactsCallBack) => {\r\n    this.settings.get((settings) => {\r\n      this.api.getContacts(\r\n        {\r\n          paramsUrl: {\r\n            limit: 5000,\r\n            contactType: \"contact\",\r\n            domain: settings.sipDomain,\r\n            name: strSearch,\r\n          },\r\n        },\r\n        (apiContacts: any, err: any) => {\r\n          if (!err) {\r\n            if (!this.api) return;\r\n            const searchList = apiContacts.contacts.map((contact: any) => {\r\n              return parseContact(contact);\r\n            });\r\n\r\n            callback(searchList);\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }, 250);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}