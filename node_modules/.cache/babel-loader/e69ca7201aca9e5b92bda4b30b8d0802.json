{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import React,{useEffect}from\"react\";import{SquadCommunicator as SquadService}from\"./SquadCommunicatorService\";import{useChat}from\"../contexts/ChatContext\";import{useAuth}from\"../contexts/AuthContext\";import{Events}from\"./chat/types/types\";import ChatType from\"./../enuns/ChatType\";import DeliverStatus from\"../enuns/DeliverStatus\";import{ChatType as XMPPChatType}from\"./chat/types/types\";import{getFileName,getUrlBooleans,isUrl}from\"./utils/parseUtils\";import ReadStatus from\"../enuns/ReadStatus\";import{useGroup}from\"../contexts/GroupContext\";import{useContact}from\"../contexts/ContactContext\";import{useModal}from\"../contexts/ModalContext\";import UserType from\"../enuns/UserType\";import{useConference}from\"../contexts/ConferenceContext\";import moment from\"moment\";import{ConferenceRoomParticipantType}from\"./business/Conferences\";import PresenceStatus from\"../enuns/PresenceStatus\";import{DateTime}from'luxon';//import { callbackify } from \"util\";\n// import IContact from \"../alias/IContact\";\n//Comentar para Evitar Warnings no console\nvar squadService;var typingTimeout=new Map();var SquadCommunicator=function SquadCommunicator(){var _squadService60;var _useChat=useChat(),chats=_useChat.chats,setChats=_useChat.setChats,activeChat=_useChat.activeChat,replyMsg=_useChat.replyMsg,setReplyMsg=_useChat.setReplyMsg,setActiveChat=_useChat.setActiveChat,forwardMessageList=_useChat.forwardMessageList,setForwardMessageList=_useChat.setForwardMessageList,setShowChat=_useChat.setShowChat,showChatProfileSidebar=_useChat.showChatProfileSidebar;var _useContact=useContact(),contactsSearch=_useContact.contactsSearch,setContactsSearched=_useContact.setContactsSearched,newFavorite=_useContact.newFavorite,setNewFavorite=_useContact.setNewFavorite,contacts=_useContact.contacts,setContacts=_useContact.setContacts,setContactsOutsideUserContacts=_useContact.setContactsOutsideUserContacts,toggleAddingContacts=_useContact.toggleAddingContacts,setToggleAddingContacts=_useContact.setToggleAddingContacts,checkedContacts=_useContact.checkedContacts,setCheckedContacts=_useContact.setCheckedContacts,removedContact=_useContact.removedContact,setRemovedContact=_useContact.setRemovedContact,checkedMembers=_useContact.checkedMembers,setCheckedMembers=_useContact.setCheckedMembers,groupToInsertMember=_useContact.groupToInsertMember,setGroupToInsertMember=_useContact.setGroupToInsertMember,clickedContact=_useContact.clickedContact,setClickedContact=_useContact.setClickedContact;var _useAuth=useAuth(),user=_useAuth.user,setUser=_useAuth.setUser,changedUserData=_useAuth.changedUserData,changedUserPassword=_useAuth.changedUserPassword,setChangedUserPassword=_useAuth.setChangedUserPassword;var _useModal=useModal(),showModalForwardMessageTo=_useModal.showModalForwardMessageTo,setShowModalForwardMessageTo=_useModal.setShowModalForwardMessageTo,showModalAddContact=_useModal.showModalAddContact;var _useGroup=useGroup(),setGroups=_useGroup.setGroups,groups=_useGroup.groups,memberQuit=_useGroup.memberQuit,groupIdOfLeaveRequest=_useGroup.groupIdOfLeaveRequest,setGroupIdOfLeaveRequest=_useGroup.setGroupIdOfLeaveRequest,setMemberQuit=_useGroup.setMemberQuit,groupToRemoveContact=_useGroup.groupToRemoveContact,setGroupToRemoveContact=_useGroup.setGroupToRemoveContact,removedMember=_useGroup.removedMember,setRemovedMember=_useGroup.setRemovedMember,toggleMemberRole=_useGroup.toggleMemberRole,setToggleMemberRole=_useGroup.setToggleMemberRole,changeGroupData=_useGroup.changeGroupData,setChangeGroupData=_useGroup.setChangeGroupData,groupToCreate=_useGroup.groupToCreate,setGroupToCreate=_useGroup.setGroupToCreate,groupJid=_useGroup.groupJid,setGroupJid=_useGroup.setGroupJid;var _useConference=useConference(),listRooms=_useConference.listRooms,setListRooms=_useConference.setListRooms,setConferenceList=_useConference.setConferenceList,setCreateConference=_useConference.setCreateConference,createConference=_useConference.createConference;var init=function init(){var _squadService;localStorage.setItem(\"authorization\",JSON.stringify({access_token:\"71e1503a96d94e1e231444bc5c0399ca\",user_id:\"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",user_name:\"ZZ Romero 2\",expires_in:2592000,email:\"romero2@digivox.com.br\",baseUrl:\"https://app.citrussquad.com/api/v1/\"}));squadService=SquadService.getInstance({chatCommunicatorSubscribe:chatCommunicatorSubscribe});(_squadService=squadService)===null||_squadService===void 0?void 0:_squadService.user.get(function(user){setUser(user);});};var clearSendFile=function clearSendFile(chatId,messageId){setChats(chats.map(function(chat){if(chat.id===chatId){chat.messages=chat.messages.map(function(message){if(message.id===messageId){message.deliverStatus=DeliverStatus.QUEUED;message.sendFile=undefined;}return message;});}return chat;}));};var onChatsChange=function onChatsChange(){// chats.forEach((chat) => {\n// });\n};var onActiveChatChange=function onActiveChatChange(){checkSendMessage(activeChat);checkAttachedFiles(activeChat);checkNewContact(activeChat);// checkTyping(activeChat)\n};// const checkTyping = (chat: IChat) => {\n//   const oldTimeoutData = typingTimeout.get(chat.jid)\n//   if (chat.inputMessage !== \"\" && (!oldTimeoutData || (oldTimeoutData.msgStr !== chat.inputMessage))) {\n//     if (oldTimeoutData)\n//       clearTimeout(oldTimeoutData.timeout)\n//     else\n//       squadService?.chat?.chat.sendTyping(chat.jid)\n//     const timeoutData = {\n//       timeout: setTimeout(() => { squadService?.chat?.chat.sendActive(chat.jid); typingTimeout.delete(chat.jid) }, 3000),\n//       msgStr: `${chat.inputMessage}`\n//     }\n//     typingTimeout.set(chat.jid, timeoutData)\n//   }\n// }\nvar checkNewContact=function checkNewContact(cht){if(!cht.added){var _squadService2;(_squadService2=squadService)===null||_squadService2===void 0?void 0:_squadService2.contacts.add(cht,function(success){if(success){var _squadService3;setChats(chats.map(function(chat){if(chat.jid===cht.jid){chat.added=true;}if(activeChat.jid===chat.jid)setActiveChat(chat);return chat;}));(_squadService3=squadService)===null||_squadService3===void 0?void 0:_squadService3.contacts.list(function(ctcs){setContacts(ctcs);});}});}};var checkAttachedFiles=function checkAttachedFiles(cht){if(cht.attachedFileList&&!cht.attachedFileList[0]){var _squadService4;(_squadService4=squadService)===null||_squadService4===void 0?void 0:_squadService4.attachments.list(cht,function(attachments){if(attachments.length>0){setActiveChat(_objectSpread(_objectSpread({},cht),{},{attachedFileList:attachments}));}else setActiveChat(_objectSpread(_objectSpread({},cht),{},{attachedFileList:null}));});}};/* getMessageUserProfilePicture = (msg: Message | FileMessage) => {\r\n    if (msg.from.includes(\"@conference.\")) {\r\n      const groups = this.groups.getGroups();\r\n      const group = groups.get(msg.from.split(\"@\")[0]);\r\n      const member = group?.members.filter(\r\n        (member) => member.userId === msg.from.split(\"/\")[1]\r\n      )[0];\r\n      return member?.profilePicture;\r\n    } else {\r\n      return this.contacts.getContacts().get(msg.from.split(\"@\")[0])\r\n        ?.profilePicture;\r\n    }\r\n  }; */var checkSearchMessages=function checkSearchMessages(){if(activeChat.messageLoaded){var _squadService5;(_squadService5=squadService)===null||_squadService5===void 0?void 0:_squadService5.messages.list(activeChat,function(messages){if(messages.length){setChats(chats.map(function(cht){if(cht.id===activeChat.id){messages.forEach(function(msg){if(!activeChat.messages.find(function(m){return m.id===msg.id;}))cht.messages.unshift(msg);});cht.messageLoaded=false;setActiveChat(cht);}return cht;}));}else{var chat=_objectSpread(_objectSpread({},activeChat),{},{messageLoaded:false});setActiveChat(chat);}});}};var getFileExtension=function getFileExtension(url){return url.split('.')[1];};var checkSendMessage=function checkSendMessage(chat){chat.messages.forEach(function(msg){if(msg.deliverStatus===DeliverStatus.SENDING){if(msg.sendFile&&!replyMsg){var _squadService6,_squadService6$chat;var files=[msg.sendFile];clearSendFile(chat.id,msg.id);(_squadService6=squadService)===null||_squadService6===void 0?void 0:(_squadService6$chat=_squadService6.chat)===null||_squadService6$chat===void 0?void 0:_squadService6$chat.sendFiles(chat,files,function(data){var _squadService7,_squadService7$user$u,_squadService8,_squadService$user$us;updateMessageFiles(data,chat,msg);console.log('jidFromUser:',(_squadService7=squadService)===null||_squadService7===void 0?void 0:(_squadService7$user$u=_squadService7.user.user)===null||_squadService7$user$u===void 0?void 0:_squadService7$user$u.jid);(_squadService8=squadService)===null||_squadService8===void 0?void 0:_squadService8.attachments.saveData({createdAt:DateTime.local().toISO().split(\"T\").join(\" \").slice(0,18),src:(_squadService$user$us=squadService.user.user)===null||_squadService$user$us===void 0?void 0:_squadService$user$us.jid,dst:chat.jid,fileExtension:getFileExtension(getFileName(data.url)),fileName:getFileName(data.url),fileUrl:data.url,kind:chat.chatType},function(){return true;});});}else{if(!msg.isForwardMessage&&!replyMsg){sendMessage(chat,msg.message,function(msgId){return updateMessage(msgId,chat,msg);});}else if(replyMsg){var _squadService9,_squadService9$chat;var replyMsgCopy=_objectSpread({},replyMsg);setReplyMsg(undefined);(_squadService9=squadService)===null||_squadService9===void 0?void 0:(_squadService9$chat=_squadService9.chat)===null||_squadService9$chat===void 0?void 0:_squadService9$chat.replyMsg(chat,msg,replyMsgCopy,function(msgId){updateMessage(msgId,chat,msg,replyMsgCopy);});}}}});};var updateMessageFiles=function updateMessageFiles(data,chat,msg){var newChat=_objectSpread({},chat);newChat.messages=chat.messages.map(function(message){if(msg.id===message.id){var booleans=getUrlBooleans(data.url);message.id=data.msgId;message.fileUrl=data.url;message.deliverStatus=DeliverStatus.QUEUED;message.time=new Date().toISOString();message.message=getFileName(data.url);message.isFileMessage=booleans.isFileMessage;message.isImageMessage=booleans.isImageMessage;message.isVideoMessage=booleans.isVideoMessage;message.isAudioMessage=booleans.isAudioMessage;}return message;});setActiveChat(newChat);if(!chats.filter(function(cht){return cht.id===chat.id;})[0]){var newChats=[chat].concat(_toConsumableArray(chats));setChats(newChats);}else{var _newChats=[];chats.forEach(function(cht){if(cht.id===chat.id){cht.messages=newChat.messages;_newChats.unshift(cht);}else{_newChats.push(cht);}});setChats(_newChats);}};var updateMessage=function updateMessage(msgId,chat,msg){var replyedMsg=arguments.length>3&&arguments[3]!==undefined?arguments[3]:undefined;var newChat=_objectSpread({},chat);newChat.messages=chat.messages.map(function(message){if(msg.id===message.id){message.id=msgId;message.deliverStatus=DeliverStatus.QUEUED;message.time=new Date().toISOString();if(replyedMsg){var _squadService10,_squadService10$conta,_squadService11,_squadService11$user,_squadService11$user$,_squadService12,_squadService12$user,_squadService12$user$;message.isReplyMessage=true;message.replyedMessage=replyedMsg.message||replyedMsg.fileUrl;message.replyedMessageId=replyedMsg.id;message.replyedMessageTo=((_squadService10=squadService)===null||_squadService10===void 0?void 0:(_squadService10$conta=_squadService10.contacts.getContacts().get(replyedMsg.fromUser.split(\"@\")[0]))===null||_squadService10$conta===void 0?void 0:_squadService10$conta.name)||((_squadService11=squadService)===null||_squadService11===void 0?void 0:(_squadService11$user=_squadService11.user)===null||_squadService11$user===void 0?void 0:(_squadService11$user$=_squadService11$user.user)===null||_squadService11$user$===void 0?void 0:_squadService11$user$.id)===replyedMsg.fromUser.split(\"@\")[0]?(_squadService12=squadService)===null||_squadService12===void 0?void 0:(_squadService12$user=_squadService12.user)===null||_squadService12$user===void 0?void 0:(_squadService12$user$=_squadService12$user.user)===null||_squadService12$user$===void 0?void 0:_squadService12$user$.name:\"Participant\";}if(isUrl(message.message)){var booleans=getUrlBooleans(message.message);message.isFileMessage=booleans.isFileMessage;message.isImageMessage=booleans.isImageMessage;message.isAudioMessage=booleans.isAudioMessage;message.isVideoMessage=booleans.isVideoMessage;message.fileUrl=message.message;}}return message;});if(activeChat.jid===newChat.jid)setActiveChat(newChat);if(!chats.filter(function(cht){return cht.id===chat.id;})[0]){var newChats=[chat].concat(_toConsumableArray(chats));setChats(newChats);}else{var _newChats2=[];chats.forEach(function(cht){if(cht.id===chat.id){cht.messages=newChat.messages;_newChats2.unshift(cht);}else{_newChats2.push(cht);}});setChats(_newChats2);}};var forwardMessage=function forwardMessage(){if(forwardMessageList&&showModalForwardMessageTo){var ctcs=_toConsumableArray(forwardMessageList);var message=_objectSpread({},showModalForwardMessageTo);setForwardMessageList(undefined);setShowModalForwardMessageTo(undefined);var chatsFinded=[];var oldChats=_toConsumableArray(chats.map(function(chat){return _objectSpread({},chat);}));ctcs===null||ctcs===void 0?void 0:ctcs.forEach(function(ctc,i){var cht=oldChats.find(function(cht){return cht.jid===ctc.jid;});if(cht){var _squadService13,_squadService13$chat;var msg=_objectSpread(_objectSpread({},message),{},{id:\"\".concat(cht.messages.length+1),userName:user.name,fromUser:user.id,toUser:ctc.jid.split(\"@\")[0],message:message.fileUrl||message.message,deliverStatus:DeliverStatus.QUEUED,isForwardMessage:true});(_squadService13=squadService)===null||_squadService13===void 0?void 0:(_squadService13$chat=_squadService13.chat)===null||_squadService13$chat===void 0?void 0:_squadService13$chat.forwardMessage(cht,msg,function(msgId){msg.id=msgId;cht.messages.push(msg);chatsFinded.push(cht);});}});var newChats=oldChats.map(function(chat){return chatsFinded.find(function(cht){return cht.id===chat.id;})||chat;});var ctcsNotInChat=ctcs.filter(function(ctc){return!newChats.find(function(cht){return ctc.jid===cht.jid;});});ctcsNotInChat.forEach(function(ctc,i){var _squadService14,_squadService14$chat;var chat={id:ctc.jid.split(\"@\")[0],jid:ctc.jid,name:ctc.name,profilePicture:ctc.profilePicture,status:ctc.status||undefined,unRead:0,chatType:ctc.jid.includes(\"@conference.\")?ChatType.GROUP:ChatType.USER,inputMessage:\"\",messageLoaded:false,isTyping:false,messages:[],email:ctc.email||undefined,favorite:ctc.favorite,added:ctc.added};var newMessage=_objectSpread(_objectSpread({},message),{},{id:\"\".concat(1),userName:user.name,fromUser:user.id,toUser:ctc.jid.split(\"@\")[0],deliverStatus:DeliverStatus.QUEUED,isForwardMessage:true});(_squadService14=squadService)===null||_squadService14===void 0?void 0:(_squadService14$chat=_squadService14.chat)===null||_squadService14$chat===void 0?void 0:_squadService14$chat.forwardMessage(chat,newMessage,function(msgId){newMessage.id=msgId;chat.messages.push(newMessage);newChats.unshift(chat);});});setChats(newChats);}};var onChangeStatus=function onChangeStatus(){var _squadService15,_squadService15$chat,_squadService15$chat$,_squadService15$chat$2;if(((_squadService15=squadService)===null||_squadService15===void 0?void 0:(_squadService15$chat=_squadService15.chat)===null||_squadService15$chat===void 0?void 0:(_squadService15$chat$=_squadService15$chat.chat)===null||_squadService15$chat$===void 0?void 0:(_squadService15$chat$2=_squadService15$chat$.client)===null||_squadService15$chat$2===void 0?void 0:_squadService15$chat$2.status)===\"online\"){var _squadService16,_squadService16$chat;(_squadService16=squadService)===null||_squadService16===void 0?void 0:(_squadService16$chat=_squadService16.chat)===null||_squadService16$chat===void 0?void 0:_squadService16$chat.changeStatus(user.status);}};var onSearchContacts=function onSearchContacts(){if(contactsSearch.length>2){var _squadService17;(_squadService17=squadService)===null||_squadService17===void 0?void 0:_squadService17.contacts.search(contactsSearch,function(searchList){setContactsSearched(searchList);});}else{setContactsSearched(undefined);}};var onSearchContactsOutsideUserContacts=function onSearchContactsOutsideUserContacts(){var _squadService18;(_squadService18=squadService)===null||_squadService18===void 0?void 0:_squadService18.contacts.getContactsOutsideUserLists(function(contacts){if(contacts){setContactsOutsideUserContacts(contacts);}});};var onToggleSidebarMenu=function onToggleSidebarMenu(){var _squadService19;(_squadService19=squadService)===null||_squadService19===void 0?void 0:_squadService19.contacts.getContactsOutsideUserLists(function(contacts){if(contacts){setContactsOutsideUserContacts(contacts);}});};var onRemovingMember=function onRemovingMember(){if(removedMember&&groupToRemoveContact){var _squadService20;var group=groups.find(function(grp){return grp.groupId===groupToRemoveContact;});if(group)(_squadService20=squadService)===null||_squadService20===void 0?void 0:_squadService20.groups.removeMember(group.groupId,removedMember,function(success){if(success){setGroups(groups.map(function(grp){if(grp.groupId===(group===null||group===void 0?void 0:group.groupId))grp.members=grp.members.filter(function(mb){return mb.userId!==removedMember.userId;});return grp;}));setChats(chats.map(function(cht){if(cht.groupId===(group===null||group===void 0?void 0:group.groupId)){var _cht$members;cht.members=(_cht$members=cht.members)===null||_cht$members===void 0?void 0:_cht$members.filter(function(mb){return mb.userId!==removedMember.userId;});if(cht.groupId===activeChat.groupId)setActiveChat(cht);}return cht;}));if(group){var _squadService21,_squadService21$chat;(_squadService21=squadService)===null||_squadService21===void 0?void 0:(_squadService21$chat=_squadService21.chat)===null||_squadService21$chat===void 0?void 0:_squadService21$chat.chat.sendEvent(group===null||group===void 0?void 0:group.jid,removedMember.userId,\"6\");}setRemovedMember(undefined);setGroupToRemoveContact(undefined);}});}};var onLeavingGroup=function onLeavingGroup(){if(memberQuit&&groupIdOfLeaveRequest&&groupJid){var _squadService22;(_squadService22=squadService)===null||_squadService22===void 0?void 0:_squadService22.groups.leftingGroup({groupId:groupIdOfLeaveRequest,memberId:memberQuit.userId},function(success){if(success){var _squadService23,_squadService23$chat,_squadService24,_squadService24$chat;(_squadService23=squadService)===null||_squadService23===void 0?void 0:(_squadService23$chat=_squadService23.chat)===null||_squadService23$chat===void 0?void 0:_squadService23$chat.chat.sendPresence(PresenceStatus.UNAVAILABLE,\"\".concat(groupJid,\"/\").concat(memberQuit.userId));(_squadService24=squadService)===null||_squadService24===void 0?void 0:(_squadService24$chat=_squadService24.chat)===null||_squadService24$chat===void 0?void 0:_squadService24$chat.chat.sendEvent(groupIdOfLeaveRequest,memberQuit.userId,\"3\",undefined);setChats(chats.filter(function(cht){return cht.groupId!==groupIdOfLeaveRequest;}));setGroups(groups.filter(function(grp){return grp.groupId!==groupIdOfLeaveRequest;}));if(activeChat.groupId===groupIdOfLeaveRequest){setShowChat(false);}}setGroupJid(undefined);setMemberQuit(undefined);setGroupIdOfLeaveRequest(\"\");});}};var onAddingMembers=function onAddingMembers(){var asynchronousFlag=0;if(checkedMembers&&groupToInsertMember){var copiaCheckedMembers=_toConsumableArray(checkedMembers),copiaGroupToInsertMember=_objectSpread({},groupToInsertMember);copiaCheckedMembers.forEach(function(ctt){var _squadService25;(_squadService25=squadService)===null||_squadService25===void 0?void 0:_squadService25.groups.addMember(copiaGroupToInsertMember,ctt,function(success){if(success){var _squadService26,_squadService26$chat;(_squadService26=squadService)===null||_squadService26===void 0?void 0:(_squadService26$chat=_squadService26.chat)===null||_squadService26$chat===void 0?void 0:_squadService26$chat.chat.sendEvent(copiaGroupToInsertMember.jid,ctt.id,\"2\");asynchronousFlag++;if(copiaCheckedMembers.length===asynchronousFlag){var _squadService27;(_squadService27=squadService)===null||_squadService27===void 0?void 0:_squadService27.groups.list(function(grps){setGroups(grps);setChats(chats.map(function(cht){if(cht.groupId===copiaGroupToInsertMember.groupId){var foundedGroup=grps.find(function(grp){return grp.groupId===cht.groupId;});cht.members=foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.members;if(activeChat.groupId===cht.groupId){activeChat.members=foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.members;setActiveChat(activeChat);}}return cht;}));});}}});});setCheckedMembers([]);setToggleAddingContacts(false);setGroupToInsertMember(undefined);}};var onAddingContacts=function onAddingContacts(){var asynchronousFlag=0;if(checkedContacts&&toggleAddingContacts){checkedContacts.forEach(function(ctt){if(!ctt.added){var _squadService28;(_squadService28=squadService)===null||_squadService28===void 0?void 0:_squadService28.contacts.addContacts(ctt,function(success){if(success){asynchronousFlag++;if(checkedContacts.length===asynchronousFlag){var _squadService29;(_squadService29=squadService)===null||_squadService29===void 0?void 0:_squadService29.contacts.list(function(contacts){setContacts(contacts);setCheckedContacts([]);setToggleAddingContacts(false);});}}});}});}};var onAddingContactOnGroupList=function onAddingContactOnGroupList(){if(clickedContact){if(!clickedContact.added){var _squadService30;(_squadService30=squadService)===null||_squadService30===void 0?void 0:_squadService30.contacts.addContacts(clickedContact,function(success){if(success){var _squadService31;(_squadService31=squadService)===null||_squadService31===void 0?void 0:_squadService31.contacts.list(function(contacts){setContacts(contacts);setClickedContact(undefined);});}});}}};var onToggleMemberRole=function onToggleMemberRole(){if(toggleMemberRole){var _squadService32;(_squadService32=squadService)===null||_squadService32===void 0?void 0:_squadService32.groups.list(function(grps){grps.forEach(function(gp){if(gp.groupId===toggleMemberRole.gpId){gp.members.forEach(function(mb){if(mb.userId===toggleMemberRole.mbId){var _squadService33;(_squadService33=squadService)===null||_squadService33===void 0?void 0:_squadService33.contacts.toggleMemberRole(toggleMemberRole.mbId,toggleMemberRole.gpId,toggleMemberRole.mbRole,function(success){if(success){var newRole=toggleMemberRole.mbRole===UserType.USER?UserType.ADMIN:UserType.USER;setToggleMemberRole(undefined);setChats(chats.map(function(cht){if(cht.groupId===toggleMemberRole.gpId){var _cht$members2;cht.members=(_cht$members2=cht.members)===null||_cht$members2===void 0?void 0:_cht$members2.map(function(mb){if(mb.userId===toggleMemberRole.mbId){mb.role=newRole;if(cht.groupId){if(mb.role===UserType.ADMIN){var _squadService34,_squadService34$chat;(_squadService34=squadService)===null||_squadService34===void 0?void 0:(_squadService34$chat=_squadService34.chat)===null||_squadService34$chat===void 0?void 0:_squadService34$chat.chat.sendEvent(cht.groupId,mb.userId,\"8\");}else{var _squadService35,_squadService35$chat;(_squadService35=squadService)===null||_squadService35===void 0?void 0:(_squadService35$chat=_squadService35.chat)===null||_squadService35$chat===void 0?void 0:_squadService35$chat.chat.sendEvent(cht.groupId,mb.userId,\"9\");}}}return mb;});if(activeChat.groupId===cht.groupId)setActiveChat(cht);}return cht;}));setGroups(groups.map(function(grp){if(grp.groupId===toggleMemberRole.gpId){grp.members=grp.members.map(function(member){if(member.userId===toggleMemberRole.mbId)member.role=newRole;return member;});}return grp;}));}});}});}});});}};var onChangeGroupData=function onChangeGroupData(){if(changeGroupData){var _squadService36;(_squadService36=squadService)===null||_squadService36===void 0?void 0:_squadService36.groups.editGroupInfo({groupId:changeGroupData.groupId,groupName:changeGroupData.groupName,members:changeGroupData.members,description:changeGroupData.description},function(success){if(success){var _squadService37;(_squadService37=squadService)===null||_squadService37===void 0?void 0:_squadService37.groups.list(function(grps){var _squadService38,_squadService38$chat;var foundedGroup=grps.find(function(grp){return grp.groupId===changeGroupData.groupId;});setGroups(grps);setChats(chats.map(function(cht){if(cht.groupId===changeGroupData.groupId){if(foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.name){cht.name=foundedGroup.name;}if(activeChat.groupId===cht.groupId){if(foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.name){cht.name=foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.name;}setActiveChat(cht);}}return cht;}));(_squadService38=squadService)===null||_squadService38===void 0?void 0:(_squadService38$chat=_squadService38.chat)===null||_squadService38$chat===void 0?void 0:_squadService38$chat.chat.sendEvent(foundedGroup===null||foundedGroup===void 0?void 0:foundedGroup.jid,undefined,\"10\",undefined);setChangeGroupData(undefined);});}});}};var createGroup=function createGroup(){var _squadService39;(_squadService39=squadService)===null||_squadService39===void 0?void 0:_squadService39.groups.create(groupToCreate,function(parsedGroup){if(parsedGroup){var _squadService40,_squadService40$chat,_squadService41,_squadService42,_squadService42$chat;(_squadService40=squadService)===null||_squadService40===void 0?void 0:(_squadService40$chat=_squadService40.chat)===null||_squadService40$chat===void 0?void 0:_squadService40$chat.chat.sendEvent(parsedGroup.jid,parsedGroup.jid,\"1\");(_squadService41=squadService)===null||_squadService41===void 0?void 0:_squadService41.groups.list(function(groups){setGroups(groups);setGroupToCreate(undefined);});(_squadService42=squadService)===null||_squadService42===void 0?void 0:(_squadService42$chat=_squadService42.chat)===null||_squadService42$chat===void 0?void 0:_squadService42$chat.chat.sendEvent(parsedGroup.jid,undefined,\"1\",undefined);}});};var onListRooms=function onListRooms(){if(listRooms){var _squadService43;(_squadService43=squadService)===null||_squadService43===void 0?void 0:_squadService43.conferences.list(function(conferences){var _squadService44,_squadService44$chat;setConferenceList(conferences);(_squadService44=squadService)===null||_squadService44===void 0?void 0:(_squadService44$chat=_squadService44.chat)===null||_squadService44$chat===void 0?void 0:_squadService44$chat.joinGroups(conferences.map(function(conf){return conf.jid;}));});setListRooms(false);}};var onCreateRoom=function onCreateRoom(){if(createConference){var _squadService45;var momentStartDate=moment(\"\".concat(createConference.startDate,\" \").concat(createConference.startTime,\":00\"));var momentFinalDate=moment(momentStartDate).add(createConference.duration.split(\":\")[0],\"hours\").add(createConference.duration.split(\":\")[1],\"minutes\");var parsedConference={name:createConference.name,waitMod:createConference.mdCheck,startDatetime:\"\".concat(momentStartDate.format(\"DD-MM-YYYY hh:mm:ss\")),stopDatetime:\"\".concat(momentFinalDate.format(\"DD-MM-YYYY hh:mm:ss\"))};(_squadService45=squadService)===null||_squadService45===void 0?void 0:_squadService45.conferences.create(parsedConference,function(createdConference){var participantList=[];if(createdConference===null||createdConference===void 0?void 0:createdConference.id){var _createConference$sel,_createConference$ema,_squadService46;(_createConference$sel=createConference.selectedContact)===null||_createConference$sel===void 0?void 0:_createConference$sel.forEach(function(ctc){participantList.push({userUuid:ctc.id,description:\"\",email:ctc.email,name:ctc.name,type:ConferenceRoomParticipantType.PARTICIPANT,userModerator:false});});(_createConference$ema=createConference.emailList)===null||_createConference$ema===void 0?void 0:_createConference$ema.forEach(function(participant){participantList.push({userUuid:null,description:\"\",email:participant.email,name:participant.name,type:ConferenceRoomParticipantType.PARTICIPANT_EXTERNAL,userModerator:false});});(_squadService46=squadService)===null||_squadService46===void 0?void 0:_squadService46.conferences.addParticipants(createdConference.id,participantList,function(s){if(s){setCreateConference(undefined);setListRooms(true);}});}});}};useEffect(onChatsChange,[chats]);useEffect(onNewFavorite,[newFavorite]);useEffect(checkSearchMessages,[activeChat.messageLoaded]);useEffect(onActiveChatChange,[activeChat]);useEffect(onUserDataChange,[changedUserData]);useEffect(onUserPasswordChange,[changedUserPassword]);useEffect(onChangeStatus,[user.status]);useEffect(forwardMessage,[forwardMessageList]);useEffect(onSearchContacts,[contactsSearch]);useEffect(onSearchContactsOutsideUserContacts,[showModalAddContact]);useEffect(onAddingContacts,[toggleAddingContacts]);useEffect(onRemovingMember,[removedMember,groupToRemoveContact]);useEffect(onLeavingGroup,[memberQuit,groupIdOfLeaveRequest,groupJid]);useEffect(onRemovingContact,[removedContact]);useEffect(onAddingMembers,[groupToInsertMember,checkedMembers]);useEffect(onToggleMemberRole,[toggleMemberRole]);useEffect(onChangeGroupData,[changeGroupData]);useEffect(onAddingContactOnGroupList,[clickedContact]);useEffect(createGroup,[groupToCreate]);useEffect(onToggleSidebarMenu,[showChatProfileSidebar]);useEffect(onListRooms,[listRooms]);useEffect(onCreateRoom,[createConference]);function onRemovingContact(){if(removedContact){contacts.forEach(function(ctc){if(ctc.id===removedContact.id){var _squadService47;if(ctc.added)(_squadService47=squadService)===null||_squadService47===void 0?void 0:_squadService47.contacts.remove(ctc,function(success){if(success){var _squadService48;(_squadService48=squadService)===null||_squadService48===void 0?void 0:_squadService48.contacts.list(function(ctcs){setContacts(ctcs);setRemovedContact(undefined);});}});}});}}function onUserPasswordChange(){if(changedUserPassword){var _squadService49;(_squadService49=squadService)===null||_squadService49===void 0?void 0:_squadService49.user.changePassword(changedUserPassword,function(password){if(password){setChangedUserPassword({oldPassword:\"\",newPassword:\"\"});}});}}function onUserDataChange(){if(changedUserData){var _squadService50;(_squadService50=squadService)===null||_squadService50===void 0?void 0:_squadService50.user.changeUserData(changedUserData,function(chgd){if(chgd){setUser(_objectSpread(_objectSpread({},user),{},{email:changedUserData.email,name:changedUserData.name}));}});}}function onNewFavorite(){if(newFavorite){var _squadService51;var newFavoriteLoad=_objectSpread({},newFavorite);(_squadService51=squadService)===null||_squadService51===void 0?void 0:_squadService51.contacts.setFavorite(newFavorite,function(favorite){if(favorite){setChats(chats.map(function(cht){if(cht.jid===newFavoriteLoad.jid){cht.favorite=!newFavoriteLoad.favorite;}return cht;}));setGroups(groups.map(function(grp){if(grp.jid===newFavoriteLoad.jid){return _objectSpread(_objectSpread({},grp),{},{favorite:!newFavoriteLoad.favorite});}return grp;}));setContacts(contacts.map(function(ctt){if(ctt.jid===newFavoriteLoad.jid){return _objectSpread(_objectSpread({},ctt),{},{favorite:!newFavoriteLoad.favorite});}return ctt;}));}});setNewFavorite(undefined);}}function chatCommunicatorSubscribe(event,data){var _squadService52;switch(_event){case Events.ONLINE:(_squadService52=squadService)===null||_squadService52===void 0?void 0:_squadService52.chats.list(function(receivedChats){var _squadService53,_squadService55;var chats=[];receivedChats.forEach(function(cht){if(!chats.find(function(chat){return chat.id===cht.id;})){chats.push(cht);}});setChats(chats);//populating groups\n(_squadService53=squadService)===null||_squadService53===void 0?void 0:_squadService53.groups.list(function(groups){var _squadService54,_squadService54$chat;setGroups(groups);//Joining Groups Rooms in XMPP\n(_squadService54=squadService)===null||_squadService54===void 0?void 0:(_squadService54$chat=_squadService54.chat)===null||_squadService54$chat===void 0?void 0:_squadService54$chat.joinGroups(groups.map(function(group){return group.jid;}));});//populating contacts\n(_squadService55=squadService)===null||_squadService55===void 0?void 0:_squadService55.contacts.list(function(contacts){return setContacts(contacts);});//populating conferences\nsetListRooms(true);//populating chat's with messages\n// receivedChats.forEach((chat) => {\n//   squadService?.messages.list(chat, (messages) => {\n//     const chatWithMessages = { ...chat };\n//     chatWithMessages.messages = chatWithMessages.messages.concat(\n//       messages\n//     );\n//     setChats([\n//       ...receivedChats.filter((cht) => chat.id !== cht.id),\n//       chatWithMessages,\n//     ]);\n//   });\n// });\n});break;case Events.MESSAGE:if(data.fromUser===user.jid)break;var find=false;var newChats=[];chats.forEach(function(chat){if(data.fromUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]||data.toUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]){find=true;if(!chat.messages.filter(function(msg){return msg.id===data.id;})[0])chat.messages.push(data);if(chat.id===activeChat.id){var chatTemporary=_objectSpread({},chat);setActiveChat(chatTemporary);}else{chat.unRead++;}newChats.unshift(chat);}else{newChats.push(chat);}});if(!find){var _squadService56;var _newChat={};(_squadService56=squadService)===null||_squadService56===void 0?void 0:_squadService56.contacts.list(function(listContacts){listContacts.forEach(function(c){if(data.fromUser.split(\"@\")[0]===c.jid.split(\"@\")[0]||data.toUser.split(\"@\")[0]===c.jid.split(\"@\")[0]){if(c.jid===data.fromUser){find=true;_newChat={id:c.id,jid:c.jid,name:c.name,profilePicture:c.profilePicture,status:c.status,unRead:1,chatType:ChatType.USER,inputMessage:\"\",isTyping:false,messages:[],favorite:c.favorite,added:c.added};_newChat.messages.push(data);newChats.unshift(_newChat);}}});});}if(!find){var _squadService57;var _newChat2={};(_squadService57=squadService)===null||_squadService57===void 0?void 0:_squadService57.groups.list(function(listGroups){listGroups.forEach(function(g){if(data.fromUser.split(\"@\")[0]===g.jid.split(\"@\")[0]||data.toUser.split(\"@\")[0]===g.jid.split(\"@\")[0]){if(g.jid===data.fromUser){find=true;_newChat2={id:g.groupId,jid:g.jid,name:g.name,profilePicture:g.profilePicture,attachedFileList:undefined,conferenceRoomParticipants:undefined,department:undefined,email:undefined,groupId:g.groupId,members:g.members,messageLoaded:undefined,userDescription:undefined,status:undefined,unRead:1,chatType:ChatType.GROUP,inputMessage:\"\",isTyping:false,messages:[],favorite:g.favorite,added:g.added};_newChat2.messages.push(data);newChats.unshift(_newChat2);}}});});}setChats(newChats);break;case Events.RECEIVED:setChats(chats.map(function(chat){if(chat.messages.find(function(msg){return msg.id===data.id;}))chat.messages=chat.messages.map(function(message){message.deliverStatus=DeliverStatus.DELIVERED;return message;});return chat;}));break;case Events.DISPLAYED:setChats(chats.map(function(chat){if(chat.messages.find(function(msg){return msg.id===data.id;}))chat.messages=chat.messages.map(function(message){message.readStatus=ReadStatus.READ;return message;});return chat;}));break;case Events.COMPOSING:setChats(chats.map(function(chat){if(chat.jid===data){chat.isTyping=true;if(activeChat.jid===data)setActiveChat(chat);deleteTypingTimeout(chat.jid);setTypingTimeout(chat.jid);}return chat;}));break;case Events.ACTIVE:setChats(chats.map(function(chat){if(chat.jid===data){chat.isTyping=false;if(activeChat.jid===data){var chatUpdate=_objectSpread({},chat);setActiveChat(chatUpdate);}deleteTypingTimeout(chat.jid);}return chat;}));break;case Events.PRESENCE:setChats(chats.map(function(cht){if(cht.jid&&data.from){if(cht.jid===data.from.split(\"/\")[0]&&!cht.jid.includes(\"@conference.\")){cht.status=data.status;}}return cht;}));setContacts(contacts.map(function(ctc){if(ctc.jid&&data.from){if(ctc.jid===data.from.split(\"/\")[0]&&!ctc.jid.includes(\"@conference.\")){ctc.status=data.status;}}return ctc;}));break;case Events.SEND_EVENT:var _event=data;var finded;var newChat=[];chats.forEach(function(chat){if(_event.fromUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]||_event.toUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]){finded=true;if(!chat.messages.filter(function(msg){return msg.id===_event.id;})[0])chat.messages.push(_event);if(chat.id===activeChat.id){var chatTemporary=_objectSpread({},chat);setActiveChat(chatTemporary);}else{chat.unRead++;}newChat.unshift(chat);}else{newChat.push(chat);}});if(!finded){groups.forEach(function(grp){if(_event.fromUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]||_event.toUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]){finded=true;var groupToBeInserted={added:grp.added,chatType:ChatType.GROUP,favorite:grp.favorite,id:grp.groupId,inputMessage:\"\",isTyping:false,jid:grp.jid,messages:[_event],name:grp.name,unRead:0,attachedFileList:undefined,department:undefined,email:undefined,groupId:grp.groupId,members:grp.members,messageLoaded:undefined,profilePicture:grp.profilePicture,status:undefined,userDescription:grp.description};newChat.unshift(groupToBeInserted);setActiveChat(groupToBeInserted);}});}if(!finded){var _squadService58;(_squadService58=squadService)===null||_squadService58===void 0?void 0:_squadService58.groups.list(function(grps){setGroups(grps);grps.forEach(function(grp){if(_event.fromUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]||_event.toUser.split(\"@\")[0]===grp.jid.split(\"@\")[0]){finded=true;var groupToBeInserted={added:grp.added,chatType:ChatType.GROUP,favorite:grp.favorite,id:grp.groupId,inputMessage:\"\",isTyping:false,jid:grp.jid,messages:[_event],name:grp.name,unRead:1,attachedFileList:undefined,department:undefined,email:undefined,groupId:grp.groupId,members:grp.members,messageLoaded:undefined,profilePicture:grp.profilePicture,status:undefined,userDescription:grp.description};newChat.unshift(groupToBeInserted);}});});}setChats(newChat);if(_event.eventId===6||_event.eventId===2){refreshMembers(_event);}break;}}var refreshMembers=function refreshMembers(event){var _squadService59;(_squadService59=squadService)===null||_squadService59===void 0?void 0:_squadService59.groups.list(function(grps){setGroups(grps);setChats(chats.map(function(chat){if(event.fromUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]||event.toUser.split(\"@\")[0]===chat.jid.split(\"@\")[0]){var _grps$find;chat.members=(_grps$find=grps.find(function(grp){return grp.groupId===chat.id;}))===null||_grps$find===void 0?void 0:_grps$find.members;if(chat.id===activeChat.id){setActiveChat(chat);}}return chat;}));});};var deleteTypingTimeout=function deleteTypingTimeout(jid){var _typingTimeout$get;clearTimeout(((_typingTimeout$get=typingTimeout.get(jid))===null||_typingTimeout$get===void 0?void 0:_typingTimeout$get.timeout)||setTimeout(function(){},1));typingTimeout.delete(jid);};var setTypingTimeout=function setTypingTimeout(jid){var timeoutData={msgStr:\"\",timeout:setTimeout(function(){setChats(chats.map(function(cht){if(cht.jid===jid){cht.isTyping=false;if(activeChat.jid===jid)setActiveChat(cht);}return cht;}));},20000)};typingTimeout.set(jid,timeoutData);};(_squadService60=squadService)===null||_squadService60===void 0?void 0:_squadService60.updateChatSubscribeFuncition(chatCommunicatorSubscribe);// Comentado para evitar warnings no console enquanto não é usado\n// function createGroup(group: INewGroup, callback: CreateGroupCallback) {\n//   squadService?.groups.create(group, (iGroup: IGroup) => {\n//     squadService?.groups.list((groups) => {\n//       setGroups(groups);\n//       callback(true);\n//     });\n//   });\n// }\nfunction sendMessage(chat,message,callback){var _squadService61,_squadService61$chat;(_squadService61=squadService)===null||_squadService61===void 0?void 0:(_squadService61$chat=_squadService61.chat)===null||_squadService61$chat===void 0?void 0:_squadService61$chat.chat.sendMessage(chat.jid,chat.jid.includes(\"@conference.\")?XMPPChatType.GROUPCHAT:XMPPChatType.CHAT,message,callback);}useEffect(init,[]);return/*#__PURE__*/React.createElement(React.Fragment,null);};export default SquadCommunicator;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/services/SquadCommunicator.tsx"],"names":["React","useEffect","SquadCommunicator","SquadService","useChat","useAuth","Events","ChatType","DeliverStatus","XMPPChatType","getFileName","getUrlBooleans","isUrl","ReadStatus","useGroup","useContact","useModal","UserType","useConference","moment","ConferenceRoomParticipantType","PresenceStatus","DateTime","squadService","typingTimeout","Map","chats","setChats","activeChat","replyMsg","setReplyMsg","setActiveChat","forwardMessageList","setForwardMessageList","setShowChat","showChatProfileSidebar","contactsSearch","setContactsSearched","newFavorite","setNewFavorite","contacts","setContacts","setContactsOutsideUserContacts","toggleAddingContacts","setToggleAddingContacts","checkedContacts","setCheckedContacts","removedContact","setRemovedContact","checkedMembers","setCheckedMembers","groupToInsertMember","setGroupToInsertMember","clickedContact","setClickedContact","user","setUser","changedUserData","changedUserPassword","setChangedUserPassword","showModalForwardMessageTo","setShowModalForwardMessageTo","showModalAddContact","setGroups","groups","memberQuit","groupIdOfLeaveRequest","setGroupIdOfLeaveRequest","setMemberQuit","groupToRemoveContact","setGroupToRemoveContact","removedMember","setRemovedMember","toggleMemberRole","setToggleMemberRole","changeGroupData","setChangeGroupData","groupToCreate","setGroupToCreate","groupJid","setGroupJid","listRooms","setListRooms","setConferenceList","setCreateConference","createConference","init","localStorage","setItem","JSON","stringify","access_token","user_id","user_name","expires_in","email","baseUrl","getInstance","chatCommunicatorSubscribe","get","clearSendFile","chatId","messageId","map","chat","id","messages","message","deliverStatus","QUEUED","sendFile","undefined","onChatsChange","onActiveChatChange","checkSendMessage","checkAttachedFiles","checkNewContact","cht","added","add","success","jid","list","ctcs","attachedFileList","attachments","length","checkSearchMessages","messageLoaded","forEach","msg","find","m","unshift","getFileExtension","url","split","SENDING","files","sendFiles","data","updateMessageFiles","console","log","saveData","createdAt","local","toISO","join","slice","src","dst","fileExtension","fileName","fileUrl","kind","chatType","isForwardMessage","sendMessage","msgId","updateMessage","replyMsgCopy","newChat","booleans","time","Date","toISOString","isFileMessage","isImageMessage","isVideoMessage","isAudioMessage","filter","newChats","push","replyedMsg","isReplyMessage","replyedMessage","replyedMessageId","replyedMessageTo","getContacts","fromUser","name","forwardMessage","chatsFinded","oldChats","ctc","i","userName","toUser","ctcsNotInChat","profilePicture","status","unRead","includes","GROUP","USER","inputMessage","isTyping","favorite","newMessage","onChangeStatus","client","changeStatus","onSearchContacts","search","searchList","onSearchContactsOutsideUserContacts","getContactsOutsideUserLists","onToggleSidebarMenu","onRemovingMember","group","grp","groupId","removeMember","members","mb","userId","sendEvent","onLeavingGroup","leftingGroup","memberId","sendPresence","UNAVAILABLE","onAddingMembers","asynchronousFlag","copiaCheckedMembers","copiaGroupToInsertMember","ctt","addMember","grps","foundedGroup","onAddingContacts","addContacts","onAddingContactOnGroupList","onToggleMemberRole","gp","gpId","mbId","mbRole","newRole","ADMIN","role","member","onChangeGroupData","editGroupInfo","groupName","description","createGroup","create","parsedGroup","onListRooms","conferences","joinGroups","conf","onCreateRoom","momentStartDate","startDate","startTime","momentFinalDate","duration","parsedConference","waitMod","mdCheck","startDatetime","format","stopDatetime","createdConference","participantList","selectedContact","userUuid","type","PARTICIPANT","userModerator","emailList","participant","PARTICIPANT_EXTERNAL","addParticipants","s","onNewFavorite","onUserDataChange","onUserPasswordChange","onRemovingContact","remove","changePassword","password","oldPassword","newPassword","changeUserData","chgd","newFavoriteLoad","setFavorite","event","ONLINE","receivedChats","MESSAGE","chatTemporary","listContacts","c","listGroups","g","conferenceRoomParticipants","department","userDescription","RECEIVED","DELIVERED","DISPLAYED","readStatus","READ","COMPOSING","deleteTypingTimeout","setTypingTimeout","ACTIVE","chatUpdate","PRESENCE","from","SEND_EVENT","finded","groupToBeInserted","eventId","refreshMembers","clearTimeout","timeout","setTimeout","delete","timeoutData","msgStr","set","updateChatSubscribeFuncition","callback","GROUPCHAT","CHAT"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { SquadCommunicator as SquadService } from \"./SquadCommunicatorService\";\r\nimport { useChat } from \"../contexts/ChatContext\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport IUser from \"../alias/IUser\";\r\nimport { Events, SendImageCallbackReturn } from \"./chat/types/types\";\r\nimport ChatType from \"./../enuns/ChatType\";\r\nimport IChat from \"../alias/IChat\";\r\nimport DeliverStatus from \"../enuns/DeliverStatus\";\r\nimport { ChatType as XMPPChatType } from \"./chat/types/types\";\r\nimport { SendMessageCallback } from \"./types\";\r\nimport IMessage from \"../alias/IMessage\";\r\nimport { getFileName, getUrlBooleans, isUrl } from \"./utils/parseUtils\";\r\nimport ReadStatus from \"../enuns/ReadStatus\";\r\nimport { useGroup } from \"../contexts/GroupContext\";\r\nimport { useContact } from \"../contexts/ContactContext\";\r\nimport { useModal } from \"../contexts/ModalContext\";\r\nimport IContact from \"../alias/IContact\";\r\nimport IGroup from \"../alias/IGroup\";\r\nimport UserType from \"../enuns/UserType\";\r\nimport { useConference } from \"../contexts/ConferenceContext\";\r\nimport moment from \"moment\";\r\nimport { ConferenceRoomParticipantType } from \"./business/Conferences\";\r\nimport { ConferenceRoomParticipant } from \"@digivox/apicommunicator/dist/types/types/types\";\r\nimport PresenceStatus from \"../enuns/PresenceStatus\";\r\nimport { DateTime } from 'luxon'\r\n\r\n//import { callbackify } from \"util\";\r\n\r\n// import IContact from \"../alias/IContact\";\r\n//Comentar para Evitar Warnings no console\r\ninterface CreateGroupCallback {\r\n  (success: boolean): void;\r\n}\r\ninterface TypingTimeoutData {\r\n  timeout: NodeJS.Timeout;\r\n  msgStr: string;\r\n}\r\nlet squadService: SquadService | undefined;\r\nlet typingTimeout: Map<string, TypingTimeoutData> = new Map<\r\n  string,\r\n  TypingTimeoutData\r\n>();\r\n\r\nconst SquadCommunicator: React.FC = () => {\r\n  const {\r\n    chats,\r\n    setChats,\r\n    activeChat,\r\n    replyMsg,\r\n    setReplyMsg,\r\n    setActiveChat,\r\n    forwardMessageList,\r\n    setForwardMessageList,\r\n    setShowChat,\r\n    showChatProfileSidebar,\r\n  } = useChat();\r\n  const {\r\n    contactsSearch,\r\n    setContactsSearched,\r\n    newFavorite,\r\n    setNewFavorite,\r\n    contacts,\r\n    setContacts,\r\n    setContactsOutsideUserContacts,\r\n    toggleAddingContacts,\r\n    setToggleAddingContacts,\r\n    checkedContacts,\r\n    setCheckedContacts,\r\n    removedContact,\r\n    setRemovedContact,\r\n    checkedMembers,\r\n    setCheckedMembers,\r\n    groupToInsertMember,\r\n    setGroupToInsertMember,\r\n    clickedContact,\r\n    setClickedContact,\r\n  } = useContact();\r\n  const {\r\n    user,\r\n    setUser,\r\n    changedUserData,\r\n    changedUserPassword,\r\n    setChangedUserPassword,\r\n  } = useAuth();\r\n  const {\r\n    showModalForwardMessageTo,\r\n    setShowModalForwardMessageTo,\r\n    showModalAddContact,\r\n  } = useModal();\r\n\r\n  const {\r\n    setGroups,\r\n    groups,\r\n    memberQuit,\r\n    groupIdOfLeaveRequest,\r\n    setGroupIdOfLeaveRequest,\r\n    setMemberQuit,\r\n    groupToRemoveContact,\r\n    setGroupToRemoveContact,\r\n    removedMember,\r\n    setRemovedMember,\r\n    toggleMemberRole,\r\n    setToggleMemberRole,\r\n    changeGroupData,\r\n    setChangeGroupData,\r\n    groupToCreate,\r\n    setGroupToCreate,\r\n    groupJid,\r\n    setGroupJid\r\n  } = useGroup();\r\n  const {\r\n    listRooms,\r\n    setListRooms,\r\n    setConferenceList,\r\n    setCreateConference,\r\n    createConference,\r\n  } = useConference();\r\n  const init = () => {\r\n    localStorage.setItem(\r\n      \"authorization\",\r\n      JSON.stringify({\r\n        access_token: \"71e1503a96d94e1e231444bc5c0399ca\",\r\n        user_id: \"11d3a709-8c53-0392-0149-3a3a0e0eeaae\",\r\n        user_name: \"ZZ Romero 2\",\r\n        expires_in: 2592000,\r\n        email: \"romero2@digivox.com.br\",\r\n        baseUrl: \"https://app.citrussquad.com/api/v1/\",\r\n      })\r\n    );\r\n    squadService = SquadService.getInstance({\r\n      chatCommunicatorSubscribe: chatCommunicatorSubscribe,\r\n    });\r\n    squadService?.user.get((user: IUser) => {\r\n      setUser(user);\r\n    });\r\n  };\r\n\r\n  const clearSendFile = (chatId: string, messageId: string) => {\r\n    setChats(\r\n      chats.map((chat) => {\r\n        if (chat.id === chatId) {\r\n          chat.messages = chat.messages.map((message) => {\r\n            if (message.id === messageId) {\r\n              message.deliverStatus = DeliverStatus.QUEUED;\r\n              message.sendFile = undefined;\r\n            }\r\n            return message;\r\n          });\r\n        }\r\n        return chat;\r\n      })\r\n    );\r\n  };\r\n\r\n  const onChatsChange = () => {\r\n    // chats.forEach((chat) => {\r\n    // });\r\n  };\r\n  const onActiveChatChange = () => {\r\n    checkSendMessage(activeChat);\r\n    checkAttachedFiles(activeChat);\r\n    checkNewContact(activeChat);\r\n    // checkTyping(activeChat)\r\n  };\r\n  // const checkTyping = (chat: IChat) => {\r\n  //   const oldTimeoutData = typingTimeout.get(chat.jid)\r\n  //   if (chat.inputMessage !== \"\" && (!oldTimeoutData || (oldTimeoutData.msgStr !== chat.inputMessage))) {\r\n  //     if (oldTimeoutData)\r\n  //       clearTimeout(oldTimeoutData.timeout)\r\n  //     else\r\n  //       squadService?.chat?.chat.sendTyping(chat.jid)\r\n  //     const timeoutData = {\r\n  //       timeout: setTimeout(() => { squadService?.chat?.chat.sendActive(chat.jid); typingTimeout.delete(chat.jid) }, 3000),\r\n  //       msgStr: `${chat.inputMessage}`\r\n  //     }\r\n  //     typingTimeout.set(chat.jid, timeoutData)\r\n  //   }\r\n  // }\r\n  const checkNewContact = (cht: IChat) => {\r\n    if (!cht.added) {\r\n      squadService?.contacts.add(cht, (success: boolean) => {\r\n        if (success) {\r\n          setChats(\r\n            chats.map((chat) => {\r\n              if (chat.jid === cht.jid) {\r\n                chat.added = true;\r\n              }\r\n              if (activeChat.jid === chat.jid) setActiveChat(chat);\r\n              return chat;\r\n            })\r\n          );\r\n          squadService?.contacts.list((ctcs) => {\r\n            setContacts(ctcs);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const checkAttachedFiles = (cht: IChat) => {\r\n    if (cht.attachedFileList && !cht.attachedFileList[0]) {\r\n      squadService?.attachments.list(cht, (attachments) => {\r\n        if (attachments.length > 0){\r\n          setActiveChat({ ...cht, attachedFileList: attachments });\r\n        }\r\n        else setActiveChat({ ...cht, attachedFileList: null });\r\n      });\r\n    }\r\n  };\r\n\r\n  /* getMessageUserProfilePicture = (msg: Message | FileMessage) => {\r\n    if (msg.from.includes(\"@conference.\")) {\r\n      const groups = this.groups.getGroups();\r\n      const group = groups.get(msg.from.split(\"@\")[0]);\r\n      const member = group?.members.filter(\r\n        (member) => member.userId === msg.from.split(\"/\")[1]\r\n      )[0];\r\n      return member?.profilePicture;\r\n    } else {\r\n      return this.contacts.getContacts().get(msg.from.split(\"@\")[0])\r\n        ?.profilePicture;\r\n    }\r\n  }; */\r\n\r\n  const checkSearchMessages = () => {\r\n    if (activeChat.messageLoaded) {\r\n      squadService?.messages.list(activeChat, (messages) => {\r\n        if (messages.length) {\r\n          setChats(\r\n            chats.map((cht) => {\r\n              if (cht.id === activeChat.id) {\r\n                messages.forEach((msg) => {\r\n                  if (!activeChat.messages.find((m) => m.id === msg.id))\r\n                    cht.messages.unshift(msg);\r\n                });\r\n                cht.messageLoaded = false;\r\n                setActiveChat(cht);\r\n              }\r\n              return cht;\r\n            })\r\n          );\r\n        } else {\r\n          const chat = { ...activeChat, messageLoaded: false };\r\n          setActiveChat(chat);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const getFileExtension = (url: string) => {\r\n    return url.split('.')[1];\r\n  }\r\n\r\n  const checkSendMessage = (chat: IChat) => {\r\n    chat.messages.forEach((msg) => {\r\n      if (msg.deliverStatus === DeliverStatus.SENDING) {\r\n        if (msg.sendFile && !replyMsg) {\r\n          const files = [msg.sendFile];\r\n          clearSendFile(chat.id, msg.id);\r\n          squadService?.chat?.sendFiles(\r\n            chat,\r\n            files,\r\n            (data: SendImageCallbackReturn) => {\r\n              updateMessageFiles(data, chat, msg);\r\n              console.log('jidFromUser:', squadService?.user.user?.jid as string,);\r\n              squadService?.attachments.saveData({\r\n                createdAt: DateTime.local().toISO().split(\"T\").join(\" \").slice(0,18),\r\n                src: squadService.user.user?.jid as string,\r\n                dst: chat.jid,\r\n                fileExtension: getFileExtension(getFileName(data.url)),\r\n                fileName: getFileName(data.url),\r\n                fileUrl: data.url,\r\n                kind: chat.chatType,\r\n              }, () => true)\r\n            }\r\n          );\r\n        } else {\r\n          if (!msg.isForwardMessage && !replyMsg) {\r\n            sendMessage(chat, msg.message, (msgId) =>\r\n              updateMessage(msgId, chat, msg)\r\n            );\r\n          } else if (replyMsg) {\r\n            const replyMsgCopy = { ...replyMsg };\r\n            setReplyMsg(undefined);\r\n            squadService?.chat?.replyMsg(chat, msg, replyMsgCopy, (msgId) => {\r\n              updateMessage(msgId, chat, msg, replyMsgCopy);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  };\r\n  const updateMessageFiles = (\r\n    data: SendImageCallbackReturn,\r\n    chat: IChat,\r\n    msg: IMessage\r\n  ) => {\r\n    const newChat = { ...chat };\r\n    newChat.messages = chat.messages.map((message) => {\r\n      if (msg.id === message.id) {\r\n        const booleans = getUrlBooleans(data.url);\r\n        message.id = data.msgId;\r\n        message.fileUrl = data.url;\r\n        message.deliverStatus = DeliverStatus.QUEUED;\r\n        message.time = new Date().toISOString();\r\n        message.message = getFileName(data.url);\r\n        message.isFileMessage = booleans.isFileMessage;\r\n        message.isImageMessage = booleans.isImageMessage;\r\n        message.isVideoMessage = booleans.isVideoMessage;\r\n        message.isAudioMessage = booleans.isAudioMessage;\r\n      }\r\n      return message;\r\n    });\r\n    setActiveChat(newChat);\r\n    if (!chats.filter((cht) => cht.id === chat.id)[0]) {\r\n      const newChats = [chat, ...chats];\r\n      setChats(newChats);\r\n    } else {\r\n      const newChats: IChat[] = [];\r\n      chats.forEach((cht) => {\r\n        if (cht.id === chat.id) {\r\n          cht.messages = newChat.messages;\r\n          newChats.unshift(cht);\r\n        } else {\r\n          newChats.push(cht);\r\n        }\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const updateMessage = (\r\n    msgId: string,\r\n    chat: IChat,\r\n    msg: IMessage,\r\n    replyedMsg: IMessage | undefined = undefined\r\n  ) => {\r\n    const newChat = { ...chat };\r\n    newChat.messages = chat.messages.map((message) => {\r\n      if (msg.id === message.id) {\r\n        message.id = msgId;\r\n        message.deliverStatus = DeliverStatus.QUEUED;\r\n        message.time = new Date().toISOString();\r\n        if (replyedMsg) {\r\n          message.isReplyMessage = true;\r\n          message.replyedMessage = replyedMsg.message || replyedMsg.fileUrl;\r\n          message.replyedMessageId = replyedMsg.id;\r\n          message.replyedMessageTo =\r\n            squadService?.contacts\r\n              .getContacts()\r\n              .get(replyedMsg.fromUser.split(\"@\")[0])?.name ||\r\n            squadService?.user?.user?.id === replyedMsg.fromUser.split(\"@\")[0]\r\n              ? squadService?.user?.user?.name\r\n              : \"Participant\";\r\n        }\r\n        if (isUrl(message.message)) {\r\n          const booleans = getUrlBooleans(message.message);\r\n          message.isFileMessage = booleans.isFileMessage;\r\n          message.isImageMessage = booleans.isImageMessage;\r\n          message.isAudioMessage = booleans.isAudioMessage;\r\n          message.isVideoMessage = booleans.isVideoMessage;\r\n          message.fileUrl = message.message;\r\n        }\r\n      }\r\n      return message;\r\n    });\r\n    if (activeChat.jid === newChat.jid) setActiveChat(newChat);\r\n    if (!chats.filter((cht) => cht.id === chat.id)[0]) {\r\n      const newChats = [chat, ...chats];\r\n      setChats(newChats);\r\n    } else {\r\n      const newChats: IChat[] = [];\r\n      chats.forEach((cht) => {\r\n        if (cht.id === chat.id) {\r\n          cht.messages = newChat.messages;\r\n          newChats.unshift(cht);\r\n        } else {\r\n          newChats.push(cht);\r\n        }\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const forwardMessage = () => {\r\n    if (forwardMessageList && showModalForwardMessageTo) {\r\n      const ctcs = [...forwardMessageList];\r\n      const message = { ...showModalForwardMessageTo };\r\n      setForwardMessageList(undefined);\r\n      setShowModalForwardMessageTo(undefined);\r\n      const chatsFinded: IChat[] = [];\r\n      const oldChats = [\r\n        ...chats.map((chat) => {\r\n          return { ...chat };\r\n        }),\r\n      ];\r\n      ctcs?.forEach((ctc, i) => {\r\n        const cht = oldChats.find((cht) => cht.jid === ctc.jid);\r\n        if (cht) {\r\n          const msg = {\r\n            ...message,\r\n            id: `${cht.messages.length + 1}`,\r\n            userName: user.name,\r\n            fromUser: user.id,\r\n            toUser: ctc.jid.split(\"@\")[0],\r\n            message: message.fileUrl || message.message,\r\n            deliverStatus: DeliverStatus.QUEUED,\r\n            isForwardMessage: true,\r\n          };\r\n          squadService?.chat?.forwardMessage(cht, msg, (msgId) => {\r\n            msg.id = msgId;\r\n            cht.messages.push(msg);\r\n            chatsFinded.push(cht);\r\n          });\r\n        }\r\n      });\r\n      const newChats = oldChats.map(\r\n        (chat) => chatsFinded.find((cht) => cht.id === chat.id) || chat\r\n      );\r\n      const ctcsNotInChat: (IContact | IGroup)[] = ctcs.filter(\r\n        (ctc) => !newChats.find((cht) => ctc.jid === cht.jid)\r\n      );\r\n      ctcsNotInChat.forEach((ctc, i) => {\r\n        const chat = {\r\n          id: ctc.jid.split(\"@\")[0],\r\n          jid: ctc.jid,\r\n          name: ctc.name,\r\n          profilePicture: ctc.profilePicture,\r\n          status: (ctc as IContact).status || undefined,\r\n          unRead: 0,\r\n          chatType: ctc.jid.includes(\"@conference.\")\r\n            ? ChatType.GROUP\r\n            : ChatType.USER,\r\n          inputMessage: \"\",\r\n          messageLoaded: false,\r\n          isTyping: false,\r\n          messages: [] as IMessage[],\r\n          email: (ctc as IContact).email || undefined,\r\n          favorite: ctc.favorite,\r\n          added: ctc.added,\r\n        };\r\n        const newMessage: IMessage = {\r\n          ...message,\r\n          id: `${1}`,\r\n          userName: user.name,\r\n          fromUser: user.id,\r\n          toUser: ctc.jid.split(\"@\")[0],\r\n          deliverStatus: DeliverStatus.QUEUED,\r\n          isForwardMessage: true,\r\n        };\r\n        squadService?.chat?.forwardMessage(chat, newMessage, (msgId) => {\r\n          newMessage.id = msgId;\r\n          chat.messages.push(newMessage);\r\n          newChats.unshift(chat);\r\n        });\r\n      });\r\n      setChats(newChats);\r\n    }\r\n  };\r\n  const onChangeStatus = () => {\r\n    if (squadService?.chat?.chat?.client?.status === \"online\") {\r\n      squadService?.chat?.changeStatus(user.status);\r\n    }\r\n  };\r\n  const onSearchContacts = () => {\r\n    if (contactsSearch.length > 2) {\r\n      squadService?.contacts.search(contactsSearch, (searchList) => {\r\n        setContactsSearched(searchList);\r\n      });\r\n    } else {\r\n      setContactsSearched(undefined);\r\n    }\r\n  };\r\n\r\n  const onSearchContactsOutsideUserContacts = () => {\r\n    squadService?.contacts.getContactsOutsideUserLists((contacts) => {\r\n      if (contacts) {\r\n        setContactsOutsideUserContacts(contacts);\r\n      }\r\n    });\r\n  };\r\n\r\n  const onToggleSidebarMenu = () => {\r\n    squadService?.contacts.getContactsOutsideUserLists((contacts) => {\r\n      if (contacts) {\r\n        setContactsOutsideUserContacts(contacts);\r\n      }\r\n    });\r\n  };\r\n\r\n  const onRemovingMember = () => {\r\n    if (removedMember && groupToRemoveContact) {\r\n      let group = groups.find((grp) => grp.groupId === groupToRemoveContact);\r\n      if (group)\r\n        squadService?.groups.removeMember(\r\n          group.groupId,\r\n          removedMember,\r\n          (success: boolean) => {\r\n            if (success) {\r\n              setGroups(\r\n                groups.map((grp) => {\r\n                  if (grp.groupId === group?.groupId)\r\n                    grp.members = grp.members.filter(\r\n                      (mb) => mb.userId !== removedMember.userId\r\n                    );\r\n                  return grp;\r\n                })\r\n              );\r\n              setChats(\r\n                chats.map((cht) => {\r\n                  if (cht.groupId === group?.groupId) {\r\n                    cht.members = cht.members?.filter(\r\n                      (mb) => mb.userId !== removedMember.userId\r\n                    );\r\n                    if (cht.groupId === activeChat.groupId) setActiveChat(cht);\r\n                  }\r\n                  return cht;\r\n                })\r\n              );\r\n              if (group) {\r\n                squadService?.chat?.chat.sendEvent(\r\n                  group?.jid,\r\n                  removedMember.userId,\r\n                  \"6\"\r\n                );\r\n              }\r\n              setRemovedMember(undefined);\r\n              setGroupToRemoveContact(undefined);\r\n            }\r\n          }\r\n        );\r\n    }\r\n  };\r\n\r\n  const onLeavingGroup = () => {\r\n    if (memberQuit && groupIdOfLeaveRequest && groupJid) {\r\n      squadService?.groups.leftingGroup(\r\n        { groupId: groupIdOfLeaveRequest, memberId: memberQuit.userId },\r\n        (success: boolean) => { \r\n          if (success) {\r\n            squadService?.chat?.chat.sendPresence(PresenceStatus.UNAVAILABLE, `${groupJid}/${memberQuit.userId}`);  \r\n            squadService?.chat?.chat.sendEvent(\r\n              groupIdOfLeaveRequest,\r\n              memberQuit.userId,\r\n              \"3\",\r\n              undefined\r\n              );\r\n            setChats(\r\n              chats.filter((cht) => cht.groupId !== groupIdOfLeaveRequest)\r\n            );\r\n            setGroups(\r\n              groups.filter((grp) => grp.groupId !== groupIdOfLeaveRequest)\r\n            );\r\n              if (activeChat.groupId === groupIdOfLeaveRequest) {\r\n                setShowChat(false);\r\n              }\r\n            }\r\n            setGroupJid(undefined);\r\n            setMemberQuit(undefined);\r\n            setGroupIdOfLeaveRequest(\"\");\r\n          }\r\n          \r\n      );\r\n    }\r\n  };\r\n\r\n  const onAddingMembers = () => {\r\n    let asynchronousFlag = 0;\r\n    if (checkedMembers && groupToInsertMember) {\r\n      let copiaCheckedMembers = [...checkedMembers],\r\n        copiaGroupToInsertMember = { ...groupToInsertMember };\r\n      copiaCheckedMembers.forEach((ctt) => {\r\n        squadService?.groups.addMember(\r\n          copiaGroupToInsertMember,\r\n          ctt,\r\n          (success: boolean) => {\r\n            if (success) {\r\n              squadService?.chat?.chat.sendEvent(\r\n                copiaGroupToInsertMember.jid,\r\n                ctt.id,\r\n                \"2\"\r\n              );\r\n              asynchronousFlag++;\r\n\r\n              if (copiaCheckedMembers.length === asynchronousFlag) {\r\n                squadService?.groups.list((grps) => {\r\n                  setGroups(grps);\r\n                  setChats(\r\n                    chats.map((cht) => {\r\n                      if (cht.groupId === copiaGroupToInsertMember.groupId) {\r\n                        let foundedGroup = grps.find(\r\n                          (grp) => grp.groupId === cht.groupId\r\n                        );\r\n                        cht.members = foundedGroup?.members;\r\n                        if (activeChat.groupId === cht.groupId) {\r\n                          activeChat.members = foundedGroup?.members;\r\n                          setActiveChat(activeChat);\r\n                        }\r\n                      }\r\n                      return cht;\r\n                    })\r\n                  );\r\n                });\r\n              }\r\n            }\r\n          }\r\n        );\r\n      });\r\n      setCheckedMembers([]);\r\n      setToggleAddingContacts(false);\r\n      setGroupToInsertMember(undefined);\r\n    }\r\n  };\r\n\r\n  const onAddingContacts = () => {\r\n    let asynchronousFlag = 0;\r\n    if (checkedContacts && toggleAddingContacts) {\r\n      checkedContacts.forEach((ctt) => {\r\n        if (!ctt.added) {\r\n          squadService?.contacts.addContacts(ctt, (success: boolean) => {\r\n            if (success) {\r\n              asynchronousFlag++;\r\n              if (checkedContacts.length === asynchronousFlag) {\r\n                squadService?.contacts.list((contacts) => {\r\n                  setContacts(contacts);\r\n                  setCheckedContacts([]);\r\n                  setToggleAddingContacts(false);\r\n                });\r\n              }\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const onAddingContactOnGroupList = () => {\r\n    if (clickedContact) {\r\n      if (!clickedContact.added) {\r\n        squadService?.contacts.addContacts(\r\n          clickedContact,\r\n          (success: boolean) => {\r\n            if (success) {\r\n              squadService?.contacts.list((contacts) => {\r\n                setContacts(contacts);\r\n                setClickedContact(undefined);\r\n              });\r\n            }\r\n          }\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const onToggleMemberRole = () => {\r\n    if (toggleMemberRole) {\r\n      squadService?.groups.list((grps) => {\r\n        grps.forEach((gp) => {\r\n          if (gp.groupId === toggleMemberRole.gpId) {\r\n            gp.members.forEach((mb) => {\r\n              if (mb.userId === toggleMemberRole.mbId) {\r\n                squadService?.contacts.toggleMemberRole(\r\n                  toggleMemberRole.mbId,\r\n                  toggleMemberRole.gpId,\r\n                  toggleMemberRole.mbRole,\r\n                  (success: boolean) => {\r\n                    if (success) {\r\n                      const newRole =\r\n                        toggleMemberRole.mbRole === UserType.USER\r\n                          ? UserType.ADMIN\r\n                          : UserType.USER;\r\n                      setToggleMemberRole(undefined);\r\n                      setChats(\r\n                        chats.map((cht) => {\r\n                          if (cht.groupId === toggleMemberRole.gpId) {\r\n                            cht.members = cht.members?.map((mb) => {\r\n                              if (mb.userId === toggleMemberRole.mbId) {\r\n                                mb.role = newRole;\r\n                                if (cht.groupId) {\r\n                                  if (mb.role === UserType.ADMIN) {\r\n                                    squadService?.chat?.chat.sendEvent(\r\n                                      cht.groupId,\r\n                                      mb.userId,\r\n                                      \"8\"\r\n                                    );\r\n                                  } else {\r\n                                    squadService?.chat?.chat.sendEvent(\r\n                                      cht.groupId,\r\n                                      mb.userId,\r\n                                      \"9\"\r\n                                    );\r\n                                  }\r\n                                }\r\n                              }\r\n                              return mb;\r\n                            });\r\n                            if (activeChat.groupId === cht.groupId)\r\n                              setActiveChat(cht);\r\n                          }\r\n                          return cht;\r\n                        })\r\n                      );\r\n                      setGroups(\r\n                        groups.map((grp) => {\r\n                          if (grp.groupId === toggleMemberRole.gpId) {\r\n                            grp.members = grp.members.map((member) => {\r\n                              if (member.userId === toggleMemberRole.mbId)\r\n                                member.role = newRole;\r\n                              return member;\r\n                            });\r\n                          }\r\n                          return grp;\r\n                        })\r\n                      );\r\n                    }\r\n                  }\r\n                );\r\n              }\r\n            });\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  const onChangeGroupData = () => {\r\n    if (changeGroupData) {\r\n      squadService?.groups.editGroupInfo(\r\n        {\r\n          groupId: changeGroupData.groupId as string,\r\n          groupName: changeGroupData.groupName,\r\n          members: changeGroupData.members,\r\n          description: changeGroupData.description,\r\n        },\r\n        (success: boolean) => {\r\n          if (success) {\r\n            squadService?.groups.list((grps) => {\r\n              let foundedGroup = grps.find(\r\n                (grp) => grp.groupId === changeGroupData.groupId\r\n              );\r\n              setGroups(grps);\r\n              setChats(\r\n                chats.map((cht) => {\r\n                  if (cht.groupId === changeGroupData.groupId) {\r\n                    if (foundedGroup?.name) {\r\n                      cht.name = foundedGroup.name;\r\n                    }\r\n                    if (activeChat.groupId === cht.groupId) {\r\n                      if (foundedGroup?.name) {\r\n                        cht.name = foundedGroup?.name;\r\n                      }\r\n                      setActiveChat(cht);\r\n                    }\r\n                  }\r\n                  return cht;\r\n                })\r\n              );\r\n              squadService?.chat?.chat.sendEvent(\r\n                foundedGroup?.jid as string,\r\n                undefined,\r\n                \"10\",\r\n                undefined\r\n              );\r\n              setChangeGroupData(undefined);\r\n            });\r\n          }\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const createGroup = () => {\r\n    squadService?.groups.create(groupToCreate, (parsedGroup) => {\r\n      if (parsedGroup) {\r\n        squadService?.chat?.chat.sendEvent(\r\n          parsedGroup.jid,\r\n          parsedGroup.jid,\r\n          \"1\"\r\n        );\r\n        squadService?.groups.list((groups) => {\r\n          setGroups(groups);\r\n          setGroupToCreate(undefined);\r\n        });\r\n        squadService?.chat?.chat.sendEvent(\r\n          parsedGroup.jid,\r\n          undefined,\r\n          \"1\",\r\n          undefined\r\n        );\r\n      }\r\n    });\r\n  };\r\n  const onListRooms = () => {\r\n    if (listRooms) {\r\n      squadService?.conferences.list((conferences) => {\r\n        setConferenceList(conferences);\r\n        squadService?.chat?.joinGroups(conferences.map((conf) => conf.jid));\r\n      });\r\n      setListRooms(false);\r\n    }\r\n  };\r\n  const onCreateRoom = () => {\r\n    if (createConference) {\r\n      const momentStartDate = moment(\r\n        `${createConference.startDate} ${createConference.startTime}:00`\r\n      );\r\n      const momentFinalDate = moment(momentStartDate)\r\n        .add(createConference.duration.split(\":\")[0], \"hours\")\r\n        .add(createConference.duration.split(\":\")[1], \"minutes\");\r\n      const parsedConference = {\r\n        name: createConference.name,\r\n        waitMod: createConference.mdCheck,\r\n        startDatetime: `${momentStartDate.format(\"DD-MM-YYYY hh:mm:ss\")}`,\r\n        stopDatetime: `${momentFinalDate.format(\"DD-MM-YYYY hh:mm:ss\")}`,\r\n      };\r\n      squadService?.conferences.create(\r\n        parsedConference,\r\n        (createdConference) => {\r\n          const participantList: ConferenceRoomParticipant[] = [];\r\n          if (createdConference?.id) {\r\n            createConference.selectedContact?.forEach((ctc) => {\r\n              participantList.push({\r\n                userUuid: ctc.id,\r\n                description: \"\",\r\n                email: ctc.email,\r\n                name: ctc.name,\r\n                type: ConferenceRoomParticipantType.PARTICIPANT,\r\n                userModerator: false,\r\n              });\r\n            });\r\n            createConference.emailList?.forEach((participant) => {\r\n              participantList.push({\r\n                userUuid: null,\r\n                description: \"\",\r\n                email: participant.email,\r\n                name: participant.name,\r\n                type: ConferenceRoomParticipantType.PARTICIPANT_EXTERNAL,\r\n                userModerator: false,\r\n              });\r\n            });\r\n            squadService?.conferences.addParticipants(\r\n              createdConference.id,\r\n              participantList,\r\n              (s) => {\r\n                if (s) {\r\n                  setCreateConference(undefined);\r\n                  setListRooms(true);\r\n                }\r\n              }\r\n            );\r\n          }\r\n        }\r\n      );\r\n    }\r\n  };\r\n  useEffect(onChatsChange, [chats]);\r\n  useEffect(onNewFavorite, [newFavorite]);\r\n  useEffect(checkSearchMessages, [activeChat.messageLoaded]);\r\n  useEffect(onActiveChatChange, [activeChat]);\r\n  useEffect(onUserDataChange, [changedUserData]);\r\n  useEffect(onUserPasswordChange, [changedUserPassword]);\r\n  useEffect(onChangeStatus, [user.status]);\r\n  useEffect(forwardMessage, [forwardMessageList]);\r\n  useEffect(onSearchContacts, [contactsSearch]);\r\n  useEffect(onSearchContactsOutsideUserContacts, [showModalAddContact]);\r\n  useEffect(onAddingContacts, [toggleAddingContacts]);\r\n  useEffect(onRemovingMember, [removedMember, groupToRemoveContact]);\r\n  useEffect(onLeavingGroup, [memberQuit, groupIdOfLeaveRequest, groupJid]);\r\n  useEffect(onRemovingContact, [removedContact]);\r\n  useEffect(onAddingMembers, [groupToInsertMember, checkedMembers]);\r\n  useEffect(onToggleMemberRole, [toggleMemberRole]);\r\n  useEffect(onChangeGroupData, [changeGroupData]);\r\n  useEffect(onAddingContactOnGroupList, [clickedContact]);\r\n  useEffect(createGroup, [groupToCreate]);\r\n  useEffect(onToggleSidebarMenu, [showChatProfileSidebar]);\r\n  useEffect(onListRooms, [listRooms]);\r\n  useEffect(onCreateRoom, [createConference]);\r\n\r\n  function onRemovingContact() {\r\n    if (removedContact) {\r\n      contacts.forEach((ctc) => {\r\n        if (ctc.id === removedContact.id) {\r\n          if (ctc.added)\r\n            squadService?.contacts.remove(ctc, (success: boolean) => {\r\n              if (success) {\r\n                squadService?.contacts.list((ctcs) => {\r\n                  setContacts(ctcs);\r\n                  setRemovedContact(undefined);\r\n                });\r\n              }\r\n            });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onUserPasswordChange() {\r\n    if (changedUserPassword) {\r\n      squadService?.user.changePassword(changedUserPassword, (password) => {\r\n        if (password) {\r\n          setChangedUserPassword({ oldPassword: \"\", newPassword: \"\" });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onUserDataChange() {\r\n    if (changedUserData) {\r\n      squadService?.user.changeUserData(changedUserData, (chgd) => {\r\n        if (chgd) {\r\n          setUser({\r\n            ...user,\r\n            email: changedUserData.email,\r\n            name: changedUserData.name,\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  function onNewFavorite() {\r\n    if (newFavorite) {\r\n      const newFavoriteLoad = { ...newFavorite };\r\n      squadService?.contacts.setFavorite(newFavorite, (favorite) => {\r\n        if (favorite) {\r\n          setChats(\r\n            chats.map((cht) => {\r\n              if (cht.jid === newFavoriteLoad.jid) {\r\n                cht.favorite = !newFavoriteLoad.favorite;\r\n              }\r\n              return cht;\r\n            })\r\n          );\r\n          setGroups(\r\n            groups.map((grp) => {\r\n              if (grp.jid === newFavoriteLoad.jid) {\r\n                return {\r\n                  ...grp,\r\n                  favorite: !newFavoriteLoad.favorite,\r\n                };\r\n              }\r\n              return grp;\r\n            })\r\n          );\r\n          setContacts(\r\n            contacts.map((ctt) => {\r\n              if (ctt.jid === newFavoriteLoad.jid) {\r\n                return {\r\n                  ...ctt,\r\n                  favorite: !newFavoriteLoad.favorite,\r\n                };\r\n              }\r\n              return ctt;\r\n            })\r\n          );\r\n        }\r\n      });\r\n      setNewFavorite(undefined);\r\n    }\r\n  }\r\n  function chatCommunicatorSubscribe(event: string, data: any) {\r\n    switch (event) {\r\n      case Events.ONLINE:\r\n        squadService?.chats.list((receivedChats) => {\r\n          const chats: IChat[] = [];\r\n          receivedChats.forEach((cht) => {\r\n            if (!chats.find((chat) => chat.id === cht.id)) {\r\n              chats.push(cht);\r\n            }\r\n          });\r\n          setChats(chats);\r\n          //populating groups\r\n          squadService?.groups.list((groups) => {\r\n            setGroups(groups);\r\n            //Joining Groups Rooms in XMPP\r\n            squadService?.chat?.joinGroups(groups.map((group) => group.jid));\r\n          });\r\n          //populating contacts\r\n          squadService?.contacts.list((contacts) => setContacts(contacts));\r\n\r\n          //populating conferences\r\n          setListRooms(true);\r\n          //populating chat's with messages\r\n\r\n          // receivedChats.forEach((chat) => {\r\n          //   squadService?.messages.list(chat, (messages) => {\r\n          //     const chatWithMessages = { ...chat };\r\n          //     chatWithMessages.messages = chatWithMessages.messages.concat(\r\n          //       messages\r\n          //     );\r\n          //     setChats([\r\n          //       ...receivedChats.filter((cht) => chat.id !== cht.id),\r\n          //       chatWithMessages,\r\n          //     ]);\r\n          //   });\r\n          // });\r\n        });\r\n        break;\r\n      case Events.MESSAGE:\r\n        if (data.fromUser === user.jid) break;\r\n        let find = false;\r\n\r\n        let newChats: IChat[] = [];\r\n        chats.forEach((chat) => {\r\n          if (\r\n            data.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            data.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            find = true;\r\n            if (!chat.messages.filter((msg) => msg.id === data.id)[0])\r\n              chat.messages.push(data);\r\n            if (chat.id === activeChat.id) {\r\n              let chatTemporary = { ...chat };\r\n              setActiveChat(chatTemporary);\r\n            } else {\r\n              chat.unRead++;\r\n            }\r\n            newChats.unshift(chat);\r\n          } else {\r\n            newChats.push(chat);\r\n          }\r\n        });\r\n\r\n        if (!find) {\r\n          \r\n          let newChat: IChat = {} as IChat;\r\n          squadService?.contacts.list((listContacts) => {\r\n            listContacts.forEach((c) => {\r\n            if (\r\n              data.fromUser.split(\"@\")[0] === c.jid.split(\"@\")[0] ||\r\n              data.toUser.split(\"@\")[0] === c.jid.split(\"@\")[0]\r\n            ){\r\n              if (c.jid === data.fromUser) {\r\n                find = true;\r\n                newChat = {\r\n                  id: c.id,\r\n                  jid: c.jid,\r\n                  name: c.name,\r\n                  profilePicture: c.profilePicture,\r\n                  status: c.status,\r\n                  unRead: 1,\r\n                  chatType: ChatType.USER,\r\n                  inputMessage: \"\",\r\n                  isTyping: false,\r\n                  messages: [],\r\n                  favorite: c.favorite,\r\n                  added: c.added,\r\n                };\r\n                newChat.messages.push(data);\r\n                newChats.unshift(newChat);\r\n              }\r\n            }\r\n            });\r\n          });\r\n        }\r\n\r\n        if (!find) {\r\n          let newChat: IChat = {} as IChat;\r\n\r\n          squadService?.groups.list((listGroups) => {\r\n            listGroups.forEach((g) => {\r\n              if (\r\n                data.fromUser.split(\"@\")[0] === g.jid.split(\"@\")[0] ||\r\n                data.toUser.split(\"@\")[0] === g.jid.split(\"@\")[0]\r\n              ){\r\n              if (g.jid === data.fromUser) {\r\n                find = true;\r\n                newChat = {\r\n                  id: g.groupId,\r\n                  jid: g.jid,\r\n                  name: g.name,\r\n                  profilePicture: g.profilePicture,\r\n                  attachedFileList: undefined,\r\n                  conferenceRoomParticipants: undefined,\r\n                  department: undefined,\r\n                  email: undefined,\r\n                  groupId: g.groupId,\r\n                  members: g.members,\r\n                  messageLoaded: undefined,\r\n                  userDescription: undefined,\r\n                  status: undefined,\r\n                  unRead: 1,\r\n                  chatType: ChatType.GROUP,\r\n                  inputMessage: \"\",\r\n                  isTyping: false,\r\n                  messages: [],\r\n                  favorite: g.favorite,\r\n                  added: g.added,\r\n                };\r\n                newChat.messages.push(data);\r\n                newChats.unshift(newChat);\r\n              }\r\n            }\r\n            });\r\n          });\r\n        }\r\n\r\n        setChats(newChats);\r\n\r\n        break;\r\n      case Events.RECEIVED:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.messages.find((msg) => msg.id === data.id))\r\n              chat.messages = chat.messages.map((message) => {\r\n                message.deliverStatus = DeliverStatus.DELIVERED;\r\n                return message;\r\n              });\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.DISPLAYED:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.messages.find((msg) => msg.id === data.id))\r\n              chat.messages = chat.messages.map((message) => {\r\n                message.readStatus = ReadStatus.READ;\r\n                return message;\r\n              });\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.COMPOSING:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.jid === data) {\r\n              chat.isTyping = true;\r\n              if (activeChat.jid === data) setActiveChat(chat);\r\n              deleteTypingTimeout(chat.jid);\r\n              setTypingTimeout(chat.jid);\r\n            }\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.ACTIVE:\r\n        setChats(\r\n          chats.map((chat) => {\r\n            if (chat.jid === data) {\r\n              chat.isTyping = false;\r\n              if (activeChat.jid === data) {\r\n                let chatUpdate = { ...chat };\r\n                setActiveChat(chatUpdate);\r\n              }\r\n              deleteTypingTimeout(chat.jid);\r\n            }\r\n            return chat;\r\n          })\r\n        );\r\n        break;\r\n      case Events.PRESENCE:\r\n        setChats(\r\n          chats.map((cht) => {\r\n            if(cht.jid && data.from){\r\n              if(\r\n                cht.jid === data.from.split(\"/\")[0] &&\r\n                !cht.jid.includes(\"@conference.\")\r\n              ) {\r\n                cht.status = data.status;\r\n              }  \r\n            }    \r\n            return cht;\r\n          })\r\n        );\r\n        setContacts(\r\n          contacts.map((ctc) => {\r\n            if(ctc.jid && data.from){\r\n              if (\r\n                ctc.jid === data.from.split(\"/\")[0] &&\r\n                !ctc.jid.includes(\"@conference.\")\r\n              ) {\r\n                ctc.status = data.status;\r\n              }\r\n            }\r\n            return ctc;\r\n          })\r\n        );\r\n        break;\r\n        \r\n   \r\n        case Events.SEND_EVENT:\r\n        const event = data as IMessage;\r\n        let finded;\r\n        let newChat: IChat[] = [];\r\n        chats.forEach((chat) => {\r\n          if (\r\n            event.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            event.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            finded = true;\r\n            if (!chat.messages.filter((msg) => msg.id === event.id)[0])\r\n              chat.messages.push(event);\r\n            if (chat.id === activeChat.id) {\r\n              let chatTemporary = { ...chat };\r\n              setActiveChat(chatTemporary);\r\n            } else {\r\n              chat.unRead++;\r\n            }\r\n            newChat.unshift(chat);\r\n          } else {\r\n            newChat.push(chat);\r\n          }\r\n        });\r\n        if (!finded) {\r\n          groups.forEach((grp) => {\r\n            if (\r\n              event.fromUser.split(\"@\")[0] === grp.jid.split(\"@\")[0] ||\r\n              event.toUser.split(\"@\")[0] === grp.jid.split(\"@\")[0]\r\n            ) {\r\n              finded = true;\r\n              let groupToBeInserted: IChat = {\r\n                added: grp.added,\r\n                chatType: ChatType.GROUP,\r\n                favorite: grp.favorite,\r\n                id: grp.groupId,\r\n                inputMessage: \"\",\r\n                isTyping: false,\r\n                jid: grp.jid,\r\n                messages: [event],\r\n                name: grp.name,\r\n                unRead: 0,\r\n                attachedFileList: undefined,\r\n                department: undefined,\r\n                email: undefined,\r\n                groupId: grp.groupId,\r\n                members: grp.members,\r\n                messageLoaded: undefined,\r\n                profilePicture: grp.profilePicture,\r\n                status: undefined,\r\n                userDescription: grp.description,\r\n              };\r\n              newChat.unshift(groupToBeInserted);\r\n              setActiveChat(groupToBeInserted);\r\n            }\r\n          });\r\n        }\r\n        if (!finded) {\r\n          squadService?.groups.list((grps) => {\r\n            setGroups(grps);\r\n            grps.forEach((grp) => {\r\n              if (\r\n                event.fromUser.split(\"@\")[0] === grp.jid.split(\"@\")[0] ||\r\n                event.toUser.split(\"@\")[0] === grp.jid.split(\"@\")[0]\r\n              ) {\r\n                finded = true;\r\n                let groupToBeInserted: IChat = {\r\n                  added: grp.added,\r\n                  chatType: ChatType.GROUP,\r\n                  favorite: grp.favorite,\r\n                  id: grp.groupId,\r\n                  inputMessage: \"\",\r\n                  isTyping: false,\r\n                  jid: grp.jid,\r\n                  messages: [event],\r\n                  name: grp.name,\r\n                  unRead: 1,\r\n                  attachedFileList: undefined,\r\n                  department: undefined,\r\n                  email: undefined,\r\n                  groupId: grp.groupId,\r\n                  members: grp.members,\r\n                  messageLoaded: undefined,\r\n                  profilePicture: grp.profilePicture,\r\n                  status: undefined,\r\n                  userDescription: grp.description,\r\n                };\r\n                newChat.unshift(groupToBeInserted);\r\n              }\r\n            });\r\n          });\r\n        }\r\n        setChats(newChat);\r\n        if (event.eventId === 6 || event.eventId === 2) {\r\n          refreshMembers(event);\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  const refreshMembers = (event: IMessage) => {\r\n    squadService?.groups.list((grps) => {\r\n      setGroups(grps);\r\n      setChats(\r\n        chats.map((chat) => {\r\n          if (\r\n            event.fromUser.split(\"@\")[0] === chat.jid.split(\"@\")[0] ||\r\n            event.toUser.split(\"@\")[0] === chat.jid.split(\"@\")[0]\r\n          ) {\r\n            chat.members = grps.find((grp) => grp.groupId === chat.id)?.members;\r\n            if (chat.id === activeChat.id) {\r\n              setActiveChat(chat);\r\n            }\r\n          }\r\n          return chat;\r\n        })\r\n      );\r\n    });\r\n  };\r\n\r\n  const deleteTypingTimeout = (jid: string) => {\r\n    clearTimeout(typingTimeout.get(jid)?.timeout || setTimeout(() => {}, 1));\r\n    typingTimeout.delete(jid);\r\n  };\r\n  const setTypingTimeout = (jid: string) => {\r\n    const timeoutData: TypingTimeoutData = {\r\n      msgStr: \"\",\r\n      timeout: setTimeout(() => {\r\n        setChats(\r\n          chats.map((cht) => {\r\n            if (cht.jid === jid) {\r\n              cht.isTyping = false;\r\n              if (activeChat.jid === jid) setActiveChat(cht);\r\n            }\r\n            return cht;\r\n          })\r\n        );\r\n      }, 20000),\r\n    };\r\n    typingTimeout.set(jid, timeoutData);\r\n  };\r\n\r\n  squadService?.updateChatSubscribeFuncition(chatCommunicatorSubscribe);\r\n  // Comentado para evitar warnings no console enquanto não é usado\r\n  // function createGroup(group: INewGroup, callback: CreateGroupCallback) {\r\n  //   squadService?.groups.create(group, (iGroup: IGroup) => {\r\n  //     squadService?.groups.list((groups) => {\r\n  //       setGroups(groups);\r\n  //       callback(true);\r\n  //     });\r\n  //   });\r\n  // }\r\n\r\n  function sendMessage(\r\n    chat: IChat,\r\n    message: string,\r\n    callback: SendMessageCallback\r\n  ) {\r\n    squadService?.chat?.chat.sendMessage(\r\n      chat.jid,\r\n      chat.jid.includes(\"@conference.\")\r\n        ? XMPPChatType.GROUPCHAT\r\n        : XMPPChatType.CHAT,\r\n      message,\r\n      callback\r\n    );\r\n  }\r\n\r\n  useEffect(init, []);\r\n\r\n  return <></>;\r\n};\r\n\r\nexport default SquadCommunicator;\r\n"]},"metadata":{},"sourceType":"module"}