{"ast":null,"code":"import React,{useEffect}from\"react\";import{motion}from\"framer-motion\";import{Button}from\"reactstrap\";import{useCall}from\"./../contexts/CallContext\";import CallStatus from\"../enuns/CallStatus\";import ReactImageFallback from\"react-image-fallback\";import defaultAvatar from\"../assets/images/default.png\";import{useContact}from\"../contexts/ContactContext\";import{useGroup}from\"../contexts/GroupContext\";import{height,width}from\"../helpers/windowSize\";var audio=new Audio();var IncomingCall=function IncomingCall(){var _currentCall$callerNa;var _useCall=useCall(),show=_useCall.show,setShow=_useCall.setShow,currentCalls=_useCall.currentCalls;var _useContact=useContact(),openContact=_useContact.openContact;var _useGroup=useGroup(),openGroup=_useGroup.openGroup;var currentCall=Array.from(currentCalls.values()).find(function(call){return call.callStatus===CallStatus.RINGING;});var open=function open(){setShow(true);};var close=function close(){setShow(false);};var acceptCall=function acceptCall(){var video=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(currentCall&&currentCall.accept){if(currentCall.isGroup){openGroup(currentCall.callerObject);}else{openContact(currentCall.callerObject);}currentCall.accept(video);close();}};var rejectCall=function rejectCall(){if(currentCall&&currentCall.endCall){currentCall.endCall();}};var init=function init(){var callRinging=Array.from(currentCalls.values()).find(function(call){return call.callStatus===CallStatus.RINGING;});if(callRinging){open();}if(!callRinging){close();}};useEffect(init,[currentCalls]);if(!show)return/*#__PURE__*/React.createElement(React.Fragment,null);return/*#__PURE__*/React.createElement(motion.div,{initial:{top:\"-150px\"},animate:{top:\"30px\"},transition:{duration:1},drag:true,dragConstraints:{top:(height()-210)*-1,bottom:0,left:(width()-260)*-1,right:0},style:{position:\"fixed\",bottom:\"30px\",right:\"30px\",border:\"4px solid #ffffff\",backgroundColor:\"rgba(255,255,255,.7)\",width:\"200px\",height:\"150px\",zIndex:100,borderRadius:\"3px\",boxShadow:\"0 5px 5px 5px rgba(0,0,0,0.03)\"}},/*#__PURE__*/React.createElement(\"audio\",{src:require(\"../assets/audio/ringing.mp3\"),autoPlay:true,hidden:true}),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",flexDirection:\"column\",height:\"60%\"}},(currentCall===null||currentCall===void 0?void 0:currentCall.callerProfilePicture)?/*#__PURE__*/React.createElement(\"div\",{className:\"mr-3\"},/*#__PURE__*/React.createElement(ReactImageFallback,{src:currentCall===null||currentCall===void 0?void 0:currentCall.callerProfilePicture,style:{maxHeight:\"40px\",maxWidth:\"40px\"},fallbackImage:defaultAvatar,className:\"rounded-circle avatar-lg img-thumbnail\",alt:\"chatvia\"})):/*#__PURE__*/React.createElement(\"div\",{className:\"chat-user-img align-self-center mr-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"avatar-xs\"},/*#__PURE__*/React.createElement(\"span\",{className:\"avatar-title rounded-circle bg-soft-primary text-primary\"},(currentCall===null||currentCall===void 0?void 0:(_currentCall$callerNa=currentCall.callerName)===null||_currentCall$callerNa===void 0?void 0:_currentCall$callerNa.trim().charAt(0))||\"C\"))),/*#__PURE__*/React.createElement(\"h6\",null,(currentCall===null||currentCall===void 0?void 0:currentCall.callerName)||(currentCall===null||currentCall===void 0?void 0:currentCall.callerNumber))),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",height:\"40%\"}},/*#__PURE__*/React.createElement(Button,{type:\"button\",color:\"none\",onClick:function onClick(){return acceptCall();},className:\"nav-btn user-profile-show bg-primary mr-2\",style:{color:\"#ffffff\"}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-phone-line\"})),/*#__PURE__*/React.createElement(Button,{type:\"button\",color:\"none\",onClick:function onClick(){return acceptCall(true);},className:\"nav-btn user-profile-show bg-success\",style:{color:\"#ffffff\"}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-vidicon-line\"})),/*#__PURE__*/React.createElement(Button,{type:\"button\",color:\"none\",onClick:function onClick(){return rejectCall();},className:\"nav-btn user-profile-show bg-danger ml-2\",style:{color:\"#ffffff\"}},/*#__PURE__*/React.createElement(\"i\",{className:\"ri-close-line\"}))));};export default IncomingCall;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/components/IncomingCall.tsx"],"names":["React","useEffect","motion","Button","useCall","CallStatus","ReactImageFallback","defaultAvatar","useContact","useGroup","height","width","audio","Audio","IncomingCall","show","setShow","currentCalls","openContact","openGroup","currentCall","Array","from","values","find","call","callStatus","RINGING","open","close","acceptCall","video","accept","isGroup","callerObject","rejectCall","endCall","init","callRinging","top","duration","bottom","left","right","position","border","backgroundColor","zIndex","borderRadius","boxShadow","require","display","justifyContent","alignItems","flexDirection","callerProfilePicture","maxHeight","maxWidth","callerName","trim","charAt","callerNumber","color"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport { Button } from \"reactstrap\";\r\nimport { useCall } from \"./../contexts/CallContext\";\r\nimport CallStatus from \"../enuns/CallStatus\";\r\nimport ReactImageFallback from \"react-image-fallback\";\r\nimport defaultAvatar from \"../assets/images/default.png\";\r\nimport { useContact } from \"../contexts/ContactContext\";\r\nimport IGroup from \"../alias/IGroup\";\r\nimport IContact from \"../alias/IContact\";\r\nimport { useGroup } from \"../contexts/GroupContext\";\r\nimport { height, width } from \"../helpers/windowSize\";\r\n\r\nvar audio = new Audio();\r\n\r\nconst IncomingCall: React.FC = () => {\r\n  const { show, setShow, currentCalls } = useCall();\r\n  const { openContact } = useContact();\r\n  const { openGroup } = useGroup();\r\n\r\n  const currentCall = Array.from(currentCalls.values()).find(\r\n    (call) => call.callStatus === CallStatus.RINGING\r\n  );\r\n  const open = () => {\r\n    setShow(true);\r\n  };\r\n\r\n  const close = () => {\r\n    setShow(false);\r\n  };\r\n\r\n  const acceptCall = (video = false) => {\r\n    if (currentCall && currentCall.accept) {\r\n      if (currentCall.isGroup) {\r\n        openGroup(currentCall.callerObject as IGroup);\r\n      } else {\r\n        openContact(currentCall.callerObject as IContact);\r\n      }\r\n      currentCall.accept(video);\r\n      close();\r\n    }\r\n  };\r\n\r\n  const rejectCall = () => {\r\n    if (currentCall && currentCall.endCall) {\r\n      currentCall.endCall();\r\n    }\r\n  };\r\n\r\n  const init = () => {\r\n    const callRinging = Array.from(currentCalls.values()).find(\r\n      (call) => call.callStatus === CallStatus.RINGING\r\n    );\r\n    if (callRinging) {\r\n      open();\r\n    }\r\n\r\n    if (!callRinging) {\r\n      close();\r\n    }\r\n  };\r\n\r\n  useEffect(init, [currentCalls]);\r\n\r\n  if (!show) return <></>;\r\n  return (\r\n    <motion.div\r\n      initial={{ top: \"-150px\" }}\r\n      animate={{ top: \"30px\" }}\r\n      transition={{ duration: 1 }}\r\n      drag\r\n      dragConstraints={{\r\n        top: (height() - 210) * -1,\r\n        bottom: 0,\r\n        left: (width() - 260) * -1,\r\n        right: 0,\r\n      }}\r\n      style={{\r\n        position: \"fixed\",\r\n        bottom: \"30px\",\r\n        right: \"30px\",\r\n        border: \"4px solid #ffffff\",\r\n        backgroundColor: \"rgba(255,255,255,.7)\",\r\n        width: \"200px\",\r\n        height: \"150px\",\r\n        zIndex: 100,\r\n        borderRadius: \"3px\",\r\n        boxShadow: \"0 5px 5px 5px rgba(0,0,0,0.03)\",\r\n      }}\r\n    >\r\n      <audio\r\n        src={require(\"../assets/audio/ringing.mp3\")}\r\n        autoPlay={true}\r\n        hidden={true}\r\n      />\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          justifyContent: \"center\",\r\n          alignItems: \"center\",\r\n          flexDirection: \"column\",\r\n          height: \"60%\",\r\n        }}\r\n      >\r\n        {currentCall?.callerProfilePicture ? (\r\n          <div className=\"mr-3\">\r\n            <ReactImageFallback\r\n              src={currentCall?.callerProfilePicture}\r\n              style={{ maxHeight: \"40px\", maxWidth: \"40px\" }}\r\n              fallbackImage={defaultAvatar}\r\n              className=\"rounded-circle avatar-lg img-thumbnail\"\r\n              alt=\"chatvia\"\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div className=\"chat-user-img align-self-center mr-3\">\r\n            <div className=\"avatar-xs\">\r\n              <span className=\"avatar-title rounded-circle bg-soft-primary text-primary\">\r\n                {currentCall?.callerName?.trim().charAt(0) || \"C\"}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <h6>{currentCall?.callerName || currentCall?.callerNumber}</h6>\r\n      </div>\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          justifyContent: \"center\",\r\n          alignItems: \"center\",\r\n          height: \"40%\",\r\n        }}\r\n      >\r\n        <Button\r\n          type=\"button\"\r\n          color=\"none\"\r\n          onClick={() => acceptCall()}\r\n          className=\"nav-btn user-profile-show bg-primary mr-2\"\r\n          style={{\r\n            color: \"#ffffff\",\r\n          }}\r\n        >\r\n          <i className=\"ri-phone-line\"></i>\r\n        </Button>\r\n        <Button\r\n          type=\"button\"\r\n          color=\"none\"\r\n          onClick={() => acceptCall(true)}\r\n          className=\"nav-btn user-profile-show bg-success\"\r\n          style={{\r\n            color: \"#ffffff\",\r\n          }}\r\n        >\r\n          <i className=\"ri-vidicon-line\"></i>\r\n        </Button>\r\n        <Button\r\n          type=\"button\"\r\n          color=\"none\"\r\n          onClick={() => rejectCall()}\r\n          className=\"nav-btn user-profile-show bg-danger ml-2\"\r\n          style={{\r\n            color: \"#ffffff\",\r\n          }}\r\n        >\r\n          <i className=\"ri-close-line\"></i>\r\n        </Button>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default IncomingCall;\r\n"]},"metadata":{},"sourceType":"module"}