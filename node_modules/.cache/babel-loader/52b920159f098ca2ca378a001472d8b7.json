{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Digivox\\\\dev\\\\Digivox\\\\Refatoracao\\\\squad\\\\src\\\\components\\\\VideoBox.tsx\";\nimport React, { useState } from \"react\";\nimport { useCall } from \"../contexts/CallContext\";\nimport { useChat } from \"../contexts/ChatContext\";\nimport { tagsRange } from \"../services/voice/voicecommunicator\";\nimport { motion } from \"framer-motion\";\nimport { height, width } from \"../helpers/windowSize\";\nimport { Button } from \"reactstrap\";\n\nconst VideoBox = () => {\n  const [widthBox, setWidthBox] = useState(400);\n  const [pictureInPictureEnabled, setPictureInPictureEnabled] = useState(false);\n  const [pictureInPictureTag, setPictureInPictureTag] = useState(undefined);\n  const {\n    activeChat\n  } = useChat();\n  const {\n    currentCalls\n  } = useCall();\n  const currentCall = Array.from(currentCalls.values()).find(call => {\n    var _call$callerObject;\n\n    return ((_call$callerObject = call.callerObject) === null || _call$callerObject === void 0 ? void 0 : _call$callerObject.jid) === activeChat.jid;\n  });\n\n  const togglePictureInPicture = tagId => {\n    const doc = document;\n\n    if (!doc.pictureInPictureElement && doc.pictureInPictureEnabled) {\n      const video = document.querySelector(`#remote-stream-${tagId}`);\n      video === null || video === void 0 ? void 0 : video.requestPictureInPicture().catch(error => {});\n    } else {\n      if (doc.pictureInPictureEnabled) {\n        document.exitPictureInPicture().catch(error => {});\n      }\n    }\n  };\n\n  const listenPictureInPictureChanges = () => {\n    tagsRange.forEach(tagId => {\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\n\n      if (videoEl && !videoEl.disablePictureInPicture) {\n        videoEl.addEventListener(\"enterpictureinpicture\", () => {\n          // Video entered Picture-in-Picture mode.\n          setPictureInPictureEnabled(true);\n          setPictureInPictureTag(tagId);\n        });\n        videoEl.addEventListener(\"leavepictureinpicture\", () => {\n          // Video left Picture-in-Picture mode.\n          setPictureInPictureEnabled(false);\n          setPictureInPictureTag(undefined);\n        });\n      }\n    });\n  };\n\n  const removeListeners = () => {\n    tagsRange.forEach(tagId => {\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\n\n      if (videoEl) {\n        videoEl.removeEventListener(\"enterpictureinpicture\", () => {});\n        videoEl.removeEventListener(\"leavepictureinpicture\", () => {});\n      }\n    });\n  };\n\n  const isVisible = tagId => (currentCall === null || currentCall === void 0 ? void 0 : currentCall.tagId) === `remote-stream-${tagId}` && (currentCall.receivingVideo || currentCall.sendingVideo) && pictureInPictureTag !== tagId;\n\n  removeListeners();\n  listenPictureInPictureChanges();\n  const boxVideo = {\n    position: \"fixed\",\n    right: \"50px\",\n    bottom: \"50px\",\n    zIndex: 100,\n    maxWidth: `${widthBox}px`,\n    borderRadius: \"2px\",\n    backgroundColor: \"#000000\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  };\n  const video = {\n    position: \"relative\",\n    width: `${widthBox}px`\n  };\n  const optionBox = {\n    position: \"absolute\",\n    zIndex: 10,\n    top: \"2%\",\n    right: \"2%\",\n    color: \"#ffffff\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  };\n  const option = {\n    cursor: \"pointer\",\n    marginLeft: \"5px\",\n    fontSize: \"18px\",\n    padding: \"5px\"\n  };\n  const buttonBox = {\n    position: \"absolute\",\n    zIndex: 10,\n    width: \"100%\",\n    bottom: 0,\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  };\n  return /*#__PURE__*/React.createElement(React.Fragment, null, tagsRange.map(tagId => /*#__PURE__*/React.createElement(motion.div, {\n    drag: true,\n    dragConstraints: {\n      top: (height() - 300) * -1,\n      bottom: 0,\n      left: (width() - 400) * -1,\n      right: 0\n    },\n    style: { ...boxVideo,\n      display: isVisible(tagId) ? boxVideo.display : \"none\"\n    },\n    key: `remote-stream-${tagId}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: optionBox,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: { ...option,\n      fontSize: \"14px\"\n    },\n    onClick: () => setWidthBox(widthBox + 100),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-add-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    style: { ...option,\n      fontSize: \"14px\"\n    },\n    onClick: () => setWidthBox(widthBox - 100),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-subtract-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 15\n    }\n  })), document.pictureInPictureEnabled ? /*#__PURE__*/React.createElement(React.Fragment, null, !pictureInPictureEnabled && /*#__PURE__*/React.createElement(\"div\", {\n    style: option,\n    onClick: () => togglePictureInPicture(tagId),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-picture-in-picture-2-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 21\n    }\n  })), pictureInPictureTag === tagId && /*#__PURE__*/React.createElement(\"div\", {\n    style: option,\n    onClick: () => togglePictureInPicture(tagId),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-picture-in-picture-exit-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 21\n    }\n  }))) : null, /*#__PURE__*/React.createElement(\"div\", {\n    style: option,\n    onClick: () => (currentCall === null || currentCall === void 0 ? void 0 : currentCall.endCall) && currentCall.endCall(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-close-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    style: buttonBox,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: \"button\",\n    color: \"none\",\n    onClick: () => (currentCall === null || currentCall === void 0 ? void 0 : currentCall.endCall) && currentCall.endCall(),\n    className: \"nav-btn user-profile-show btn-head-conference red\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-phone-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    type: \"button\",\n    color: \"none\",\n    onClick: () => {\n      if (currentCall === null || currentCall === void 0 ? void 0 : currentCall.micMuted) currentCall === null || currentCall === void 0 ? void 0 : currentCall.unMuteMic();else currentCall === null || currentCall === void 0 ? void 0 : currentCall.muteMic();\n    },\n    className: `nav-btn user-profile-show btn-head-conference ${(currentCall === null || currentCall === void 0 ? void 0 : currentCall.micMuted) ? \"red\" : \"white\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 13\n    }\n  }, !(currentCall === null || currentCall === void 0 ? void 0 : currentCall.micMuted) ? /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-mic-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 17\n    }\n  }) : /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-mic-off-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    type: \"button\",\n    color: \"none\",\n    onClick: () => {\n      if (currentCall === null || currentCall === void 0 ? void 0 : currentCall.hold) currentCall === null || currentCall === void 0 ? void 0 : currentCall.unHoldCall();else currentCall === null || currentCall === void 0 ? void 0 : currentCall.holdCall();\n    },\n    className: `nav-btn user-profile-show btn-head-conference ${(currentCall === null || currentCall === void 0 ? void 0 : currentCall.hold) ? \"red\" : \"white\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 13\n    }\n  }, (currentCall === null || currentCall === void 0 ? void 0 : currentCall.hold) ? /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-play-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 17\n    }\n  }) : /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-pause-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    type: \"button\",\n    color: \"none\",\n    onClick: () => {\n      if (currentCall === null || currentCall === void 0 ? void 0 : currentCall.sendingVideo) {\n        if (currentCall === null || currentCall === void 0 ? void 0 : currentCall.videoMuted) currentCall === null || currentCall === void 0 ? void 0 : currentCall.enableCam();else currentCall === null || currentCall === void 0 ? void 0 : currentCall.disableCam();\n      } else {\n        alert(\"Mudança de tipo de chamada ainda não está disponivel :(\");\n      }\n    },\n    className: `nav-btn user-profile-show btn-head-conference white ${(currentCall === null || currentCall === void 0 ? void 0 : currentCall.videoMuted) ? \"red\" : \"white\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 13\n    }\n  }, (currentCall === null || currentCall === void 0 ? void 0 : currentCall.videoMuted) ? /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-camera-off-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 17\n    }\n  }) : /*#__PURE__*/React.createElement(\"i\", {\n    className: \"ri-camera-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 17\n    }\n  }))), /*#__PURE__*/React.createElement(\"video\", {\n    style: video,\n    id: `remote-stream-${tagId}`,\n    hidden: !isVisible(tagId),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport default VideoBox;","map":{"version":3,"sources":["C:/Users/Digivox/dev/Digivox/Refatoracao/squad/src/components/VideoBox.tsx"],"names":["React","useState","useCall","useChat","tagsRange","motion","height","width","Button","VideoBox","widthBox","setWidthBox","pictureInPictureEnabled","setPictureInPictureEnabled","pictureInPictureTag","setPictureInPictureTag","undefined","activeChat","currentCalls","currentCall","Array","from","values","find","call","callerObject","jid","togglePictureInPicture","tagId","doc","document","pictureInPictureElement","video","querySelector","requestPictureInPicture","catch","error","exitPictureInPicture","listenPictureInPictureChanges","forEach","videoEl","disablePictureInPicture","addEventListener","removeListeners","removeEventListener","isVisible","receivingVideo","sendingVideo","boxVideo","position","right","bottom","zIndex","maxWidth","borderRadius","backgroundColor","display","justifyContent","alignItems","optionBox","top","color","option","cursor","marginLeft","fontSize","padding","buttonBox","map","left","endCall","micMuted","unMuteMic","muteMic","hold","unHoldCall","holdCall","videoMuted","enableCam","disableCam","alert"],"mappings":"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","sourcesContent":["import React, { CSSProperties, useState } from \"react\";\r\nimport { useCall } from \"../contexts/CallContext\";\r\nimport { useChat } from \"../contexts/ChatContext\";\r\nimport { tagsRange } from \"../services/voice/voicecommunicator\";\r\nimport { motion } from \"framer-motion\";\r\nimport { height, width } from \"../helpers/windowSize\";\r\nimport { Button } from \"reactstrap\";\r\n\r\ninterface DocumentPictureInPicture extends Document {\r\n  pictureInPictureEnabled: boolean;\r\n  pictureInPictureElement: HTMLVideoElementPictureInPicture;\r\n  exitPictureInPicture(): Promise<any>;\r\n}\r\n\r\ninterface HTMLVideoElementPictureInPicture extends HTMLVideoElement {\r\n  requestPictureInPicture(): Promise<any>;\r\n  disablePictureInPicture: any;\r\n}\r\n\r\nconst VideoBox: React.FC = () => {\r\n  const [widthBox, setWidthBox] = useState(400);\r\n  const [\r\n    pictureInPictureEnabled,\r\n    setPictureInPictureEnabled,\r\n  ] = useState<boolean>(false);\r\n\r\n  const [pictureInPictureTag, setPictureInPictureTag] = useState<\r\n    number | undefined\r\n  >(undefined);\r\n\r\n  const { activeChat } = useChat();\r\n  const { currentCalls } = useCall();\r\n  const currentCall = Array.from(currentCalls.values()).find(\r\n    (call) => call.callerObject?.jid === activeChat.jid\r\n  );\r\n\r\n  const togglePictureInPicture = (tagId: number) => {\r\n    const doc = document as DocumentPictureInPicture;\r\n    if (!doc.pictureInPictureElement && doc.pictureInPictureEnabled) {\r\n      const video = document.querySelector(\r\n        `#remote-stream-${tagId}`\r\n      ) as HTMLVideoElementPictureInPicture;\r\n      video?.requestPictureInPicture().catch((error) => {});\r\n    } else {\r\n      if (doc.pictureInPictureEnabled) {\r\n        (document as DocumentPictureInPicture)\r\n          .exitPictureInPicture()\r\n          .catch((error) => {});\r\n      }\r\n    }\r\n  };\r\n\r\n  const listenPictureInPictureChanges = () => {\r\n    tagsRange.forEach((tagId) => {\r\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\r\n      if (\r\n        videoEl &&\r\n        !(videoEl as HTMLVideoElementPictureInPicture).disablePictureInPicture\r\n      ) {\r\n        videoEl.addEventListener(\"enterpictureinpicture\", () => {\r\n          // Video entered Picture-in-Picture mode.\r\n          setPictureInPictureEnabled(true);\r\n          setPictureInPictureTag(tagId);\r\n        });\r\n        videoEl.addEventListener(\"leavepictureinpicture\", () => {\r\n          // Video left Picture-in-Picture mode.\r\n          setPictureInPictureEnabled(false);\r\n          setPictureInPictureTag(undefined);\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  const removeListeners = () => {\r\n    tagsRange.forEach((tagId) => {\r\n      const videoEl = document.querySelector(`#remote-stream-${tagId}`);\r\n      if (videoEl) {\r\n        videoEl.removeEventListener(\"enterpictureinpicture\", () => {});\r\n        videoEl.removeEventListener(\"leavepictureinpicture\", () => {});\r\n      }\r\n    });\r\n  };\r\n\r\n  const isVisible = (tagId: number) =>\r\n    currentCall?.tagId === `remote-stream-${tagId}` &&\r\n    (currentCall.receivingVideo || currentCall.sendingVideo) &&\r\n    pictureInPictureTag !== tagId;\r\n\r\n  removeListeners();\r\n  listenPictureInPictureChanges();\r\n\r\n  const boxVideo: CSSProperties = {\r\n    position: \"fixed\",\r\n    right: \"50px\",\r\n    bottom: \"50px\",\r\n    zIndex: 100,\r\n    maxWidth: `${widthBox}px`,\r\n    borderRadius: \"2px\",\r\n    backgroundColor: \"#000000\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  };\r\n\r\n  const video: CSSProperties = {\r\n    position: \"relative\",\r\n    width: `${widthBox}px`,\r\n  };\r\n\r\n  const optionBox: CSSProperties = {\r\n    position: \"absolute\",\r\n    zIndex: 10,\r\n    top: \"2%\",\r\n    right: \"2%\",\r\n    color: \"#ffffff\",\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  };\r\n\r\n  const option: CSSProperties = {\r\n    cursor: \"pointer\",\r\n    marginLeft: \"5px\",\r\n    fontSize: \"18px\",\r\n    padding: \"5px\",\r\n  };\r\n\r\n  const buttonBox: CSSProperties = {\r\n    position: \"absolute\",\r\n    zIndex: 10,\r\n    width: \"100%\",\r\n    bottom: 0,\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {tagsRange.map((tagId) => (\r\n        <motion.div\r\n          drag\r\n          dragConstraints={{\r\n            top: (height() - 300) * -1,\r\n            bottom: 0,\r\n            left: (width() - 400) * -1,\r\n            right: 0,\r\n          }}\r\n          style={{\r\n            ...boxVideo,\r\n            display: isVisible(tagId) ? boxVideo.display : \"none\",\r\n          }}\r\n          key={`remote-stream-${tagId}`}\r\n        >\r\n          <div style={optionBox}>\r\n            <div\r\n              style={{ ...option, fontSize: \"14px\" }}\r\n              onClick={() => setWidthBox(widthBox + 100)}\r\n            >\r\n              <i className=\"ri-add-line\"></i>\r\n            </div>\r\n\r\n            <div\r\n              style={{ ...option, fontSize: \"14px\" }}\r\n              onClick={() => setWidthBox(widthBox - 100)}\r\n            >\r\n              <i className=\"ri-subtract-line\"></i>\r\n            </div>\r\n\r\n            {(document as DocumentPictureInPicture).pictureInPictureEnabled ? (\r\n              <>\r\n                {!pictureInPictureEnabled && (\r\n                  <div\r\n                    style={option}\r\n                    onClick={() => togglePictureInPicture(tagId)}\r\n                  >\r\n                    <i className=\"ri-picture-in-picture-2-line\"></i>\r\n                  </div>\r\n                )}\r\n                {pictureInPictureTag === tagId && (\r\n                  <div\r\n                    style={option}\r\n                    onClick={() => togglePictureInPicture(tagId)}\r\n                  >\r\n                    <i className=\"ri-picture-in-picture-exit-line\"></i>\r\n                  </div>\r\n                )}\r\n              </>\r\n            ) : null}\r\n\r\n            <div\r\n              style={option}\r\n              onClick={() => currentCall?.endCall && currentCall.endCall()}\r\n            >\r\n              <i className=\"ri-close-line\"></i>\r\n            </div>\r\n          </div>\r\n\r\n          <div style={buttonBox}>\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => currentCall?.endCall && currentCall.endCall()}\r\n              className=\"nav-btn user-profile-show btn-head-conference red\"\r\n            >\r\n              <i className=\"ri-phone-line\"></i>\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                if (currentCall?.micMuted) currentCall?.unMuteMic();\r\n                else currentCall?.muteMic();\r\n              }}\r\n              className={`nav-btn user-profile-show btn-head-conference ${\r\n                currentCall?.micMuted ? \"red\" : \"white\"\r\n              }`}\r\n            >\r\n              {!currentCall?.micMuted ? (\r\n                <i className=\"ri-mic-line\"></i>\r\n              ) : (\r\n                <i className=\"ri-mic-off-line\"></i>\r\n              )}\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                if (currentCall?.hold) currentCall?.unHoldCall();\r\n                else currentCall?.holdCall();\r\n              }}\r\n              className={`nav-btn user-profile-show btn-head-conference ${\r\n                currentCall?.hold ? \"red\" : \"white\"\r\n              }`}\r\n            >\r\n              {currentCall?.hold ? (\r\n                <i className=\"ri-play-line\"></i>\r\n              ) : (\r\n                <i className=\"ri-pause-line\"></i>\r\n              )}\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              color=\"none\"\r\n              onClick={() => {\r\n                if (currentCall?.sendingVideo) {\r\n                  if (currentCall?.videoMuted) currentCall?.enableCam();\r\n                  else currentCall?.disableCam();\r\n                } else {\r\n                  alert(\r\n                    \"Mudança de tipo de chamada ainda não está disponivel :(\"\r\n                  );\r\n                }\r\n              }}\r\n              className={`nav-btn user-profile-show btn-head-conference white ${\r\n                currentCall?.videoMuted ? \"red\" : \"white\"\r\n              }`}\r\n            >\r\n              {currentCall?.videoMuted ? (\r\n                <i className=\"ri-camera-off-line\"></i>\r\n              ) : (\r\n                <i className=\"ri-camera-line\"></i>\r\n              )}\r\n            </Button>\r\n          </div>\r\n\r\n          <video\r\n            style={video}\r\n            id={`remote-stream-${tagId}`}\r\n            hidden={!isVisible(tagId)}\r\n          />\r\n        </motion.div>\r\n      ))}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default VideoBox;\r\n"]},"metadata":{},"sourceType":"module"}